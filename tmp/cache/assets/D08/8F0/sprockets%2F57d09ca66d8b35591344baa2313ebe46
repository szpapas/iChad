o: ActiveSupport::Cache::Entry	:@expires_in0:@value{"
mtime"2012-12-01T14:05:08+08:00"content_type"application/javascript"pathname"4$root/app/assets/javascripts/desktop/Notepad.js"	body"t¬/*

This file is part of Ext JS 4

Copyright (c) 2011 Sencha Inc

Contact:  http://www.sencha.com/contact

GNU General Public License Usage
This file may be used under the terms of the GNU General Public License version 3.0 as published by the Free Software Foundation and appearing in the file LICENSE included in the packaging of this file.  Please review the following information to ensure the GNU General Public License version 3.0 requirements will be met: http://www.gnu.org/copyleft/gpl.html.

If you are unsure which license is appropriate for your use, please contact the sales department at http://www.sencha.com/contact.

*/
/*!
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */


Ext.define('MyDesktop.Notepad', {
  extend: 'Ext.ux.desktop.Module',
  requires: [
      'Ext.form.field.HtmlEditor'
  ],
  id:'notepad',
  init : function(){
      this.launcher = {
          text: 'æ™ºæ…§ç‰©è”ç®¡ç†',
          iconCls:'zhwl',
          handler : this.createWindow,
          scope: this
      }
  },

  createWindow : function(){
    var desktop = this.app.getDesktop();
    var win = desktop.getWindow('notepad');
    qjms_id="";
    qjms_name="";
    var tjlx_data = [
     ['0','æŒ‰è®¾å¤‡'],
     ['1','æŒ‰æˆ¿é—´'],
     ['2','æŒ‰è®¾å¤‡ç±»å‹'],
     ['3','æŒ‰æ¥¼å±‚']
    ];

    var tjlx_store = new Ext.data.SimpleStore({
      fields: ['value', 'text'],
      data : tjlx_data
    });
        
    var myStore = new Ext.data.ArrayStore({
        fields: ['name', 'url'], 
        idIndex: 0
    });

    var myData = [
        ['æç¬‘', 'assets/chart48x48.png'], ['åˆ˜äº¦è²', 'assets/grid48x48.png'] ];      
        myStore.loadData(myData);  
        var tpl = new Ext.XTemplate(
        '<tpl for=".">',
        '<div class="thumb-wrap" id="{name}">',
        '<div class="thumb"><img src="{url}" title="{name}11"></div>',   
		'<strong class="x-editable">{name}22</strong>',   
        '<span class="x-editable">{name}</span></div>',
        '</tpl>',
        '<div class="x-clear"></div>'
        );

    
      
	  //  new Ext.DataView({
      //  store: myStore,
      //  singleSelect: true,
      //  overItemCls: 'x-view-over',
      //  tpl: tpl,
      //  autoHeight:true,
      //  overClass:'x-view-over',
      //  itemSelector:'div.thumb-wrap',
      //  emptyText: 'No images to display'          
      //  })


    var win = Ext.getCmp('user_disp_win');
    var ztRender = function(val) {
        if (val == "å…³") {
            return '<span style="color:red;">' + val + '</span>';
        } else if (val == "å¼€") {
            return '<span style="color:blue;">' + val + '</span>';
        } else {
           return '<span style="color:gray;">' + val + '</span>';
        }
        return val;                          
      };
      
    Ext.regModel('ly_model', {
      fields: [
        {name: 'id',    type: 'integer'},
        {name: 'lymc',    type: 'string'}
      ]
    });
    
    var ly_store = Ext.create('Ext.data.Store', {
        id:'ly_store',
        model : 'ly_model',
        proxy: {
          type: 'ajax',
          url : '/desktop/get_zn_ly_grid',
          reader: {
            type: 'json',
            root: 'rows',
            totalProperty: 'results'
          }
        }       
    });
    
      ly_store.load();
      Ext.regModel('lc_model', {
        fields: [
          {name: 'id',    type: 'integer'},
          {name: 'lcmc',    type: 'string'}
        ]
      });
      
      var lc_store = Ext.create('Ext.data.Store', {
          id:'lc_store',
          model : 'lc_model',
          proxy: {
            type: 'ajax',
            url : '/desktop/get_zn_lc_grid',
            //extraParams: {query:title},
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }       
      });
      //lc_store.load();
      Ext.regModel('fj_model', {
        fields: [
          {name: 'id',    type: 'integer'},
          {name: 'fjmc',    type: 'string'}
        ]
      });
      var fj_store = Ext.create('Ext.data.Store', {
          id:'fj_store',
          model : 'fj_model',
          proxy: {
            type: 'ajax',
            url : '/desktop/get_zn_fj_grid',
            //extraParams: {query:title},
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }       
      });
      Ext.regModel('sblx_model', {
        fields: [
          {name: 'id',    type: 'integer'},
          {name: 'lxsm',    type: 'string'}
        ]
      });
      var sblx_store = Ext.create('Ext.data.Store', {
          id:'sblx_store',
          model : 'sblx_model',
          proxy: {
            type: 'ajax',
            url : '/desktop/get_zn_sb_lx_grid',
            //extraParams: {query:title},
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }       
      });
      Ext.regModel('user_model', {
        fields: [
          {name: 'id',    type: 'integer'},
          {name: 'username',    type: 'string'}
        ]
      });
      var user_store = Ext.create('Ext.data.Store', {
          id:'user_store',
          model : 'user_model',
          proxy: {
            type: 'ajax',
            url : '/desktop/get_user_grid',
            //extraParams: {query:title},
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }       
      });
      user_store.load();
      
      
      
      
      Ext.regModel('sb_model', {
        fields: [
          {name: 'sbid',    type: 'integer'},
          {name: 'sbmc',    type: 'string'}
        ]
      });
      var sb_store = Ext.create('Ext.data.Store', {
          id:'sb_store',
          model : 'sb_model',
          proxy: {
            type: 'ajax',
            url : '/desktop/get_user_sb_grid',
            extraParams: {id:currentUser.id},
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }       
      });
      sb_store.load();
      
      Ext.regModel('sb_cz_model', {
        fields: [
          {name: 'czid',    type: 'integer'},
          {name: 'czsm',    type: 'string'}
        ]
      });
      var sb_cz_store = Ext.create('Ext.data.Store', {
          id:'sb_cz_store',
          model : 'sb_cz_model',
          proxy: {
            type: 'ajax',
            url : '/desktop/get_sb_cz_grid',
            //extraParams: {id:currentUser.id},
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }       
      });
      sb_cz_store.load();
      
      
      Ext.regModel('qjms_model', {
        fields: [
          {name: 'id',    type: 'integer'},
          {name: 'msmc',    type: 'string'}
        ]
      });
      var qjms_store = Ext.create('Ext.data.Store', {
          id:'qjms_store',
          model : 'qjms_model',
          proxy: {
            type: 'ajax',
            url : '/desktop/get_qjms_grid',
            extraParams: {query:currentUser.id},
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }       
      });
      qjms_store.load();
      
      function getNodes(node,tf) {
        //éå†æ‰€æœ‰å­èŠ‚ç‚¹
        if (node.childNodes.size() == 0) return;
        node.eachChild(function(n){
          n.data.checked=tf;
          n.updateInfo({checked:tf});
          getNodes(n,tf);
        });
      };
      function get_mlqx_NodesChecked(node) {
        //è·å–ç”¨æˆ·ç›®å½•æƒé™æ ‘
        if (node.childNodes.size() == 0) return;
        node.eachChild(function(n){
              if(n.data.leaf==true){
                  if (n.data.checked==true){
                  if (insert_qx==""){
                    insert_qx= n.data.id 
                  }else{
                    insert_qx=insert_qx+ "$" + n.data.id 
                  }
                };
                };
              get_mlqx_NodesChecked(n);
                });


      };
      function get_cdqx_NodesChecked(node) {
        //è·å–ç”¨æˆ·èœå•æƒé™æ ‘
        if (node.childNodes.size() == 0) return;
        node.eachChild(function(n){
                  if (n.data.checked==true){
                  if (insert_qx==""){
                    insert_qx= n.data.id + ";" + n.data.text + ";1"
                  }else{
                    insert_qx=insert_qx+ "$" + n.data.id + ";" + n.data.text + ";1"
                  }
                };

                get_cdqx_NodesChecked(n);
                });


      };
      function get_parentNode(node){
        if (node.data.parentId=="root"){
        }else
        {
          node.parentNode.data.checked=true;
          node.parentNode.updateInfo({checked:true});
          get_parentNode(node.parentNode);
        }
      };

      var sb_cz_win = function(record,add_new){
        var win = Ext.getCmp('sb_cz_win');
	      Ext.regModel('sbdisp_model', {
	        fields: [
	          {name: 'id',    type: 'integer'},
	          {name: 'lxsm',    type: 'string'},
			  {name: 'img',    type: 'string'}
	        ]
	      });
	      var sbdisp_store = Ext.create('Ext.data.Store', {
	          id:'sbdisp_store',
			  autoLoad: true,
	          model : 'sbdisp_model',
	          proxy: {
	            type: 'ajax',
	            url : '/desktop/get_sb_grid',
	            //extraParams: {query:title},
	            reader: {
	              	type: 'json',
	                root: ''
	            }
	          }       
	      });
		var dataview = Ext.create('Ext.view.View', {
	        deferInitialRefresh: false,
	        store: sbdisp_store,
	        tpl  : Ext.create('Ext.XTemplate',
	            '<tpl for=".">',
					'<div class="thumb-wrap" id="{name}">',
			        	'<div class="thumb"><img src="assets/{img}" title="{lxsm}11"></div>',
	                    //'<strong>{lxsm}</strong>',
						'<span>{lxsm}</span>',
	                    '<span>{lxsm}</span>',
	                '</div>',
	            '</tpl>'
	        ),

	        plugins : [
	            Ext.create('Ext.ux.DataView.Animated', {
	                duration  : 550,
	                idProperty: 'id'
	            })
	        ],
			listeners: {
                itemclick: function(dataview, selections) {
			        var selected = selections[0];

			        if (selected) {
			            this.down('infopanel').loadRecord(selected);
			        }
			    }
            },
	        id: 'phones',

	          singleSelect: true,
	          overItemCls: 'x-view-over',
	          autoHeight:true,
	          overClass:'x-view-over',
	          itemSelector:'div.thumb-wrap',
	          emptyText: 'No images to display'
	    });
		
		var panel = new Ext.Panel({
	      id:'images-view',
	      frame:true,
	      autoWidth:true,
	      autoHeight:true,
	      collapsible:true,
	      layout:'fit',
	      title:'Simple DataView',
	      items: [dataview]      
	      });
        if (win==null) {
          win = new Ext.Window({
            id : 'sb_cz_win',
            title: 'è®¾å¤‡æ“ä½œ',
            //closeAction: 'hide',
            x : 300,
            y : 50,
            width: 670,
            height: 500,
            minHeight: 500,
            layout: 'fit',
            //modal: true,
            plain: true,
            //items:user_setup_grid,          
            items: panel

          });
        }
        

        win.show();
      };

      var sb_cz_disp = function(record,add_new){
        var win = Ext.getCmp('sb_cz_disp_win');

        if (win==null) {
          win = new Ext.Window({
            id : 'sb_cz_disp_win',
            title: 'ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯',
            //closeAction: 'hide',
            width: 370,
            height: 240,

            //minHeight: 200,
            layout: 'fit',
            modal: true,
            plain: true,
            //items:user_setup_grid,          
            items: [{
              width: 370,
              height: 210,
              xtype:'form',
              layout: 'absolute',
              id : 'user_disp_form',
              items: [
                {
                  xtype: 'label',
                  text: 'ç”¨æˆ·åç§°:',
                  x: 10,
                  y: 10,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'Email:',
                  x: 10,
                  y: 40,
                  width: 100
                }
                ,
                {
                  xtype: 'label',
                  text: 'å¯†ç :',
                  x: 10,
                  y: 70,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'æ˜¯å¦æ˜¾ç¤ºä¸‹çº§æ¡£æ¡ˆ:',
                  x: 10,
                  y: 100,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'æ‰€å±å…¨å®—:',
                  x: 10,
                  y: 130,
                  width: 100
                },
                {
                  xtype: 'textfield',
                  hidden : true,
                  name : 'id' ,
                  id:'user_id'                    
                },
                {
                  xtype: 'textfield',
                  x: 130,
                  y: 10,
                  width: 200,
                  name: 'username',
                  id:'user_username'
                },
                {
                  xtype: 'textfield',
                  x: 130,
                  y: 40,
                  width: 200,
                  name: 'email',
                  id:'user_email'
                },
                {
                  xtype: 'textfield',
                  x: 130,
                  y: 70,
                  width: 200,
                  name: 'encrypted_password',
                  id:'user_encrypted_password'
                } ,
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 100,
                  width: 200,
                  store: sf_store,
                  emptyText:'è¯·é€‰æ‹©',
                  mode: 'remote',
                  minChars : 2,
                  valueField:'text',
                  displayField:'text',
                  triggerAction:'all',
                  name: 'sfxsxyisj',
                  id:'user_sfxsxyisj'
                },
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 130,
                  width: 200,
                  store: qz_store,
                  emptyText:'è¯·é€‰æ‹©',
                  mode: 'remote',
                  minChars : 2,
                  valueField:'id',
                  displayField:'dwdm',
                  triggerAction:'all',
                  name: 'dwdm',
                  id:'user_ssqz'
                }
              ],
              buttons:[{
                  xtype: 'button',
                  iconCls: 'option',
                  id:'button_user_add',
                  text:'ä¿®æ”¹',
                  handler: function() {
                    var pars=this.up('panel').getForm().getValues();
                    if(pars['email']!=''){
                      if(pars['encrypted_password']!=''){
                        if(add_new==false){
                          new Ajax.Request("/desktop/update_user", { 
                            method: "POST",
                            parameters: pars,
                            onComplete:  function(request) {
                              if (request.responseText=='success'){
                                alert("ä¿®æ”¹æˆåŠŸã€‚");
                                Ext.getCmp('user_disp_win').close();

                                Ext.getCmp('user_setup_grid').store.url='/desktop/get_user_grid';
                                Ext.getCmp('user_setup_grid').store.load();
                              }else{
                                alert("ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚");
                              }

                            }
                          });
                        }else{
                          new Ajax.Request("/desktop/insert_user", { 
                            method: "POST",
                            parameters: pars,
                            onComplete:  function(request) {
                              if (request.responseText=='success'){
                                alert("æ–°å¢æˆåŠŸã€‚");
                                Ext.getCmp('user_disp_win').close();
                                Ext.getCmp('user_setup_grid').store.url='/desktop/get_user_grid';
                                Ext.getCmp('user_setup_grid').store.load();
                              }else{
                                alert("æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°æ–°å¢ã€‚");
                              }
                            }
                          });
                        }
                      }else{
                        alert("å¯†ç ä¸èƒ½ä¸ºç©ºã€‚");
                      }
                    }else{
                      alert("ç”¨æˆ·åç§°ä¸èƒ½ä¸ºç©ºã€‚");
                    }
                  }
                },
                {
                  xtype: 'button',
                  iconCls: 'exit',
                  text:'é€€å‡º',
                  handler: function() {
                    //this.up('window').hide();
                    Ext.getCmp('user_disp_win').close();
                  }
                }]
            }]

          });
        }
        if(add_new==false){
        //è®¾ç½®æ•°æ®
          Ext.getCmp('user_disp_form').getForm().setValues(record.data);

        }else{
          Ext.getCmp('user_disp_win').title="æ–°å¢ç”¨æˆ·ä¿¡æ¯";
          Ext.getCmp('button_user_add').text="æ–°å¢";
          Ext.getCmp('button_user_add').iconCls="add";
        }

        win.show();
      };

      var js_disp = function(record,add_new){
        var win = Ext.getCmp('js_disp_win');

        if (win==null) {
          win = new Ext.Window({
            id : 'js_disp_win',
            title: 'ä¿®æ”¹è§’è‰²ä¿¡æ¯',
            //closeAction: 'hide',
            width: 370,
            height: 140,
            //minHeight: 200,
            layout: 'fit',
            modal: true,
            plain: true,
            //items:user_setup_grid,          
            items: [{
              width: 370,
              height: 140,
              xtype:'form',
              layout: 'absolute',
              id : 'js_disp_form',
              items: [
                {
                  xtype: 'label',
                  text: 'è§’è‰²åç§°ï¼š',
                  x: 10,
                  y: 10,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'è§’è‰²ç­‰çº§ï¼š',
                  x: 10,
                  y: 40,
                  width: 100
                },
                {
                  xtype: 'textfield',
                  hidden : true,
                  name : 'id' ,
                  id:'js_id'                    
                },

                {
                  xtype: 'textfield',
                  x: 130,
                  y: 10,
                  width: 200,
                  name: 'jsmc',
                  id:'js_jsmc'
                },
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 40,
                  width: 200,
                  store: qzdj_store,
                  emptyText:'è¯·é€‰æ‹©',
                  mode: 'remote',
                  minChars : 2,
                  valueField:'text',
                  displayField:'text',
                  triggerAction:'all',
                  name: 'jsdj',
                  id:'qz_jsdj'
                }
              ],
              buttons:[{
                  xtype: 'button',
                  iconCls: 'option',
                  id:'button_user_add',
                  text:'ä¿®æ”¹',
                  handler: function() {
                    var pars=this.up('panel').getForm().getValues();
                    if(pars['jsmc']!=''){

                        if(add_new==false){
                          new Ajax.Request("/desktop/update_js", { 
                            method: "POST",
                            parameters: pars,
                            onComplete:  function(request) {
                              if (request.responseText=='success'){

                                Ext.getCmp('js_disp_win').close();

                                Ext.getCmp('js_setup_grid').store.url='/desktop/get_js_grid';
                                Ext.getCmp('js_setup_grid').store.load();
                              }else{
                                alert("ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚");
                              }

                            }
                          });
                        }else{
                          new Ajax.Request("/desktop/insert_js", { 
                            method: "POST",
                            parameters: pars,
                            onComplete:  function(request) {
                              if (request.responseText=='success'){

                                Ext.getCmp('js_disp_win').close();
                                Ext.getCmp('js_setup_grid').store.url='/desktop/get_js_grid';
                                Ext.getCmp('js_setup_grid').store.load();
                              }else{
                                alert("æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°æ–°å¢ã€‚");
                              }
                            }
                          });
                        }

                    }else{
                      alert("ç”¨æˆ·åç§°ä¸èƒ½ä¸ºç©ºã€‚");
                    }
                  }
                },
                {
                  xtype: 'button',
                  iconCls: 'exit',
                  text:'é€€å‡º',
                  handler: function() {
                    //this.up('window').hide();
                    Ext.getCmp('js_disp_win').close();
                  }
                }]
            }]

          });
        }
        if(add_new==false){
        //è®¾ç½®æ•°æ®
          Ext.getCmp('js_disp_form').getForm().setValues(record.data);

        }else{
          Ext.getCmp('js_disp_win').title="æ–°å¢è§’è‰²ä¿¡æ¯";
          Ext.getCmp('button_user_add').text="æ–°å¢";
          Ext.getCmp('button_user_add').iconCls="add";
        }

        win.show();
      };

      var user_sb_setup = function(){
        var win = Ext.getCmp('user_sb_setup_win');

        Ext.regModel('user_sb_setup_model', {
          fields: [
            {name: 'id',    type: 'integer'},
            {name: 'email',   type: 'string'},
            {name: 'username',    type: 'string'},
            {name: 'sfxsxyisj',   type: 'string'},
            {name: 'encrypted_password',    type: 'string'},
            {name: 'ssqz',    type: 'string'},
            {name: 'dwdm',    type: 'string'}
          ]
        });

        var user_sb_setup_store = Ext.create('Ext.data.Store', {
          id:'user_sb_setup_store',
          model : 'user_sb_setup_model',
          autoLoad: true,
          proxy: {
            type: 'ajax',
            url : '/desktop/get_user_grid',
            //extraParams: cx_tj,
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }
          //sortInfo:{field: 'level4', direction: "ASC"},
          //baseParams: {start:0, limit:25, query:""}
        });
        var user_sb_setup_grid = new Ext.grid.GridPanel({
          id : 'user_sb_setup_grid',
          store: user_sb_setup_store,       
          columns: [
            { text : 'id',  width : 0, sortable : true, dataIndex: 'id'},
            { text : 'ç”¨æˆ·å', width : 100, sortable : true, dataIndex: 'username'},
            { text : 'Email', width : 150, sortable : true, dataIndex: 'email'},
            { text : 'æ˜¯å¦æ˜¾ç¤ºä¸‹çº§æ¡£æ¡ˆ',  width : 150, sortable : true, dataIndex: 'sfxsxyisj'},
            { text : 'æ‰€å±å…¨å®—',  width : 150, sortable : true, dataIndex: 'dwdm'},         
            { text : 'å¯†ç ',  width : 0, sortable : true, dataIndex: 'encrypted_password'}
            ],
            selType:'checkboxmodel',
            //multiSelect:true,
            listeners:{

            },

          viewConfig: {
            stripeRows:true
          }
        });
        user_sb_setup_grid.on("select",function(node){
          data = node.selected.items[0].data;    // data.id, data.parent, data.text, data.leaf              
          new Ajax.Request("/desktop/get_user_sb", { 
            method: "POST",
            parameters: "id="+data.id,
            onComplete:  function(request) {
              //alert(request.responseText);
              root=Ext.getCmp('user_sb_tree_panel').store.getRootNode();      
              getNodes(root,false);           
              nodes=request.responseText.split("|");
              for (k=0; k <nodes.size(); k++) {
                Ext.getCmp('user_sb_tree_panel').store.getNodeById(nodes[k]).data.checked=true;
                Ext.getCmp('user_sb_tree_panel').store.getNodeById(nodes[k]).updateInfo({checked:true});
              }   
            }
          });
        });
        var sb_tree_store = Ext.create('Ext.data.TreeStore', {
            autoLoad: true,
            proxy: {
                type: 'ajax',
                url: 'desktop/get_sb_tree',
                extraParams: {style:"0"},
                actionMethods: 'POST'
            }
        }); 
        var sb_tree_panel = Ext.create('Ext.tree.Panel', {
          id : 'user_sb_tree_panel',
          store: sb_tree_store,
          rootVisible:false,
          useArrows: true,
          //singleExpand: true,
          width: 200,
          listeners:{
            checkchange:function(node,checked,option){          
              if (checked){             
                getNodes(node,true);
                get_parentNode(node);           
                }else{
                getNodes(node,false);
                }           
            }
          }     
        });
        if (win==null) {
          win = new Ext.Window({
            id : 'user_sb_setup_win',
            title: 'ç”¨æˆ·è®¾å¤‡è®¾ç½®',
            x : 300,
            y : 50,
            width: 670,
            height: 500,
            minHeight: 500,
            layout: 'border',
            //modal: true,
            plain: true,          
            items: [
              { title:'ç”¨æˆ·åˆ—è¡¨',
                region:'west',
                iconCls:'users',
                xtype:'panel',
                margins:'0 0 0 0',
                width: 400,
                collapsible:true,//å¯ä»¥è¢«æŠ˜å               
                layout:'fit',
                split:true,
                items:user_sb_setup_grid
              },
              { title:'è®¾å¤‡æ ‘',
                region:'center',
                iconCls:'dept_tree',
                xtype:'panel',
                margins:'0 0 0 0',
                //width: 250,
                //collapsible:true,//å¯ä»¥è¢«æŠ˜å             
                //id:'user-qx-tree',
                layout:'fit',
                split:true,
                items:sb_tree_panel
              }
            ],

            tbar:[
            {
              xtype: 'button',
              iconCls: 'save',
              text:'ä¿å­˜ç”¨æˆ·è®¾å¤‡',
              handler: function() {
                var grid = Ext.getCmp('user_sb_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  root=Ext.getCmp('user_sb_tree_panel').store.getRootNode();
                  insert_qx="";
                  get_mlqx_NodesChecked(root);

                  var node=nodes[0];
                  if (insert_qx==""){
                    alert("è¯·æ‚¨é€‰æ‹©ä¸€äº›è®¾å¤‡å†ä¿å­˜ã€‚");
                  }else{
                    insert_qx="({insert_qx:'" + insert_qx + "',userid:" + records[0].data.id + "})";
                    new Ajax.Request("/desktop/insert_user_sb", { 
                      method: "POST",
                      parameters: eval(insert_qx),
                      onComplete:  function(request) {
                        if (request.responseText=='success'){
                          alert("ä¿å­˜ç”¨æˆ·è®¾å¤‡æˆåŠŸã€‚");                       
                        }else{
                          alert("ä¿å­˜ç”¨æˆ·è®¾å¤‡å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚");
                        }
                      }
                    });                 
                  }
                }else{
                  alert("è¯·æ‚¨å…ˆé€‰æ‹©ä¸€ä¸ªç”¨æˆ·ã€‚");
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'exit',
              text:'é€€å‡º',
              handler: function() {
                //this.up('window').hide();
                Ext.getCmp('user_sb_setup_win').close();
              }
            }]

          });
        }


        win.show();
      };

      var ktjz_disp = function(record,add_new){
        var win = Ext.getCmp('ktjz_disp_win');

        //qz_store.load();
        if (win==null) {
          win = new Ext.Window({
            id : 'ktjz_disp_win',
            title: 'ç©ºè°ƒæ ¡å‡†--æ ¹æ®å½“å‰ç©ºè°ƒçš„å®é™…æƒ…å†µè¿›è¡Œæ ¡å‡†',
            //closeAction: 'hide',
            width: 370,
            height: 300,
            //minHeight: 200,
            layout: 'fit',
            modal: true,
            plain: true,
            //items:user_setup_grid,          
            items: [{
              width: 370,
              height: 300,
              xtype:'form',
              layout: 'absolute',
              id : 'ktjz_disp_form',
              items: [
                {
                  xtype: 'label',
                  text: 'è®¾å¤‡åç§°ï¼š',
                  x: 10,
                  y: 10,
                  
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'å½“å‰å®¤å†…æ¸©åº¦ï¼š',
                  x: 10,
                  y: 40,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'ç©ºè°ƒè®¾å®šæ¸©åº¦ï¼š',
                  x: 10,
                  y: 70,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'å½“å‰å¼€å…³çŠ¶æ€ï¼š',
                  x: 10,
                  y: 100,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'å½“å‰ç©ºè°ƒæ¨¡å¼ï¼š',
                  x: 10,
                  y: 130,
                  width: 100
                },
                
                {
                  xtype: 'textfield',
                  hidden : true,
                  name : 'id' ,
                  id:'sb_id'                    
                },

                {
                  xtype: 'textfield',
                  x: 130,
                  y: 10,
                  width: 200,
                  name: 'sbmc',
                  readonly:true,
                  id:'sb_sbmc'
                },
                {
                  xtype: 'textfield',
                  x: 130,
                  y: 40,
                  width: 200,
                  name: 'sw',
                  id:'sb_sw'
                },
                {
                  xtype: 'textfield',
                  x: 130,
                  y: 70,
                  width: 200,
                  name: 'kw',
                  id:'sb_kw'

                },
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 100,
                  width: 200,
                  store: kg_store,
                  emptyText:'è¯·é€‰æ‹©',
                  mode: 'remote',
                  minChars : 2,
                  valueField:'value',
                  displayField:'text',
                  triggerAction:'all',
                  listConfig: { loadMask: false },                  
                  name: 'kg',
                  id:'sb_kg'
                },
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 130,
                  width: 200,
                  store: ktms_store,
                  emptyText:'è¯·é€‰æ‹©',
                  mode: 'remote',
                  minChars : 2,
                  valueField:'value',
                  displayField:'text',
                  triggerAction:'all',
                  listConfig: { loadMask: false },
                  name: 'ktms',
                  id:'sb_ktms'
                }
                


              ],
              buttons:[{
                  xtype: 'button',
                  iconCls: 'option',
                  id:'button_qz_add',
                  text:'æ ¡å‡†',
                  handler: function() {
                    var pars=this.up('panel').getForm().getValues();
                    if(pars['sbmc']!=''){
                      if(pars['kw']!=''){
                        if(pars['sw']!=''){
                          
                            new Ajax.Request("/desktop/update_ktjz", { 
                              method: "POST",
                              parameters: pars,
                              onComplete:  function(request) {
                                text=request.responseText.split(':');
                                if (request.responseText=='success'){

                                  Ext.getCmp('ktjz_disp_win').close();

                                  Ext.getCmp('sb_cz_setup_grid').store.url='/desktop/get_zn_sb_grid';
                                  Ext.getCmp('sb_cz_setup_grid').store.load();
                                }else{
                                  if (text[0]=='false'){
                                    alert(text[1]);
                                  }else{
                                    alert("æ ¡å‡†å¤±è´¥ã€‚");
                                  }
                                }

                              }
                            });
                          
                        }else{
                          alert("å½“å‰å®¤å†…æ¸©åº¦ä¸èƒ½ä¸ºç©ºã€‚");
                        }
                      }else{
                        alert("å½“å‰ç©ºè°ƒæ¸©åº¦ä¸èƒ½ä¸ºç©ºã€‚");
                      }
                    }else{
                      alert("è®¾å¤‡åç§°ä¸èƒ½ä¸ºç©ºã€‚");
                    }
                  }
                },
                {
                  xtype: 'button',
                  iconCls: 'exit',
                  text:'é€€å‡º',
                  handler: function() {
                    //this.up('window').hide();
                    Ext.getCmp('ktjz_disp_win').close();
                  }
                }]
            }]

          });
        }
        
          Ext.getCmp('ktjz_disp_form').getForm().setValues(record.data);

        
        win.show();
      };


      var sb_cz_setup = function(){
        var win = Ext.getCmp('sb_cz_setup_win');

	    Ext.regModel('sbdisp_model', {
	        fields: [
	          {name: 'id',    type: 'integer'},
            {name: 'sbmc',    type: 'string'},
            {name: 'sbsm',    type: 'string'},
            {name: 'lymc',    type: 'string'},
            {name: 'ssly',    type: 'integer'},
            {name: 'lcmc',    type: 'string'},
            {name: 'sslc',    type: 'integer'},
            {name: 'fjmc',    type: 'string'},
            {name: 'ssfj',    type: 'integer'},
            {name: 'kzl',   type: 'string'},
            {name: 'gzl',   type: 'string'},
            {name: 'sbh',   type: 'string'},
            {name: 'kgzt',    type: 'string'},
            {name: 'sblx',    type: 'string'},
			  {name: 'img',    type: 'string'}
	        ]
	    });
	    var sbdisp_store = Ext.create('Ext.data.Store', {
	          id:'sbdisp_store',
			  //autoLoad: true,
	          model : 'sbdisp_model',
	          proxy: {
	            type: 'ajax',
	            url : '/desktop/get_sb_grid',
	            extraParams: {userid:currentUser.id},
	            reader: {
	              	type: 'json',
	                root: ''
	            }
	          }       
	    });
		sbdisp_store.load();
		var dataview = Ext.create('Ext.view.View', {
	        //deferInitialRefresh: false,
	        store: sbdisp_store,
	        tpl  : Ext.create('Ext.XTemplate',
	            '<tpl for=".">',
					'<div class="thumb-wrap" id="{name}">',
			        	'<div class="thumb"><img src="assets/{img}" title="{sbsm}"></div>',
	                    //'<strong>{lxsm}</strong>',
						'<span>{[values.kgzt]}</span>',
	                    '<span>{sbmc}</span>',	
	                '</div>',
	            '</tpl>'
	        ),

	       // plugins : [
	       //     Ext.create('Ext.ux.DataView.Animated', {
	       //         duration  : 550,
	       //         idProperty: 'id'
	       //     })
	       // ],
			listeners: {
                itemclick: function(dataview, selections) {
			        var selected = selections;
			        
			            Ext.getCmp('zn_sb_cz_open').setVisible(false);
						Ext.getCmp('zn_sb_cz_close').setVisible(false);
						Ext.getCmp('zn_sb_cz_add').setVisible(false);
						Ext.getCmp('zn_sb_cz_jw').setVisible(false);
						Ext.getCmp('zn_sb_cz_refresh').setVisible(false);
						Ext.getCmp('zn_sb_cz_dqzt').setVisible(false);
						Ext.getCmp('zn_sb_cz_qczt').setVisible(false);
						Ext.getCmp('zn_sb_cz_dqwsd').setVisible(false);
						Ext.getCmp('zn_sb_cz_ktjz').setVisible(false);
						switch (selected.data.sblx) { 
			                case "1": 
			                  Ext.getCmp('zn_sb_cz_open').setVisible(true);
							  Ext.getCmp('zn_sb_cz_close').setVisible(true);
			                  break; 
			                case "2": 
			                  Ext.getCmp('zn_sb_cz_open').setVisible(true);
							  Ext.getCmp('zn_sb_cz_close').setVisible(true);
			                  break; 
			                case "3": 
			                  Ext.getCmp('zn_sb_cz_open').setVisible(true);
							  Ext.getCmp('zn_sb_cz_close').setVisible(true);
							  Ext.getCmp('zn_sb_cz_add').setVisible(true);
							  Ext.getCmp('zn_sb_cz_jw').setVisible(true);
							  Ext.getCmp('zn_sb_cz_refresh').setVisible(true);
							  Ext.getCmp('zn_sb_cz_ktjz').setVisible(true);
			                  break; 
			                case "4": 
			                  Ext.getCmp('zn_sb_cz_dqwsd').setVisible(true);
			                  break;
			                case "5": 
			                  
			                  break;
							case "6": 
			                  Ext.getCmp('zn_sb_cz_dqzt').setVisible(true);
			                  break;
							case "7": 
			                  Ext.getCmp('zn_sb_cz_dqzt').setVisible(true);
			                  break;
						}
			        
			    }
            },
	        id: 'zn_sb',
			autoScroll  : true,
	        singleSelect: true,
	        overItemCls: 'x-view-over',
	        autoHeight:true,
	        overClass:'x-view-over',
	        itemSelector:'div.thumb-wrap',
	        emptyText: 'æ— è®¾å¤‡'
	    });
		var panel = new Ext.Panel({
	      	id:'images-view',
	      	frame:true,
	      	autoWidth:true,
	      	autoHeight:true,
	      	//collapsible:true,
	      	layout:'fit',
	      	items: [dataview]      
	   	});
        Ext.regModel('sb_cz_setup_model', {
          fields: [
            {name: 'id',    type: 'integer'},
            {name: 'sbmc',    type: 'string'},
            {name: 'sbsm',    type: 'string'},
            {name: 'lymc',    type: 'string'},
            {name: 'ssly',    type: 'integer'},
            {name: 'lcmc',    type: 'string'},
            {name: 'sslc',    type: 'integer'},
            {name: 'fjmc',    type: 'string'},
            {name: 'ssfj',    type: 'integer'},
            {name: 'kzl',   type: 'string'},
            {name: 'gzl',   type: 'string'},
            {name: 'sbh',   type: 'string'},
            {name: 'kgzt',    type: 'string'},
            {name: 'sblx',    type: 'string'}
          ]
        });

        var sb_cz_setup_store = Ext.create('Ext.data.Store', {
          id:'sb_cz_setup_store',
          model : 'sb_cz_setup_model',
          //autoLoad: true,
          proxy: {
            type: 'ajax',
            url : '/desktop/get_zn_sb_grid',
            extraParams: {query:""},
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }
          //sortInfo:{field: 'level4', direction: "ASC"},
          //baseParams: {start:0, limit:25, query:""}
        });
        var sb_cz_setup_grid = new Ext.grid.GridPanel({
          id : 'sb_cz_setup_grid',
          store: sb_cz_setup_store,       
          columns: [
            { text : 'id',  width : 0, sortable : true, dataIndex: 'id'},
            { text : 'å¼€å…³çŠ¶æ€',  width : 60, sortable : true, dataIndex: 'kgzt',renderer:ztRender},
            { text : 'è®¾å¤‡åç§°',  width : 70, sortable : true, dataIndex: 'sbmc'},
            { text : 'è®¾å¤‡è¯´æ˜',  width : 250, sortable : true, dataIndex: 'sbsm'},
            { text : 'æ‰€å±æˆ¿é—´',  width : 100, sortable : true, dataIndex: 'fjmc'},
            { text : 'æ‰€å±æ¥¼å±‚',  width : 100, sortable : true, dataIndex: 'lcmc'},
            { text : 'æ‰€å±æ¥¼å®‡',  width : 100, sortable : true, dataIndex: 'lymc'},
            { text : 'è®¾å¤‡å·', width : 50, sortable : true, dataIndex: 'sbh'}           
            ],
            selType:'checkboxmodel',
            //multiSelect:true,
            listeners:{
              itemdblclick:{
                fn:function(v,r,i,n,e,b){
                  var tt=r.get("zrq");
                  //DispAj(r,false);
                }
              }
            },
          viewConfig: {
            stripeRows:true
          }
        });

        var fj_tree_store = Ext.create('Ext.data.TreeStore', {
            autoLoad: true,
            proxy: {
                type: 'ajax',
                url: 'desktop/get_fj_tree',
                extraParams: {style:"0"},
                actionMethods: 'POST'
            }
        }); 
        var fj_tree_panel = Ext.create('Ext.tree.Panel', {
          id : 'user_fj_tree_panel',
          store: fj_tree_store,
          rootVisible:false,
          useArrows: true,
          //singleExpand: true,
          width: 200
        });
        fj_tree_panel.on("select",function(node){ 
          data = node.selected.items[0].data;  // data.id, data.parent, data.text, data.leaf
         // Ext.getCmp('sb_cz_setup_grid').store.proxy.extraParams.query=  data.id;
         // Ext.getCmp('sb_cz_setup_grid').store.proxy.extraParams.userid= currentUser.id;
         // Ext.getCmp('sb_cz_setup_grid').store.url='/desktop/get_zn_sb_grid';
         //
         // Ext.getCmp('sb_cz_setup_grid').store.load();
			sbdisp_store.proxy.extraParams.query=  data.id;
			sbdisp_store.proxy.extraParams.userid= currentUser.id;
			sbdisp_store.load();
			//sbdisp_store.load();
			//sbdisp_store.reload(); 
        });
        loopable=false;
        i =0;
        
        function loopCheck(sf,lp) {
          if (lp) {
            loopable=true;
            //move to new position
            alert(i);
            if (i>5){
              loopable=false;
            };
            //Set Delay
            i = i +1;
            sf = 0;
            td = 5*1000 ; //60s 
            var f = function() { loopCheck(sf,loopable); };
            var t = setTimeout(f,td);
          }
        };
        
        if (win==null) {
          win = new Ext.Window({
            id : 'sb_cz_setup_win',
            title: 'è®¾å¤‡çŠ¶æ€åŠæ§åˆ¶',
            x : 300,
            y : 50,
            width: 670,
            height: 500,
            minHeight: 500,
            layout: 'border',
            //modal: true,
            plain: true,          
            items: [
              { title:'æˆ¿é—´æ ‘',
                region:'west',
                iconCls:'users',
                xtype:'panel',
                margins:'0 0 0 0',
                width: 200,
                collapsible:true,//å¯ä»¥è¢«æŠ˜å               
                layout:'fit',
                split:true,
                items:fj_tree_panel
              },
              { title:'è®¾å¤‡åˆ—è¡¨',
                region:'center',
                iconCls:'dept_tree',
                xtype:'panel',
                margins:'0 0 0 0',
                layout:'fit',
                split:true,
                items:panel
              }
            ],
            tbar:[{
              xtype: 'button',
			ã€€ã€€id:'zn_sb_cz_open',
              iconCls: 'dksb',
              text:'æ‰“å¼€è®¾å¤‡',
              handler: function() {
                var grid = Ext.getCmp('zn_sb');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];                 
                    var pars={sbh:record.data.sbh,kzzl:record.data.kzl,cz:'å¼€',sbid:record.data.id,userid:currentUser.id};
                    new Ajax.Request("/desktop/zn_kg_kz", { 
                      method: "POST",
                      parameters: pars,
                      onComplete:  function(request) {
                        text=request.responseText.split(':');
                        if (text[0]=='success'){
                          alert("è®¾å¤‡æ‰“å¼€æˆåŠŸã€‚"); 
                          sbdisp_store.load();
                        }else{
                          if (text[0]=='false'){
                            alert(text[1]);
                          }else{
                            alert("è®¾å¤‡æ‰“å¼€å¤±è´¥ã€‚");
                          }
                        }
                            
                      }
                    })                                             
                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªè®¾å¤‡è¿›è¡Œæ‰“å¼€ã€‚");
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'delete',
			  id:'zn_sb_cz_close',
              text:'å…³é—­è®¾å¤‡',
              handler: function() {
                var grid = Ext.getCmp('zn_sb');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];                  
                    var pars={sbh:record.data.sbh,kzzl:record.data.gzl,cz:'å…³',sbid:record.data.id,userid:currentUser.id};
                    new Ajax.Request("/desktop/zn_kg_kz", { 
                      method: "POST",
                      parameters: pars,
                      onComplete:  function(request) {
                        text=request.responseText.split(':');
                        if (text[0]=='success'){
                          alert("è®¾å¤‡å…³é—­æˆåŠŸã€‚");                                             
                          sbdisp_store.load();
                        }else{
                          if (text[0]=='false'){
                            alert(text[1]);
                          }else{
                            alert("è®¾å¤‡å…³é—­å¤±è´¥ã€‚");
                          }
                        }

                      }
                    })
                  

                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªè®¾å¤‡è¿›è¡Œå…³é—­ã€‚");
                }

              }
            },
            {
              xtype: 'button',
              iconCls: 'add',
			  id:'zn_sb_cz_add',
              text:'åŠ æ¸©',
              handler: function() {
                var grid = Ext.getCmp('zn_sb');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];
                    var pars={sbh:record.data.sbh,kzzl:record.data.gzl,cz:'åŠ æ¸©',sbid:record.data.id,userid:currentUser.id};
                    new Ajax.Request("/desktop/zn_kg_kz", { 
                      method: "POST",
                      parameters: pars,
                      onComplete:  function(request) {
                        text=request.responseText.split(':');
                        if (text[0]=='success'){
                          alert("è®¾å¤‡åŠ æ¸©æˆåŠŸã€‚");                                             
                          sbdisp_store.load();
                        }else{
                          if (text[0]=='false'){
                            alert(text[1]);
                          }else{
                            alert("è®¾å¤‡åŠ æ¸©å¤±è´¥ã€‚");
                          }
                        }

                      }
                    })
                  

                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªåŠ æ¸©è¿›è¡Œå…³é—­ã€‚");
                }

              }
            },
            {
              xtype: 'button',
              iconCls: 'jw',
			  id:'zn_sb_cz_jw',
              text:'å‡æ¸©',
              handler: function() {
                //this.up('window').hide();
                var grid = Ext.getCmp('zn_sb');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];
                  
                    var pars={sbh:record.data.sbh,kzzl:record.data.gzl,cz:'å‡æ¸©',sbid:record.data.id,userid:currentUser.id};
                    new Ajax.Request("/desktop/zn_kg_kz", { 
                      method: "POST",
                      parameters: pars,
                      onComplete:  function(request) {
                        text=request.responseText.split(':');
                        if (text[0]=='success'){
                          alert("è®¾å¤‡å‡æ¸©æˆåŠŸã€‚");
                          sbdisp_store.load();
                        }else{
                          if (text[0]=='false'){
                            alert(text[1]);
                          }else{
                            alert("è®¾å¤‡å‡æ¸©å¤±è´¥ã€‚");
                          }
                        }

                      }
                    })

                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªè®¾å¤‡è¿›è¡Œå‡æ¸©ã€‚");
                }

              }
            },
            {
              xtype: 'button',
              iconCls: 'refresh',
			  id:'zn_sb_cz_refresh',
              text:'æ¨¡å¼è½¬æ¢',
              handler: function() {
                //this.up('window').hide();
                var grid = Ext.getCmp('zn_sb');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];
                  
                    var pars={sbh:record.data.sbh,kzzl:record.data.gzl,cz:'æ¨¡å¼è½¬æ¢',sbid:record.data.id,userid:currentUser.id};
                    new Ajax.Request("/desktop/zn_kg_kz", { 
                      method: "POST",
                      parameters: pars,
                      onComplete:  function(request) {
                        text=request.responseText.split(':');
                        if (text[0]=='success'){
                          alert("æ¨¡å¼è½¬æ¢æˆåŠŸã€‚");                                             
						  sbdisp_store.load();
                        }else{
                          if (text[0]=='false'){
                            alert(text[1]);
                          }else{
                            alert("æ¨¡å¼è½¬æ¢å¤±è´¥ã€‚");
                          }
                        }

                      }
                    })
                  

                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªè®¾å¤‡è¿›è¡Œæ¨¡å¼è½¬æ¢ã€‚");
                }

              }
            },
            {
              xtype: 'button',
              iconCls: 'refresh',
			  id:'zn_sb_cz_dqzt',
              text:'è¯»å–çŠ¶æ€',
              handler: function() {
                //this.up('window').hide();
                var grid = Ext.getCmp('zn_sb');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];
                  
                    var pars={sbh:record.data.sbh,kzzl:record.data.gzl,cz:'è¯»å–çŠ¶æ€',sbid:record.data.id,userid:currentUser.id};
                    new Ajax.Request("/desktop/zn_kg_kz", { 
                      method: "POST",
                      parameters: pars,
                      onComplete:  function(request) {
                        text=request.responseText.split(':');
                        if (text[0]=='success'){
                          alert("è¯»å–çŠ¶æ€æˆåŠŸã€‚");                                             
                          sbdisp_store.load();
                        }else{
                          if (text[0]=='false'){
                            alert(text[1]);
                          }else{
                            alert("è¯»å–çŠ¶æ€å¤±è´¥ã€‚");
                          }
                        }

                      }
                    })
                  

                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªè®¾å¤‡è¿›è¡Œæ¨¡å¼è½¬æ¢ã€‚");
                }

              }
            },
            {
              xtype: 'button',
              iconCls: 'refresh',
              text:'æ¸…é™¤çŠ¶æ€',
			  id:'zn_sb_cz_qczt',
              handler: function() {
                //this.up('window').hide();
                var grid = Ext.getCmp('zn_sb');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];                  
                    var pars={sbh:record.data.sbh,kzzl:record.data.gzl,cz:'æ¸…é™¤çŠ¶æ€',sbid:record.data.id,userid:currentUser.id};
                    new Ajax.Request("/desktop/zn_kg_kz", { 
                      method: "POST",
                      parameters: pars,
                      onComplete:  function(request) {
                        text=request.responseText.split(':');
                        if (text[0]=='success'){
                          alert("è¯»å–çŠ¶æ€æˆåŠŸã€‚");                                             
                          sbdisp_store.load();
                        }else{
                          if (text[0]=='false'){
                            alert(text[1]);
                          }else{
                            alert("è¯»å–çŠ¶æ€å¤±è´¥ã€‚");
                          }
                        }

                      }
                    })                  
                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªè®¾å¤‡è¿›è¡Œæ¨¡å¼è½¬æ¢ã€‚");
                }

              }
            },
            {
              xtype: 'button',
              iconCls: 'refresh',
              text:'è¯»å–æ¸©æ¹¿åº¦',
			  id:'zn_sb_cz_dqwsd',
              handler: function() {
                //this.up('window').hide();
                var grid = Ext.getCmp('zn_sb');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];
                  
                    var pars={sbh:record.data.sbh,kzzl:record.data.gzl,cz:'è¯»å–æ¸©æ¹¿åº¦',sbid:record.data.id,userid:currentUser.id};
                    new Ajax.Request("/desktop/zn_kg_kz", { 
                      method: "POST",
                      parameters: pars,
                      onComplete:  function(request) {
                        text=request.responseText.split(':');
                        if (text[0]=='success'){
                          alert("è¯»å–çŠ¶æ€æˆåŠŸã€‚");                                             
                          sbdisp_store.load();
                        }else{
                          if (text[0]=='false'){
                            alert(text[1]);
                          }else{
                            alert("è¯»å–çŠ¶æ€å¤±è´¥ã€‚");
                          }
                        }

                      }
                    })
                  

                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªè®¾å¤‡è¿›è¡Œæ¨¡å¼è½¬æ¢ã€‚");
                }

              }
            },
            {
              xtype: 'button',
              iconCls: 'settings',
              text:'ç©ºè°ƒæ ¡å‡†',
			  id:'zn_sb_cz_ktjz',
              handler: function() {
                //this.up('window').hide();
                var grid = Ext.getCmp('zn_sb');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];
                    if (record.data.sblx==3){
                      ktjz_disp(record,false);
                    }                     
                    else{
                      alert("åªæœ‰ç©ºè°ƒæ‰éœ€è¦è¿›è¡Œæ ¡å‡†ã€‚");
                    }
                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªè®¾å¤‡è¿›è¡Œæ¨¡å¼è½¬æ¢ã€‚");
                }

              }
            },
            {
              xtype: 'button',
              iconCls: 'exit',
              text:'é€€å‡º',
              handler: function() {
                //this.up('window').hide();
                Ext.getCmp('sb_cz_setup_win').close();
              }
            }]

          });
        }


        win.show();
      };

      var js_setup = function(){
        var win = Ext.getCmp('js_setup_win');

        Ext.regModel('js_setup_model', {
          fields: [
            {name: 'id',    type: 'integer'},
            {name: 'jsmc',    type: 'string'},
            {name: 'jsdj',    type: 'string'}
          ]
        });

        var js_setup_store = Ext.create('Ext.data.Store', {
          id:'js_setup_store',
          model : 'js_setup_model',
          autoLoad: true,
          proxy: {
            type: 'ajax',
            url : '/desktop/get_js_grid',
            //extraParams: cx_tj,
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }
          //sortInfo:{field: 'level4', direction: "ASC"},
          //baseParams: {start:0, limit:25, query:""}
        });
        var js_setup_grid = new Ext.grid.GridPanel({
          id : 'js_setup_grid',
          store: js_setup_store,        
          columns: [
            { text : 'id',  width : 0, sortable : true, dataIndex: 'id'},
            { text : 'è§’è‰²åç§°',  width : 250, sortable : true, dataIndex: 'jsmc'},
            { text : 'è§’è‰²ç­‰çº§',  width : 250, sortable : true, dataIndex: 'jsdj'}
            ],
            selType:'checkboxmodel',
            //multiSelect:true,
            listeners:{

            },

          viewConfig: {
            stripeRows:true
          }
        });

        if (win==null) {
          win = new Ext.Window({
            id : 'js_setup_win',
            title: 'è§’è‰²è®¾ç½®',
            //closeAction: 'hide',
            width: 570,
            x : 300,
            y : 50,
            height: 500,
            minHeight: 500,
            layout: 'fit',
            //modal: true,
            plain: true,
            items:js_setup_grid,          
            tbar:[{
              xtype: 'button',
              iconCls: 'add',
              text:'æ–°å¢',
              handler: function() {
                //this.up('window').hide();

                js_disp("record",true);
              }
            },
            {
              xtype: 'button',
              iconCls: 'option',
              text:'ä¿®æ”¹',
              handler: function() {
                //this.up('window').hide();

                var grid = Ext.getCmp('js_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];
                  js_disp(record,false);
                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªè§’è‰²è¿›è¡Œä¿®æ”¹ã€‚");
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'delete',
              text:'åˆ é™¤',
              handler: function() {
                var grid = Ext.getCmp('js_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==0){
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªè§’è‰²è¿›è¡Œåˆ é™¤ã€‚");

                }else{
                  var record = records[0];
                  var pars="id="+record.data.id;
                  Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤è§’è‰²åç§°ä¸ºï¼šï¼"+record.data.jsmc+"çš„è§’è‰²ï¼Ÿ",function callback(id){
                        if(id=="yes"){
                          new Ajax.Request("/desktop/delete_js", { 
                            method: "POST",
                            parameters: pars,
                            onComplete:  function(request) {
                              if (request.responseText=='success'){
                                Ext.getCmp('js_setup_grid').store.url='/desktop/get_js_grid';
                                Ext.getCmp('js_setup_grid').store.load();
                              }else{
                                alert("åˆ é™¤å¤±è´¥ï¼Œè¯·é‡æ–°åˆ é™¤ã€‚");
                              }
                            }
                          });
                        }else{
                          //alert('O,no');
                        }

                    }); 
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'exit',
              text:'é€€å‡º',
              handler: function() {
                //this.up('window').hide();
                Ext.getCmp('js_setup_win').close();
              }
            }]

          });
        }


        win.show();
      };

      var ly_disp = function(record,add_new){
        var win = Ext.getCmp('ly_disp_win');

        //qz_store.load();
        if (win==null) {
          win = new Ext.Window({
            id : 'ly_disp_win',
            title: 'ä¿®æ”¹æ¥¼å®‡ä¿¡æ¯',
            //closeAction: 'hide',
            width: 370,
            height: 150,
            //minHeight: 200,
            layout: 'fit',
            modal: true,
            plain: true,
            //items:user_setup_grid,          
            items: [{
              width: 370,
              height: 140,
              xtype:'form',
              layout: 'absolute',
              id : 'ly_disp_form',
              items: [
                {
                  xtype: 'label',
                  text: 'æ¥¼å®‡åç§°ï¼š',
                  x: 10,
                  y: 10,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'æ¥¼å®‡è¯´æ˜ï¼š',
                  x: 10,
                  y: 40,
                  width: 100
                },
                {
                  xtype: 'textfield',
                  hidden : true,
                  name : 'id' ,
                  id:'ly_id'                    
                },

                {
                  xtype: 'textfield',
                  x: 130,
                  y: 10,
                  width: 200,
                  name: 'lymc',
                  id:'ly_lymc'
                },
                {
                  xtype: 'textfield',
                  x: 130,
                  y: 40,
                  width: 200,
                  name: 'lysm',
                  id:'ly_lysm'
                }
              ],
              buttons:[{
                  xtype: 'button',
                  iconCls: 'option',
                  id:'button_qz_add',
                  text:'ä¿®æ”¹',
                  handler: function() {
                    var pars=this.up('panel').getForm().getValues();
                    if(pars['lymc']!=''){
                      if(pars['lysm']!=''){
                        if(add_new==false){
                          new Ajax.Request("/desktop/update_zn_ly", { 
                            method: "POST",
                            parameters: pars,
                            onComplete:  function(request) {
                              text=request.responseText.split(':');
                              if (request.responseText=='success'){

                                Ext.getCmp('ly_disp_win').close();

                                Ext.getCmp('ly_setup_grid').store.url='/desktop/get_zn_ly_grid';
                                Ext.getCmp('ly_setup_grid').store.load();
                              }else{
                                if (text[0]=='false'){
                                  alert(text[1]);
                                }else{
                                  alert("ä¿®æ”¹å¤±è´¥ã€‚");
                                }
                              }

                            }
                          });
                        }else{
                          new Ajax.Request("/desktop/insert_zn_ly", { 
                            method: "POST",
                            parameters: pars,
                            onComplete:  function(request) {
                              text=request.responseText.split(':');
                              if (text[0]=='success'){

                                Ext.getCmp('ly_disp_win').close();
                                Ext.getCmp('ly_setup_grid').store.url='/desktop/get_zn_ly_grid';
                                Ext.getCmp('ly_setup_grid').store.load();
                              }else{
                                if (text[0]=='false'){
                                  alert(text[1]);
                                }else{
                                  alert("æ–°å¢å¤±è´¥ã€‚");
                                }
                              }
                            }
                          });
                        }
                      }else{
                        alert("æ¥¼å®‡è¯´æ˜ä¸èƒ½ä¸ºç©ºã€‚");
                      }
                    }else{
                      alert("æ¥¼å®‡åç§°ä¸èƒ½ä¸ºç©ºã€‚");
                    }
                  }
                },
                {
                  xtype: 'button',
                  iconCls: 'exit',
                  text:'é€€å‡º',
                  handler: function() {
                    //this.up('window').hide();
                    Ext.getCmp('ly_disp_win').close();
                  }
                }]
            }]

          });
        }
        if(add_new==false){
        //è®¾ç½®æ•°æ®
          Ext.getCmp('ly_disp_form').getForm().setValues(record.data);

        }else{
          Ext.getCmp('ly_disp_win').title="æ–°å¢æ¥¼å®‡ä¿¡æ¯";
          Ext.getCmp('button_qz_add').text="æ–°å¢";
          Ext.getCmp('button_qz_add').iconCls="add";
        }

        win.show();
      };
      var ly_setup = function(){
        var win = Ext.getCmp('ly_setup_win');

        Ext.regModel('ly_setup_model', {
          fields: [
            {name: 'id',    type: 'integer'},
            {name: 'lymc',    type: 'string'},
            {name: 'lysm',    type: 'string'}

          ]
        });

        var ly_setup_store = Ext.create('Ext.data.Store', {
          id:'ly_setup_store',
          model : 'ly_setup_model',
          autoLoad: true,
          proxy: {
            type: 'ajax',
            url : '/desktop/get_zn_ly_grid',
            //extraParams: cx_tj,
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }
          //sortInfo:{field: 'level4', direction: "ASC"},
          //baseParams: {start:0, limit:25, query:""}
        });
        var ly_setup_grid = new Ext.grid.GridPanel({
          id : 'ly_setup_grid',
          store: ly_setup_store,        
          columns: [
            { text : 'id',  width : 0, sortable : true, dataIndex: 'id'},
            { text : 'æ¥¼å®‡åç§°',  width : 150, sortable : true, dataIndex: 'lymc'},
            { text : 'æ¥¼å®‡è¯´æ˜',  width : 250, sortable : true, dataIndex: 'lysm'}
            ],
            selType:'checkboxmodel',
            //multiSelect:true,
            listeners:{
              itemdblclick:{
                fn:function(v,r,i,n,e,b){
                  var tt=r.get("zrq");

                  //DispAj(r,false);
                }
              }
            },

          viewConfig: {
            stripeRows:true
          }
        });
        if (win==null) {
          win = new Ext.Window({
            id : 'ly_setup_win',
            title: 'æ¥¼å®‡è®¾ç½®',
            //closeAction: 'hide',
            width: 670,
            x : 300,
            y : 50,
            height: 500,
            minHeight: 500,
            layout: 'fit',
            //modal: true,
            plain: true,
            items:ly_setup_grid,          
            tbar:[{
              xtype: 'button',
              iconCls: 'add',
              text:'æ–°å¢',
              handler: function() {
                //this.up('window').hide();

                ly_disp("record",true);
              }
            },
            {
              xtype: 'button',
              iconCls: 'option',
              text:'ä¿®æ”¹',
              handler: function() {
                //this.up('window').hide();

                var grid = Ext.getCmp('ly_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];
                  ly_disp(record,false);
                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªæ¥¼å®‡è¿›è¡Œä¿®æ”¹ã€‚");
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'delete',
              text:'åˆ é™¤',
              handler: function() {
                var grid = Ext.getCmp('ly_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==0){
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªæ¥¼å®‡è¿›è¡Œåˆ é™¤ã€‚");

                }else{
                  var record = records[0];
                  var pars="id="+record.data.id;
                  Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¥¼å®‡åç§°ä¸ºï¼šï¼"+record.data.lymc+"çš„æ¥¼å®‡ï¼Ÿ",function callback(id){
                        if(id=="yes"){
                          new Ajax.Request("/desktop/delete_zn_ly", { 
                            method: "POST",
                            parameters: pars,
                            onComplete:  function(request) {
                              text=request.responseText.split(':');
                              if (request.responseText=='success'){
                                Ext.getCmp('ly_setup_grid').store.url='/desktop/get_ly_grid';
                                Ext.getCmp('ly_setup_grid').store.load();
                              }else{
                                if (text[0]=='false'){
                                  alert(text[1]);
                                }else{
                                  alert("åˆ é™¤å¤±è´¥ã€‚");
                                }

                              }
                            }
                          });
                        }else{
                          //alert('O,no');
                        }

                    }); 
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'exit',
              text:'é€€å‡º',
              handler: function() {
                //this.up('window').hide();
                Ext.getCmp('ly_setup_win').close();
              }
            }]

          });
        }


        win.show();
      };  

      var lc_disp = function(record,add_new){
        var win = Ext.getCmp('lc_disp_win');

        //qz_store.load();
        if (win==null) {
          win = new Ext.Window({
            id : 'lc_disp_win',
            title: 'ä¿®æ”¹æ¥¼å±‚ä¿¡æ¯',
            //closeAction: 'hide',
            width: 370,
            height: 180,
            //minHeight: 200,
            layout: 'fit',
            modal: true,
            plain: true,
            //items:user_setup_grid,          
            items: [{
              width: 370,
              height: 140,
              xtype:'form',
              layout: 'absolute',
              id : 'lc_disp_form',
              items: [
                {
                  xtype: 'label',
                  text: 'æ¥¼å±‚åç§°ï¼š',
                  x: 10,
                  y: 10,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'æ¥¼å±‚è¯´æ˜ï¼š',
                  x: 10,
                  y: 40,
                  width: 100
                },

                {
                  xtype: 'label',
                  text: 'æ‰€å±æ¥¼å®‡ï¼š',
                  x: 10,
                  y: 70,
                  width: 100
                },
                {
                  xtype: 'textfield',
                  hidden : true,
                  name : 'id' ,
                  id:'lc_id'                    
                },

                {
                  xtype: 'textfield',
                  x: 130,
                  y: 10,
                  width: 200,
                  name: 'lcmc',
                  id:'lc_lcmc'
                },
                {
                  xtype: 'textfield',
                  x: 130,
                  y: 40,
                  width: 200,
                  name: 'lcsm',
                  id:'lc_lcsm'
                },
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 70,
                  width: 200,
                  store: ly_store,
                  emptyText:'è¯·é€‰æ‹©',
                  mode: 'remote',
                  minChars : 2,
                  valueField:'id',
                  displayField:'lymc',
                  triggerAction:'all',
                  name: 'ssly',
                  id:'lc_ssly'
                }
              ],
              buttons:[{
                  xtype: 'button',
                  iconCls: 'option',
                  id:'button_qz_add',
                  text:'ä¿®æ”¹',
                  handler: function() {
                    var pars=this.up('panel').getForm().getValues();
                    if(pars['lcmc']!=''){
                      if(pars['lcsm']!=''){
                        if(pars['ssly']!=''){
                          if(add_new==false){
                            new Ajax.Request("/desktop/update_zn_lc", { 
                              method: "POST",
                              parameters: pars,
                              onComplete:  function(request) {
                                text=request.responseText.split(':');
                                if (request.responseText=='success'){

                                  Ext.getCmp('lc_disp_win').close();

                                  Ext.getCmp('lc_setup_grid').store.url='/desktop/get_zn_lc_grid';
                                  Ext.getCmp('lc_setup_grid').store.load();
                                }else{
                                  if (text[0]=='false'){
                                    alert(text[1]);
                                  }else{
                                    alert("ä¿®æ”¹å¤±è´¥ã€‚");
                                  }
                                }

                              }
                            });
                          }else{
                            new Ajax.Request("/desktop/insert_zn_lc", { 
                              method: "POST",
                              parameters: pars,
                              onComplete:  function(request) {
                                text=request.responseText.split(':');
                                if (text[0]=='success'){

                                  Ext.getCmp('lc_disp_win').close();
                                  Ext.getCmp('lc_setup_grid').store.url='/desktop/get_zn_lc_grid';
                                  Ext.getCmp('lc_setup_grid').store.load();
                                }else{
                                  if (text[0]=='false'){
                                    alert(text[1]);
                                  }else{
                                    alert("æ–°å¢å¤±è´¥ã€‚");
                                  }
                                }
                              }
                            });
                          }
                        }else{
                          alert("æ‰€å±æ¥¼å®‡è¯´æ˜ä¸èƒ½ä¸ºç©ºã€‚");
                        }
                      }else{
                        alert("æ¥¼å±‚è¯´æ˜ä¸èƒ½ä¸ºç©ºã€‚");
                      }
                    }else{
                      alert("æ¥¼å±‚åç§°ä¸èƒ½ä¸ºç©ºã€‚");
                    }
                  }
                },
                {
                  xtype: 'button',
                  iconCls: 'exit',
                  text:'é€€å‡º',
                  handler: function() {
                    //this.up('window').hide();
                    Ext.getCmp('lc_disp_win').close();
                  }
                }]
            }]

          });
        }
        if(add_new==false){
        //è®¾ç½®æ•°æ®
          Ext.getCmp('lc_disp_form').getForm().setValues(record.data);

        }else{
          Ext.getCmp('lc_disp_win').title="æ–°å¢æ¥¼å±‚ä¿¡æ¯";
          Ext.getCmp('button_qz_add').text="æ–°å¢";
          Ext.getCmp('button_qz_add').iconCls="add";
        }

        win.show();
      };
      var lc_setup = function(){
        var win = Ext.getCmp('lc_setup_win');

        Ext.regModel('lc_setup_model', {
          fields: [
            {name: 'id',    type: 'integer'},
            {name: 'lcmc',    type: 'string'},
            {name: 'lcsm',    type: 'string'},
            {name: 'lymc',    type: 'string'},
            {name: 'ssly',    type: 'integer'}

          ]
        });

        var lc_setup_store = Ext.create('Ext.data.Store', {
          id:'lc_setup_store',
          model : 'lc_setup_model',
          autoLoad: true,
          proxy: {
            type: 'ajax',
            url : '/desktop/get_zn_lc_grid',
            //extraParams: cx_tj,
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }
          //sortInfo:{field: 'level4', direction: "ASC"},
          //baseParams: {start:0, limit:25, query:""}
        });
        var lc_setup_grid = new Ext.grid.GridPanel({
          id : 'lc_setup_grid',
          store: lc_setup_store,        
          columns: [
            { text : 'id',  width : 0, sortable : true, dataIndex: 'id'},
            { text : 'æ¥¼å±‚åç§°',  width : 150, sortable : true, dataIndex: 'lcmc'},
            { text : 'æ¥¼å±‚è¯´æ˜',  width : 250, sortable : true, dataIndex: 'lcsm'},
            { text : 'æ‰€å±æ¥¼å®‡',  width : 250, sortable : true, dataIndex: 'lymc'}
            ],
            selType:'checkboxmodel',
            //multiSelect:true,
            listeners:{
              itemdblclick:{
                fn:function(v,r,i,n,e,b){
                  var tt=r.get("zrq");

                  //DispAj(r,false);
                }
              }
            },

          viewConfig: {
            stripeRows:true
          }
        });
        if (win==null) {
          win = new Ext.Window({
            id : 'lc_setup_win',
            title: 'æ¥¼å±‚è®¾ç½®',
            //closeAction: 'hide',
            width: 670,
            x : 300,
            y : 50,
            height: 500,
            minHeight: 500,
            layout: 'fit',
            //modal: true,
            plain: true,
            items:lc_setup_grid,          
            tbar:[{
              xtype: 'button',
              iconCls: 'add',
              text:'æ–°å¢',
              handler: function() {
                //this.up('window').hide();

                lc_disp("record",true);
              }
            },
            {
              xtype: 'button',
              iconCls: 'option',
              text:'ä¿®æ”¹',
              handler: function() {
                //this.up('window').hide();

                var grid = Ext.getCmp('lc_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];
                  lc_disp(record,false);
                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªæ¥¼å±‚è¿›è¡Œä¿®æ”¹ã€‚");
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'delete',
              text:'åˆ é™¤',
              handler: function() {
                var grid = Ext.getCmp('lc_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==0){
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªæ¥¼å±‚è¿›è¡Œåˆ é™¤ã€‚");

                }else{
                  var record = records[0];
                  var pars="id="+record.data.id;
                  Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¥¼å±‚åç§°ä¸ºï¼šï¼"+record.data.lcmc+"çš„æ¥¼å±‚ï¼Ÿ",function callback(id){
                        if(id=="yes"){
                          new Ajax.Request("/desktop/delete_zn_lc", { 
                            method: "POST",
                            parameters: pars,
                            onComplete:  function(request) {
                              text=request.responseText.split(':');
                              if (request.responseText=='success'){
                                Ext.getCmp('lc_setup_grid').store.url='/desktop/get_lc_grid';
                                Ext.getCmp('lc_setup_grid').store.load();
                              }else{
                                if (text[0]=='false'){
                                  alert(text[1]);
                                }else{
                                  alert("åˆ é™¤å¤±è´¥ã€‚");
                                }

                              }
                            }
                          });
                        }else{
                          //alert('O,no');
                        }

                    }); 
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'exit',
              text:'é€€å‡º',
              handler: function() {
                //this.up('window').hide();
                Ext.getCmp('lc_setup_win').close();
              }
            }]

          });
        }


        win.show();
      };  

      var fj_disp = function(record,add_new){
        var win = Ext.getCmp('fj_disp_win');

        //qz_store.load();
        if (win==null) {
          win = new Ext.Window({
            id : 'fj_disp_win',
            title: 'ä¿®æ”¹æˆ¿é—´ä¿¡æ¯',
            //closeAction: 'hide',
            width: 370,
            height: 210,
            //minHeight: 200,
            layout: 'fit',
            modal: true,
            plain: true,
            //items:user_setup_grid,          
            items: [{
              width: 370,
              height: 140,
              xtype:'form',
              layout: 'absolute',
              id : 'fj_disp_form',
              items: [
                {
                  xtype: 'label',
                  text: 'æˆ¿é—´å·ï¼š',
                  x: 10,
                  y: 10,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'æˆ¿é—´è¯´æ˜ï¼š',
                  x: 10,
                  y: 40,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'æ‰€å±æ¥¼å®‡ï¼š',
                  x: 10,
                  y: 70,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'æ‰€å±æ¥¼å±‚ï¼š',
                  x: 10,
                  y: 100,
                  width: 100
                },
                {
                  xtype: 'textfield',
                  hidden : true,
                  name : 'id' ,
                  id:'fj_id'                    
                },

                {
                  xtype: 'textfield',
                  x: 130,
                  y: 10,
                  width: 200,
                  name: 'fjmc',
                  id:'fj_fjmc'
                },
                {
                  xtype: 'textfield',
                  x: 130,
                  y: 40,
                  width: 200,
                  name: 'fjsm',
                  id:'fj_fjsm'
                },
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 70,
                  width: 200,
                  store: ly_store,
                  emptyText:'è¯·é€‰æ‹©',
                  mode: 'remote',
                  minChars : 2,
                  valueField:'id',
                  displayField:'lymc',
                  triggerAction:'all',
                  name: 'ssly',
                  id:'fj_ssly',
                  listConfig: { loadMask: false },
                  listeners:{  
                    select:function(combo, record,index){

                  //userAdd = record.data.name;
                    var parent=Ext.getCmp('fj_sslc');

                    parent.clearValue();

                    parent.store.load({params:{param:this.value}});
                    //Ext.getCmp('fj_sslc').lastQuery = null;
                    }

                  }

                },
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 100,
                  width: 200,
                  store: lc_store,
                  emptyText:'è¯·é€‰æ‹©',
                  queryMode:'local', 
                  minChars : 2,
                  valueField:'id',
                  displayField:'lcmc',
                  triggerAction:'all',
                  listConfig: { loadMask: false },
                  name: 'sslc',
                  id:'fj_sslc'
                }

              ],
              buttons:[{
                  xtype: 'button',
                  iconCls: 'option',
                  id:'button_qz_add',
                  text:'ä¿®æ”¹',
                  handler: function() {
                    var pars=this.up('panel').getForm().getValues();
                    if(pars['fjmc']!=''){
                      if(pars['fjsm']!=''){
                        if(pars['ssly']!=''){
                          if(add_new==false){
                            new Ajax.Request("/desktop/update_zn_fj", { 
                              method: "POST",
                              parameters: pars,
                              onComplete:  function(request) {
                                text=request.responseText.split(':');
                                if (request.responseText=='success'){

                                  Ext.getCmp('fj_disp_win').close();

                                  Ext.getCmp('fj_setup_grid').store.url='/desktop/get_zn_fj_grid';
                                  Ext.getCmp('fj_setup_grid').store.load();
                                }else{
                                  if (text[0]=='false'){
                                    alert(text[1]);
                                  }else{
                                    alert("ä¿®æ”¹å¤±è´¥ã€‚");
                                  }
                                }

                              }
                            });
                          }else{
                            new Ajax.Request("/desktop/insert_zn_fj", { 
                              method: "POST",
                              parameters: pars,
                              onComplete:  function(request) {
                                text=request.responseText.split(':');
                                if (text[0]=='success'){

                                  Ext.getCmp('fj_disp_win').close();
                                  Ext.getCmp('fj_setup_grid').store.url='/desktop/get_zn_fj_grid';
                                  Ext.getCmp('fj_setup_grid').store.load();
                                }else{
                                  if (text[0]=='false'){
                                    alert(text[1]);
                                  }else{
                                    alert("æ–°å¢å¤±è´¥ã€‚");
                                  }
                                }
                              }
                            });
                          }
                        }else{
                          alert("æ‰€å±æ¥¼å®‡è¯´æ˜ä¸èƒ½ä¸ºç©ºã€‚");
                        }
                      }else{
                        alert("æˆ¿é—´è¯´æ˜ä¸èƒ½ä¸ºç©ºã€‚");
                      }
                    }else{
                      alert("æˆ¿é—´å·ä¸èƒ½ä¸ºç©ºã€‚");
                    }
                  }
                },
                {
                  xtype: 'button',
                  iconCls: 'exit',
                  text:'é€€å‡º',
                  handler: function() {
                    //this.up('window').hide();
                    Ext.getCmp('fj_disp_win').close();
                  }
                }]
            }]

          });
        }
        if(add_new==false){
        //è®¾ç½®æ•°æ®
          Ext.getCmp('fj_disp_form').getForm().setValues(record.data);

        }else{
          Ext.getCmp('fj_disp_win').title="æ–°å¢æˆ¿é—´ä¿¡æ¯";
          Ext.getCmp('button_qz_add').text="æ–°å¢";
          Ext.getCmp('button_qz_add').iconCls="add";
        }

        win.show();
      };

      var fj_setup = function(){
        var win = Ext.getCmp('fj_setup_win');

        Ext.regModel('fj_setup_model', {
          fields: [
            {name: 'id',    type: 'integer'},
            {name: 'fjmc',    type: 'string'},
            {name: 'fjsm',    type: 'string'},
            {name: 'lymc',    type: 'string'},
            {name: 'ssly',    type: 'integer'},
            {name: 'lcmc',    type: 'string'},
            {name: 'sslc',    type: 'integer'}

          ]
        });

        var fj_setup_store = Ext.create('Ext.data.Store', {
          id:'fj_setup_store',
          model : 'fj_setup_model',
          autoLoad: true,
          proxy: {
            type: 'ajax',
            url : '/desktop/get_zn_fj_grid',
            //extraParams: cx_tj,
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }
          //sortInfo:{field: 'level4', direction: "ASC"},
          //baseParams: {start:0, limit:25, query:""}
        });
        var fj_setup_grid = new Ext.grid.GridPanel({
          id : 'fj_setup_grid',
          store: fj_setup_store,        
          columns: [
            { text : 'id',  width : 0, sortable : true, dataIndex: 'id'},
            { text : 'æˆ¿é—´å·', width : 70, sortable : true, dataIndex: 'fjmc'},
            { text : 'æˆ¿é—´è¯´æ˜',  width : 250, sortable : true, dataIndex: 'fjsm'},
            { text : 'æ‰€å±æ¥¼å±‚',  width : 100, sortable : true, dataIndex: 'lcmc'},
            { text : 'æ‰€å±æ¥¼å®‡',  width : 100, sortable : true, dataIndex: 'lymc'}
            ],
            selType:'checkboxmodel',
            //multiSelect:true,
            listeners:{
              itemdblclick:{
                fn:function(v,r,i,n,e,b){
                  var tt=r.get("zrq");

                  //DispAj(r,false);
                }
              }
            },

          viewConfig: {
            stripeRows:true
          }
        });
        if (win==null) {
          win = new Ext.Window({
            id : 'fj_setup_win',
            title: 'æˆ¿é—´è®¾ç½®',
            //closeAction: 'hide',
            width: 670,
            x : 300,
            y : 50,
            height: 500,
            minHeight: 500,
            layout: 'fit',
            //modal: true,
            plain: true,
            items:fj_setup_grid,          
            tbar:[{
              xtype: 'button',
              iconCls: 'add',
              text:'æ–°å¢',
              handler: function() {
                //this.up('window').hide();

                fj_disp("record",true);
              }
            },
            {
              xtype: 'button',
              iconCls: 'option',
              text:'ä¿®æ”¹',
              handler: function() {
                //this.up('window').hide();

                var grid = Ext.getCmp('fj_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];
                  fj_disp(record,false);
                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªæˆ¿é—´è¿›è¡Œä¿®æ”¹ã€‚");
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'delete',
              text:'åˆ é™¤',
              handler: function() {
                var grid = Ext.getCmp('fj_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==0){
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªæˆ¿é—´è¿›è¡Œåˆ é™¤ã€‚");

                }else{
                  var record = records[0];
                  var pars="id="+record.data.id;
                  Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æˆ¿é—´å·ä¸ºï¼šï¼"+record.data.fjmc+"çš„æˆ¿é—´ï¼Ÿ",function callback(id){
                        if(id=="yes"){
                          new Ajax.Request("/desktop/delete_zn_fj", { 
                            method: "POST",
                            parameters: pars,
                            onComplete:  function(request) {
                              text=request.responseText.split(':');
                              if (request.responseText=='success'){
                                Ext.getCmp('fj_setup_grid').store.url='/desktop/get_fj_grid';
                                Ext.getCmp('fj_setup_grid').store.load();
                              }else{
                                if (text[0]=='false'){
                                  alert(text[1]);
                                }else{
                                  alert("åˆ é™¤å¤±è´¥ã€‚");
                                }

                              }
                            }
                          });
                        }else{
                          //alert('O,no');
                        }

                    }); 
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'exit',
              text:'é€€å‡º',
              handler: function() {
                //this.up('window').hide();
                Ext.getCmp('fj_setup_win').close();
              }
            }]

          });
        }


        win.show();
      };  

      var sb_disp = function(record,add_new){
        var win = Ext.getCmp('sb_disp_win');

        //qz_store.load();
        if (win==null) {
          win = new Ext.Window({
            id : 'sb_disp_win',
            title: 'ä¿®æ”¹è®¾å¤‡ä¿¡æ¯',
            //closeAction: 'hide',
            width: 370,
            height: 360,
            //minHeight: 200,
            layout: 'fit',
            modal: true,
            plain: true,
            //items:user_setup_grid,          
            items: [{
              width: 370,
              height: 360,
              xtype:'form',
              layout: 'absolute',
              id : 'sb_disp_form',
              items: [
                {
                  xtype: 'label',
                  text: 'è®¾å¤‡åç§°ï¼š',
                  x: 10,
                  y: 10,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'è®¾å¤‡è¯´æ˜ï¼š',
                  x: 10,
                  y: 40,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'æ‰€å±æ¥¼å®‡ï¼š',
                  x: 10,
                  y: 70,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'æ‰€å±æ¥¼å±‚ï¼š',
                  x: 10,
                  y: 100,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'æ‰€å±æˆ¿é—´ï¼š',
                  x: 10,
                  y: 130,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'è®¾å¤‡ç±»å‹ï¼š',
                  x: 10,
                  y: 160,
                  width: 100
                },
				{
                  xtype: 'label',
                  text: 'ç¬¬å‡ è·¯ï¼š',
                  x: 10,
                  y: 190,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'è®¾å¤‡å·ï¼š',
                  x: 10,
                  y: 220,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'é¢å®šåŠŸç‡ï¼š',
                  x: 10,
                  y: 250,
                  width: 100
                },
                {
                  xtype: 'textfield',
                  hidden : true,
                  name : 'id' ,
                  id:'sb_id'                    
                },

                {
                  xtype: 'textfield',
                  x: 130,
                  y: 10,
                  width: 200,
                  name: 'sbmc',
                  id:'sb_sbmc'
                },
                {
                  xtype: 'textfield',
                  x: 130,
                  y: 40,
                  width: 200,
                  name: 'sbsm',
                  id:'sb_sbsm'
                },
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 70,
                  width: 200,
                  store: ly_store,
                  emptyText:'è¯·é€‰æ‹©',
                  mode: 'remote',
                  minChars : 2,
                  valueField:'id',
                  displayField:'lymc',
                  triggerAction:'all',
                  name: 'ssly',
                  id:'sb_ssly',
                  listConfig: { loadMask: false },
                  listeners:{  
                    select:function(combo, record,index){

                  //userAdd = record.data.name;
                    var parent=Ext.getCmp('sb_sslc');

                    parent.clearValue();

                    parent.store.load({params:{param:this.value}});
                    //Ext.getCmp('fj_sslc').lastQuery = null;
                    }

                  }

                },
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 100,
                  width: 200,
                  store: lc_store,
                  emptyText:'è¯·é€‰æ‹©',
                  queryMode:'local', 
                  minChars : 2,
                  valueField:'id',
                  displayField:'lcmc',
                  triggerAction:'all',
                  listConfig: { loadMask: false },
                  listeners:{  
                    select:function(combo, record,index){
                  //userAdd = record.data.name;
                    var parent=Ext.getCmp('sb_ssfj');
                    parent.clearValue();
                    parent.store.load({params:{param:this.value}});					
                    //Ext.getCmp('fj_sslc').lastQuery = null;
                    }
                  },
                  name: 'sslc',
                  id:'sb_sslc'
                },
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 130,
                  width: 200,
                  store: fj_store,
                  emptyText:'è¯·é€‰æ‹©',
                  queryMode:'local', 
                  minChars : 2,
                  valueField:'id',
                  displayField:'fjmc',
                  triggerAction:'all',
                  listConfig: { loadMask: false },
                  name: 'ssfj',
                  id:'sb_ssfj'
                },
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 160,
                  width: 200,
                  store: sblx_store,
                  emptyText:'è¯·é€‰æ‹©',
                  mode: 'remote',
                  minChars : 2,
                  valueField:'id',
                  displayField:'lxsm',
                  triggerAction:'all',
                  listConfig: { loadMask: false },
                  name: 'sblx',
                  id:'sb_sblx'
                },
				{
                  xtype: 'numberfield',
                  x: 130,
                  y: 190,
                  width: 200,
                  name: 'kgls',
                  id:'sb_kgls'
                },
                {
                  xtype: 'textfield',
                  x: 130,
                  y: 220,
                  width: 200,
                  name: 'sbh',
                  id:'sb_sbh'
                },
                {
                  xtype: 'textfield',
                  x: 130,
                  y: 250,
                  width: 200,
                  name: 'edgl',
                  id:'sb_edgl'
                }
                


              ],
              buttons:[{
                  xtype: 'button',
                  iconCls: 'option',
                  id:'button_qz_add',
                  text:'ä¿®æ”¹',
                  handler: function() {
                    var pars=this.up('panel').getForm().getValues();
                    if(pars['sbmc']!=''){
                      if(pars['sbsm']!=''){
                        if(pars['sbly']!=''){
                          if(add_new==false){
                            new Ajax.Request("/desktop/update_zn_sb", { 
                              method: "POST",
                              parameters: pars,
                              onComplete:  function(request) {
                                text=request.responseText.split(':');
                                if (request.responseText=='success'){

                                  Ext.getCmp('sb_disp_win').close();

                                  Ext.getCmp('sb_setup_grid').store.url='/desktop/get_zn_sb_grid';
                                  Ext.getCmp('sb_setup_grid').store.load();
                                }else{
                                  if (text[0]=='false'){
                                    alert(text[1]);
                                  }else{
                                    alert("ä¿®æ”¹å¤±è´¥ã€‚");
                                  }
                                }

                              }
                            });
                          }else{
                            new Ajax.Request("/desktop/insert_zn_sb", { 
                              method: "POST",
                              parameters: pars,
                              onComplete:  function(request) {
                                text=request.responseText.split(':');
                                if (text[0]=='success'){

                                  Ext.getCmp('sb_disp_win').close();
                                  Ext.getCmp('sb_setup_grid').store.url='/desktop/get_zn_sb_grid';
                                  Ext.getCmp('sb_setup_grid').store.load();
                                }else{
                                  if (text[0]=='false'){
                                    alert(text[1]);
                                  }else{
                                    alert("æ–°å¢å¤±è´¥ã€‚");
                                  }
                                }
                              }
                            });
                          }
                        }else{
                          alert("æ‰€å±æ¥¼å®‡ä¸èƒ½ä¸ºç©ºã€‚");
                        }
                      }else{
                        alert("è®¾å¤‡è¯´æ˜ä¸èƒ½ä¸ºç©ºã€‚");
                      }
                    }else{
                      alert("è®¾å¤‡åç§°ä¸èƒ½ä¸ºç©ºã€‚");
                    }
                  }
                },
                {
                  xtype: 'button',
                  iconCls: 'exit',
                  text:'é€€å‡º',
                  handler: function() {
                    //this.up('window').hide();
                    Ext.getCmp('sb_disp_win').close();
                  }
                }]
            }]

          });
        }
        if(add_new==false){
        //è®¾ç½®æ•°æ®
          Ext.getCmp('sb_disp_form').getForm().setValues(record.data);

        }else{
          Ext.getCmp('sb_disp_win').title="æ–°å¢è®¾å¤‡ä¿¡æ¯";
          Ext.getCmp('button_qz_add').text="æ–°å¢";
          Ext.getCmp('button_qz_add').iconCls="add";
        }

        win.show();
      };

      var sb_setup = function(){
        var win = Ext.getCmp('sb_setup_win');

        Ext.regModel('sb_setup_model', {
          fields: [
            {name: 'id',    type: 'integer'},
            {name: 'sbmc',    type: 'string'},
            {name: 'sbsm',    type: 'string'},
            {name: 'lymc',    type: 'string'},
            {name: 'ssly',    type: 'integer'},
            {name: 'lcmc',    type: 'string'},
            {name: 'sslc',    type: 'integer'},
            {name: 'fjmc',    type: 'string'},
            {name: 'ssfj',    type: 'integer'},
            {name: 'kzl',   type: 'string'},
            {name: 'sbh',   type: 'string'},
            {name: 'gzl',   type: 'string'},
            {name: 'edgl',    type: 'string'},
            {name: 'sblx',    type: 'integer'},
            {name: 'kgls',    type: 'integer'}

          ]
        });

        var sb_setup_store = Ext.create('Ext.data.Store', {
          id:'sb_setup_store',
          model : 'sb_setup_model',
          autoLoad: true,
          proxy: {
            type: 'ajax',
            url : '/desktop/get_zn_sb_grid',
            //extraParams: cx_tj,
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }
          //sortInfo:{field: 'level4', direction: "ASC"},
          //baseParams: {start:0, limit:25, query:""}
        });
        var sb_setup_grid = new Ext.grid.GridPanel({
          id : 'sb_setup_grid',
          store: sb_setup_store,        
          columns: [
            { text : 'id',  width : 0, sortable : true, dataIndex: 'id'},
            { text : 'è®¾å¤‡åç§°',  width : 70, sortable : true, dataIndex: 'sbmc'},
            { text : 'è®¾å¤‡è¯´æ˜',  width : 250, sortable : true, dataIndex: 'sbsm'},
            { text : 'æ‰€å±æˆ¿é—´',  width : 100, sortable : true, dataIndex: 'fjmc'},
            { text : 'æ‰€å±æ¥¼å±‚',  width : 100, sortable : true, dataIndex: 'lcmc'},
            { text : 'æ‰€å±æ¥¼å®‡',  width : 100, sortable : true, dataIndex: 'lymc'},
            { text : 'è®¾å¤‡å·', width : 100, sortable : true, dataIndex: 'sbh'},
            { text : 'é¢å®šåŠŸç‡',  width : 100, sortable : true, dataIndex: 'edgl'},
            { text : 'è®¾å¤‡ç±»å‹',  width : 100, sortable : true, dataIndex: 'sblx'}
            ],
            selType:'checkboxmodel',
            //multiSelect:true,
            listeners:{
              itemdblclick:{
                fn:function(v,r,i,n,e,b){
                  var tt=r.get("zrq");

                  //DispAj(r,false);
                }
              }
            },

          viewConfig: {
            stripeRows:true
          }
        });
        if (win==null) {
          win = new Ext.Window({
            id : 'sb_setup_win',
            title: 'è®¾å¤‡è®¾ç½®',
            //closeAction: 'hide',
            width: 670,
            x : 300,
            y : 50,
            height: 500,
            minHeight: 500,
            layout: 'fit',
            //modal: true,
            plain: true,
            items:sb_setup_grid,          
            tbar:[{
              xtype: 'button',
              iconCls: 'add',
              text:'æ–°å¢',
              handler: function() {
                //this.up('window').hide();

                sb_disp("record",true);
              }
            },

            {
              xtype: 'button',
              iconCls: 'option',
              text:'ä¿®æ”¹',
              handler: function() {
                //this.up('window').hide();

                var grid = Ext.getCmp('sb_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];
                  sb_disp(record,false);
                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªè®¾å¤‡è¿›è¡Œä¿®æ”¹ã€‚");
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'delete',
              text:'åˆ é™¤',
              handler: function() {
                var grid = Ext.getCmp('sb_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==0){
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªè®¾å¤‡è¿›è¡Œåˆ é™¤ã€‚");

                }else{
                  var record = records[0];
                  var pars="id="+record.data.id;
                  Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤è®¾å¤‡åç§°ä¸ºï¼šï¼"+record.data.sbmc+"çš„è®¾å¤‡ï¼Ÿ",function callback(id){
                        if(id=="yes"){
                          new Ajax.Request("/desktop/delete_zn_sb", { 
                            method: "POST",
                            parameters: pars,
                            onComplete:  function(request) {
                              text=request.responseText.split(':');
                              if (request.responseText=='success'){
                                Ext.getCmp('sb_setup_grid').store.url='/desktop/get_sb_grid';
                                Ext.getCmp('sb_setup_grid').store.load();
                              }else{
                                if (text[0]=='false'){
                                  alert(text[1]);
                                }else{
                                  alert("åˆ é™¤å¤±è´¥ã€‚");
                                }

                              }
                            }
                          });
                        }else{
                          //alert('O,no');
                        }

                    }); 
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'exit',
              text:'é€€å‡º',
              handler: function() {
                //this.up('window').hide();
                Ext.getCmp('sb_setup_win').close();
              }
            }]

          });
        }


        win.show();
      };  

      var qjms_disp = function(record,add_new){
        var win = Ext.getCmp('qjms_disp_win');

        //qz_store.load();
        if (win==null) {
          win = new Ext.Window({
            id : 'qjms_disp_win',
            title: 'ä¿®æ”¹æƒ…æ™¯æ¨¡å¼',
            //closeAction: 'hide',
            width: 370,
            height: 150,
            //minHeight: 200,
            layout: 'fit',
            modal: true,
            plain: true,
            //items:user_setup_grid,          
            items: [{
              width: 370,
              height: 150,
              xtype:'form',
              layout: 'absolute',
              id : 'qjms_disp_form',
              items: [
                {
                  xtype: 'label',
                  text: 'æƒ…æ™¯æ¨¡å¼åç§°ï¼š',
                  x: 10,
                  y: 10,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'æ‰€å±äººå‘˜ï¼š',
                  x: 10,
                  y: 40,
                  width: 100
                },
                {
                  xtype: 'textfield',
                  hidden : true,
                  name : 'id' ,
                  id:'qjms_id'                    
                },

                {
                  xtype: 'textfield',
                  x: 130,
                  y: 10,
                  width: 200,
                  name: 'msmc',
                  id:'qjms_msmc'
                },
                
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 40,
                  width: 200,
                  store: user_store,
                  emptyText:'è¯·é€‰æ‹©',
                  mode: 'remote',
                  minChars : 2,
                  valueField:'id',
                  displayField:'username',
                  triggerAction:'all',
                  name: 'userid',
                  id:'qjms_userid'

                }


              ],
              buttons:[{
                  xtype: 'button',
                  iconCls: 'option',
                  id:'button_qz_add',
                  text:'ä¿®æ”¹',
                  handler: function() {
                    var pars=this.up('panel').getForm().getValues();
                    if(pars['sbmc']!=''){
                      if(pars['sbsm']!=''){
                        if(pars['sbly']!=''){
                          if(add_new==false){
                            new Ajax.Request("/desktop/update_zn_qjms", { 
                              method: "POST",
                              parameters: pars,
                              onComplete:  function(request) {
                                text=request.responseText.split(':');
                                if (request.responseText=='success'){

                                  Ext.getCmp('qjms_disp_win').close();

                                  Ext.getCmp('qjms_setup_grid').store.url='/desktop/get_zn_qjms_grid';
                                  Ext.getCmp('qjms_setup_grid').store.load();
                                }else{
                                  if (text[0]=='false'){
                                    alert(text[1]);
                                  }else{
                                    alert("ä¿®æ”¹å¤±è´¥ã€‚");
                                  }
                                }

                              }
                            });
                          }else{
                            new Ajax.Request("/desktop/insert_zn_qjms", { 
                              method: "POST",
                              parameters: pars,
                              onComplete:  function(request) {
                                text=request.responseText.split(':');
                                if (text[0]=='success'){

                                  Ext.getCmp('qjms_disp_win').close();
                                  Ext.getCmp('qjms_setup_grid').store.url='/desktop/get_zn_qjms_grid';
                                  Ext.getCmp('qjms_setup_grid').store.load();
                                }else{
                                  if (text[0]=='false'){
                                    alert(text[1]);
                                  }else{
                                    alert("æ–°å¢å¤±è´¥ã€‚");
                                  }
                                }
                              }
                            });
                          }
                        }else{
                          alert("æ‰€å±æ¥¼å®‡ä¸èƒ½ä¸ºç©ºã€‚");
                        }
                      }else{
                        alert("è®¾å¤‡è¯´æ˜ä¸èƒ½ä¸ºç©ºã€‚");
                      }
                    }else{
                      alert("è®¾å¤‡åç§°ä¸èƒ½ä¸ºç©ºã€‚");
                    }
                  }
                },
                {
                  xtype: 'button',
                  iconCls: 'exit',
                  text:'é€€å‡º',
                  handler: function() {
                    //this.up('window').hide();
                    Ext.getCmp('qjms_disp_win').close();
                  }
                }]
            }]

          });
        }
        if(add_new==false){
        //è®¾ç½®æ•°æ®
          Ext.getCmp('qjms_disp_form').getForm().setValues(record.data);

        }else{
          Ext.getCmp('qjms_disp_win').title="æ–°å¢æƒ…æ™¯æ¨¡å¼";
          Ext.getCmp('button_qz_add').text="æ–°å¢";
          Ext.getCmp('button_qz_add').iconCls="add";
        }

        win.show();
      };
      var qjms_setup = function(){
        var win = Ext.getCmp('qjms_setup_win');

        Ext.regModel('qjms_setup_model', {
          fields: [
            {name: 'id',    type: 'integer'},
            {name: 'msmc',    type: 'string'},
            {name: 'userid',    type: 'integer'},
            {name: 'username',    type: 'string'}
            

          ]
        });

        var qjms_setup_store = Ext.create('Ext.data.Store', {
          id:'qjms_setup_store',
          model : 'qjms_setup_model',
          autoLoad: true,
          proxy: {
            type: 'ajax',
            url : '/desktop/get_zn_qjms_grid',
            //extraParams: cx_tj,
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }
          //sortInfo:{field: 'level4', direction: "ASC"},
          //baseParams: {start:0, limit:25, query:""}
        });
        var qjms_setup_grid = new Ext.grid.GridPanel({
          id : 'qjms_setup_grid',
          store: qjms_setup_store,        
          columns: [
            { text : 'id',  width : 0, sortable : true, dataIndex: 'id'},
            { text : 'æƒ…æ™¯æ¨¡å¼åç§°',  width : 100, sortable : true, dataIndex: 'msmc'},
            { text : 'æ‰€å±äººå‘˜',  width : 150, sortable : true, dataIndex: 'username'}
            
            ],
            selType:'checkboxmodel',
            //multiSelect:true,
            listeners:{
              itemdblclick:{
                fn:function(v,r,i,n,e,b){
                  var tt=r.get("zrq");

                  //DispAj(r,false);
                }
              }
            },

          viewConfig: {
            stripeRows:true
          }
        });
        if (win==null) {
          win = new Ext.Window({
            id : 'qjms_setup_win',
            title: 'æƒ…æ™¯æ¨¡å¼åç§°è®¾ç½®',
            //closeAction: 'hide',
            width: 670,
            x : 300,
            y : 50,
            height: 500,
            minHeight: 500,
            layout: 'fit',
            //modal: true,
            plain: true,
            items:qjms_setup_grid,          
            tbar:[{
              xtype: 'button',
              iconCls: 'add',
              text:'æ–°å¢',
              handler: function() {
                //this.up('window').hide();

                qjms_disp("record",true);
              }
            },

            {
              xtype: 'button',
              iconCls: 'option',
              text:'ä¿®æ”¹',
              handler: function() {
                //this.up('window').hide();

                var grid = Ext.getCmp('qjms_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];
                  qjms_disp(record,false);
                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªæƒ…æ™¯æ¨¡å¼è¿›è¡Œä¿®æ”¹ã€‚");
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'delete',
              text:'åˆ é™¤',
              handler: function() {
                var grid = Ext.getCmp('qjms_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==0){
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªæƒ…æ™¯æ¨¡å¼è¿›è¡Œåˆ é™¤ã€‚");

                }else{
                  var record = records[0];
                  var pars="id="+record.data.id;
                  Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æƒ…æ™¯æ¨¡å¼åç§°ä¸ºï¼šï¼"+record.data.fjmc+"çš„æƒ…æ™¯æ¨¡å¼ï¼Ÿ",function callback(id){
                        if(id=="yes"){
                          new Ajax.Request("/desktop/delete_qjms", { 
                            method: "POST",
                            parameters: pars,
                            onComplete:  function(request) {
                              text=request.responseText.split(':');
                              if (request.responseText=='success'){
                                Ext.getCmp('qjms_setup_grid').store.url='/desktop/get_qjms_grid';
                                Ext.getCmp('qjms_setup_grid').store.load();
                              }else{
                                if (text[0]=='false'){
                                  alert(text[1]);
                                }else{
                                  alert("åˆ é™¤å¤±è´¥ã€‚");
                                }

                              }
                            }
                          });
                        }else{
                          //alert('O,no');
                        }

                    }); 
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'exit',
              text:'é€€å‡º',
              handler: function() {
                //this.up('window').hide();
                Ext.getCmp('qjms_setup_win').close();
              }
            }]

          });
        }


        win.show();
      };  


      var qjms_sb_cz_setup = function(){
        var win = Ext.getCmp('qjms_sb_cz_setup_win');

        Ext.regModel('qjms_sb_cz_setup_model', {
          fields: [
            {name: 'id',    type: 'integer'},
            {name: 'sbmc',    type: 'string'},
            {name: 'sbid',    type: 'integer'},
            {name: 'qjmsid',    type: 'integer'},
            {name: 'sbczid',    type: 'integer'},
            {name: 'czsm',    type: 'string'},
            {name: 'msmc',    type: 'string'}

          ]
        });

        var qjms_sb_cz_setup_store = Ext.create('Ext.data.Store', {
          id:'qjms_sb_cz_setup_store',
          model : 'qjms_sb_cz_setup_model',
          autoLoad: true,
          proxy: {
            type: 'ajax',
            url : '/desktop/get_zn_qjms_sb_cz_grid',
            extraParams: {query:""},
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }
          //sortInfo:{field: 'level4', direction: "ASC"},
          //baseParams: {start:0, limit:25, query:""}
        });
        var qjms_sb_cz_setup_grid = new Ext.grid.GridPanel({
          id : 'qjms_sb_cz_setup_grid',
          store: qjms_sb_cz_setup_store,        
          columns: [
            { text : 'id',  width : 0, sortable : true, dataIndex: 'id'},
            { text : 'è®¾å¤‡åç§°',  width : 70, sortable : true, dataIndex: 'sbmc'},
            { text : 'æ“ä½œè¯´æ˜',  width : 70, sortable : true, dataIndex: 'czsm'},
            { text : 'æƒ…æ™¯æ¨¡å¼',  width : 100, sortable : true, dataIndex: 'msmc'}
            
            ],
            selType:'checkboxmodel',
            //multiSelect:true,
            listeners:{
              itemdblclick:{
                fn:function(v,r,i,n,e,b){
                  var tt=r.get("zrq");

                  //DispAj(r,false);
                }
              }
            },

          viewConfig: {
            stripeRows:true
          }
        });

        var qjms_tree_store = Ext.create('Ext.data.TreeStore', {
            autoLoad: true,
            proxy: {
                type: 'ajax',
                url: 'desktop/get_qjms_tree',
                extraParams: {userid:currentUser.id},
                actionMethods: 'POST'
            }
        }); 
        var qjms_tree_panel = Ext.create('Ext.tree.Panel', {
          id : 'qjms_tree_panel',
          store: qjms_tree_store,
          rootVisible:false,
          useArrows: true,
          singleExpand: true,
          width: 200,
          listeners:{
            checkchange:function(node,checked,option){
              if(checked){
                root=Ext.getCmp('qjms_tree_panel').store.getRootNode();     
                getNodes(root,false);
                node.data.checked=true;
                node.updateInfo({checked:true});
                data=node.data;
                qjms_id=data.id;
                qjms_name=data.text;
                Ext.getCmp('qjms_sb_cz_setup_grid').store.proxy.extraParams.query=  data.id;
                Ext.getCmp('qjms_sb_cz_setup_grid').store.proxy.extraParams.userid= currentUser.id;
                Ext.getCmp('qjms_sb_cz_setup_grid').store.url='/desktop/get_zn_qjms_sb_cz_grid';
                Ext.getCmp('qjms_sb_cz_setup_grid').store.load();
              }
            }
          }
        });
      
        if (win==null) {
          win = new Ext.Window({
            id : 'qjms_sb_cz_setup_win',
            title: 'æƒ…æ™¯æ¨¡å¼è®¾å¤‡æ“ä½œè®¾ç½®',
            x : 300,
            y : 50,
            width: 670,
            height: 500,
            minHeight: 500,
            layout: 'border',
            //modal: true,
            plain: true,          
            items: [
              { title:'æƒ…æ™¯æ¨¡å¼æ ‘',
                region:'west',
                iconCls:'users',
                xtype:'panel',
                margins:'0 0 0 0',
                width: 200,
                collapsible:true,//å¯ä»¥è¢«æŠ˜å               
                layout:'fit',
                split:true,
                items:qjms_tree_panel

              },
              { title:'è®¾å¤‡æ“ä½œåˆ—è¡¨',
                region:'center',
                iconCls:'dept_tree',
                xtype:'panel',
                margins:'0 0 0 0',
                //width: 250,
                //collapsible:true,//å¯ä»¥è¢«æŠ˜å             
                //id:'user-qx-tree',
                layout:'fit',
                split:true,
                items:qjms_sb_cz_setup_grid
              }
            ],

            tbar:[{
              xtype: 'button',
              iconCls: 'add',
              text:'æ–°å¢è®¾å¤‡æ“ä½œ',
              handler: function() {
                //this.up('window').hide();

                qjms_sb_cz_disp("record",true);
              }
            },

            {
              xtype: 'button',
              iconCls: 'option',
              text:'ä¿®æ”¹è®¾å¤‡æ“ä½œ',
              handler: function() {
                //this.up('window').hide();

                var grid = Ext.getCmp('qjms_sb_cz_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];
                  qjms_sb_cz_disp(record,false);
                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªè®¾å¤‡æ“ä½œè¿›è¡Œä¿®æ”¹ã€‚");
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'delete',
              text:'åˆ é™¤è®¾å¤‡æ“ä½œ',
              handler: function() {
                var grid = Ext.getCmp('qjms_sb_cz_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==0){
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªè®¾å¤‡æ“ä½œè¿›è¡Œåˆ é™¤ã€‚");

                }else{
                  var record = records[0];
                  var pars="id="+record.data.id;
                  Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤è®¾å¤‡åç§°ä¸ºï¼šï¼"+record.data.sbmc+"çš„" + record.data.czsm + "æ“ä½œï¼Ÿ",function callback(id){
                        if(id=="yes"){
                          new Ajax.Request("/desktop/delete_zn_qjms_sb_cz", { 
                            method: "POST",
                            parameters: pars,
                            onComplete:  function(request) {
                              text=request.responseText.split(':');
                              if (request.responseText=='success'){
                                Ext.getCmp('qjms_sb_cz_setup_grid').store.url='/desktop/get_zn_qjms_sb_cz_grid';
                                Ext.getCmp('qjms_sb_cz_setup_grid').store.load();
                              }else{
                                if (text[0]=='false'){
                                  alert(text[1]);
                                }else{
                                  alert("åˆ é™¤å¤±è´¥ã€‚");
                                }

                              }
                            }
                          });
                        }else{
                          //alert('O,no');
                        }

                    });
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'save',
              text:'è¿è¡Œæƒ…æ™¯æ¨¡å¼',
              handler: function() {
                var grid = Ext.getCmp('qjms_sb_cz_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (qjms_id==""){
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªæƒ…æ„æ¨¡å¼è¿›è¡Œæ“ä½œã€‚");

                }else{
                  Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦å¼€å¯åç§°ä¸ºï¼šï¼"+qjms_name+"çš„æƒ…æ™¯æ¨¡å¼ï¼Ÿ",function callback(id){
                        if(id=="yes"){
                          new Ajax.Request("/desktop/insert_zn_sb_cz", { 
                            method: "POST",
                            parameters: {qjms_id:qjms_id},
                            onComplete:  function(request) {
                              text=request.responseText.split(':');
                              if (request.responseText=='success'){
                                alert("æ­£åœ¨å¼€å¯ã€‚");
                              }else{
                                if (text[0]=='false'){
                                  alert(text[1]);
                                }else{
                                  alert("å¼€å¯å¤±è´¥ã€‚");
                                }

                              }
                            }
                          });
                        }else{
                          //alert('O,no');
                        }

                    });
                  
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'exit',
              text:'é€€å‡º',
              handler: function() {
                //this.up('window').hide();
                Ext.getCmp('qjms_sb_cz_setup_win').close();
              }
            }]

          });
        }


        win.show();
      };

      var qjms_sb_cz_disp = function(record,add_new){
        var win = Ext.getCmp('qjms_sb_cz_disp_win');

        //qz_store.load();
        if (win==null) {
          win = new Ext.Window({
            id : 'qjms_sb_cz_disp_win',
            title: 'ä¿®æ”¹æƒ…æ™¯æ¨¡å¼è®¾å¤‡æ“ä½œ',
            //closeAction: 'hide',
            width: 370,
            height: 210,
            //minHeight: 200,
            layout: 'fit',
            modal: true,
            plain: true,
            //items:user_setup_grid,          
            items: [{
              width: 370,
              height: 140,
              xtype:'form',
              layout: 'absolute',
              id : 'qjms_sb_cz_disp_form',
              items: [
                {
                  xtype: 'label',
                  text: 'æƒ…æ™¯æ¨¡å¼åç§°ï¼š',
                  x: 10,
                  y: 10,
                  width: 100
                },
                
                {
                  xtype: 'label',
                  text: 'è®¾å¤‡åç§°ï¼š',
                  x: 10,
                  y: 40,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'è®¾å¤‡æ“ä½œï¼š',
                  x: 10,
                  y: 70,
                  width: 100
                },
                {
                  xtype: 'textfield',
                  hidden : true,
                  name : 'id' ,
                  id:'qjms_sb_cz_id'                    
                },

                
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 10,
                  width: 200,
                  store: qjms_store,
                  emptyText:'è¯·é€‰æ‹©',
                  mode: 'remote',
                  minChars : 2,
                  valueField:'id',
                  displayField:'msmc',
                  //triggerAction:'all',
                  listConfig: { loadMask: false },
                  name: 'qjmsid',
                  id:'qjms_sb_cz_qjmsid'
                },
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 40,
                  width: 200,
                  store: sb_store,
                  emptyText:'è¯·é€‰æ‹©',
                  mode: 'remote',
                  minChars : 2,
                  valueField:'sbid',
                  displayField:'sbmc',
                  triggerAction:'all',
                  name: 'sbid',
                  id:'qjms_sb_cz_sbid',
                  listConfig: { loadMask: false },
                  listeners:{  
                    select:function(combo, record,index){

                  //userAdd = record.data.name;
                    var parent=Ext.getCmp('qjms_sb_cz_sbczid');

                    parent.clearValue();

                    parent.store.load({params:{sbid:this.value}});
                    //Ext.getCmp('fj_sslc').lastQuery = null;
                    }

                  }

                },
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 70,
                  width: 200,
                  store: sb_cz_store,
                  emptyText:'è¯·é€‰æ‹©',
                  queryMode:'local', 
                  minChars : 2,
                  valueField:'czid',
                  displayField:'czsm',
                  triggerAction:'all',
                  listConfig: { loadMask: false },
                  name: 'sbczid',
                  id:'qjms_sb_cz_sbczid'
                }

              ],
              buttons:[{
                  xtype: 'button',
                  iconCls: 'option',
                  id:'button_qz_add',
                  text:'ä¿®æ”¹',
                  handler: function() {
                    var pars=this.up('panel').getForm().getValues();
                    if(pars['sbczid']!=''){
                      if(pars['sbid']!=''){
                        if(pars['qjmsid']!=''){
                          if(add_new==false){
                            new Ajax.Request("/desktop/update_zn_qjms_sb_cz", { 
                              method: "POST",
                              parameters: pars,
                              onComplete:  function(request) {
                                text=request.responseText.split(':');
                                if (request.responseText=='success'){

                                  Ext.getCmp('qjms_sb_cz_disp_win').close();

                                  Ext.getCmp('qjms_sb_cz_setup_grid').store.url='/desktop/get_zn_qjms_sb_cz_grid';
                                  Ext.getCmp('qjms_sb_cz_setup_grid').store.load();
                                }else{
                                  if (text[0]=='false'){
                                    alert(text[1]);
                                  }else{
                                    alert("ä¿®æ”¹å¤±è´¥ã€‚");
                                  }
                                }

                              }
                            });
                          }else{
                            new Ajax.Request("/desktop/insert_zn_qjms_sb_cz", { 
                              method: "POST",
                              parameters: pars,
                              onComplete:  function(request) {
                                text=request.responseText.split(':');
                                if (text[0]=='success'){

                                  Ext.getCmp('qjms_sb_cz_disp_win').close();
                                  Ext.getCmp('qjms_sb_cz_setup_grid').store.url='/desktop/get_zn_qjms_sb_cz_grid';
                                  Ext.getCmp('qjms_sb_cz_setup_grid').store.load();
                                }else{
                                  if (text[0]=='false'){
                                    alert(text[1]);
                                  }else{
                                    alert("æ–°å¢å¤±è´¥ã€‚");
                                  }
                                }
                              }
                            });
                          }
                        }else{
                          alert("æƒ…æ™¯æ¨¡å¼ä¸èƒ½ä¸ºç©ºã€‚");
                        }
                      }else{
                        alert("è®¾å¤‡ä¸èƒ½ä¸ºç©ºã€‚");
                      }
                    }else{
                      alert("è®¾å¤‡æ“ä½œä¸èƒ½ä¸ºç©ºã€‚");
                    }
                  }
                },
                {
                  xtype: 'button',
                  iconCls: 'exit',
                  text:'é€€å‡º',
                  handler: function() {
                    //this.up('window').hide();
                    Ext.getCmp('qjms_sb_cz_disp_win').close();
                  }
                }]
            }]

          });
        }
        if(add_new==false){
        //è®¾ç½®æ•°æ®
          Ext.getCmp('qjms_sb_cz_disp_form').getForm().setValues(record.data);

        }else{
          Ext.getCmp('qjms_sb_cz_disp_win').title="æ–°å¢æƒ…æ™¯æ¨¡å¼è®¾å¤‡æ“ä½œ";
          Ext.getCmp('button_qz_add').text="æ–°å¢";
          Ext.getCmp('button_qz_add').iconCls="add";
        }

        win.show();
      };


      var cz_rz_setup = function(){
        var win = Ext.getCmp('cz_rz_setup_win');

        Ext.regModel('cz_rz_setup_model', {
          fields: [
            {name: 'id',    type: 'integer'},
            {name: 'czsm',    type: 'string'},
            {name: 'czid',    type: 'integer'},
            {name: 'userid',    type: 'integer'},
            {name: 'sbmc',    type: 'string'},
            {name: 'wdz',   type: 'string'},
            {name: 'sdz',   type: 'string'},
            {name: 'dlz',   type: 'string'},
            {name: 'fjmc',    type: 'string'},
            {name: 'lcmc',    type: 'string'},
            {name: 'lymc',    type: 'string'},
            {name: 'rq',    type: 'date', dateFormat: 'Y-m-d H:i:s'}

          ]
        });

        var cz_rz_setup_store = Ext.create('Ext.data.Store', {
          id:'cz_rz_setup_store',
          model : 'cz_rz_setup_model',
          autoLoad: true,
          proxy: {
            type: 'ajax',
            url : '/desktop/get_cz_rz_grid',
            //extraParams: cx_tj,
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }
          //sortInfo:{field: 'level4', direction: "ASC"},
          //baseParams: {start:0, limit:25, query:""}
        });
        var cz_rz_setup_grid = new Ext.grid.GridPanel({
          id : 'cz_rz_setup_grid',
          store: cz_rz_setup_store,       
          columns: [
            { text : 'id',  width : 0, sortable : true, dataIndex: 'id'},
            { text : 'æ“ä½œè¯´æ˜',  width : 100, sortable : true, dataIndex: 'czsm',renderer:ztRender},
            { text : 'è®¾å¤‡åç§°',  width : 150, sortable : true, dataIndex: 'sbmc'},
            { text : 'æˆ¿é—´åç§°',  width : 50, sortable : true, dataIndex: 'fjmc'},
            { text : 'æ¥¼å±‚åç§°',  width : 50, sortable : true, dataIndex: 'lcmc'},
            { text : 'æ¥¼å®‡åç§°',  width : 100, sortable : true, dataIndex: 'lymc'},         
            { text : 'æ¸©åº¦å€¼', width : 50, sortable : true, dataIndex: 'wdz'},
            { text : 'æ¹¿åº¦å€¼', width : 50, sortable : true, dataIndex: 'sdz'},
            { text : 'ç”µæµå€¼', width : 50, sortable : true, dataIndex: 'dlz'},
            { text : 'æ—¥æœŸ',  width : 150, sortable : true, dataIndex: 'rq', renderer: Ext.util.Format.dateRenderer('Y-m-d H:i:s')}
            ],
            selType:'checkboxmodel',
            //multiSelect:true,
            listeners:{
              itemdblclick:{
                fn:function(v,r,i,n,e,b){
                  var tt=r.get("zrq");

                  //DispAj(r,false);
                }
              }
            },

          viewConfig: {
            stripeRows:true
          }
        });
        if (win==null) {
          win = new Ext.Window({
            id : 'cz_rz_setup_win',
            title: 'è®¾å¤‡æ“ä½œæ—¥å¿—',
            //closeAction: 'hide',
            width: 670,
            x : 300,
            y : 50,
            height: 500,
            minHeight: 500,
            layout: 'fit',
            //modal: true,
            plain: true,
            items:cz_rz_setup_grid,         
            tbar:[{
              xtype: 'button',
              iconCls: 'add',
              text:'æ–°å¢',
              handler: function() {
                //this.up('window').hide();

                ly_disp("record",true);
              }
            },
            {
              xtype: 'button',
              iconCls: 'option',
              text:'ä¿®æ”¹',
              handler: function() {
                //this.up('window').hide();

                var grid = Ext.getCmp('ly_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];
                  ly_disp(record,false);
                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªæ¥¼å®‡è¿›è¡Œä¿®æ”¹ã€‚");
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'delete',
              text:'åˆ é™¤',
              handler: function() {
                var grid = Ext.getCmp('ly_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==0){
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªæ¥¼å®‡è¿›è¡Œåˆ é™¤ã€‚");

                }else{
                  var record = records[0];
                  var pars="id="+record.data.id;
                  Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¥¼å®‡åç§°ä¸ºï¼šï¼"+record.data.lymc+"çš„æ¥¼å®‡ï¼Ÿ",function callback(id){
                        if(id=="yes"){
                          new Ajax.Request("/desktop/delete_zn_ly", { 
                            method: "POST",
                            parameters: pars,
                            onComplete:  function(request) {
                              text=request.responseText.split(':');
                              if (request.responseText=='success'){
                                Ext.getCmp('ly_setup_grid').store.url='/desktop/get_ly_grid';
                                Ext.getCmp('ly_setup_grid').store.load();
                              }else{
                                if (text[0]=='false'){
                                  alert(text[1]);
                                }else{
                                  alert("åˆ é™¤å¤±è´¥ã€‚");
                                }

                              }
                            }
                          });
                        }else{
                          //alert('O,no');
                        }

                    }); 
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'exit',
              text:'é€€å‡º',
              handler: function() {
                //this.up('window').hide();
                Ext.getCmp('cz_rz_setup_win').close();
              }
            }]

          });
        }


        win.show();
      };  


      var sb_nx_setup = function(){
        var win = Ext.getCmp('sb_nx_setup_win');

        Ext.regModel('sb_nx_setup_model', {
          fields: [
            {name: 'id',    type: 'integer'},
            {name: 'czsm',    type: 'string'},
            {name: 'czid',    type: 'integer'},
            {name: 'sbid',    type: 'integer'},
            {name: 'nxdj',    type: 'integer'},
            {name: 'sbmc',    type: 'string'}
            

          ]
        });

        var sb_nx_setup_store = Ext.create('Ext.data.Store', {
          id:'sb_nx_setup_store',
          model : 'sb_nx_setup_model',
          autoLoad: true,
          proxy: {
            type: 'ajax',
            url : '/desktop/get_sb_nx_grid',
            //extraParams: cx_tj,
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }
          //sortInfo:{field: 'level4', direction: "ASC"},
          //baseParams: {start:0, limit:25, query:""}
        });
        var sb_nx_setup_grid = new Ext.grid.GridPanel({
          id : 'sb_nx_setup_grid',
          store: sb_nx_setup_store,       
          columns: [
            { text : 'id',  width : 0, sortable : true, dataIndex: 'id'},
            { text : 'æ“ä½œè¯´æ˜',  width : 100, sortable : true, dataIndex: 'czsm',renderer:ztRender},
            { text : 'è®¾å¤‡åç§°',  width : 150, sortable : true, dataIndex: 'sbmc'},
            { text : 'è½®å·¡ç­‰çº§',  width : 50, sortable : true, dataIndex: 'nxdj'}
            
            ],
            selType:'checkboxmodel',
            //multiSelect:true,
            listeners:{
              itemdblclick:{
                fn:function(v,r,i,n,e,b){
                  var tt=r.get("zrq");

                  //DispAj(r,false);
                }
              }
            },

          viewConfig: {
            stripeRows:true
          }
        });
        if (win==null) {
          win = new Ext.Window({
            id : 'sb_nx_setup_win',
            title: 'è®¾å¤‡è½®å·¡è®¾ç½®',
            //closeAction: 'hide',
            width: 670,
            x : 300,
            y : 50,
            height: 500,
            minHeight: 500,
            layout: 'fit',
            //modal: true,
            plain: true,
            items:sb_nx_setup_grid,         
            tbar:[{
              xtype: 'button',
              iconCls: 'add',
              text:'æ–°å¢',
              handler: function() {
                //this.up('window').hide();

                sb_nx_disp("record",true);
              }
            },
            {
              xtype: 'button',
              iconCls: 'option',
              text:'ä¿®æ”¹',
              handler: function() {
                //this.up('window').hide();

                var grid = Ext.getCmp('sb_nx_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==1){
                  var record = records[0];
                  sb_nx_disp(record,false);
                }else{
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªè®¾å¤‡è½®å·¡è¿›è¡Œä¿®æ”¹ã€‚");
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'delete',
              text:'åˆ é™¤',
              handler: function() {
                var grid = Ext.getCmp('sb_nx_setup_grid');
                var records = grid.getSelectionModel().getSelection();
                if (records.length==0){
                  alert("è¯·é€‰æ‹©ä¸€ä¸ªè®¾å¤‡è½®å·¡è¿›è¡Œåˆ é™¤ã€‚");

                }else{
                  var record = records[0];
                  var pars="id="+record.data.id;
                  Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦æŠŠåç§°ä¸ºï¼š"+record.data.sbmc+"ä»è½®å·¡ä¸­çš„åˆ é™¤ï¼Ÿ",function callback(id){
                        if(id=="yes"){
                          new Ajax.Request("/desktop/delete_sb_nx", { 
                            method: "POST",
                            parameters: pars,
                            onComplete:  function(request) {
                              text=request.responseText.split(':');
                              if (request.responseText=='success'){
                                Ext.getCmp('sb_nx_setup_grid').store.url='/desktop/get_sb_nx_grid';
                                Ext.getCmp('sb_nx_setup_grid').store.load();
                              }else{
                                if (text[0]=='false'){
                                  alert(text[1]);
                                }else{
                                  alert("åˆ é™¤å¤±è´¥ã€‚");
                                }

                              }
                            }
                          });
                        }else{
                          //alert('O,no');
                        }

                    }); 
                }
              }
            },
            {
              xtype: 'button',
              iconCls: 'exit',
              text:'é€€å‡º',
              handler: function() {
                //this.up('window').hide();
                Ext.getCmp('sb_nx_setup_win').close();
              }
            }]

          });
        }


        win.show();
      };  
      var sb_nx_disp = function(record,add_new){
        var win = Ext.getCmp('sb_nx_disp_win');

        //qz_store.load();
        if (win==null) {
          win = new Ext.Window({
            id : 'sb_nx_disp_win',
            title: 'ä¿®æ”¹è®¾å¤‡è½®å·¡æ“ä½œ',
            //closeAction: 'hide',
            width: 370,
            height: 170,
            //minHeight: 200,
            layout: 'fit',
            modal: true,
            plain: true,
            //items:user_setup_grid,          
            items: [{
              width: 370,
              height: 170,
              xtype:'form',
              layout: 'absolute',
              id : 'sb_nx_disp_form',
              items: [
                
                
                {
                  xtype: 'label',
                  text: 'è®¾å¤‡åç§°ï¼š',
                  x: 10,
                  y: 10,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'è®¾å¤‡æ“ä½œï¼š',
                  x: 10,
                  y: 40,
                  width: 100
                },
                {
                  xtype: 'label',
                  text: 'è½®å·¡ç­‰çº§ï¼š',
                  x: 10,
                  y: 70,
                  width: 100
                },
                {
                  xtype: 'textfield',
                  hidden : true,
                  name : 'id' ,
                  id:'sb_nx_id'                   
                },

                
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 10,
                  width: 200,
                  store: sb_store,
                  emptyText:'è¯·é€‰æ‹©',
                  mode: 'remote',
                  minChars : 2,
                  valueField:'sbid',
                  displayField:'sbmc',
                  triggerAction:'all',
                  name: 'sbid',
                  id:'sb_nx_sbid',
                  listConfig: { loadMask: false },
                  listeners:{  
                    select:function(combo, record,index){

                  //userAdd = record.data.name;
                    var parent=Ext.getCmp('sb_nx_sbczid');

                    parent.clearValue();

                    parent.store.load({params:{sbid:this.value}});
                    //Ext.getCmp('fj_sslc').lastQuery = null;
                    }

                  }

                },
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 40,
                  width: 200,
                  store: sb_cz_store,
                  emptyText:'è¯·é€‰æ‹©',
                  queryMode:'local', 
                  minChars : 2,
                  valueField:'czid',
                  displayField:'czsm',
                  triggerAction:'all',
                  listConfig: { loadMask: false },
                  name: 'sbczid',
                  id:'sb_nx_sbczid'
                },
                {
                  xtype: 'combobox',
                  x: 130,
                  y: 70,
                  width: 200,
                  store: sb_nxdj_store,
                  emptyText:'è¯·é€‰æ‹©',
                  mode: 'remote',
                  minChars : 2,
                  valueField:'id',
                  displayField:'text',
                  triggerAction:'all',
                  listConfig: { loadMask: false },
                  name: 'nxdj',
                  id:'sb_nx_nxdj'
                }

              ],
              buttons:[{
                  xtype: 'button',
                  iconCls: 'option',
                  id:'button_qz_add',
                  text:'ä¿®æ”¹',
                  handler: function() {
                    var pars=this.up('panel').getForm().getValues();
                    if(pars['sbczid']!=''){
                      if(pars['sbid']!=''){
                        
                          if(add_new==false){
                            new Ajax.Request("/desktop/update_sb_nx", { 
                              method: "POST",
                              parameters: pars,
                              onComplete:  function(request) {
                                text=request.responseText.split(':');
                                if (request.responseText=='success'){

                                  Ext.getCmp('sb_nx_disp_win').close();

                                  Ext.getCmp('sb_nx_setup_grid').store.url='/desktop/get_sb_nx_grid';
                                  Ext.getCmp('sb_nx_setup_grid').store.load();
                                }else{
                                  if (text[0]=='false'){
                                    alert(text[1]);
                                  }else{
                                    alert("ä¿®æ”¹å¤±è´¥ã€‚");
                                  }
                                }

                              }
                            });
                          }else{
                            new Ajax.Request("/desktop/insert_sb_nx", { 
                              method: "POST",
                              parameters: pars,
                              onComplete:  function(request) {
                                text=request.responseText.split(':');
                                if (text[0]=='success'){

                                  Ext.getCmp('sb_nx_disp_win').close();
                                  Ext.getCmp('sb_nx_setup_grid').store.url='/desktop/get_sb_nx_grid';
                                  Ext.getCmp('sb_nx_setup_grid').store.load();
                                }else{
                                  if (text[0]=='false'){
                                    alert(text[1]);
                                  }else{
                                    alert("æ–°å¢å¤±è´¥ã€‚");
                                  }
                                }
                              }
                            });
                          }
                        
                        
                      }else{
                        alert("è®¾å¤‡ä¸èƒ½ä¸ºç©ºã€‚");
                      }
                    }else{
                      alert("è®¾å¤‡æ“ä½œä¸èƒ½ä¸ºç©ºã€‚");
                    }
                  }
                },
                {
                  xtype: 'button',
                  iconCls: 'exit',
                  text:'é€€å‡º',
                  handler: function() {
                    //this.up('window').hide();
                    Ext.getCmp('sb_nx_disp_win').close();
                  }
                }]
            }]

          });
        }
        if(add_new==false){
        //è®¾ç½®æ•°æ®
          Ext.getCmp('sb_nx_disp_form').getForm().setValues(record.data);

        }else{
          Ext.getCmp('sb_nx_disp_win').title="æ–°å¢è½®å·¡è®¾å¤‡æ“ä½œ";
          Ext.getCmp('button_qz_add').text="æ–°å¢";
          Ext.getCmp('button_qz_add').iconCls="add";
        }

        win.show();
      };

      var sb_gl_tj_setup = function(){
        var win = Ext.getCmp('sb_gl_tj_setup_win');
        tjxl=0;
        Ext.regModel('sb_gl_tj_setup_model', {
          fields: [
            {name: 'id',    type: 'integer'},
            {name: 'edgl',    type: 'integer'},
            {name: 'czsm',    type: 'string'},
            {name: 'czid',    type: 'integer'},
            {name: 'id',    type: 'integer'},
            {name: 'userid',    type: 'integer'},
            {name: 'sbmc',    type: 'string'},
            {name: 'shgl',    type: 'string'},
            {name: 'wdz',   type: 'string'},
            {name: 'sdz',   type: 'string'},
            {name: 'dlz',   type: 'string'},
            {name: 'fjmc',    type: 'string'},
            {name: 'lcmc',    type: 'string'},
            {name: 'lymc',    type: 'string'},
            {name: 'zsj',   type: 'string',stringFormat: '0.00'},
            {name: 'rq',    type: 'date', dateFormat: 'Y-m-d H:i:s'}
          ]
        });

        var sb_gl_tj_setup_store = Ext.create('Ext.data.Store', {
          id:'sb_gl_tj_setup_store',
          model : 'sb_gl_tj_setup_model',
          //autoLoad: true,
          proxy: {
            type: 'ajax',
            url : '/desktop/get_sb_gl_tj_grid',
            //extraParams: cx_tj,
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }
        });
        var sb_gl_tj_setup_grid = new Ext.grid.GridPanel({
          id : 'sb_gl_tj_setup_grid',
          store: sb_gl_tj_setup_store,        
          columns: [
            { text : 'id',  width : 0, sortable : true, dataIndex: 'id'},           
            { text : 'åç§°',  width : 150, sortable : true, dataIndex: 'sbmc'},
            { text : 'æ‰€è€—åŠŸç‡',  width : 50, sortable : true, dataIndex: 'shgl'},
            { text : 'ä½¿ç”¨æ—¶é—´',  width : 50, sortable : true, dataIndex: 'zsj'},
            { text : 'é¢å®šåŠŸç‡',  width : 50, sortable : true, dataIndex: 'edgl'},
            { text : 'æˆ¿é—´åç§°',  width : 50, sortable : true, dataIndex: 'fjmc'},
            { text : 'æ¥¼å±‚åç§°',  width : 50, sortable : true, dataIndex: 'lcmc'},
            { text : 'æ¥¼å®‡åç§°',  width : 100, sortable : true, dataIndex: 'lymc'}        
            
            ],
            selType:'checkboxmodel',
            //multiSelect:true,
            listeners:{
              itemdblclick:{
                fn:function(v,r,i,n,e,b){
                    Ext.getCmp("chartCmp").axes.items[0].title="åŠŸç‡ï¼ˆç“¦ï¼‰";
                    Ext.getCmp("chartCmp").axes.items[1].title="";
                    sb_gl_tj_zz_store.proxy.extraParams={gl:r.get('shgl')+','+r.get('edgl')
                  }
                  sb_gl_tj_zz_store.load();
                }
              }
            },

          viewConfig: {
            stripeRows:true
          }
        });
        Ext.regModel('sb_kg_tj_setup_model', {
          fields: [
            {name: 'id',    type: 'integer'},
            {name: 'czsm',    type: 'string'},
            {name: 'czid',    type: 'integer'},
            {name: 'id',    type: 'integer'},
            {name: 'userid',    type: 'integer'},
            {name: 'sbmc',    type: 'string'},
            {name: 'shgl',    type: 'string'},
            {name: 'kgcs',    type: 'integer'},
            {name: 'wdz',   type: 'string'},
            {name: 'sdz',   type: 'string'},
            {name: 'dlz',   type: 'string'},
            {name: 'fjmc',    type: 'string'},
            {name: 'lcmc',    type: 'string'},
            {name: 'lymc',    type: 'string'},
            {name: 'zsj',   type: 'string',stringFormat: '0.00'},
            {name: 'rq',    type: 'date', dateFormat: 'Y-m-d H:i:s'}
          ]
        });

        var sb_kg_tj_setup_store = Ext.create('Ext.data.Store', {
          id:'sb_kg_tj_setup_store',
          model : 'sb_kg_tj_setup_model',
          //autoLoad: true,
          proxy: {
            type: 'ajax',
            url : '/desktop/get_sb_kg_tj_grid',
            //extraParams: cx_tj,
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }
        });
        var sb_kg_tj_setup_grid = new Ext.grid.GridPanel({
          id : 'sb_kg_tj_setup_grid',
          store: sb_kg_tj_setup_store,        
          columns: [
            { text : 'id',  width : 0, sortable : true, dataIndex: 'id'},           
            { text : 'è®¾å¤‡åç§°',  width : 150, sortable : true, dataIndex: 'sbmc'},
            { text : 'å¼€å…³æ¬¡æ•°',  width : 50, sortable : true, dataIndex: 'kgcs'},
            
            { text : 'æˆ¿é—´åç§°',  width : 50, sortable : true, dataIndex: 'fjmc'},
            { text : 'æ¥¼å±‚åç§°',  width : 50, sortable : true, dataIndex: 'lcmc'},
            { text : 'æ¥¼å®‡åç§°',  width : 100, sortable : true, dataIndex: 'lymc'}        
            
            ],
            selType:'checkboxmodel',
            //multiSelect:true,
            listeners:{
              itemdblclick:{
                fn:function(v,r,i,n,e,b){
                  //var tt=r.get("zrq");
                  if (Ext.getCmp("sb_gl_tj_zrq").rawValue!=''){
                    if (Ext.getCmp("sb_gl_tj_qrq").rawValue!=''){
                      Ext.getCmp("chartCmp").axes.items[0].title="å¼€å…³æ¬¡æ•°";
                      Ext.getCmp("chartCmp").axes.items[1].title="æ—¶é—´ï¼ˆå°æ—¶ï¼‰";
                      sb_gl_tj_zz_store.proxy.extraParams={qrq:Ext.getCmp("sb_gl_tj_qrq").rawValue,zrq:Ext.getCmp("sb_gl_tj_zrq").rawValue,sbid:r.get('id')}
                      sb_gl_tj_zz_store.load();
                    }else{
                      alert("èµ·æ—¥æœŸä¸èƒ½ä¸ºç©ºã€‚");
                    }
                  }else{
                    alert("æ­¢æ—¥æœŸä¸èƒ½ä¸ºç©ºã€‚");
                  } 
                }
              }
            },

          viewConfig: {
            stripeRows:true
          }
        });
        Ext.regModel('sb_gl_tj_zz_model', {
          fields: [
            {name: 'id',    type: 'integer'},
            
            {name: 'name',    type: 'string'},
            {name: 'data1',   type: 'string'},
            {name: 'data2',   type: 'string'},
            {name: 'data3',   type: 'string'},
            {name: 'userid',    type: 'integer'},
            {name: 'sbmc',    type: 'string'},
            {name: 'shgl',    type: 'string'},
            {name: 'wdz',   type: 'string'},
            {name: 'sdz',   type: 'string'},
            {name: 'dlz',   type: 'string'},
            {name: 'fjmc',    type: 'string'},
            {name: 'lcmc',    type: 'string'},
            {name: 'lymc',    type: 'string'},
            {name: 'zsj',   type: 'string',stringFormat: '0.00'},
            {name: 'rq',    type: 'date', dateFormat: 'Y-m-d H:i:s'}

          ]
        });
        var sb_gl_tj_zz_store = Ext.create('Ext.data.Store', {
          id:'sb_gl_tj_zz_store',
          model : 'sb_gl_tj_zz_model',
          //autoLoad: true,
          proxy: {
            type: 'ajax',
            url : '/desktop/get_sb_gl_dj_zz_grid',
            //extraParams: cx_tj,
            reader: {
              type: 'json',
              root: 'rows',
              totalProperty: 'results'
            }
          }
          //sortInfo:{field: 'level4', direction: "ASC"},
          //baseParams: {start:0, limit:25, query:""}
        });
        var sb_gl_tj_tab = Ext.createWidget('tabpanel', {
              
              activeTab: 0,
              width: 600,
              height: 250,
          margins:'5 2 5 5',
              plain: true,
              defaults :{
                  autoScroll: true,
                  bodyPadding: 10
              },
              items: [{
                      title: 'è®¾å¤‡åŠŸç‡ç»Ÿè®¡',
              margins:'5 2 5 5',
                      items:sb_gl_tj_setup_grid,
              listeners: {
                          activate: function(tab){
                              tjlx=0;
                          }
                      }
                  },{
                      title: 'è®¾å¤‡å¼€å…³ç»Ÿè®¡',
                      items:sb_kg_tj_setup_grid,
                      listeners: {
                          activate: function(tab){
                              tjlx=1;
                          }
                      }
                  }
              ]
          });
        if (win==null) {
          win = new Ext.Window({
            id : 'sb_gl_tj_setup_win',
            title: 'è®¾å¤‡åŠŸç‡ç»Ÿè®¡',
            //closeAction: 'hide',
            width: 670,
            x : 300,
            y : 50,
            height: 500,
            minHeight: 500,
            layout: 'border',
            //modal: true,
            plain: true,
            items:[
              {
                region: 'center',
                iconCls:'icon-grid',
                layout: 'fit',
                height: 150,
                split: true,
                collapsible: true,
                title: 'è®¾å¤‡èƒ½è€—ç»Ÿè®¡å›¾ï¼ˆç»¿è‰²ï¼šä¼ ç»Ÿèƒ½è€—ï¼Œè“è‰²ï¼šå®é™…èƒ½è€—ï¼Œçº¢è‰²ï¼šå‡å°‘çš„ç¢³æ’æ”¾ï¼‰',
                items: {
                        id: 'chartCmp',
                        xtype: 'chart',
                        style: 'background:#fff',
                        animate: true,
                        shadow: true,
                        store: sb_gl_tj_zz_store,
                        legend: {
                          position: 'right'  
                        },
                        axes: [{
                            type: 'Numeric',
                            position: 'bottom',
                            fields: ['data1', 'data2', 'data3'],
                            minimum: 0,
                            label: {
                                renderer: Ext.util.Format.numberRenderer('0,0')
                            },
                            grid: true,
                            title: 'èƒ½è€—ï¼ˆåº¦ï¼‰'
                        }, {
                            type: 'Category',
                            position: 'left',
                            fields: ['name'],
                            title: ''
                        }],
                        series: [{
                            type: 'bar',
                            axis: 'bottom',
                    highlight: true,
                    tips: {  
                                      trackMouse: true,  
                                      width: 140,  
                                      height: 28,  
                                      renderer: function(storeItem, item) {  
                                        this.setTitle( item.value  );  
                                      }},
                            xField: 'name',
                            yField: ['data1', 'data2', 'data3']
                        }]
                       
                    }

              }],
                    
            tbar:[
            {
              xtype: 'button',
              iconCls: 'exit',
              text:'é€€å‡º',
              handler: function() {
                Ext.getCmp('sb_gl_tj_setup_win').close();
              }
            },
            '->',
            '<span style=" font-size:12px;font-weight:600;color:#3366FF;">ç»Ÿè®¡ç±»å‹</span>:&nbsp;&nbsp;',
            {
              xtype: 'combo',
              name: 'tjlx',
              store: tjlx_data,
              emptyText:'è¯·é€‰æ‹©',
              mode: 'local',
              minChars : 2,
              valueField:'text',
              displayField:'text',
              triggerAction:'all',
              width:90,
              id:'sb_tjlx'
            },
                  '<span style=" font-size:12px;font-weight:600;color:#3366FF;">èµ·æ—¥æœŸ</span>:&nbsp;&nbsp;',
                  {
                    xtype: 'datefield',format: 'Y-m-d',id:'sb_gl_tj_qrq',width:90
                  },
                  '<span style=" font-size:12px;font-weight:600;color:#3366FF;">æ­¢æ—¥æœŸ</span>:&nbsp;&nbsp;',
                  {
                    xtype: 'datefield',format: 'Y-m-d',id:'sb_gl_tj_zrq',width:90
                  },          
                  {xtype:'button',text:'ç»Ÿè®¡',tooltip:'è®¾å¤‡åŠŸç‡ç»Ÿè®¡',iconCls:'search',
                      handler: function() {                       
                        if (Ext.getCmp("sb_gl_tj_zrq").rawValue!=''){
                          if (Ext.getCmp("sb_gl_tj_qrq").rawValue!=''){
                            if (Ext.getCmp("sb_tjlx").rawValue!=''){
                              sb_gl_tj_zz_store.proxy.extraParams={tjzl:Ext.getCmp("sb_tjlx").rawValue,tjlx:0,qrq:Ext.getCmp("sb_gl_tj_qrq").rawValue,zrq:Ext.getCmp("sb_gl_tj_zrq").rawValue};
                                sb_gl_tj_zz_store.load();
                              }else{
                                alert("ç»Ÿè®¡ç±»å‹ä¸èƒ½ä¸ºç©ºã€‚");
                              }                               
                          }else{
                            alert("èµ·æ—¥æœŸä¸èƒ½ä¸ºç©ºã€‚");
                          }
                        }else{
                          alert("æ­¢æ—¥æœŸä¸èƒ½ä¸ºç©ºã€‚");
                        }
                      }
                  }
            ]

          });
        }


        win.show();
      };  


      var sys_zn_store  = Ext.create('Ext.data.TreeStore', {
        autoLoad: true,
        proxy: {
            type: 'ajax',
            url: 'desktop/get_zn_tree',
            extraParams: {userid:currentUser.id},
            actionMethods: 'POST'
        }
      });
      
      var sys_zn_panel = Ext.create('Ext.tree.Panel', {
        id : 'sys_zn_panel',
        store: sys_zn_store,
        rootVisible:false,
        useArrows: true,
        listeners:{
          checkchange:function(node,checked,option){
            if(checked){
              root=Ext.getCmp('sys_zn_panel').store.getRootNode();      
              getNodes(root,false);
              node.data.checked=true;
              node.updateInfo({checked:true});
              if (Ext.getCmp('ly_setup_win')!=undefined){Ext.getCmp('ly_setup_win').close();}

              if (Ext.getCmp('lc_setup_win')!=undefined){Ext.getCmp('lc_setup_win').close();}
              if (Ext.getCmp('fj_setup_win')!=undefined){Ext.getCmp('fj_setup_win').close();}
              if (Ext.getCmp('sb_setup_win')!=undefined){Ext.getCmp('sb_setup_win').close();}
              if (Ext.getCmp('sb_cz_setup_win')!=undefined){Ext.getCmp('sb_cz_setup_win').close();}
              if (Ext.getCmp('user_sb_setup_win')!=undefined){Ext.getCmp('user_sb_setup_win').close();}
              if (Ext.getCmp('cz_rz_setup_win')!=undefined){Ext.getCmp('cz_rz_setup_win').close();}
              
              if (Ext.getCmp('qjms_setup_win')!=undefined){Ext.getCmp('qjms_setup_win').close();}
              if (Ext.getCmp('qjms_sb_cz_setup_win')!=undefined){Ext.getCmp('qjms_sb_cz_setup_win').close();}
              
              if (Ext.getCmp('sb_nx_setup_win')!=undefined){Ext.getCmp('sb_nx_setup_win').close();}
              
              if (Ext.getCmp('sb_gl_tj_setup_win')!=undefined){Ext.getCmp('sb_gl_tj_setup_win').close();}

			  if (Ext.getCmp('sb_cz_win')!=undefined){Ext.getCmp('sb_cz_win').close();}

              switch (node.data.id) { 
                case "1": 
                  ly_setup();
                  break; 
                case "2": 
                  lc_setup();
                  break; 
                case "3": 
                  fj_setup();
                  break; 
                case "4": 
                  sb_setup();
                  break;
                case "5": 
                  sb_cz_setup();
                  break;
                case "6": 				  
                  user_sb_setup();
                  break;
                case "7": 
				  //sb_cz_win();
                  cz_rz_setup();
                  break;
                case "8": 
                  qjms_setup();
                  break;
                case "9": 
                  qjms_sb_cz_setup();
                  break;
                case "10": 
                  sb_nx_setup();
                  break;
                case "11": 
                  sb_gl_tj_setup();
                  break;

              }
            }

          }
        }
      });
      if(!win){
          win = desktop.createWindow({
            id: 'notepad',
            title:'æ™ºæ…§ç‰©è”ç®¡ç†',
            width:200,
            height:500,
            x : 100,
            y : 50,
            iconCls: 'zhwl',
            animCollapse:false,
            border: false,
            hideMode: 'offsets',
            layout: 'fit',
            split:true,
            items: sys_zn_panel
          });
      }
      win.show();
      return win;
    }
});

"id"%b906353830d65fa5bb49697eda3ef72d"
class"BundledAsset"dependency_paths[{"
mtimeu:	Time&,€  €"	path"4$root/app/assets/javascripts/desktop/Notepad.js"hexdigest"%d10e0bddb470e341f0ced3ba33b7c731"logical_path"desktop/Notepad.js"_version"%46dde6621c301f4928e3b34efee9e3b5"asset_paths["4$root/app/assets/javascripts/desktop/Notepad.js:@created_atf1354346015.4081249 ¸:@compressedF