o: ActiveSupport::Cache::Entry	:@expires_in0:@value{	"_version"%082f96d7b6db50b557809c7f9f78aeed"lengthi]—"source"]—var currentUser={};
var archive_id=0;
var archive_data={};
var tree_id=0;
var user_id="";
var docglcx=0; //ç”¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¯ç‚¹å‡»æ”¶æ–‡ã€å‘æ–‡ã€å†…éƒ¨èµ„æ–™æŸ¥è¯¢ã€‚1ä»£è¡¨æ˜¯ï¼Œ0ä»£è¡¨æ˜¯ä»åˆ†é¡µä¸­ç‚¹çš„ä¸‹ä¸€é¡µ
Ext.override(Ext.grid.Scroller, {
    onAdded: function() {
        this.callParent(arguments);
        var me = this;
        if (me.scrollEl) {
            me.mun(me.scrollEl, 'scroll', me.onElScroll, me);
            me.mon(me.scrollEl, 'scroll', me.onElScroll, me);
        }
    }
});

Ext.Loader.setPath({
    'Ext.ux.desktop': '/assets/desktop/js',
    'Ext.ux' : '/assets/desktop/ux',
    MyDesktop: '/assets/desktop'
});

Ext.Loader.setConfig({enabled:true});
 new Ajax.Request("/desktop/get_userid", { 
 	method: "POST",
 	//parameters: eval(pars),
 	onComplete:	 function(request) {
 		user_id=request.responseText;
 	}
 });
var msg = function(title, msg){
		Ext.Msg.show({
				title: title,
				msg: msg,
				minWidth: 300,
				modal: true,
				icon: Ext.Msg.WARNING,
				buttons: Ext.Msg.OK
		});
};

//Simple Store



var kyq_djlx_data = [
 ['0','åœ°è´¨å‹˜æŸ¥å·¥ä½œæ ‡å‡†ã€è§„ç¨‹ã€è§„èŒƒå®æ–½åŠç®¡ç†åŠæ³•ç­‰ææ–™'],
 ['1','é‡‡çŸ¿æƒç®¡ç†è§„èŒƒæ€§æ–‡ä»¶ææ–™ï¼ˆç”³è¯·ã€å˜æ›´ã€å»¶ç»­ã€æ³¨é”€ã€é‡‡çŸ¿æƒå‡ºè®©ã€è½¬è®©å®¡æ‰¹ç­‰ï¼‰'],
 ['2','çŸ¿äº§èµ„æºå‚¨é‡ç®¡ç†åŠæ³•ã€æ ‡å‡†ã€è§„ç¨‹ã€è§„èŒƒ'],
['3','åœ°è´¨ç¯å¢ƒä¿æŠ¤å’Œåœ°ä¸‹æ°´åŠ¨æ€ç›‘æµ‹ã€è¯„ä»·ï¼›åœ°è´¨ç¾å®³æ€§é˜²æ²»ã€ç®¡ç†ã€é‡å¤§åœ°è´¨ç¾å®³æ•´æ²»å·¥ä½œåŠåœ°è´¨é—è¿¹åœ°è´¨æ™¯è§‚ä¿æŠ¤ç­‰'],
 ['4','åœ°è´¨å‹˜å¯Ÿç›‘ç£ç®¡ç†,çŸ¿ä¸šæƒç®¡ç†ç±»']
];

var kyq_djlx_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : kyq_djlx_data
});

var kyq_jjlx_data = [
 ['0','å›½æœ‰ä¼ä¸š'],
 ['1','é›†ä½“ä¼ä¸š'],
 ['2','è‚¡ä»½åˆä½œä¼ä¸š'],
['3','è”è¥ä¼ä¸š'],
 ['4','æœ‰é™è´£ä»»å…¬å¸'],
['5','è‚¡ä»½æœ‰é™å…¬å¸'],
 ['6','ç§è¥ä¼ä¸š'],
 ['7','å…¶ä»–ä¼ä¸š'],
['8','åˆèµ„ç»è¥ä¼ä¸šï¼ˆæ¸¯æ¾³å°ï¼‰'],
 ['9','åˆä½œç»è¥ä¼ä¸šï¼ˆæ¸¯æ¾³å°ï¼‰'],
['10','æ¸¯æ¾³å°å•†ç‹¬èµ„ç»è¥ä¼ä¸š'],
 ['11','æ¸¯æ¾³å°å•†æŠ•èµ„è‚¡ä»½æœ‰é™å…¬å¸'],
 ['12','ä¸­å¤–åˆèµ„ç»è¥ä¼ä¸š'],
['13','ä¸­å¤–åˆä½œç»è¥ä¼ä¸š'],
 ['14','å¤–èµ„ä¼ä¸š'],
 ['15','å¤–å•†æŠ•èµ„è‚¡ä»½æœ‰é™å…¬å¸']
];



var kyq_jjlx_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : kyq_jjlx_data
});


var kyq_ksgm_data = [
 ['0','ç‰¹å¤§å‹'],
 ['1','å¤§å‹'],
 ['2','ä¸­å‹'],
['3','å°å‹'],
 ['4','å°çŸ¿'],
['5','å…¶ä»–']
];
var kyq_ksgm_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : kyq_ksgm_data
});


var kyq_clgm_data = [
 ['0','ç‰¹å¤§å‹'],
 ['1','å¤§å‹'],
 ['2','ä¸­å‹'],
['3','å°å‹'],
 ['4','å°çŸ¿'],
['5','å…¶ä»–']
];
var kyq_clgm_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : kyq_clgm_data
});

var kyq_mjdw_data = [
 ['0','å¹³æ–¹ç±³'],
 ['1','å…¬é¡·'],
 ['2','å¹³æ–¹å…¬é‡Œ'],
['3','äº©']
];
var kyq_mjdw_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : kyq_mjdw_data
});

var kyq_scgm_data = [
 ['0','ç‰¹å¤§å‹'],
 ['1','å¤§å‹'],
 ['2','ä¸­å‹'],
['3','å°å‹'],
 ['4','å°çŸ¿'],
['5','å…¶ä»–']
];
var kyq_scgm_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : kyq_scgm_data
});

var kyq_cldw_data = [
 ['0','å¨'],
 ['1','ç™¾å¨'],
 ['2','åƒå¨'],
['3','ä¸‡å¨']
];
var kyq_cldw_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : kyq_cldw_data
});


var kyq_scldw_data = [
 ['0','å¨'],
 ['1','ç™¾å¨'],
 ['2','åƒå¨'],
['3','ä¸‡å¨']
];
var kyq_scldw_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : kyq_scldw_data
});


var kyq_sjncl_data = [
 ['0','å¨'],
 ['1','ç™¾å¨'],
 ['2','åƒå¨'],
['3','ä¸‡å¨']
];
var kyq_sjncl_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : kyq_sjncl_data
});


var kyq_kz_data = [
 ['0','ç…¤ç‚­'],
 ['1','é“çŸ¿'],
 ['2','å†¶é‡‘ç”¨ç™½äº‘å²©'],
['3','å«é’¾ç ‚é¡µå²©'],
 ['4','ç›çŸ¿'],
['5','çŸ³è†'],
 ['6','æ°´æ³¥ç”¨ç°å²©'],
 ['7','å»ºç­‘çŸ³æ–™ç”¨ç°å²©'],
['8','æ³¥ç°å²©'],
 ['9','å»ºç­‘ç”¨ç™½äº‘å²©'],
['10','å»ºç­‘ç”¨çŸ³è‹±å²©'],
 ['11','æ°´æ³¥é…æ–™ç”¨ç ‚å²©'],
 ['12','ç»ç’ƒç”¨ç ‚'],
['13','å»ºç­‘ç”¨ç ‚'],
 ['14','æ°´æ³¥é…æ–™ç”¨è„‰çŸ³è‹±'],
 ['15','é™¶ç“·åœŸ'],
['16','ç –ç“¦ç”¨ç²˜åœŸ'],
 ['17','å»ºç­‘ç”¨è¾‰ç»¿å²©'],
['18','å»ºç­‘ç”¨èŠ±å²—å²©'],
 ['19','é¥°é¢ç”¨å¤§ç†å²©'],
 ['20','çŸ¿æ³‰æ°´']
];
var kyq_kz_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : kyq_kz_data
});


var txfw_data = [
 ['0','ä¸æé†’'],
 ['1','ä¸ªäºº'],
 ['2','éƒ¨é—¨']
];

var txfw_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : txfw_data
});
var qsxz_data = [
 ['0','å›½æœ‰åœŸåœ°ä½¿ç”¨æƒ'],
 ['1','é›†ä½“åœŸåœ°æ‰€æœ‰æƒ'],
 ['2','é›†ä½“åœŸåœ°ä½¿ç”¨æƒ'],

 ['3','åˆ†å‰²'],
 ['4','æ³¨é”€'],
 ['5','ç§Ÿèµ']

];

var qsxz_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : qsxz_data
});
var sxzl_data = [
 ['0','å½•éŸ³å¸¦'],
 ['1','å½•åƒå¸¦'],
 ['2','å…¶ä»–']
];

var sxzl_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : sxzl_data
});

var bgqx_data = [
	['1','æ°¸ä¹…'],
	['2','é•¿æœŸ'],
	['3','çŸ­æœŸ']
];


var bgqx_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : bgqx_data
});

var jhcw_bgqx_data = [
	['1','æ°¸ä¹…'],	
	['2','25å¹´'],
	['3','15å¹´'],
	['4','5å¹´']

];


var jhcw_bgqx_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : jhcw_bgqx_data
});

var doc_bgqx_data = [
	['1','æ°¸ä¹…'],	
	['2','é•¿æœŸ'],
	['3','çŸ­æœŸ'],
	['4','å®šæœŸ-10å¹´'],
	['5','å®šæœŸ-30å¹´']

];


var doc_bgqx_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : doc_bgqx_data
});

var mj_data = [
	['1','ç»å¯†'],
	['2','æœºå¯†'],
	['3','ç§˜å¯†'],
	['4','å†…éƒ¨'],
	['5','å…¬å¼€']	
];


var mj_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : mj_data
});


var gb_data = [
	['1','è‰ç¨¿'],
	['2','å®šç¨¿'],
	['3','æ‰‹ç¨¿'],
	['4','è‰å›¾'],
	['5','åŸå›¾'],
	['6','åº•å›¾'],
	['7','è“å›¾'],
	['8','æ­£æœ¬'],
	['9','å‰¯æœ¬'],
	['10','åŸç‰ˆ'],
	['11','è¯•è¡Œæœ¬'],
	['12','ä¿®è®¢æœ¬'],
	['13','å½±å°æœ¬']	
];
var gb_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : gb_data
});
var wz_data = [
	['1','å‘½ä»¤'],
	['2','å†³è®®'],
	['3','æŒ‡ç¤º'],
	['4','é€šçŸ¥'],
	['5','æŠ¥å‘Š'],
	['6','æ‰¹å¤'],
	['7','å‡½'],
	['8','ä¼šè®®çºªè¦'],
	['9','è¯´æ˜ä¹¦'],
	['10','åè®®ä¹¦'],
	['11','é‰´å®šä¹¦'],
	['12','ä»»åŠ¡ä¹¦'],
	['13','åˆ¤å†³ä¹¦'],
	['14','å›½ä¹¦'],
	['15','ç…§ä¼š'],
	['16','è¯°'],
	['17','æ••'],
	['18','å¥æŠ˜']
		
];
var wz_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : wz_data
});

var ztgg_data = [
	['1','16å¼€'],
	['2','A4'],
	['3','105mmâ•³148mm'],
	['4','3.5è‹±å¯¸']
	
		
];
var ztgg_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : ztgg_data
});

var ztlx_data = [
	['1','çº¸'],
	['2','å”±ç‰‡'],
	['3','ç…§ç‰‡'],
	['4','èƒ¶ç‰‡'],
	['5','èƒ¶å·'],
	['6','ç£å¸¦'],
	['7','ç£ç›˜'],
	['8','å…‰ç›˜'],
	['9','ç”²éª¨'],
	['10','é‡‘çŸ³'],
	['11','ç®€ç‰'],
	['12','ç¼£å¸›']

		
];
var ztlx_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : ztlx_data
});

var ztdw_data = [
	['1','é¡µ'],
	['2','å¼ '],
	['3','å·'],
	['4','å†Œ'],
	['5','ç›’'],
	['6','ç›˜'],
	['7','ç‰‡'],
	['8','ç±³']
	
	
];
var ztdw_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : ztdw_data
});

var ajzt_data = [
	['1','ç©ºå·'],
	['2','ç¼ºé¡µ'],
	['3','å¤šé¡µ'],
	['4','è‘—å½•'],
	['5','å½’æ¡£'],
	['6','å…¨éƒ¨']
];

var ajzt_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : ajzt_data
});


var aj_where_field_data = [
	['tm','æ¡ˆå·æ ‡é¢˜']
];

var aj_where_field_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : jr_where_field_data
});

var jr_where_field_data = [
	['tm','é¢˜å'],
	['wh','æ–‡å·'],
	['zrz','è´£ä»»è€…']
];

var jr_where_field_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : jr_where_field_data
});

var jydj_jyqx_data = [
	['1','1å¤©'],
	['2','2å¤©'],
	['3','3å¤©'],
	['4','4å¤©'],
	['5','5å¤©'],
	['6','6å¤©']
];

var jydj_jyqx_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : jydj_jyqx_data
});

var jydj_lymd_data = [
	['1','ç¼–å²ä¿®å¿—'],
	['2','å·¥ä½œè€ƒæŸ¥'],
	['3','å­¦æœ¯ç ”ç©¶'],
	['4','ç»æµå»ºè®¾'],
	['5','å®£ä¼ æ•™è‚²'],
	['6','å…¶å®ƒ']
];

var jydj_lymd_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : jydj_lymd_data
});

var jydj_jylx_data = [
	['1','æ¡ˆå·ç›®å½•'],
	['2','å·å†…ç›®å½•'],
	['3','åŸæ–‡']
];

var jydj_jylx_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : jydj_jylx_data
});

var zlxx_lb_data = [
	['1','æ–‡ä»¶æ±‡ç¼–'],
	['2','å¹´é‰´'],
	['3','å…¶ä»–'],
	
];
var zlxx_lb_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : zlxx_lb_data
});
var swda_lb_data = [
	['1','è¯ä¹¦'],
	['2','å¥–çŠ¶'],
	['3','é•œæ¡†'],
	['4','å¥–æ——'],
	['5','é”¦æ——'],
	['6','å¥–ç‰Œ'],
	['7','å¥–æ¯'],
	['8','å…¶ä»–']
];
var swda_lb_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : swda_lb_data
});

var qzdj_data = [	
	['3','åœ°å¸‚çº§'],
	['4','å¿çº§'],
	['5','ä¹¡é•‡çº§']
];
var qzdj_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : qzdj_data
});
var sf_data = [	
	['1','æ˜¯'],
	['2','å¦']
];
var sf_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : sf_data
});
var qzdj_data = [	
	['3','åœ°å¸‚çº§'],
	['4','å¿çº§'],
	['5','ä¹¡é•‡çº§']
];
var qzdj_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : qzdj_data
});

var print_lb_data = [	
	['1','æ¡ˆå·ç›®å½•æ‰“å°'],
	['2','å·å†…ç›®å½•æ‰“å°'],
	['3','æ¡ˆå·å°é¢æ‰“å°'],
	['4','å¤‡è€ƒè¡¨æ‰“å°']
];
var print_lb_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : print_lb_data
});
   Ext.regModel('qz_model', {
   	fields: [
   		{name: 'id',		type: 'integer'},
   		{name: 'dwdm',		type: 'string'}
   	]
   });
   var qz_store = Ext.create('Ext.data.Store', {
   		id:'qz_store',
   		model : 'qz_model',
   		proxy: {
   			type: 'ajax',
   			url : '/desktop/get_qz_grid',
   			//extraParams: {query:title},
   			reader: {
   				type: 'json',
   				root: 'rows',
   				totalProperty: 'results'
   			}
   		}				
   });



   //qz_store.load();
Ext.regModel('dalb_model', {
	fields: [
		{name: 'id',		type: 'integer'},
		{name: 'lbmc',		type: 'string'}
	]
});
var dalb_store = Ext.create('Ext.data.Store', {
		id:'dalb_store',
		model : 'dalb_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_dalb_grid',
			//extraParams: {query:title},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}				
});


var zt_data = [	
	['1','å®‹ä½“'],
	['2','é»‘ä½“']
];
var zt_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : zt_data
});

var ktms_data = [
 ['0','åˆ¶å†·'],
 ['1','é€šé£'],
 ['2','åˆ¶çƒ­']
];

var ktms_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : ktms_data
});

var kg_data = [
 ['0','å…³'],
 ['1','å¼€']
];


var kg_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : kg_data
});

var print_dylx_data = [
 ['0','é€šç”¨æ‰“å°'],
 ['1','åœŸåœ°ç™»è®°æ‰“å°'],
['2','çŸ¿ä¸šæƒæ‰“å°']
];


var print_dylx_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : print_dylx_data
});

var sb_nxdj_data = [
 ['1','5ç§’é’Ÿä¸€æ¬¡'],
 ['2','5åˆ†é’Ÿä¸€æ¬¡']
];
var sb_nxdj_store = new Ext.data.SimpleStore({
	fields: ['id', 'text'],
	data : sb_nxdj_data
});

var jr_model_data = [
 ['1','é¢˜å'],
 ['2','è´£ä»»è€…'],
 ['3','æ–‡å·']
];

var jr_model_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : jr_model_data
});

var print_model_data = [
 ['1','é€šç”¨æ‰“å°'],
 ['2','åœŸåœ°ç™»è®°æ‰“å°'],
ã€€['3','çŸ¿ä¸šæƒæ‰“å°']

];

var print_model_store = new Ext.data.SimpleStore({
	fields: ['value', 'text'],
	data : print_model_data
});


ã€€ã€€Ext.regModel('com_jr_wh_model', {
   	fields: [
   		{name: 'id',		type: 'integer'},
   		{name: 'name',		type: 'string'}
   	]
   });
   var com_jr_wh_store = Ext.create('Ext.data.Store', {
   		id:'com_jr_wh_store',
   		model : 'com_jr_wh_model',
   		proxy: {
   			type: 'ajax',
   			url : '/desktop/get_jr_model_wh_grid',
   			//extraParams: {query:'æ–‡å·'},
   			reader: {
   				type: 'json',
   				root: 'rows',
   				totalProperty: 'results'
   			}
   		}				
   });
ã€€ã€€Ext.regModel('com_jr_zrz_model', {
   	fields: [
   		{name: 'id',		type: 'integer'},
   		{name: 'name',		type: 'string'}
   	]
   });
   var com_jr_zrz_store = Ext.create('Ext.data.Store', {
   		id:'com_jr_zrz_store',
   		model : 'com_jr_zrz_model',
   		proxy: {
   			type: 'ajax',
   			url : '/desktop/get_jr_model_zrz_grid',
   			//extraParams: {query:'è´£ä»»è€…'},
   			reader: {
   				type: 'json',
   				root: 'rows',
   				totalProperty: 'results'
   			}
   		}				
   });
//com_jr_zrz_store.load();



Ext.regModel('com_jr_tm_model', {
  fields: [
    {name: 'id',    type: 'integer'},
    {name: 'name',    type: 'string'}
  ]
});
var com_jr_tm_store = Ext.create('Ext.data.Store', {
    id:'com_jr_tm_store',
    model : 'com_jr_tm_model',
    proxy: {
      type: 'ajax',
      url : '/desktop/get_jr_model_tm_grid',
	  //extraParams: {query:'é¢˜å'},
      reader: {
        type: 'json',
        root: 'rows',
        totalProperty: 'results'
      }
    }       
});
//com_jr_tm_store.load();

Ext.regModel('timage_model', {
    fields: [
      {name: 'id',     type: 'integer'},
      {name: 'dh',     type: 'string'},
      {name: 'yxmc',     type: 'string'},
      {name: 'yxdx',     type: 'string'},
      {name: 'yxbh',     type: 'string'}
    ]
  });

  var timage_store =  Ext.create('Ext.data.Store', {
    model : 'timage_model',
    proxy: {
      type: 'ajax',
      url : '/desktop/get_timage',
      extraParams: {dh:"",type:"0"},
      reader: {
        type: 'json',
        root: 'rows',
        totalProperty: 'results'
      }
    }
  });


Ext.regModel('jgwt_model', {
  fields: [
    {name: 'jgwtmc',    type: 'integer'},
    {name: 'jgwth',    type: 'string'}
  ]
});
var jgwt_store = Ext.create('Ext.data.Store', {
    id:'jgwt_store',
    model : 'jgwt_model',
    proxy: {
      type: 'ajax',
      url : '/desktop/get_doc_jgwt_grid',
	  //extraParams: {query:'é¢˜å'},
      reader: {
        type: 'json',
        root: 'rows',
        totalProperty: 'results'
      }
    }       
});
var sprintf = (function() {
	function get_type(variable) {
		return Object.prototype.toString.call(variable).slice(8, -1).toLowerCase();
	}
	function str_repeat(input, multiplier) {
		for (var output = []; multiplier > 0; output[--multiplier] = input) {/* do nothing */}
		return output.join('');
	}

	var str_format = function() {
		if (!str_format.cache.hasOwnProperty(arguments[0])) {
			str_format.cache[arguments[0]] = str_format.parse(arguments[0]);
		}
		return str_format.format.call(null, str_format.cache[arguments[0]], arguments);
	};

	str_format.format = function(parse_tree, argv) {
		var cursor = 1, tree_length = parse_tree.length, node_type = '', arg, output = [], i, k, match, pad, pad_character, pad_length;
		for (i = 0; i < tree_length; i++) {
			node_type = get_type(parse_tree[i]);
			if (node_type === 'string') {
				output.push(parse_tree[i]);
			}
			else if (node_type === 'array') {
				match = parse_tree[i]; // convenience purposes only
				if (match[2]) { // keyword argument
					arg = argv[cursor];
					for (k = 0; k < match[2].length; k++) {
						if (!arg.hasOwnProperty(match[2][k])) {
							throw(sprintf('[sprintf] property "%s" does not exist', match[2][k]));
						}
						arg = arg[match[2][k]];
					}
				}
				else if (match[1]) { // positional argument (explicit)
					arg = argv[match[1]];
				}
				else { // positional argument (implicit)
					arg = argv[cursor++];
				}

				if (/[^s]/.test(match[8]) && (get_type(arg) != 'number')) {
					throw(sprintf('[sprintf] expecting number but found %s', get_type(arg)));
				}
				switch (match[8]) {
					case 'b': arg = arg.toString(2); break;
					case 'c': arg = String.fromCharCode(arg); break;
					case 'd': arg = parseInt(arg, 10); break;
					case 'e': arg = match[7] ? arg.toExponential(match[7]) : arg.toExponential(); break;
					case 'f': arg = match[7] ? parseFloat(arg).toFixed(match[7]) : parseFloat(arg); break;
					case 'o': arg = arg.toString(8); break;
					case 's': arg = ((arg = String(arg)) && match[7] ? arg.substring(0, match[7]) : arg); break;
					case 'u': arg = Math.abs(arg); break;
					case 'x': arg = arg.toString(16); break;
					case 'X': arg = arg.toString(16).toUpperCase(); break;
				}
				arg = (/[def]/.test(match[8]) && match[3] && arg >= 0 ? '+'+ arg : arg);
				pad_character = match[4] ? match[4] == '0' ? '0' : match[4].charAt(1) : ' ';
				pad_length = match[6] - String(arg).length;
				pad = match[6] ? str_repeat(pad_character, pad_length) : '';
				output.push(match[5] ? arg + pad : pad + arg);
			}
		}
		return output.join('');
	};

	str_format.cache = {};

	str_format.parse = function(fmt) {
		var _fmt = fmt, match = [], parse_tree = [], arg_names = 0;
		while (_fmt) {
			if ((match = /^[^\x25]+/.exec(_fmt)) !== null) {
				parse_tree.push(match[0]);
			}
			else if ((match = /^\x25{2}/.exec(_fmt)) !== null) {
				parse_tree.push('%');
			}
			else if ((match = /^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt)) !== null) {
				if (match[2]) {
					arg_names |= 1;
					var field_list = [], replacement_field = match[2], field_match = [];
					if ((field_match = /^([a-z_][a-z_\d]*)/i.exec(replacement_field)) !== null) {
						field_list.push(field_match[1]);
						while ((replacement_field = replacement_field.substring(field_match[0].length)) !== '') {
							if ((field_match = /^\.([a-z_][a-z_\d]*)/i.exec(replacement_field)) !== null) {
								field_list.push(field_match[1]);
							}
							else if ((field_match = /^\[(\d+)\]/.exec(replacement_field)) !== null) {
								field_list.push(field_match[1]);
							}
							else {
								throw('[sprintf] huh?');
							}
						}
					}
					else {
						throw('[sprintf] huh?');
					}
					match[2] = field_list;
				}
				else {
					arg_names |= 2;
				}
				if (arg_names === 3) {
					throw('[sprintf] mixing positional and named placeholders is not (yet) supported');
				}
				parse_tree.push(match);
			}
			else {
				throw('[sprintf] huh?');
			}
			_fmt = _fmt.substring(match[0].length);
		}
		return parse_tree;
	};

	return str_format;
})();

var vsprintf = function(fmt, argv) {
	argv.unshift(fmt);
	return sprintf.apply(null, argv);
};




var DispAj_zh = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
		tbar:[
			{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
				handler: function() {
					if (Ext.getCmp('zh_id').value!=undefined){
						DispJr(record,true,Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
					}else
					{
						alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
					}

				}
			},
			{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
				handler: function() {

					var grid = Ext.getCmp('com_document_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];

					var pars="id="+record.data.id;
					
					Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
								if(id=="yes"){
									new Ajax.Request("/desktop/delete_document", { 
										method: "POST",
										parameters: {id:record.data.id,userid:currentUser.id},
										onComplete:	 function(request) {
											Ext.getCmp('com_document_grid').store.load();
										}
									});
								}else{
									//alert('O,no');
								}

						});

				}},
			{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
			handler: function() {
				var grid  = this.ownerCt.ownerCt;
				//alert(grid);
					var store = grid.getStore(); 
					var records = grid.getSelectionModel().getSelection();
					var data = [];
					Ext.Array.each(records,function(model){
						data.push(Ext.JSON.encode(model.get('id')));
						DispJr(model,false,'','',true);
					});
				}
			},{
				xtype:'button',text:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',tooltip:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',id:'jrmbsave',iconCls:'add',
		          handler: function() {
					if (Ext.getCmp('zh_id').value!=undefined){
						size=Ext.getCmp('com_document_grid').store.count();
						if (size>0){	              					  
			              	alert("æ­¤æ¡ˆå·å·²ç»æœ‰å·å†…ç›®å½•ï¼Œä¸èƒ½ä»¥æ¨¡æ¿æ–¹å¼è¿›è¡Œå¢åŠ å·å†…ç›®å½•ã€‚");
						}else{					
							DispJr_model(Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
						}
					}else
					{
						alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
					}		              
			 	}
			}
		],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						//DispJr(r,false);
						DispJr(r,false,'','',true);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'æ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						
						if(add_new==false || add_new=='3'){
							new Ajax.Request("/desktop/update_flow", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");	
										Ext.getCmp('zh_dh').setValue(responseT[1]);																					
									}else{
										alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
									}
									
								}
							});
						}else{
							new Ajax.Request("/desktop/insert_archive", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
										dh=responseT[1];
										Ext.getCmp('button_aj_add').setText('ä¿®æ”¹ä¿å­˜');
										Ext.getCmp('zh_id').setValue(responseT[2]);
										Ext.getCmp('zh_dh').setValue(responseT[1]);
										add_new=false;											
									}else{
										alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
									}
									
								}
							});
						}
					}
				},
				{
		          text:'æŸ¥çœ‹å›¾åƒæˆ–é™„ä»¶',
		          iconCls:'',
		          handler : function() {
		          
					if (Ext.getCmp('zh_dh').value!=undefined){
		              var dh = Ext.getCmp('zh_dh').value;
					  if(add_new=='4'){
						show_image(dh,record.data.ip,"1");	 
					  }else{
		              	show_image(dh);	  
		              }
		              set_image("/assets/dady/fm.jpg");
		            }
		          }    
		        },
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						if (add_new!='3' && add_new!='4'){
							Ext.getCmp('archive_grid').store.load();
						};						
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				region: 'south',
				iconCls:'icon-grid',
				layout: 'fit',
				height: 150,
				split: true,
				collapsible: true,
				title: 'å·å†…ç›®å½•',
				items: documentGrid

			},{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'ç›® å½• å·',
	                    labelWidth: 60,
	                    x: 10,
						name: 'mlh',
						id: 'zh_mlh',
	                    y: 10,
						listeners : {
						       change : function(field,newValue,oldValue){
									if (newValue==""){
										alert("ç›®å½•å·ä¸èƒ½ä¸ºç©ºã€‚");
										field.value=oldValue;
									}else{
										qzh=title.split("_");
										if(add_new==true){
							               //alert(newValue+'---'+'oldValue');										
											new Ajax.Request("/desktop/get_max_ajh", { 
											    	method: "POST",
											    	parameters: {dalb:qzh[0] + "_" +qzh[1]+"_"+ newValue,qx:false},
											    	onComplete:	 function(request) {
											    		Ext.getCmp('zh_ajh').setValue(request.responseText);
											     	}
											     });
										}
									}
									
						       }
						}
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'åˆ†ç±»å·',
	                    labelWidth: 60,
						name: 'flh',
						id: 'zh_flh',
	                    x: 175,
	                    y: 10
	                },
	                {
	                    xtype: 'textareafield',
	                    height: 55,
	                    width: 655,
	                    fieldLabel: 'æ¡ˆå·æ ‡é¢˜',
	                    labelWidth: 60,
						name: 'tm',
						id: 'zh_aj_tm',
	                    x: 10,
	                    y: 45
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'æ¡ˆå·å·',
	                    labelWidth: 60,
						name: 'ajh',
						id: 'zh_ajh',
	                    x: 345,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'å¹´åº¦',
	                    labelWidth: 60,
						name: 'nd',
						id: 'zh_nd',
	                    x: 520,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'èµ· å¹´ æœˆ',
	                    labelWidth: 60,
						name: 'qny',
						id: 'zh_qny',
	                    x: 10,
	                    y: 115
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'æ­¢å¹´æœˆ',
	                    labelWidth: 60,
						name: 'zny',
						id: 'zh_zny',
	                    x: 175,
	                    y: 115
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'ä»¶æ•°',
	                    labelWidth: 60,
						name: 'js',
						id: 'zh_js',
	                    x: 345,
	                    y: 115
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'é¡µæ•°',
	                    labelWidth: 60,
						name: 'ys',
						id: 'zh_ys',
	                    x: 520,
	                    y: 115
	                },
	                {
	                    xtype: 'textfield',
	                    width: 310,
	                    fieldLabel: 'å­˜å…¥ä½ç½®',
	                    labelWidth: 60,
						name: 'cfwz',
						id: 'zh_cfwz',
	                    x: 10,
	                    y: 185
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'ç®±å·',
	                    labelWidth: 60,
						name: 'xh',
						id: 'zh_xh',
	                    x: 345,
	                    y: 150
	                },
	                {
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'ä¿ç®¡æœŸé™',
	                    labelWidth: 60,
						name: 'bgqx',
						store: bgqx_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_bgqx',
	                    x: 10,
	                    y: 150
	                },
	                {
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'å¯†çº§',
	                    labelWidth: 60,
						name: 'mj',
						store: mj_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_mj',
	                    x: 175,
	                    y: 150
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'å¤‡æ³¨',
	                    labelWidth: 60,
						name: 'bz',
						id: 'zh_bz',
	                    x: 345,
	                    y: 185
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'zh_qzh',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'zh_dalb',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'zh_id',
	                    x: 10,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dh',
						id: 'zh_dh',
	                    x: 10,
	                    y: 190
	                }	,
						{
		                    xtype: 'textfield',
		                    hidden : true,
							name: 'userid',
							id: 'userid',
		                    x: 10,
		                    y: 190
		                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		if(add_new==true){
			Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
			ss=title.split('_');
			Ext.getCmp('zh_dalb').setValue(ss[1]);		
			Ext.getCmp('zh_qzh').setValue(ss[0]);
			if(ss.length==3){
				new Ajax.Request("/desktop/get_mlh", { 
				    	method: "POST",
				    	parameters: {dalb:ss[2]},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_mlh').setValue(request.responseText);
				     	}
				     });
				new Ajax.Request("/desktop/get_max_ajh", { 
				    	method: "POST",
				    	parameters: {dalb:title,qx:true},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_ajh').setValue(request.responseText);
				     	}
				     });
				if (record!=undefined){
					Ext.getCmp('zh_nd').setValue(record.data.nd);			
					Ext.getCmp('zh_flh').setValue(record.data.flh);
					Ext.getCmp('zh_qny').setValue(record.data.qny);			
					Ext.getCmp('zh_zny').setValue(record.data.zny);
					Ext.getCmp('zh_bgqx').setValue(record.data.bgqx);			
					Ext.getCmp('zh_aj_tm').setValue(record.data.tm);
					Ext.getCmp('zh_js').setValue(record.data.js);
					Ext.getCmp('zh_ys').setValue(record.data.ys);
				}
			}
		}else{
			if(add_new=='4'){
				Ext.getCmp('button_aj_add').setVisible(false);
				Ext.getCmp('jrdelete').setVisible(false);
				Ext.getCmp('jradd').setVisible(false);
				Ext.getCmp('jrsave').setVisible(false);
				Ext.getCmp('jrmbsave').setVisible(false);
				
				new Ajax.Request("/desktop/yun_get_archivebyid", { 
 
				    	method: "POST",
				    	parameters: {ip:record.data.ip,dh:record.data.dh,id:record.data.daid,userid:currentUser.id},
				    	onComplete:	 function(request) {
				    		requestdata=eval('(' + request.responseText + ')');						
							Ext.getCmp('daglaj_form').getForm().setValues(requestdata[0]);
							com_document_store.proxy.url="/desktop/yun_get_documentbyajid"
							com_document_store.proxy.extraParams={ip:record.data.ip,dh:record.data.dh,id:record.data.daid,userid:currentUser.id}
							com_document_store.load();
				     	}
				});
							
			}else{
				requestdata='';
				new Ajax.Request("/desktop/get_archivebyid", { 
				    	method: "POST",
				    	parameters: {dh:record.data.dh,id:record.data.id,userid:currentUser.id},
				    	onComplete:	 function(request) {
				    		requestdata=eval('(' + request.responseText + ')');						
							Ext.getCmp('daglaj_form').getForm().setValues(requestdata[0]);
				     	}
				     });
				//Ext.getCmp('button_aj_add').hidden=true;
				com_document_store.proxy.extraParams.query=record.data.id;
				com_document_store.load();
			}
		}
		
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};

var DispAj_zp = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	Ext.regModel('com_document_model', {
		fields: [
            {name: 'id',    type: 'integer'},
            {name: 'tm',    type: 'string'},
			{name: 'mlh',    type: 'string'},
            {name: 'ajh',   type: 'string'},
            {name: 'sxh',   type: 'string'},
            {name: 'yh',    type: 'string'},
            {name: 'wh',    type: 'string'},
            {name: 'zrz',   type: 'string'},
            {name: 'psrq',    type: 'string',  type: 'date',  dateFormat: 'Y-m-d H:i:s'},
            {name: 'bz',    type: 'string'},
            {name: 'dh',    type: 'string'},
			{name: 'zph',    type: 'string'},
			{name: 'psz',    type: 'string'},
            {name: 'sy',    type: 'string'},
			{name: 'dd',    type: 'string'},
			{name: 'rw',    type: 'string'},
			{name: 'bj',    type: 'string'},
            {name: 'ownerid',   type: 'integer'},
			{name: 'zpid',   type: 'integer'}
        ]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
		tbar:[
			{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
				handler: function() {
					if (Ext.getCmp('zh_id').value!=undefined){
						DispJr_zp(record,true,Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
					}else
					{
						alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
					}

				}
			},
			{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
				handler: function() {

					var grid = Ext.getCmp('com_document_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];

					var pars="id="+record.data.id;
					Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
								if(id=="yes"){
									new Ajax.Request("/desktop/delete_document", { 
										method: "POST",
										parameters: {id:record.data.id,userid:currentUser.id},
										onComplete:	 function(request) {
											Ext.getCmp('com_document_grid').store.load();
										}
									});
								}else{
									//alert('O,no');
								}

						});

				}},
			{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
			handler: function() {
				var grid  = this.ownerCt.ownerCt;
				//alert(grid);
					var store = grid.getStore(); 
					var records = grid.getSelectionModel().getSelection();
					var data = [];
					Ext.Array.each(records,function(model){
						data.push(Ext.JSON.encode(model.get('id')));
						DispJr_zp(model,false,'','',true);
					});
				}
			},{
				xtype:'button',text:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',tooltip:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',iconCls:'add',
		          handler: function() {
					if (Ext.getCmp('zh_id').value!=undefined){
						size=Ext.getCmp('com_document_grid').store.count();
						if (size>0){	              					  
			              	alert("æ­¤æ¡ˆå·å·²ç»æœ‰å·å†…ç›®å½•ï¼Œä¸èƒ½ä»¥æ¨¡æ¿æ–¹å¼è¿›è¡Œå¢åŠ å·å†…ç›®å½•ã€‚");
						}else{					
							DispJr_model(Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
						}
					}else
					{
						alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
					}		              
			 	}
			}
		],
		columns: [
			{ text : 'id',  width : 0, sortable : true, dataIndex: 'id'},
	          { text : 'æ¡£å·',  width : 0, sortable : true, dataIndex: 'dh'},
	          { text : 'ç…§ç‰‡å·',  width : 30, sortable : true, dataIndex: 'zph'},

	          { text : 'é¢˜å',  width : 175, sortable : true, dataIndex: 'tm'},
	          { text : 'æ‹æ‘„è€…',  width : 105, sortable : true, dataIndex: 'psz'},

			  { text : 'äº‹ç”±',  width : 105, sortable : true, dataIndex: 'sy'},
	          { text : 'åœ°ç‚¹',  width : 75, sortable : true, dataIndex: 'dd'},
			ã€€ã€€{ text : 'äººç‰©',  width : 105, sortable : true, dataIndex: 'rw'},
	          { text : 'èƒŒæ™¯',  width : 75, sortable : true, dataIndex: 'bj'},


	          { text : 'é¡µå·',  width : 75, sortable : true, dataIndex: 'yh'},

	          { text : 'æ—¥æœŸ',  width : 75, sortable : true, dataIndex: 'psrq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
	          { text : 'å¤‡æ³¨',  width : 75, sortable : true, dataIndex: 'bz'},
	          { text : 'ownerid',  flex : 1, sortable : true, dataIndex: 'ownerid'},
			  { text : 'zpid',  flex : 1, sortable : true, dataIndex: 'zpid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						//DispJr(r,false);
						DispJr_zp(r,false,'','',true);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'æ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						
						if(add_new==false || add_new=='3'){
							new Ajax.Request("/desktop/update_flow", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");	
										Ext.getCmp('zh_dh').setValue(responseT[1]);																					
									}else{
										alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
									}
									
								}
							});
						}else{
							new Ajax.Request("/desktop/insert_archive", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
										dh=responseT[1];
										Ext.getCmp('button_aj_add').setText('ä¿®æ”¹ä¿å­˜');
										Ext.getCmp('zh_id').setValue(responseT[2]);
										Ext.getCmp('zh_dh').setValue(responseT[1]);
										add_new=false;											
									}else{
										alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
									}
									
								}
							});
						}
					}
				},
				{
		          text:'æŸ¥çœ‹å›¾åƒæˆ–é™„ä»¶',
		          iconCls:'',
		          handler : function() {
		          
					if (Ext.getCmp('zh_dh').value!=undefined){
		              var dh = Ext.getCmp('zh_dh').value;
		              show_image(dh);	              
		              set_image("/assets/dady/fm.jpg");
		            }
		          }    
		        },
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						if (add_new!='3'){
							Ext.getCmp('archive_grid').store.load();
						};						
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				region: 'south',
				iconCls:'icon-grid',
				layout: 'fit',
				height: 150,
				split: true,
				collapsible: true,
				title: 'å·å†…ç›®å½•',
				items: documentGrid

			},{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'ç›® å½• å·',
	                    labelWidth: 60,
	                    x: 10,
						name: 'mlh',
						id: 'zh_mlh',
	                    y: 10,
						listeners : {
						       change : function(field,newValue,oldValue){
									if (newValue==""){
										alert("ç›®å½•å·ä¸èƒ½ä¸ºç©ºã€‚");
										field.value=oldValue;
									}else{
										qzh=title.split("_");
										if(add_new==true){
							               //alert(newValue+'---'+'oldValue');										
											new Ajax.Request("/desktop/get_max_ajh", { 
											    	method: "POST",
											    	parameters: {dalb:qzh[0] + "_" +qzh[1]+"_"+ newValue,qx:false},
											    	onComplete:	 function(request) {
											    		Ext.getCmp('zh_ajh').setValue(request.responseText);
											     	}
											     });
										}
									}
									
						       }
						}
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'åˆ†ç±»å·',
	                    labelWidth: 60,
						name: 'flh',
						id: 'zh_flh',
	                    x: 175,
	                    y: 10
	                },
	                {
	                    xtype: 'textareafield',
	                    height: 55,
	                    width: 655,
	                    fieldLabel: 'æ¡ˆå·æ ‡é¢˜',
	                    labelWidth: 60,
						name: 'tm',
						id: 'zh_aj_tm',
	                    x: 10,
	                    y: 45
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'æ¡ˆå·å·',
	                    labelWidth: 60,
						name: 'ajh',
						id: 'zh_ajh',
	                    x: 345,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'å¹´åº¦',
	                    labelWidth: 60,
						name: 'nd',
						id: 'zh_nd',
	                    x: 520,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'èµ· å¹´ æœˆ',
	                    labelWidth: 60,
						name: 'qny',
						id: 'zh_qny',
	                    x: 10,
	                    y: 115
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'æ­¢å¹´æœˆ',
	                    labelWidth: 60,
						name: 'zny',
						id: 'zh_zny',
	                    x: 175,
	                    y: 115
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'ä»¶æ•°',
	                    labelWidth: 60,
						name: 'js',
						id: 'zh_js',
	                    x: 345,
	                    y: 115
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'é¡µæ•°',
	                    labelWidth: 60,
						name: 'ys',
						id: 'zh_ys',
	                    x: 520,
	                    y: 115
	                },
	                {
	                    xtype: 'textfield',
	                    width: 310,
	                    fieldLabel: 'å­˜å…¥ä½ç½®',
	                    labelWidth: 60,
						name: 'cfwz',
						id: 'zh_cfwz',
	                    x: 10,
	                    y: 185
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'ç®±å·',
	                    labelWidth: 60,
						name: 'xh',
						id: 'zh_xh',
	                    x: 345,
	                    y: 150
	                },
	                {
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'ä¿ç®¡æœŸé™',
	                    labelWidth: 60,
						name: 'bgqx',
						store: bgqx_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_bgqx',
	                    x: 10,
	                    y: 150
	                },
	                {
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'å¯†çº§',
	                    labelWidth: 60,
						name: 'mj',
						store: mj_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_mj',
	                    x: 175,
	                    y: 150
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'å¤‡æ³¨',
	                    labelWidth: 60,
						name: 'bz',
						id: 'zh_bz',
	                    x: 345,
	                    y: 185
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'zh_qzh',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'zh_dalb',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'zh_id',
	                    x: 10,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dh',
						id: 'zh_dh',
	                    x: 10,
	                    y: 190
	                }	,
						{
		                    xtype: 'textfield',
		                    hidden : true,
							name: 'userid',
							id: 'userid',
		                    x: 10,
		                    y: 190
		                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		if(add_new==true){
			Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
			ss=title.split('_');
			Ext.getCmp('zh_dalb').setValue(ss[1]);		
			Ext.getCmp('zh_qzh').setValue(ss[0]);
			if(ss.length==3){
				new Ajax.Request("/desktop/get_mlh", { 
				    	method: "POST",
				    	parameters: {dalb:ss[2]},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_mlh').setValue(request.responseText);
				     	}
				     });
				new Ajax.Request("/desktop/get_max_ajh", { 
				    	method: "POST",
				    	parameters: {dalb:title,qx:true},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_ajh').setValue(request.responseText);
				     	}
				     });
			}
		}else{
			requestdata='';
			new Ajax.Request("/desktop/get_archivebyid", { 
			    	method: "POST",
			    	parameters: {dh:record.data.dh,id:record.data.id,userid:currentUser.id},
			    	onComplete:	 function(request) {
			    		requestdata=eval('(' + request.responseText + ')');						
						Ext.getCmp('daglaj_form').getForm().setValues(requestdata[0]);
			     	}
			     });
			//Ext.getCmp('button_aj_add').hidden=true;
			com_document_store.proxy.extraParams.query=record.data.id;
			com_document_store.load();
		}
		
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};


var DispAj_cw = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
		tbar:[
			{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
				handler: function() {
					if (Ext.getCmp('cw_id').value!=undefined){
						DispJr(record,true,Ext.getCmp('cw_id').value,Ext.getCmp('cw_dh').value,true);
					}else
					{
						alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
					}

				}
			},
			{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
				handler: function() {

					var grid = Ext.getCmp('com_document_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];

					var pars="id="+record.data.id;
					Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
								if(id=="yes"){
									new Ajax.Request("/desktop/delete_document", { 
										method: "POST",
										parameters: {id:record.data.id,userid:currentUser.id},
										onComplete:	 function(request) {
											Ext.getCmp('com_document_grid').store.load();

										}
									});
								}else{
									//alert('O,no');
								}

						});

				}},
			{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
			handler: function() {
				var grid  = this.ownerCt.ownerCt;
				//alert(grid);
					var store = grid.getStore(); 
					var records = grid.getSelectionModel().getSelection();
					var data = [];
					Ext.Array.each(records,function(model){
						data.push(Ext.JSON.encode(model.get('id')));
						DispJr(model,false,'','',true);
					});
				}
			}	,{
					xtype:'button',text:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',tooltip:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',iconCls:'add',
			          handler: function() {
						if (Ext.getCmp('cw_id').value!=undefined){
							size=Ext.getCmp('com_document_grid').store.count();
							if (size>0){	              					  
				              	alert("æ­¤æ¡ˆå·å·²ç»æœ‰å·å†…ç›®å½•ï¼Œä¸èƒ½ä»¥æ¨¡æ¿æ–¹å¼è¿›è¡Œå¢åŠ å·å†…ç›®å½•ã€‚");
							}else{					
								DispJr_model(Ext.getCmp('cw_id').value,Ext.getCmp('cw_dh').value,true);
							}
						}else
						{
							alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
						}		              
				 	}
				}

		],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						DispJr(r,false,'','',true);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'æ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						if(add_new==false || add_new=='3'){
							new Ajax.Request("/desktop/update_flow", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");	
										Ext.getCmp('cw_dh').setValue(responseT[1]);
										//Ext.getCmp('archive_grid_cw').store.load();
										//Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
									}
									
								}
							});
						}else{
							new Ajax.Request("/desktop/insert_archive", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
										dh=responseT[1];
										Ext.getCmp('button_aj_add').setText('ä¿®æ”¹ä¿å­˜');
										Ext.getCmp('cw_id').setValue(responseT[2]);
										Ext.getCmp('cw_dh').setValue(responseT[1]);
										add_new=false;												
									}else{
										alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
									}
									
								}
							});
						}
					}
				},
				{
		          text:'æŸ¥çœ‹å›¾åƒæˆ–é™„ä»¶',
		          iconCls:'',
		          handler : function() {
		          
					if (Ext.getCmp('cw_dh').value!=undefined){
		              var dh = Ext.getCmp('cw_dh').value;
		              show_image(dh);	              
		              set_image("/assets/dady/fm.jpg");
		            }
		          }    
		        },
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						if (add_new!='3'){
							Ext.getCmp('archive_grid_cw').store.load();
						};						
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				region: 'south',
				iconCls:'icon-grid',
				layout: 'fit',
				height: 150,
				split: true,
				collapsible: true,
				title: 'å·å†…ç›®å½•',
				items: documentGrid

			},{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'ç›® å½• å·',
	                    labelWidth: 60,
						name: 'mlh',
						id: 'cw_mlh',
	                    x: 10,
	                    y: 10,
						listeners : {
						       change : function(field,newValue,oldValue){
									if (newValue==""){
										alert("ç›®å½•å·ä¸èƒ½ä¸ºç©ºã€‚");
										field.value=oldValue;
									}else{
										qzh=title.split("_");
										if(add_new==true){
											new Ajax.Request("/desktop/get_max_ajh", { 
											    	method: "POST",
											    	parameters: {dalb:qzh[0] + "_" +qzh[1]+"_"+ newValue,qx:false},
											    	onComplete:	 function(request) {
											    		Ext.getCmp('cw_ajh').setValue(request.responseText);
											     	}
											     });
										}
									}
									
						       }
						}
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'åˆ†ç±»å·',
	                    labelWidth: 60,
						name: 'flh',
						id: 'cw_flh',
	                    x: 175,
	                    y: 10
	                },
	                {
	                    xtype: 'textareafield',
	                    height: 55,
	                    width: 655,
	                    fieldLabel: 'æ¡ˆå·æ ‡é¢˜',
	                    labelWidth: 60,
						name: 'tm',
						id: 'cw_aj_tm',
	                    x: 10,
	                    y: 45
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'æ¡ˆå·å·',
	                    labelWidth: 60,
						name: 'ajh',
						id: 'cw_ajh',
	                    x: 345,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'å¹´åº¦',
	                    labelWidth: 60,
						name: 'nd',
						id: 'cw_nd',
	                    x: 520,
	                    y: 10
	                },
	                {
	                    xtype: 'datefield',
						format: 'Y-m-d',
	                    width: 145,
	                    fieldLabel: 'èµ· æ—¥ æœŸ',
	                    labelWidth: 60,
						name: 'qrq',
						id: 'cw_qrq',
	                    x: 10,
	                    y: 115
	                },
	                {
	                    xtype: 'datefield',
						format: 'Y-m-d',
	                    width: 145,
	                    fieldLabel: 'æ­¢æ—¥æœŸ',
	                    labelWidth: 60,
						name: 'zrq',
						id: 'cw_zrq',
	                    x: 175,
	                    y: 115
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'å·å†…å¼ æ•°',
	                    labelWidth: 60,
						name: 'jnzs',
						id: 'cw_jnzs',
	                    x: 345,
	                    y: 115
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'é™„ä»¶å¼ æ•°',
	                    labelWidth: 60,
						name: 'fjzs',
						id: 'cw_fjzs',
	                    x: 520,
	                    y: 115
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'ä»¶æ•°',
	                    labelWidth: 60,
						name: 'js',
						id: 'cw_js',
	                    x: 10,
	                    y: 185
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'å‡­è¯èµ·å·',
	                    labelWidth: 60,
						name: 'pzqh',
						id: 'cw_pzqh',
	                    x: 345,
	                    y: 150
	                },
	                {
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'ä¿ç®¡æœŸé™',
	                    labelWidth: 60,
						name: 'bgqx',
						store: jhcw_bgqx_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'cw_bgqx',
	                    x: 10,
	                    y: 150
	                },
	                {
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'å¯†çº§',
	                    labelWidth: 60,
						name: 'mj',
						store: mj_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'cw_mj',
	                    x: 175,
	                    y: 150
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'å¤‡æ³¨',
	                    labelWidth: 60,
						name: 'bz',
						id: 'cw_bz',
	                    x: 345,
	                    y: 185
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'å‡­è¯æ­¢å·',
	                    labelWidth: 60,
						name: 'pzzh',
						id: 'cw_pzzj',
	                    x: 520,
	                    y: 150
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'é¡µæ•°',
	                    labelWidth: 60,
						name: 'ys',
						id: 'cw_ys',
	                    x: 175,
	                    y: 185
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'cw_qzh',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'cw_dalb',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'cw_id',
	                    x: 10,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dh',
						id: 'cw_dh',
	                    x: 10,
	                    y: 190
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		if(add_new==true){
			Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
			ss=title.split('_');
			Ext.getCmp('cw_dalb').setValue(ss[1]);		
			Ext.getCmp('cw_qzh').setValue(ss[0]);
			if(ss.length==3){
				new Ajax.Request("/desktop/get_mlh", { 
				    	method: "POST",
				    	parameters: {dalb:ss[2]},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('cw_mlh').setValue(request.responseText);
				     	}
				     });
				new Ajax.Request("/desktop/get_max_ajh", { 
				    	method: "POST",
				    	parameters: {dalb:title,qx:true},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('cw_ajh').setValue(request.responseText);
				     	}
				     });
			}
		}else{
			requestdata='';
			new Ajax.Request("/desktop/get_archivebyid", { 
			    	method: "POST",
			    	parameters: {dh:record.data.dh,id:record.data.id,userid:currentUser.id},
			    	onComplete:	 function(request) {
			    		requestdata=eval('(' + request.responseText + ')');						
						Ext.getCmp('daglaj_form').getForm().setValues(requestdata[0]);
			     	}
			     });
			//Ext.getCmp('button_aj_add').hidden=true;
			com_document_store.proxy.extraParams.query=record.data.id;
			com_document_store.load();
		}
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};
var DispAj_tddj = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
		tbar:[
			{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
				handler: function() {
					if (Ext.getCmp('tddj_id').value!=undefined  || Ext.getCmp('tddj_id').value!=''){
						DispJr(record,true,Ext.getCmp('tddj_id').value,Ext.getCmp('tddj_dh').value,true);
					}else
					{
						alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
					}

				}
			},
			{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
				handler: function() {

					var grid = Ext.getCmp('com_document_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];

					var pars="id="+record.data.id;
					Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
								if(id=="yes"){
									new Ajax.Request("/desktop/delete_document", { 
										method: "POST",
										parameters: {id:record.data.id,userid:currentUser.id},
										onComplete:	 function(request) {
											Ext.getCmp('com_document_grid').store.load();

										}
									});
								}else{
									//alert('O,no');
								}

						});

				}},
			{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
			handler: function() {
				var grid  = this.ownerCt.ownerCt;
				//alert(grid);
					var store = grid.getStore(); 
					var records = grid.getSelectionModel().getSelection();
					var data = [];
					Ext.Array.each(records,function(model){
						data.push(Ext.JSON.encode(model.get('id')));
						DispJr(model,false,'','',true);
					});
				}
			}	,{
					xtype:'button',text:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',tooltip:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',iconCls:'add',
			          handler: function() {
						if (Ext.getCmp('tddj_id').value!=undefined  || Ext.getCmp('tddj_id').value!=''){
							size=Ext.getCmp('com_document_grid').store.count();
							if (size>0){	              					  
				              	alert("æ­¤æ¡ˆå·å·²ç»æœ‰å·å†…ç›®å½•ï¼Œä¸èƒ½ä»¥æ¨¡æ¿æ–¹å¼è¿›è¡Œå¢åŠ å·å†…ç›®å½•ã€‚");
							}else{					
								DispJr_model(Ext.getCmp('tddj_id').value,Ext.getCmp('tddj_dh').value,true);
							}
						}else
						{
							alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
						}		              
				 	}
				},{
					xtype:'button',text:'è¯»å–åœ°ç±æ•°æ®',tooltip:'ä»åœ°ç±æ•°æ®åº“è¯»å–æ•°æ®',iconCls:'add',
			          handler: function() {
						if (Ext.getCmp('tddj_id').value==undefined  || Ext.getCmp('tddj_id').value==''){
							var pars="tdzh="+Ext.getCmp('tddj_tdzh').value;
							new Ajax.Request("/desktop/get_oracle_tddj", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									//alert(request.responseText);
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										Ext.getCmp('tddj_djh').setValue(responseT[1]);
										Ext.getCmp('tddj_tdzl').setValue(responseT[2]);
										Ext.getCmp('tddj_qlrmc').setValue(responseT[3]);
										Ext.getCmp('tddj_qsxz').setValue(responseT[4]);										
									}else{
										if (responseT[0]=='false'){
											alert("åœ°ç±åº“ä¸­æ— æ­¤è¯å·çš„æ•°æ®ã€‚");	
										}else{
											alert(responseT[0]);
										}
									}									
								}
							});
						}else
						{
							alert("å·²ä¿å­˜è¿‡çš„æ¡ˆå·ä¸èƒ½è¿›è¡Œåœ°ç±æ•°æ®çš„è¯»å–ã€‚");
						}		              
				 	}
				}

		],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						DispJr(r,false,'','',true);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'æ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[
					
					{
		          		text:'æ–°å¢',
			          	cls:'add',
						id:'aj_add',
			          	handler : function() {          
							//Ext.getCmp('tddj_djh').setValue('');
							//Ext.getCmp('tddj_qlrmc').setValue('');
							//Ext.getCmp('tddj_tdzl').setValue('');
							Ext.getCmp('tddj_id').setValue('');
							add_new=true;
							Ext.getCmp('button_aj_add').setText('æ–°å¢ä¿å­˜');
							qzh=title.split("_");
							if(Ext.getCmp('tddj_mlh').value!=undefined || Ext.getCmp('tddj_mlh').value!=''){
								new Ajax.Request("/desktop/get_max_ajh", { 
								    	method: "POST",
								    	parameters: {dalb:qzh[0] + "_" +qzh[1]+"_"+ Ext.getCmp('tddj_mlh').value,qx:false},
								    	onComplete:	 function(request) {
								    		Ext.getCmp('tddj_ajh').setValue(request.responseText);
								     	}
								     });
							}
		          		}    
		        	},
					{
						xtype: 'button',
						cls: 'change',
						id:'button_aj_add',
						text:'ä¿®æ”¹ä¿å­˜',
						handler: function() {
							var pars=Ext.getCmp('daglaj_form').getForm().getValues();
							if(add_new==false || add_new=='3'){
								new Ajax.Request("/desktop/update_flow", { 
									method: "POST",
									parameters: pars,
									onComplete:	 function(request) {
										responseT=request.responseText.split(':');
										if (responseT[0]=='success'){
											alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");	
											Ext.getCmp('tddj_dh').setValue(responseT[1]);
											//Ext.getCmp('archive_grid_tddj').store.load();
											//Ext.getCmp('archive_detail_win').close();												
										}else{
											alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
										}
									
									}
								});
							}else{
								if(Ext.getCmp('sfdrjr').checked==true ){
									if(Ext.getCmp('preajid').getValue()!=''){
										new Ajax.Request("/desktop/insert_archive", { 
											method: "POST",
											parameters: pars,
											onComplete:	 function(request) {
												responseT=request.responseText.split(':');
												if (responseT[0]=='success'){
													alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
													dh=responseT[1];
													Ext.getCmp('button_aj_add').setText('ä¿®æ”¹ä¿å­˜');
													Ext.getCmp('tddj_id').setValue(responseT[2]);
													Ext.getCmp('tddj_dh').setValue(responseT[1]);
													add_new=false;												
												}else{
													alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
												}
									
											}
										});
									}else{
										alert("åœ¨è¿›å…¥æ¡ˆå·æ˜¾ç¤ºçª—å£å‰æœªé€‰æ‹©ä¸€ä¸ªæ¡ˆå·ã€‚");
									}
								}else{
									new Ajax.Request("/desktop/insert_archive", { 
										method: "POST",
										parameters: pars,
										onComplete:	 function(request) {
											responseT=request.responseText.split(':');
											if (responseT[0]=='success'){
												alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
												dh=responseT[1];
												Ext.getCmp('button_aj_add').setText('ä¿®æ”¹ä¿å­˜');
												Ext.getCmp('tddj_id').setValue(responseT[2]);
												Ext.getCmp('tddj_dh').setValue(responseT[1]);
												add_new=false;												
											}else{
												alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
											}
								
										}
									});
								}							
							}
						}
					},
					{
		          		text:'æŸ¥çœ‹å›¾åƒæˆ–é™„ä»¶',
			          	iconCls:'',
			          	handler : function() {
		          
							if (Ext.getCmp('tddj_dh').value!=undefined){
				              var dh = Ext.getCmp('tddj_dh').value;
							  if(add_new=='4'){
								show_image(dh,record.data.ip,"1");	 
							  }else{
				              	show_image(dh);	  
				              }	              
				              set_image("/assets/dady/fm.jpg");
				            }
		          		}    
		        	},
					{
						xtype: 'button',
						cls: 'exit',
						text:'é€€å‡º',
						handler: function() {
							//this.up('window').hide();
							if (add_new!='3' && add_new!='4'){
								Ext.getCmp('archive_grid_tddj').store.load();
							};						
							Ext.getCmp('archive_detail_win').close();
						}
					}],
			items: [{
						region: 'south',
						iconCls:'icon-grid',
						layout: 'fit',
						height: 150,
						split: true,
						collapsible: true,
						title: 'å·å†…ç›®å½•',
						items: documentGrid
					},{
						width: 688,
						height: 256,
						region: 'center',
						xtype:'form',
						layout: 'absolute',
						id : 'daglaj_form',
						items: [
			                {
			                    xtype: 'textfield',
			                    width: 145,
			                    fieldLabel: 'ç›® å½• å·',
			                    labelWidth: 60,
								name: 'mlh',
								id: 'tddj_mlh',
			                    x: 10,
			                    y: 10,
								listeners : {
								       change : function(field,newValue,oldValue){
											if (newValue==""){
												alert("ç›®å½•å·ä¸èƒ½ä¸ºç©ºã€‚");
												field.value=oldValue;
											}else{
												qzh=title.split("_");
												if(add_new==true){
													new Ajax.Request("/desktop/get_max_ajh", { 
													    	method: "POST",
													    	parameters: {dalb:qzh[0] + "_" +qzh[1]+"_"+ newValue,qx:false},
													    	onComplete:	 function(request) {
													    		Ext.getCmp('tddj_ajh').setValue(request.responseText);
													     	}
													     });
												}
											}
									
								       }
								}
			                },
			                {
			                    xtype: 'textfield',
			                    width: 145,
			                    fieldLabel: 'åˆ†ç±»å·',
			                    labelWidth: 60,
								name: 'flh',
								id: 'tddj_flh',
			                    x: 175,
			                    y: 10
			                },
			                {
			                    xtype: 'textfield',
			                    width: 140,
			                    fieldLabel: 'æ¡ˆå·å·',
			                    labelWidth: 60,
								name: 'ajh',
								id: 'tddj_ajh',
			                    x: 345,
			                    y: 10
			                },
			                {
			                    xtype: 'textfield',
			                    width: 145,
			                    fieldLabel: 'å¹´åº¦',
			                    labelWidth: 60,
								name: 'nd',
								id: 'tddj_nd',
			                    x: 520,
			                    y: 10
			                },
							{
			                    xtype: 'combobox',
			                    fieldLabel: 'æƒå±æ€§è´¨',
			                    labelWidth: 60,
								name: 'qsxz',
								store: qsxz_store,
								emptyText:'è¯·é€‰æ‹©',
								mode: 'remote',
								minChars : 2,
								valueField:'text',
								displayField:'text',
								triggerAction:'all',
								id: 'tddj_qsxz',
			                    x: 10,
			                    y: 40
			                },
							{
			                    xtype: 'textfield',
			                    width: 200,
			                    fieldLabel: 'ç°åœ°ç±å·',
			                    labelWidth: 60,
								name: 'djh',
								id: 'tddj_djh',
			                    x: 245,
			                    y: 40
			                },
			                {
			                    xtype: 'textfield',
			                    width: 195,
			                    fieldLabel: 'åŸåœ°ç±å·',
			                    labelWidth: 60,
								name: 'ydjh',
								id: 'tddj_ydjh',
			                    x: 470,
			                    y: 40
			                },
							{
			                    xtype: 'textfield',
			                    width: 655,
			                    fieldLabel: 'åœŸåœ°åº§è½',
			                    labelWidth: 60,
								name: 'tdzl',
								id: 'tddj_tdzl',
			                    x: 10,
			                    y: 70
			                },
			                {
			                    xtype: 'textfield',
			                    width: 475,
			                    fieldLabel: 'æƒ  åˆ©  äºº',
			                    labelWidth: 60,
								name: 'qlrmc',
								id: 'tddj_qlrmc',
			                    x: 10,
			                    y: 100
			                },
							{
			                    xtype: 'textfield',
			                    width: 145,
			                    fieldLabel: 'å›¾å¹…å·',
			                    labelWidth: 60,
								name: 'tfh',
								id: 'tddj_tfh',
			                    x: 520,
			                    y: 100
			                },
			                {
			                    xtype: 'textfield',
			                    width: 145,
			                    fieldLabel: 'èµ· å¹´ æœˆ',
			                    labelWidth: 60,
								name: 'qny',
								id: 'tddj_qny',
			                    x: 10,
			                    y: 130
			                },
			                {
			                    xtype: 'textfield',
			                    width: 145,
			                    fieldLabel: 'æ­¢å¹´æœˆ',
			                    labelWidth: 60,
								name: 'zny',
								id: 'tddj_zny',
			                    x: 175,
			                    y: 130
			                },
			                {
			                    xtype: 'textfield',
			                    width: 140,
			                    fieldLabel: 'ä»¶æ•°',
			                    labelWidth: 60,
								name: 'js',
								id: 'tddj_js',
			                    x: 345,
			                    y: 130
			                },
			                {
			                    xtype: 'textfield',
			                    width: 145,
			                    fieldLabel: 'é¡µæ•°',
			                    labelWidth: 60,
								name: 'ys',
								id: 'tddj_ys',
			                    x: 520,
			                    y: 130
			                },
							{
			                    xtype: 'combobox',
			                    width: 145,
			                    fieldLabel: 'ä¿ç®¡æœŸé™',
			                    labelWidth: 60,
								name: 'bgqx',
								store: bgqx_store,
								emptyText:'è¯·é€‰æ‹©',
								mode: 'remote',
								minChars : 2,
								valueField:'text',
								displayField:'text',
								triggerAction:'all',
								id:'tddj_bgqx',
			                    x: 10,
			                    y: 160
			                },
			                {
			                    xtype: 'combobox',
			                    width: 145,
			                    fieldLabel: 'å¯†çº§',
			                    labelWidth: 60,
								name: 'mj',
								store: mj_store,
								emptyText:'è¯·é€‰æ‹©',
								mode: 'remote',
								minChars : 2,
								valueField:'text',
								displayField:'text',
								triggerAction:'all',
								id:'tddj_mj',
			                    x: 175,
			                    y: 160
			                },	                
			                {
			                    xtype: 'textfield',
			                    width: 140,
			                    fieldLabel: 'ç®±å·',
			                    labelWidth: 60,
								name: 'xh',
								id: 'tddj_xh',
			                    x: 345,
			                    y: 160
			                },
							{
			                    xtype: 'textfield',
			                    width: 145,
			                    fieldLabel: 'å­˜å…¥ä½ç½®',
			                    labelWidth: 60,
								name: 'cfwz',
								id: 'tddj_cfwz',
			                    x: 520,
			                    y: 160
			                },	
							{
			                    xtype: 'textfield',
			                    width: 310,
			                    fieldLabel: 'åœŸåœ°è¯å·',
			                    labelWidth: 60,
								name: 'tdzh',
								id: 'tddj_tdzh',
			                    x: 10,
			                    y: 190
			                },                
			                {
			                    xtype: 'textfield',
			                    width: 320,
			                    fieldLabel: 'å¤‡æ³¨',
			                    labelWidth: 60,
								name: 'bz',
								id: 'tddj_bz',
			                    x: 345,
			                    y: 190
			                },	                
			                {
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'qzh',
								id: 'tddj_qzh',
			                    x: 10,
			                    y: 190
			                },
			                {
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'dalb',
								id: 'tddj_dalb',
			                    x: 10,
			                    y: 190
			                },
			                {
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'id',
								id: 'tddj_id',
			                    x: 10,
			                    y: 190
			                },
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'dh',
								id: 'tddj_dh',
			                    x: 10,
			                    y: 190
			                },
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                },
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'preajid',
								id: 'preajid',
			                    x: 10,
			                    y: 190
			                },
							{
			            		xtype:'checkbox',boxLabel:'ä¿å­˜æ¡ˆå·æ—¶è‡ªåŠ¨å¯¼å…¥æ‰€é€‰æ¡ˆå·çš„å·å†…',id:'sfdrjr',
								name:'sfdrjr',
								x: 10,
			                    y: 210

			          		},
			            ]
				   }]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if (record!=undefined){
		Ext.getCmp('preajid').setValue(record.data.id);
	}else{
		Ext.getCmp('preajid').setValue('');
	}
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();		
	}else{
		if(add_new==true){
			Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
			ss=title.split('_');
			Ext.getCmp('tddj_dalb').setValue(ss[1]);			
			Ext.getCmp('tddj_qzh').setValue(ss[0]);
			if(ss.length==3){
				new Ajax.Request("/desktop/get_mlh", { 
				    	method: "POST",
				    	parameters: {dalb:ss[2]},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('tddj_mlh').setValue(request.responseText);
				     	}
				     });
				new Ajax.Request("/desktop/get_max_ajh", { 
				    	method: "POST",
				    	parameters: {dalb:title,qx:true},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('tddj_ajh').setValue(request.responseText);
				     	}
				     });
			};
			if (record!=undefined){
				Ext.getCmp('tddj_nd').setValue(record.data.nd);			
				Ext.getCmp('tddj_flh').setValue(record.data.flh);
				Ext.getCmp('tddj_qny').setValue(record.data.qny);			
				Ext.getCmp('tddj_zny').setValue(record.data.zny);
				Ext.getCmp('tddj_bgqx').setValue(record.data.bgqx);			
				Ext.getCmp('tddj_qsxz').setValue(record.data.qsxz);
			}
		}else{
			if(add_new=='4'){
				Ext.getCmp('button_aj_add').setVisible(false);
				Ext.getCmp('aj_add').setVisible(false);
				Ext.getCmp('jrdelete').setVisible(false);
				Ext.getCmp('jradd').setVisible(false);
				Ext.getCmp('jrsave').setVisible(false);
				//Ext.getCmp('jrmbsave').setVisible(false);
				
				new Ajax.Request("/desktop/yun_get_archivebyid", { 
					//new Ajax.Request("/map/get_archivebyid", { 
				    	method: "POST",
				    	parameters: {ip:record.data.ip,dh:record.data.dh,id:record.data.daid,userid:currentUser.id},
				    	onComplete:	 function(request) {
				    		requestdata=eval('(' + request.responseText + ')');						
							Ext.getCmp('daglaj_form').getForm().setValues(requestdata[0]);
							com_document_store.proxy.url="/desktop/yun_get_documentbyajid"
							com_document_store.proxy.extraParams={ip:record.data.ip,dh:record.data.dh,id:record.data.daid,userid:currentUser.id}
							com_document_store.load();
				     	}
				});
				//Ext.getCmp('button_aj_add').hidden=true;								
			}else{
				requestdata='';
				new Ajax.Request("/desktop/get_archivebyid", { 
				    	method: "POST",
				    	parameters: {dh:record.data.dh,id:record.data.id,userid:currentUser.id},
				    	onComplete:	 function(request) {
				    		requestdata=eval('(' + request.responseText + ')');						
							Ext.getCmp('daglaj_form').getForm().setValues(requestdata[0]);
				     	}
				     });
				//Ext.getCmp('button_aj_add').hidden=true;
				com_document_store.proxy.extraParams.query=record.data.id;
				com_document_store.load();
			}
		}
		
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};

var DispAj_kyq = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
		tbar:[
			{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
				handler: function() {
					if (Ext.getCmp('kyq_id').value!=undefined){
						DispJr(record,true,Ext.getCmp('kyq_id').value,Ext.getCmp('kyq_dh').value,true);
					}else
					{
						alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
					}

				}
			},
			{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
				handler: function() {

					var grid = Ext.getCmp('com_document_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];

					var pars="id="+record.data.id;
					Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
								if(id=="yes"){
									new Ajax.Request("/desktop/delete_document", { 
										method: "POST",
										parameters: {id:record.data.id,userid:currentUser.id},
										onComplete:	 function(request) {
											Ext.getCmp('com_document_grid').store.load();

										}
									});
								}else{
									//alert('O,no');
								}

						});

				}},
			{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
			handler: function() {
				var grid  = this.ownerCt.ownerCt;
				//alert(grid);
					var store = grid.getStore(); 
					var records = grid.getSelectionModel().getSelection();
					var data = [];
					Ext.Array.each(records,function(model){
						data.push(Ext.JSON.encode(model.get('id')));
						DispJr(model,false,'','',true);
					});
				}
			}	,{
					xtype:'button',text:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',tooltip:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',iconCls:'add',
			          handler: function() {
						if (Ext.getCmp('kyq_id').value!=undefined){
							size=Ext.getCmp('com_document_grid').store.count();
							if (size>0){	              					  
				              	alert("æ­¤æ¡ˆå·å·²ç»æœ‰å·å†…ç›®å½•ï¼Œä¸èƒ½ä»¥æ¨¡æ¿æ–¹å¼è¿›è¡Œå¢åŠ å·å†…ç›®å½•ã€‚");
							}else{					
								DispJr_model(Ext.getCmp('kyq_id').value,Ext.getCmp('kyq_dh').value,true);
							}
						}else
						{
							alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
						}		              
				 	}
				}

		],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						DispJr(r,false,'','',true);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'æ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 705,
			height: 550,
			minHeight: 550,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						if(add_new==false || add_new=='3'){
							new Ajax.Request("/desktop/update_flow", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");	
										Ext.getCmp('kyq_dh').setValue(responseT[1]);
										//Ext.getCmp('archive_grid_tddj').store.load();
										//Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
									}
									
								}
							});
						}else{
							new Ajax.Request("/desktop/insert_archive", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
										dh=responseT[1];
										Ext.getCmp('button_aj_add').setText('ä¿®æ”¹ä¿å­˜');
										Ext.getCmp('kyq_id').setValue(responseT[2]);
										Ext.getCmp('kyq_dh').setValue(responseT[1]);
										add_new=false;												
									}else{
										alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
									}
									
								}
							});
						}
					}
				},
				{
		          text:'æŸ¥çœ‹å›¾åƒæˆ–é™„ä»¶',
		          iconCls:'',
		          handler : function() {
		          
					if (Ext.getCmp('kyq_dh').value!=undefined){
		              var dh = Ext.getCmp('kyq_dh').value;
		              show_image(dh);	              
		              set_image("/assets/dady/fm.jpg");
		            }
		          }    
		        },
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						if (add_new!='3'){
							Ext.getCmp('archive_grid_tddj').store.load();
						};						
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				region: 'south',
				iconCls:'icon-grid',
				layout: 'fit',
				height: 170,
				split: true,
				collapsible: true,
				title: 'å·å†…ç›®å½•',
				items: documentGrid

			},{
				width: 705,
				height: 286,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
					                    xtype: 'textfield',
					                    width: 145,
					                    fieldLabel: 'ç›® å½• å·',
										name: 'mlh',
										id: 'kyq_mlh',
					                    labelWidth: 60,
					                    x: 10,
					                    y: 10,
										listeners : {
										       change : function(field,newValue,oldValue){
													if (newValue==""){
														alert("ç›®å½•å·ä¸èƒ½ä¸ºç©ºã€‚");
														field.value=oldValue;
													}else{
														qzh=title.split("_");
														if(add_new==true){
															new Ajax.Request("/desktop/get_max_ajh", { 
															    	method: "POST",
															    	parameters: {dalb:qzh[0] + "_" +qzh[1]+"_"+ newValue,qx:false},
															    	onComplete:	 function(request) {
															    		Ext.getCmp('kyq_ajh').setValue(request.responseText);
															     	}
															     });
														}
													}

										       }
										}
					                },
					                {
					                    xtype: 'textfield',
					                    width: 175,
					                    fieldLabel: 'åˆ†ç±»å·',
										name: 'flh',
										id: 'kyq_flh',
					                    labelWidth: 60,
					                    x: 165,
					                    y: 10
					                },
					                {
					                    xtype: 'textfield',
					                    width: 175,
					                    fieldLabel: 'æ¡ˆå·å·',
										name: 'ajh',
										id: 'kyq_ajh',
					                    labelWidth: 60,
					                    x: 345,
					                    y: 10
					                },
					                {
					                    xtype: 'textfield',
					                    width: 160,
					                    fieldLabel: 'å¹´åº¦',
										name: 'nd',
										id: 'kyq_nd',
					                    labelWidth: 60,
					                    x: 520,
					                    y: 10
					                },
									{
					                    xtype: 'combobox',
					                    width: 145,
					                    fieldLabel: 'èµ„æ–™ç±»å‹',
										name: 'djlx',
										id: 'kyq_djlx',
										store: kyq_djlx_store,
										emptyText:'è¯·é€‰æ‹©',
										mode: 'remote',
										minChars : 2,
										valueField:'text',
										displayField:'text',
										triggerAction:'all',
					                    labelWidth: 60,
					                    x: 10,
					                    y: 40
					                },
					                {
					                    xtype: 'textfield',
					                    width: 175,
					                    fieldLabel: 'ç°è®¸å¯è¯',
										name: 'xxkz',
										id: 'kyq_xxkz',
					                    labelWidth: 60,
					                    x: 165,
					                    y: 40
					                },
					                {
					                    xtype: 'textfield',
					                    width: 175,
					                    fieldLabel: 'åŸè®¸å¯è¯',
										name: 'yxkz',
										id: 'kyq_yxkz',
					                    labelWidth: 60,
					                    x: 345,
					                    y: 40
					                },
					                {
					                    xtype: 'textfield',
					                    width: 160,
					                    fieldLabel: 'çŸ¿å±±ç¼–å·',
										name: 'ksbh',
										id: 'kyq_ksbh',
					                    labelWidth: 60,
					                    x: 520,
					                    y: 40
					                },
					                {
					                    xtype: 'textfield',
					                    width: 330,
					                    fieldLabel: 'çŸ¿ä¸šæƒäºº',
										name: 'kyqr',
										id: 'kyq_kyqr',
					                    labelWidth: 60,
					                    x: 10,
					                    y: 70
					                },
					                {
					                    xtype: 'textfield',
					                    width: 335,
					                    fieldLabel: 'çŸ¿å±±åç§°',
										name: 'ksmc',
										id: 'kyq_ksmc',
					                    labelWidth: 60,
					                    x: 345,
					                    y: 70
					                },
					                {
					                    xtype: 'combobox',
					                    width: 145,
					                    fieldLabel: 'ç»æµç±»å‹',
										name: 'jjlx',
										id: 'kyq_jjlx',
										store: kyq_jjlx_store,
										emptyText:'è¯·é€‰æ‹©',
										mode: 'remote',
										minChars : 2,
										valueField:'text',
										displayField:'text',
										triggerAction:'all',
					                    labelWidth: 60,
					                    x: 10,
					                    y: 100
					                },
					                {
					                    xtype: 'combobox',
					                    width: 175,
					                    fieldLabel: 'çŸ¿å±±è§„æ¨¡',
										name: 'ksgm',
										id: 'kyq_ksgm',
										store: kyq_ksgm_store,
										emptyText:'è¯·é€‰æ‹©',
										mode: 'remote',
										minChars : 2,
										valueField:'text',
										displayField:'text',
										triggerAction:'all',
					                    labelWidth: 60,
					                    x: 165,
					                    y: 100
					                },
					                {
					                    xtype: 'combobox',
					                    width: 175,
					                    fieldLabel: 'çŸ¿ç§',
										store: kyq_kz_store,
										emptyText:'è¯·é€‰æ‹©',
										mode: 'remote',
										minChars : 2,
										valueField:'text',
										displayField:'text',
										triggerAction:'all',
										name: 'kz',
										id: 'kyq_kz',
					                    labelWidth: 60,
					                    x: 345,
					                    y: 100
					                },
									{
					                    xtype: 'combobox',
					                    width: 160,
					                    fieldLabel: 'ä¿ç®¡æœŸé™',
										name: 'bgqx',
										id: 'kyq_bgqx',
					                    labelWidth: 60,
										store: bgqx_store,
										emptyText:'è¯·é€‰æ‹©',
										mode: 'remote',
										minChars : 2,
										valueField:'text',
										displayField:'text',
										triggerAction:'all',
					                    x: 520,
					                    y: 100
					                },
									{
					                    xtype: 'combobox',
					                    width: 145,
					                    fieldLabel: 'è¡Œæ”¿ä»£ç ',										
					                    labelWidth: 60,
					                    x: 10,
					                    y: 130
					                },
					
					                {
					                    xtype: 'combobox',
					                    width: 90,
					                    fieldLabel: '',
					                    x: 155,
					                    y: 130
					                },
									{
					                    xtype: 'combobox',
					                    width: 95,
					                    fieldLabel: '',
					                    x: 245,
					                    y: 130
					                },
									{
					                    xtype: 'textfield',
					                    width: 180,
					                    fieldLabel: '',
										name: 'xzqdm',
										id: 'kyq_xzqdm',
					                    x: 340,
					                    y: 130
					                },
									{
					                    xtype: 'combobox',
					                    width: 160,
					                    fieldLabel: 'å¯†çº§',
										name: 'mj',
										id: 'kyq_mj',
										store: mj_store,
										emptyText:'è¯·é€‰æ‹©',
										mode: 'remote',
										minChars : 2,
										valueField:'text',
										displayField:'text',
										triggerAction:'all',
					                    labelWidth: 60,
					                    x: 520,
					                    y: 130
					                },
					                {
					                    xtype: 'textfield',
					                    width: 145,
					                    fieldLabel: 'èµ· å¹´ æœˆ',
										name: 'qny',
										id: 'kyq_qny',
					                    labelWidth: 60,
					                    x: 10,
					                    y: 160
					                },
					                {
					                    xtype: 'textfield',
					                    width: 175,
					                    fieldLabel: 'æ­¢å¹´æœˆ',
										name: 'zny',
										id: 'kyq_zny',
					                    labelWidth: 60,
					                    x: 165,
					                    y: 160
					                },
					                {
					                    xtype: 'textfield',
					                    width: 175,
					                    fieldLabel: 'ä»¶æ•°',
										name: 'js',
										id: 'kyq_js',
					                    labelWidth: 60,
					                    x: 345,
					                    y: 160
					                },
					                {
					                    xtype: 'textfield',
					                    width: 160,
					                    fieldLabel: 'é¡µæ•°',
										name: 'ys',
										id: 'kyq_ys',
					                    labelWidth: 60,
					                    x: 520,
					                    y: 160
					                },
					                {
					                    xtype: 'textfield',
					                    width: 330,
					                    fieldLabel: 'çŸ¿å±±ä½ç½®',
										name: 'kswz',
										id: 'kyq_kswz',
					                    labelWidth: 60,
					                    x: 10,
					                    y: 190
					                },
					                
					                
					                
					                {
					                    xtype: 'textfield',
					                    width: 335,
					                    fieldLabel: 'å¤‡æ³¨',
										name: 'bz',
										id: 'kyq_bz',
					                    labelWidth: 60,
					                    x: 345,
					                    y: 190
					                },
					               	{
					                    xtype: 'textfield',
					                    width: 330,
					                    fieldLabel: 'çŸ¿åŒºèŒƒå›´',
										name: 'kqfw',
										id: 'kyq_kqfw',
					                    labelWidth: 60,
					                    x: 10,
					                    y: 220
					                },
					                {
					                    xtype: 'textfield',
					                    width: 115,
					                    fieldLabel: 'å‚¨é‡',
										name: 'cl',
										id: 'kyq_cl',
					                    labelWidth: 60,
					                    x: 345,
					                    y: 220
					                },
									{
					                    xtype: 'combobox',
					                    width: 60,
					                    fieldLabel: '',
										name: 'cldw',
										id: 'kyq_cldw',
										store: kyq_cldw_store,
										emptyText:'è¯·é€‰æ‹©',
										mode: 'remote',
										minChars : 2,
										valueField:'text',
										displayField:'text',
										triggerAction:'all',
					                    x: 460,
					                    y: 220
					                },
					                {
					                    xtype: 'combobox',
					                    width: 160,
					                    fieldLabel: 'å‚¨é‡è§„æ¨¡',
										store: kyq_clgm_store,
										emptyText:'è¯·é€‰æ‹©',
										mode: 'remote',
										minChars : 2,
										valueField:'text',
										displayField:'text',
										triggerAction:'all',
										name: 'clgm',
										id: 'kyq_clgm',
					                    labelWidth: 60,
					                    x: 520,
					                    y: 220
					                },
					                
					                
	
					                {
					                    xtype: 'combobox',
					                    width: 145,
					                    fieldLabel: 'ç”Ÿäº§è§„æ¨¡',
										name: 'scgm',
										id: 'kyq_scgm',
										store: kyq_scgm_store,
										emptyText:'è¯·é€‰æ‹©',
										mode: 'remote',
										minChars : 2,
										valueField:'text',
										displayField:'text',
										triggerAction:'all',
					                    labelWidth: 60,
					                    x: 10,
					                    y: 250
					                },
									{
					                    xtype: 'textfield',
					                    width: 115,
					                    fieldLabel: 'ç”Ÿäº§é‡',
										name: 'sjncl',
										id: 'kyq_sjncl',
					                    labelWidth: 60,
					                    x: 165,
					                    y: 250
					                },
									{
					                    xtype: 'combobox',
					                    width: 60,
					                    fieldLabel: '',
										name: 'scldw',
										store: kyq_scldw_store,
										emptyText:'è¯·é€‰æ‹©',
										mode: 'remote',
										minChars : 2,
										valueField:'text',
										displayField:'text',
										triggerAction:'all',
										id: 'kyq_scldw',
					                    labelWidth: 60,
					                    x: 280,
					                    y: 250
					                },
									{
					                    xtype: 'textfield',
					                    width: 175,
					                    fieldLabel: 'æœ‰æ•ˆæœŸèµ·',
										name: 'yxqq',
										id: 'kyq_yxqq',
					                    labelWidth: 60,
					                    x: 345,
					                    y: 250
					                },
					                {
					                    xtype: 'textfield',
					                    width: 160,
					                    fieldLabel: 'æœ‰æ•ˆæœŸæ­¢',
										name: 'yxqz',
										id: 'kyq_yxqz',
					                    labelWidth: 60,
					                    x: 520,
					                    y: 250
					                },
									{
					                    xtype: 'textfield',
					                    width: 145,
					                    fieldLabel: 'æœ‰æ•ˆæœŸé™',
										name: 'yxqx',
										id: 'kyq_yxqx',
					                    labelWidth: 60,
					                    x: 10,
					                    y: 280
					                },
					                
					                
					                
					                
					                
					                
					                
					                {
					                    xtype: 'textfield',
					                    width: 115,
					                    fieldLabel: 'é¢ç§¯',
										name: 'ksmj',
										id: 'kyq_ksmj',
					                    labelWidth: 60,
					                    x: 165,
					                    y: 280
					                },
									{
					                    xtype: 'combobox',
					                    width: 60,
					                    fieldLabel: '',
										name: 'mjdw',
										id: 'kyq_mjdw',
										store: kyq_mjdw_store,
										emptyText:'è¯·é€‰æ‹©',
										mode: 'remote',
										minChars : 2,
										valueField:'text',
										displayField:'text',
										triggerAction:'all',
					                    x: 280,
					                    y: 280
					                },
					                {
					                    xtype: 'textfield',
					                    width: 175,
					                    fieldLabel: 'å‘è¯æœºå…³',
										name: 'fzjg',
										id: 'kyq_fzjg',
					                    labelWidth: 60,
					                    x: 345,
					                    y: 280
					                },
									{
					                    xtype: 'textfield',
					                    width: 160,
					                    fieldLabel: 'ç®±å·',
										name: 'xh',
										id: 'kyq_xh',
					                    labelWidth: 60,
					                    x: 520,
					                    y: 280
					                },
	                
	                
	                
	                
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'kyq_qzh',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'kyq_dalb',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'kyq_id',
	                    x: 10,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dh',
						id: 'kyq_dh',
	                    x: 10,
	                    y: 190
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		if(add_new==true){
			Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
			ss=title.split('_');
			Ext.getCmp('kyq_dalb').setValue(ss[1]);			
			Ext.getCmp('kyq_qzh').setValue(ss[0]);
			if(ss.length==3){
				new Ajax.Request("/desktop/get_mlh", { 
				    	method: "POST",
				    	parameters: {dalb:ss[2]},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('kyq_mlh').setValue(request.responseText);
				     	}
				     });
				new Ajax.Request("/desktop/get_max_ajh", { 
				    	method: "POST",
				    	parameters: {dalb:title,qx:true},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('kyq_ajh').setValue(request.responseText);
				     	}
				     });
			};
			if (record!=undefined){
				Ext.getCmp('kyq_mlh').setValue(record.data.mlh);
				new Ajax.Request("/desktop/get_max_ajh", { 
				    	method: "POST",
				    	parameters: {dalb:title,qx:true},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('kyq_ajh').setValue(request.responseText);
				     	}
				     });
				Ext.getCmp('kyq_nd').setValue(record.data.nd);			
				Ext.getCmp('kyq_flh').setValue(record.data.flh);
				Ext.getCmp('kyq_qny').setValue(record.data.qny);			
				Ext.getCmp('kyq_zny').setValue(record.data.zny);
				Ext.getCmp('kyq_bgqx').setValue(record.data.bgqx);			
			}
		}else{
			requestdata='';
			new Ajax.Request("/desktop/get_archivebyid", { 
			    	method: "POST",
			    	parameters: {dh:record.data.dh,id:record.data.id,userid:currentUser.id},
			    	onComplete:	 function(request) {
			    		requestdata=eval('(' + request.responseText + ')');						
						Ext.getCmp('daglaj_form').getForm().setValues(requestdata[0]);
			     	}
			     });
			//Ext.getCmp('button_aj_add').hidden=true;
			com_document_store.proxy.extraParams.query=record.data.id;
			com_document_store.load();
		}
		
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};


var DispAj_wsda1 = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	function getbh() {
		if (add_new==true){
			if (Ext.getCmp('wsda_bgqx').rawValue=='' || Ext.getCmp('wsda_jgwth').rawValue=='' || Ext.getCmp('wsda_nd').rawValue==''){
				Ext.getCmp('wsda_jh').setValue("0");
			}else{
				new Ajax.Request("/desktop/get_doc_main", { 
					   	method: "POST",
				    	parameters: {qzh:Ext.getCmp('wsda_qzh').rawValue,nd:Ext.getCmp('wsda_nd').rawValue,jgwth:Ext.getCmp('wsda_jgwth').rawValue,bgqx:Ext.getCmp('wsda_bgqx').rawValue},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('wsda_jh').setValue(request.responseText);
				     	}
					});
			};	
		}	
    };
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
	 //  tbar:[
	 //  	{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
	 //  		handler: function() {
	 //  			var grid = Ext.getCmp('archive_grid_wsda');
	 //  			var records = grid.getSelectionModel().getSelection();
	 //  			var record = records[0];
	 //  			DispJr(record,true);
     //
	 //  		}
	 //  	},
	 //  	{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
	 //  		handler: function() {
     //
	 //  			var grid = Ext.getCmp('com_document_grid');
	 //  			var records = grid.getSelectionModel().getSelection();
	 //  			var record = records[0];
     //
	 //  			var pars="id="+record.data.id;
	 //  			Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
	 //  						if(id=="yes"){
	 //  							new Ajax.Request("/desktop/delete_document", { 
	 //  								method: "POST",
	 //  								parameters: pars,
	 //  								onComplete:	 function(request) {
	 //  									Ext.getCmp('com_document_grid').store.load();
     //
	 //  								}
	 //  							});
	 //  						}else{
	 //  							//alert('O,no');
	 //  						}
     //
	 //  				});
     //
	 //  		}},
	 //  	{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
	 //  	handler: function() {
	 //  		var grid  = this.ownerCt.ownerCt;
	 //  		//alert(grid);
	 //  			var store = grid.getStore(); 
	 //  			var records = grid.getSelectionModel().getSelection();
	 //  			var data = [];
	 //  			Ext.Array.each(records,function(model){
	 //  				data.push(Ext.JSON.encode(model.get('id')));
	 //  				DispJr(model,false);
	 //  			});
	 //  		}
	 //  	}
     //
	 //  ],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						DispJr(r,false);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'æ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[
					{
			          text:'è½¬è‡³å‘æ–‡',
			          iconCls:'refresh',
			          handler : function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						if(Ext.getCmp('wsda_bgqx').rawValue=='' || Ext.getCmp('wsda_jgwth').rawValue=='' || Ext.getCmp('wsda_nd').rawValue=='' || Ext.getCmp('wsda_jh').rawValue==''){
							alert("æœºæ„é—®é¢˜ï¼Œä¿ç®¡æœŸé™ï¼Œå½’æ¡£å¹´åº¦ï¼Œä»¶å·ä¸èƒ½ä¸ºç©ºã€‚");
						}else{
							if(add_new==false || add_new=='3'){
								new Ajax.Request("/desktop/docmain_fw", { 
									method: "POST",
									parameters: pars,
									onComplete:	 function(request) {
										responseT=request.responseText.split(':');										
										if (responseT[0]=='success'){
											alert("è½¬è‡³å‘æ–‡æˆåŠŸã€‚");
										}else{
											alert("è½¬è‡³å‘æ–‡å¤±è´¥ã€‚"+request.responseText);
										}

									}
								});
							}else{
								alert('è¯·å…ˆä¿å­˜ï¼Œå†è½¬è‡³å‘æ–‡ã€‚');
							}
						}
						
			          }    
			        },
					{
					xtype: 'button',
					iconCls: 'option',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						if(Ext.getCmp('wsda_bgqx').rawValue=='' || Ext.getCmp('wsda_jgwth').rawValue=='' || Ext.getCmp('wsda_nd').rawValue=='' || Ext.getCmp('wsda_jh').rawValue==''){
							alert("æœºæ„é—®é¢˜ï¼Œä¿ç®¡æœŸé™ï¼Œå½’æ¡£å¹´åº¦ï¼Œä»¶å·ä¸èƒ½ä¸ºç©ºã€‚");
						}else{
							if(add_new==false || add_new=='3'){
								new Ajax.Request("/desktop/update_flow", { 
									method: "POST",
									parameters: pars,
									onComplete:	 function(request) {
										responseT=request.responseText.split(':');										
										if (responseT[0]=='success'){
											alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");
											Ext.getCmp('archive_grid_wsda').store.load();
											Ext.getCmp('archive_detail_win').close();												
										}else{
											alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
										}
									
									}
								});
							}else{
								new Ajax.Request("/desktop/insert_archive", { 
									method: "POST",
									parameters: pars,
									onComplete:	 function(request) {
										responseT=request.responseText.split(':');
										if (responseT[0]=='success'){
											alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
											Ext.getCmp('archive_grid_wsda').store.load();
											//Ext.getCmp('archive_tree').store.load();
											Ext.getCmp('archive_detail_win').close();												
										}else{
											alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
										}
									
									}
								});
							}
						}
					}
				},
				{
		          text:'æŸ¥çœ‹å›¾åƒæˆ–é™„ä»¶',
		          iconCls:'',
		          handler : function() {
		          
					if (Ext.getCmp('wsda_dh').value!=undefined){
		              var dh = Ext.getCmp('wsda_dh').value;
		              show_image(dh);	              
		              set_image("/assets/dady/fm.jpg");
		            }
		          }    
		        },
				{
					xtype: 'button',
					iconCls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
	                    xtype: 'numberfield',
	                    width: 160,
	                    fieldLabel: 'å¹´ åº¦',
	                    labelWidth: 60,
						name: 'nd',
						id: 'wsda_nd',
	                    x: 10,
	                    y: 10,
						listeners : {
						       change : function(field,newValue,oldValue){
									getbh();									
						       }
						}
	                },
					{
	                    xtype: 'combobox',
	                    width: 165,
	                    fieldLabel: 'ä¿ç®¡æœŸé™',
	                    labelWidth: 60,
						name: 'bgqx',
						id: 'wsda_bgqx',
						name: 'bgqx',
						store: doc_bgqx_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
	                    x: 175,
	                    y: 10,
						listeners : {
						       change : function(field,newValue,oldValue){
									getbh();									
						       }
						}
	                },
				 //  {
	             //      xtype: 'combobox',  //æœºæ„é—®é¢˜å·ä¸‹æ‹‰æ¡†
	             //      width: 100,
	             //      fieldLabel: '',
	             //      x: 410,
	             //      y: 10,
				 //  	listeners : {
				 //  	       select: function(f,r,i){
				 //  			if (i == 0){
				 //  				Ext.Msg.prompt('New Genre','Name',Ext.emptyFn);
				 //  				}
				 //  			}
				 //  				
				 //  	       
				 //  	}
	             //  },					
	                {
	                    xtype: 'combobox',
	                    width: 165,
	                    fieldLabel: 'æœºæ„é—®é¢˜',
	                    labelWidth: 60,
						name: 'jgwth',
						id: 'wsda_jgwth',
	                    x: 345,
	                    y: 10,
						store: jgwt_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote', 
						valueField:'jgwth',
						displayField:'jgwth',
						triggerAction:'all',
						listeners : {
						       change : function(field,newValue,oldValue){
									getbh();
									new Ajax.Request("/desktop/get_doc_jgwtmc", { 
										   	method: "POST",
									    	parameters: {jgwth:Ext.getCmp('wsda_jgwth').rawValue},
									    	onComplete:	 function(request) {
									    		Ext.getCmp('wsda_jgwtmc').setValue(request.responseText);
									     	}
										});
																		
						       }
						}
	                },
					
					{
	                    xtype: 'textfield',
	                    width: 100,
	                    fieldLabel: '',
	                    labelWidth: 60,
						name: 'jgwtmc',
						id: 'wsda_jgwtmc',
	                    x: 510,
	                    y: 10
	                },
					{
						xtype: 'button',
						x: 610,
	                    y: 10,
						width: 55,
						text:'è®¾ç½®',
						handler: function() {
							//this.up('window').hide();
							//Ext.getCmp('archive_detail_win').close();
							doc_jgwt_setup();
						}
					},
	                {
	                    xtype: 'numberfield',
	                    width: 160,
	                    fieldLabel: 'ä»¶å·',
	                    labelWidth: 60,
						name: 'jh',
						id: 'wsda_jh',
	                    x: 10,
	                    y: 40
	                },
					{
	                    xtype: 'datefield',
						format: 'Y-m-d',
	                    width: 165,
	                    fieldLabel: 'åˆ¶æ–‡æ—¥æœŸ',
	                    labelWidth: 60,
						name: 'zwrq',
						id: 'wsda_zwrq',
	                    x: 175,
	                    y: 40
	                },
					{
	                    xtype: 'numberfield',
	                    width: 165,
	                    fieldLabel: 'é¡µæ•°',
	                    labelWidth: 60,
						name: 'ys',
						id: 'wsda_ys',
	                    x: 345,
	                    y: 40
	                },
					{
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'å¯†çº§',
	                    labelWidth: 60,
						name: 'mj',
						id: 'wsda_mj',
						
						store: mj_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						
	                    x: 520,
	                    y: 40
	                },
					
					{
	                    xtype: 'textfield',
	                    width: 330,
	                    fieldLabel: 'æ–‡ å·',
	                    labelWidth: 60,
						name: 'wh',
						id: 'wsda_wh',
	                    x: 10,
	                    y: 70
	                },
					{
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'è´£ä»»è€…',
	                    labelWidth: 60,
						name: 'zrr',
						id: 'wsda_zrr',
	                    x: 345,
	                    y: 70
	                },
					{
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'é¢˜ å',
						name: 'tm',
						id: 'wsda_tm',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 100
	                },
					{
	                    xtype: 'textfield',
	                    width: 160,
	                    fieldLabel: 'é¦†ç¼–ä»¶å·',
	                    labelWidth: 60,
						name: 'gbjh',
						id: 'wsda_gbjh',
	                    x: 10,
	                    y: 130
	                },
					{
	                    xtype: 'combobox',
	                    width: 160,
	                    fieldLabel: 'ç¨¿æœ¬',
	                    labelWidth: 60,
						name: 'gb',
						id: 'wsda_gb',
						store: gb_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
	                    x: 180,
	                    y: 130
	                },
					{
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'ç›’å·',
	                    labelWidth: 60,
						name: 'hh',
						id: 'wsda_hh',
	                    x: 345,
	                    y: 130
	                },
					{
	                    xtype: 'combobox',
	                    width: 160,
	                    fieldLabel: 'æ–‡ç§',
	                    labelWidth: 60,
						store: wz_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						name: 'wz',
						id: 'wsda_wz',
	                    x: 10,
	                    y: 160
	                },
					{
	                    xtype: 'combobox',
	                    width: 160,
	                    fieldLabel: 'è½½ä½“ç±»å‹',
	                    labelWidth: 60,
						store: ztlx_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						name: 'ztlx',
						id: 'wsda_ztlx',
	                    x: 180,
	                    y: 160
	                },
					{
	                    xtype: 'combobox',
	                    width: 165,
	                    fieldLabel: 'è½½ä½“è§„æ ¼',
	                    labelWidth: 60,
						store: ztgg_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						name: 'ztgg',
						id: 'wsda_ztgg',
	                    x: 345,
	                    y: 160
	                },
					{
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'è½½ä½“å•ä½',
	                    labelWidth: 60,
						store: ztdw_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						name: 'ztdw',
						id: 'wsda_ztdw',
	                    x: 520,
	                    y: 160
	                },
					{
	                    xtype: 'textfield',
	                    width: 160,
	                    fieldLabel: 'åˆ†ç±»å·',
	                    labelWidth: 60,
						name: 'flh',
						id: 'wsda_flh',
	                    x: 10,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    width: 160,
	                    fieldLabel: 'æ¡£æ¡ˆé¦†ä»£å·',
	                    labelWidth: 65,
						name: 'dagdh',
						id: 'wsda_dagdh',
	                    x: 180,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    width: 165,
	                    fieldLabel: 'ç”µå­æ–‡æ¡£å·',
	                    labelWidth: 65,
						name: 'dzwdh',
						id: 'wsda_dzwdh',
	                    x: 345,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'ç¼© å¾® å·',
	                    labelWidth: 60,
						name: 'swh',
						id: 'wsda_swh',
	                    x: 520,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    width: 160,
	                    fieldLabel: 'è½½ä½“æ•°é‡',
						name: 'ztsl',
						id: 'wsda_ztsl',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 220
	                },
	                {
	                    xtype: 'textfield',
	                    width: 160,
	                    fieldLabel: 'å…¨æ–‡æ ‡è¯†',
	                    labelWidth: 60,
						name: 'qwbs',
						id: 'wsda_qwbs',
	                    x: 180,
	                    y: 220
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'ä¸»é¢˜è¯',
	                    labelWidth: 60,
						name: 'ztc',
						id: 'wsda_ztc',
	                    x: 345,
	                    y: 220
	                },
	                {
	                    xtype: 'textfield',
	                    width: 330,
	                    fieldLabel: 'ä¸»åŠéƒ¨é—¨',
						name: 'zbbm',
						id: 'wsda_zbbm',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 250
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'ååŠéƒ¨é—¨',
	                    labelWidth: 60,
						name: 'xbbm',
						id: 'wsda_xbbm',
	                    x: 345,
	                    y: 250
	                },	                
	                {
	                    xtype: 'textfield',
	                    width: 500,
	                    fieldLabel: 'å¤‡ æ³¨',
	                    labelWidth: 60,
						name: 'bz',
						id: 'wsda_bz',
	                    x: 10,
	                    y: 280
	                },
					{
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'ç›®å½•å·',
						hidden:true,
	                    labelWidth: 60,
						name: 'mlh',
						id: 'wsda_mlh',
	                    x: 520,
	                    y: 280
	                },{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'wsda_id',
	                    x: 520,
	                    y: 280
	                },{
		                xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'wsda_qzh',
	                    x: 10,
	                    y: 190
	                },{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'wsda_dalb',
	                    x: 10,
	                    y: 190
	                },{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dh',
						id: 'wsda_dh',
	                    x: 10,
	                    y: 190
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		if(add_new==true){
			Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
			ss=title.split('_');
			Ext.getCmp('wsda_dalb').setValue(ss[1]);			
			Ext.getCmp('wsda_qzh').setValue(ss[0]);
			if (record!=undefined){
				Ext.getCmp('wsda_nd').setValue(record.data.nd);			
				Ext.getCmp('wsda_jgwth').setValue(record.data.jgwth);
				Ext.getCmp('wsda_bgqx').setValue(record.data.bgqx);			
				Ext.getCmp('wsda_zrr').setValue(record.data.zrr);
			}
		}else{
			
				requestdata='';
				new Ajax.Request("/desktop/get_archivebyid", { 
				    	method: "POST",
				    	parameters: {dh:record.data.dh,id:record.data.id,userid:currentUser.id},
				    	onComplete:	 function(request) {
				    		requestdata=eval('(' + request.responseText + ')');						
							Ext.getCmp('daglaj_form').getForm().setValues(requestdata[0]);
							var datazwrq=requestdata[0]['zwrq'].split(" ");
							var dateArr = datazwrq[0].split("-");
							var stateDate = new Date(dateArr[0]-0, dateArr[1]-1, dateArr[2]);
							//var stateDate = new Date(2012,1,12);
							Ext.getCmp('wsda_zwrq').setValue(stateDate);
				     	}
				     });
			}
			//Ext.getCmp('button_aj_add').hidden=true;
		
	
		
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};

var DispAj_wsda = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	function getbh() {
		if (add_new==true){
			if (Ext.getCmp('wsda_bgqx').rawValue=='' || Ext.getCmp('wsda_jgwth').rawValue=='' || Ext.getCmp('wsda_nd').rawValue==''){
				Ext.getCmp('wsda_jh').setValue("0");
			}else{
				new Ajax.Request("/desktop/get_doc_main", { 
					   	method: "POST",
				    	parameters: {qzh:Ext.getCmp('wsda_qzh').rawValue,nd:Ext.getCmp('wsda_nd').rawValue,jgwth:Ext.getCmp('wsda_jgwth').rawValue,bgqx:Ext.getCmp('wsda_bgqx').rawValue},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('wsda_jh').setValue(request.responseText);
				     	}
					});
			};	
		}	
    };
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
	 //  tbar:[
	 //  	{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
	 //  		handler: function() {
	 //  			var grid = Ext.getCmp('archive_grid_wsda');
	 //  			var records = grid.getSelectionModel().getSelection();
	 //  			var record = records[0];
	 //  			DispJr(record,true);
     //
	 //  		}
	 //  	},
	 //  	{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
	 //  		handler: function() {
     //
	 //  			var grid = Ext.getCmp('com_document_grid');
	 //  			var records = grid.getSelectionModel().getSelection();
	 //  			var record = records[0];
     //
	 //  			var pars="id="+record.data.id;
	 //  			Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
	 //  						if(id=="yes"){
	 //  							new Ajax.Request("/desktop/delete_document", { 
	 //  								method: "POST",
	 //  								parameters: pars,
	 //  								onComplete:	 function(request) {
	 //  									Ext.getCmp('com_document_grid').store.load();
     //
	 //  								}
	 //  							});
	 //  						}else{
	 //  							//alert('O,no');
	 //  						}
     //
	 //  				});
     //
	 //  		}},
	 //  	{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
	 //  	handler: function() {
	 //  		var grid  = this.ownerCt.ownerCt;
	 //  		//alert(grid);
	 //  			var store = grid.getStore(); 
	 //  			var records = grid.getSelectionModel().getSelection();
	 //  			var data = [];
	 //  			Ext.Array.each(records,function(model){
	 //  				data.push(Ext.JSON.encode(model.get('id')));
	 //  				DispJr(model,false);
	 //  			});
	 //  		}
	 //  	}
     //
	 //  ],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						DispJr(r,false);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'æ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[
					{
			          text:'è½¬è‡³å‘æ–‡',
					  id:'aj_zzfw',
			          iconCls:'refresh',
			          handler : function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						if(Ext.getCmp('wsda_bgqx').rawValue=='' || Ext.getCmp('wsda_jgwth').rawValue=='' || Ext.getCmp('wsda_nd').rawValue=='' || Ext.getCmp('wsda_jh').rawValue==''){
							alert("æœºæ„é—®é¢˜ï¼Œä¿ç®¡æœŸé™ï¼Œå½’æ¡£å¹´åº¦ï¼Œä»¶å·ä¸èƒ½ä¸ºç©ºã€‚");
						}else{
							if(add_new==false || add_new=='3'){
								new Ajax.Request("/desktop/docmain_fw", { 
									method: "POST",
									parameters: pars,
									onComplete:	 function(request) {
										responseT=request.responseText.split(':');										
										if (responseT[0]=='success'){
											alert("è½¬è‡³å‘æ–‡æˆåŠŸã€‚");
										}else{
											alert("è½¬è‡³å‘æ–‡å¤±è´¥ã€‚"+request.responseText);
										}

									}
								});
							}else{
								alert('è¯·å…ˆä¿å­˜ï¼Œå†è½¬è‡³å‘æ–‡ã€‚');
							}
						}
						
			          }    
			        },
					{
					xtype: 'button',
					iconCls: 'option',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						if(Ext.getCmp('wsda_bgqx').rawValue=='' || Ext.getCmp('wsda_jgwth').rawValue=='' || Ext.getCmp('wsda_nd').rawValue=='' || Ext.getCmp('wsda_jh').rawValue==''){
							alert("æœºæ„é—®é¢˜ï¼Œä¿ç®¡æœŸé™ï¼Œå½’æ¡£å¹´åº¦ï¼Œä»¶å·ä¸èƒ½ä¸ºç©ºã€‚");
						}else{
							if(add_new==false || add_new=='3'){
								new Ajax.Request("/desktop/update_flow", { 
									method: "POST",
									parameters: pars,
									onComplete:	 function(request) {
										responseT=request.responseText.split(':');										
										if (responseT[0]=='success'){
											alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");
											Ext.getCmp('archive_grid_wsda').store.load();
											Ext.getCmp('archive_detail_win').close();												
										}else{
											alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
										}
									
									}
								});
							}else{
								new Ajax.Request("/desktop/insert_archive", { 
									method: "POST",
									parameters: pars,
									onComplete:	 function(request) {
										responseT=request.responseText.split(':');
										if (responseT[0]=='success'){
											alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
											Ext.getCmp('archive_grid_wsda').store.load();
											//Ext.getCmp('archive_tree').store.load();
											Ext.getCmp('archive_detail_win').close();												
										}else{
											alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
										}
									
									}
								});
							}
						}
					}
				},
				{
		          text:'æŸ¥çœ‹å›¾åƒæˆ–é™„ä»¶',
		          iconCls:'',
		          handler : function() {
		          
					if (Ext.getCmp('wsda_dh').value!=undefined){
		              var dh = Ext.getCmp('wsda_dh').value;
		              if(add_new=='4'){
						show_image(dh,record.data.ip,"1");	 
					  }else{
		              	show_image(dh);	  
		              }	              
		              set_image("/assets/dady/fm.jpg");
		            }
		          }    
		        },
				{
					xtype: 'button',
					iconCls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
	                    xtype: 'numberfield',
	                    width: 160,
	                    fieldLabel: 'å¹´ åº¦',
	                    labelWidth: 60,
						name: 'nd',
						id: 'wsda_nd',
	                    x: 10,
	                    y: 10,
						listeners : {
						       change : function(field,newValue,oldValue){
									getbh();									
						       }
						}
	                },
					{
	                    xtype: 'combobox',
	                    width: 165,
	                    fieldLabel: 'ä¿ç®¡æœŸé™',
	                    labelWidth: 60,
						name: 'bgqx',
						id: 'wsda_bgqx',
						name: 'bgqx',
						store: doc_bgqx_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
	                    x: 175,
	                    y: 10,
						listeners : {
						       change : function(field,newValue,oldValue){
									getbh();									
						       }
						}
	                },
				 //  {
	             //      xtype: 'combobox',  //æœºæ„é—®é¢˜å·ä¸‹æ‹‰æ¡†
	             //      width: 100,
	             //      fieldLabel: '',
	             //      x: 410,
	             //      y: 10,
				 //  	listeners : {
				 //  	       select: function(f,r,i){
				 //  			if (i == 0){
				 //  				Ext.Msg.prompt('New Genre','Name',Ext.emptyFn);
				 //  				}
				 //  			}
				 //  				
				 //  	       
				 //  	}
	             //  },					
	                {
	                    xtype: 'combobox',
	                    width: 165,
	                    fieldLabel: 'æœºæ„é—®é¢˜',
	                    labelWidth: 60,
						name: 'jgwth',
						id: 'wsda_jgwth',
	                    x: 345,
	                    y: 10,
						store: jgwt_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote', 
						valueField:'jgwth',
						displayField:'jgwth',
						triggerAction:'all',
						listeners : {
						       change : function(field,newValue,oldValue){
									getbh();
									new Ajax.Request("/desktop/get_doc_jgwtmc", { 
										   	method: "POST",
									    	parameters: {jgwth:Ext.getCmp('wsda_jgwth').rawValue},
									    	onComplete:	 function(request) {
									    		Ext.getCmp('wsda_jgwtmc').setValue(request.responseText);
									     	}
										});
																		
						       }
						}
	                },
					
					{
	                    xtype: 'textfield',
	                    width: 100,
	                    fieldLabel: '',
	                    labelWidth: 60,
						name: 'jgwtmc',
						id: 'wsda_jgwtmc',
	                    x: 510,
	                    y: 10
	                },
					{
						xtype: 'button',
						x: 610,
	                    y: 10,
						width: 55,
						text:'è®¾ç½®',
						handler: function() {
							//this.up('window').hide();
							//Ext.getCmp('archive_detail_win').close();
							doc_jgwt_setup();
						}
					},
	                {
	                    xtype: 'numberfield',
	                    width: 160,
	                    fieldLabel: 'ä»¶å·',
	                    labelWidth: 60,
						name: 'jh',
						id: 'wsda_jh',
	                    x: 10,
	                    y: 40
	                },
					{
	                    xtype: 'datefield',
						format: 'Y-m-d',
	                    width: 165,
	                    fieldLabel: 'åˆ¶æ–‡æ—¥æœŸ',
	                    labelWidth: 60,
						name: 'zwrq',
						id: 'wsda_zwrq',
	                    x: 175,
	                    y: 40
	                },
					{
	                    xtype: 'numberfield',
	                    width: 165,
	                    fieldLabel: 'é¡µæ•°',
	                    labelWidth: 60,
						name: 'ys',
						id: 'wsda_ys',
	                    x: 345,
	                    y: 40
	                },
					{
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'å¯†çº§',
	                    labelWidth: 60,
						name: 'mj',
						id: 'wsda_mj',
						
						store: mj_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						
	                    x: 520,
	                    y: 40
	                },
					
					{
	                    xtype: 'textfield',
	                    width: 330,
	                    fieldLabel: 'æ–‡ å·',
	                    labelWidth: 60,
						name: 'wh',
						id: 'wsda_wh',
	                    x: 10,
	                    y: 70
	                },
					{
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'è´£ä»»è€…',
	                    labelWidth: 60,
						name: 'zrr',
						id: 'wsda_zrr',
	                    x: 345,
	                    y: 70
	                },
					{
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'é¢˜ å',
						name: 'tm',
						id: 'wsda_tm',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 100
	                },
					{
	                    xtype: 'textfield',
	                    width: 160,
	                    fieldLabel: 'é¦†ç¼–ä»¶å·',
	                    labelWidth: 60,
						name: 'gbjh',
						id: 'wsda_gbjh',
	                    x: 10,
	                    y: 130
	                },
					{
	                    xtype: 'combobox',
	                    width: 160,
	                    fieldLabel: 'ç¨¿æœ¬',
	                    labelWidth: 60,
						name: 'gb',
						id: 'wsda_gb',
						store: gb_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
	                    x: 180,
	                    y: 130
	                },
					{
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'ç›’å·',
	                    labelWidth: 60,
						name: 'hh',
						id: 'wsda_hh',
	                    x: 345,
	                    y: 130
	                },
					{
	                    xtype: 'combobox',
	                    width: 160,
	                    fieldLabel: 'æ–‡ç§',
	                    labelWidth: 60,
						store: wz_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						name: 'wz',
						id: 'wsda_wz',
	                    x: 10,
	                    y: 160
	                },
					{
	                    xtype: 'combobox',
	                    width: 160,
	                    fieldLabel: 'è½½ä½“ç±»å‹',
	                    labelWidth: 60,
						store: ztlx_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						name: 'ztlx',
						id: 'wsda_ztlx',
	                    x: 180,
	                    y: 160
	                },
					{
	                    xtype: 'combobox',
	                    width: 165,
	                    fieldLabel: 'è½½ä½“è§„æ ¼',
	                    labelWidth: 60,
						store: ztgg_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						name: 'ztgg',
						id: 'wsda_ztgg',
	                    x: 345,
	                    y: 160
	                },
					{
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'è½½ä½“å•ä½',
	                    labelWidth: 60,
						store: ztdw_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						name: 'ztdw',
						id: 'wsda_ztdw',
	                    x: 520,
	                    y: 160
	                },
					{
	                    xtype: 'textfield',
	                    width: 160,
	                    fieldLabel: 'åˆ†ç±»å·',
	                    labelWidth: 60,
						name: 'flh',
						id: 'wsda_flh',
	                    x: 10,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    width: 160,
	                    fieldLabel: 'æ¡£æ¡ˆé¦†ä»£å·',
	                    labelWidth: 65,
						name: 'dagdh',
						id: 'wsda_dagdh',
	                    x: 180,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    width: 165,
	                    fieldLabel: 'ç”µå­æ–‡æ¡£å·',
	                    labelWidth: 65,
						name: 'dzwdh',
						id: 'wsda_dzwdh',
	                    x: 345,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'ç¼© å¾® å·',
	                    labelWidth: 60,
						name: 'swh',
						id: 'wsda_swh',
	                    x: 520,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    width: 160,
	                    fieldLabel: 'è½½ä½“æ•°é‡',
						name: 'ztsl',
						id: 'wsda_ztsl',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 220
	                },
	                {
	                    xtype: 'textfield',
	                    width: 160,
	                    fieldLabel: 'å…¨æ–‡æ ‡è¯†',
	                    labelWidth: 60,
						name: 'qwbs',
						id: 'wsda_qwbs',
	                    x: 180,
	                    y: 220
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'ä¸»é¢˜è¯',
	                    labelWidth: 60,
						name: 'ztc',
						id: 'wsda_ztc',
	                    x: 345,
	                    y: 220
	                },
	                {
	                    xtype: 'textfield',
	                    width: 330,
	                    fieldLabel: 'ä¸»åŠéƒ¨é—¨',
						name: 'zbbm',
						id: 'wsda_zbbm',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 250
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'ååŠéƒ¨é—¨',
	                    labelWidth: 60,
						name: 'xbbm',
						id: 'wsda_xbbm',
	                    x: 345,
	                    y: 250
	                },	                
	                {
	                    xtype: 'textfield',
	                    width: 500,
	                    fieldLabel: 'å¤‡ æ³¨',
	                    labelWidth: 60,
						name: 'bz',
						id: 'wsda_bz',
	                    x: 10,
	                    y: 280
	                },
					{
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'ç›®å½•å·',
						hidden:true,
	                    labelWidth: 60,
						name: 'mlh',
						id: 'wsda_mlh',
	                    x: 520,
	                    y: 280
	                },{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'wsda_id',
	                    x: 520,
	                    y: 280
	                },{
		                xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'wsda_qzh',
	                    x: 10,
	                    y: 190
	                },{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'wsda_dalb',
	                    x: 10,
	                    y: 190
	                },{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dh',
						id: 'wsda_dh',
	                    x: 10,
	                    y: 190
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		if(add_new==true){
			Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
			ss=title.split('_');
			Ext.getCmp('wsda_dalb').setValue(ss[1]);			
			Ext.getCmp('wsda_qzh').setValue(ss[0]);
			if (record!=undefined){
				Ext.getCmp('wsda_nd').setValue(record.data.nd);			
				Ext.getCmp('wsda_jgwth').setValue(record.data.jgwth);
				Ext.getCmp('wsda_bgqx').setValue(record.data.bgqx);			
				Ext.getCmp('wsda_zrr').setValue(record.data.zrr);
			}
		}else{
			if(add_new=='4'){
				Ext.getCmp('button_aj_add').setVisible(false);
				Ext.getCmp('aj_zzfw').setVisible(false);
				
				new Ajax.Request("/desktop/yun_get_archivebyid", { 
 
				    	method: "POST",
				    	parameters: {ip:record.data.ip,dh:record.data.dh,id:record.data.daid,userid:currentUser.id},
				    	onComplete:	 function(request) {
				    		requestdata=eval('(' + request.responseText + ')');						
							Ext.getCmp('daglaj_form').getForm().setValues(requestdata[0]);
							com_document_store.proxy.url="/desktop/yun_get_documentbyajid"
							com_document_store.proxy.extraParams={ip:record.data.ip,dh:record.data.dh,id:record.data.daid,userid:currentUser.id}
							com_document_store.load();
				     	}
				});
							
			}else{
				requestdata='';
				new Ajax.Request("/desktop/get_archivebyid", { 
				    	method: "POST",
				    	parameters: {dh:record.data.dh,id:record.data.id,userid:currentUser.id},
				    	onComplete:	 function(request) {
				    		requestdata=eval('(' + request.responseText + ')');						
							Ext.getCmp('daglaj_form').getForm().setValues(requestdata[0]);
							var datazwrq=requestdata[0]['zwrq'].split(" ");
							var dateArr = datazwrq[0].split("-");
							var stateDate = new Date(dateArr[0]-0, dateArr[1]-1, dateArr[2]);
							//var stateDate = new Date(2012,1,12);
							Ext.getCmp('wsda_zwrq').setValue(stateDate);
				     	}
				     });
			}
			//Ext.getCmp('button_aj_add').hidden=true;
		}
	
		
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};

var DispAj_swdj = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	function getbh() {
		if (add_new==true){
			if (Ext.getCmp('wsda_bgqx').rawValue=='' || Ext.getCmp('jgwth').rawValue=='' || Ext.getCmp('zdnd').rawValue==''){
				Ext.getCmp('swbh').setValue("0");
			}else{
				new Ajax.Request("/desktop/get_swbh", { 
					   	method: "POST",
				    	parameters: {qzh:Ext.getCmp('wsda_qzh').rawValue,zdnd:Ext.getCmp('zdnd').rawValue,jgwt:Ext.getCmp('jgwth').rawValue,bgqx:Ext.getCmp('wsda_bgqx').rawValue},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('swbh').setValue(request.responseText);
				     	}
					});
			};	
		}	
    };
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'æ”¶æ–‡ç™»è®°è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[
					{
						xtype: 'button',
						//cls: 'exit',
						text:'å½’æ¡£',
						handler: function() {
							//this.up('window').hide();
							if(add_new==false){
								if (Ext.getCmp('sfygd').rawValue=='æ˜¯'){
									alert("æ­¤å·å·²å½’è¿‡æ¡£ã€‚");
								}else{
									if(Ext.getCmp('wsda_bgqx').rawValue=='' || Ext.getCmp('jgwth').rawValue=='' || Ext.getCmp('zdnd').rawValue=='' || Ext.getCmp('swrq').rawValue==''){
										alert("æœºæ„é—®é¢˜ï¼Œä¿ç®¡æœŸé™ï¼Œå½’æ¡£å¹´åº¦ï¼Œåˆ¶æ–‡æ—¥æœŸä¸èƒ½ä¸ºç©ºã€‚");
									}else{
										var pars=Ext.getCmp('daglaj_form').getForm().getValues();
										save_sql=pars['zdnd']+'@'+pars['jgwt']+'@'+pars['bgqx']+'@'+pars['wh']+'@'+pars['zrz']+'@'+pars['tm']+'@'+pars['swrq']+'@'+pars['ys']+'@æ”¶æ–‡@'+pars['bz']+'@'+pars['id']+'@'											
										if(save_sql!=''){
											new Ajax.Request("/desktop/doc_gd", { 
												method: "POST",
												parameters: {qzh:Ext.getCmp('wsda_qzh').rawValue,save_sql:save_sql},
												onComplete:	 function(request) {
													fhz=request.responseText.split(":");
													if (fhz[0]=='success'){
														alert("å½’æ¡£æˆåŠŸã€‚");	
														Ext.getCmp('archive_grid_wsda').store.load();
														Ext.getCmp('archive_detail_win').close();										
													}else{
														if (fhz[0]=='false')
														{
															alert(fhz[1]);
														}else
														{
															alert("å½’æ¡£å¤±è´¥ï¼Œè¯·é‡æ–°å½’æ¡£ã€‚"+request.responseText);
														}
													}
												}
											});
										}										
									}
								}
							}else{
								alert("è¯·å…ˆä¿å­˜åå†å½’æ¡£ã€‚");
							}
						}
					},{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						if(Ext.getCmp('wsda_bgqx').rawValue=='' || Ext.getCmp('jgwth').rawValue=='' || Ext.getCmp('zdnd').rawValue=='' || Ext.getCmp('swbh').rawValue==''){
							alert("æœºæ„é—®é¢˜ï¼Œä¿ç®¡æœŸé™ï¼Œå½’æ¡£å¹´åº¦ï¼Œæ”¶æ–‡ç¼–å·ä¸èƒ½ä¸ºç©ºã€‚");
						}else{
							if(add_new==false){
								new Ajax.Request("/desktop/update_doc_swdj", { 
									method: "POST",
									parameters: pars,
									onComplete:	 function(request) {
										if (request.responseText=='success'){
											alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");
											Ext.getCmp('archive_grid_wsda').store.load();
											Ext.getCmp('archive_detail_win').close();												
										}else{
											alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
										}									
									}
								});
							}else{
								new Ajax.Request("/desktop/insert_doc_swdj", { 
									method: "POST",
									parameters: pars,
									onComplete:	 function(request) {
										responseT=request.responseText.split(':');
										if (responseT[0]=='success'){
											alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
											Ext.getCmp('button_aj_add').setText('ä¿®æ”¹ä¿å­˜');
											Ext.getCmp('wsda_id').setValue(responseT[1]);
											Ext.getCmp('sfygd').setValue('å¦');											
											add_new=false;
											//Ext.getCmp('archive_grid_wsda').store.load();
											//Ext.getCmp('archive_tree').store.load();
											//Ext.getCmp('archive_detail_win').close();												
										}else{
											alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
										}
										
									}
								});
							}
						}
					}
				},
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						Ext.getCmp('archive_grid_wsda').store.load();
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'sfygd',
						id: 'sfygd',
	                    x: 10,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'wsda_id',
	                    x: 10,
	                    y: 190
	                },{
		                xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'wsda_qzh',
	                    x: 10,
	                    y: 190
	                },
				    {
	                    xtype: 'datefield',
						format: 'Y-m-d',				                    
	                    width: 200,
						id:'swrq',
	                    fieldLabel: 'æ”¶æ–‡æ—¥æœŸ',
	                    labelWidth: 60,
						name: 'swrq',
	                    x: 10,
	                    y: 10
	                },
	                {
	                    xtype: 'combobox',
	                    width: 200,
	                    fieldLabel: 'ä¿ç®¡æœŸé™',
						labelWidth: 60,
						name: 'bgqx',	                    
						id: 'wsda_bgqx',
						store: doc_bgqx_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
	                    x: 230,
	                    y: 10,
						listeners : {
						       change : function(field,newValue,oldValue){
									getbh();									
						       }
						}
	                },
	                {
	                    xtype: 'numberfield',
	                    width: 200,
	                    fieldLabel: 'æ”¶æ–‡ç¼–å·',
						name: 'swbh',
						id:'swbh',
	                    labelWidth: 60,
	                    x: 460,
	                    y: 10
	                },
	                {
	                    xtype: 'combobox',
	                    width: 200,
	                    fieldLabel: 'æœºæ„é—®é¢˜',
						name: 'jgwt',
						id:'jgwth',
						store: jgwt_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote', 
						valueField:'jgwth',
						displayField:'jgwth',
						triggerAction:'all',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 40,
						listeners : {
						       change : function(field,newValue,oldValue){
									getbh();
									new Ajax.Request("/desktop/get_doc_jgwtmc", { 
										   	method: "POST",
									    	parameters: {jgwth:Ext.getCmp('jgwth').rawValue},
									    	onComplete:	 function(request) {
									    		Ext.getCmp('jgwt_name').setValue(request.responseText);
									     	}
										});									
						       }
						}
	                },
	                {
	                    xtype: 'textfield',
	                    width: 220,
	                    fieldLabel: '',
						id:'jgwt_name',
	                    x: 210,
	                    y: 40
	                },
	                {
	                    xtype: 'numberfield',
	                    width: 200,
	                    fieldLabel: 'å½’æ¡£å¹´åº¦',
						id:"zdnd",
						name: 'zdnd',
	                    labelWidth: 60,
	                    x: 460,
	                    y: 40,
						listeners : {
						       change : function(field,newValue,oldValue){
									getbh();									
						       }
						}
	                },
	                {
	                    xtype: 'textfield',
	                    width: 420,
	                    fieldLabel: 'æ–‡å·',
						id:'sw_wh',
						name: 'wh',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 100
	                },
	                {
	                    xtype: 'textfield',
	                    width: 420,
	                    fieldLabel: 'æ¥æ–‡æœºå…³',
						name: 'lwjg',
						id:'lwjg',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 70
	                },
	                {
	                    xtype: 'textfield',
	                    width: 200,
	                    fieldLabel: 'è½¬å¾€å•ä½',
						name: 'zwdw',
	                    labelWidth: 60,
	                    x: 230,
	                    y: 160
	                },
	                {
	                    xtype: 'textfield',
	                    width: 430,
	                    fieldLabel: 'è´£ä»»è€…',
						name: 'zrz',
						id:'zrz',
	                    labelWidth: 60,
	                    x: 230,
	                    y: 130
	                },
	                {
	                    xtype: 'textareafield',
	                    height: 60,
	                    width: 650,
	                    fieldLabel: 'é¢˜    å',
						id:'sw_tm',
						name: 'tm',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    width: 420,
	                    fieldLabel: 'åŠç†æƒ…å†µ',
						name: 'blqk',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 260
	                },
	                {
	                    xtype: 'textfield',
	                    width: 200,
	                    fieldLabel: 'æ”¶è€…ç­¾å',
						name: 'szqm',
						id:'szqm',
	                    labelWidth: 60,
	                    x: 460,
	                    y: 260
	                },
	                {
	                    xtype: 'numberfield',
	                    width: 200,
	                    fieldLabel: 'ä»½æ•°',
						name: 'fs',
	                    labelWidth: 60,
	                    x: 460,
	                    y: 70
	                },
	                {
	                    xtype: 'numberfield',
	                    width: 200,
	                    fieldLabel: 'é¡µæ•°',
						name: 'ys',
	                    labelWidth: 60,
	                    x: 460,
	                    y: 100
	                },
	                {
	                    xtype: 'combobox',
	                    width: 200,
	                    fieldLabel: 'å¯†çº§',
						name: 'mj',
						id: 'wsda_mj',						
						store: mj_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 160
	                },
	                {
	                    xtype: 'datefield',
						format: 'Y-m-d',
	                    width: 200,
	                    fieldLabel: 'åˆ¶æ–‡æ—¥æœŸ',
						name: 'zwrq',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 130
	                },
	                {
	                    xtype: 'textfield',
	                    width: 650,
	                    fieldLabel: 'å¤‡æ³¨',
						name: 'bz',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 320
	                },
	                {
	                    xtype: 'numberfield',
	                    width: 200,
	                    fieldLabel: 'è½¬å‡ºä»½æ•°',
						name: 'zcfs',
	                    labelWidth: 60,
	                    x: 460,
	                    y: 160
	                },
	                {
	                    xtype: 'numberfield',
	                    width: 200,
	                    fieldLabel: 'æ¸…é€€ä»½æ•°',
						name: 'qtfs',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 290
	                },
	                {
	                    xtype: 'numberfield',
	                    width: 200,
	                    fieldLabel: 'é”€æ¯ä»½æ•°',
						name: 'xhfs',
	                    labelWidth: 60,
	                    x: 230,
	                    y: 290
	                },
	                {
	                    xtype: 'datefield',
	                    width: 200,
	                    fieldLabel: 'å°å‘æ—¥æœŸ',
						format: 'Y-m-d',
						name: 'yfrq',
	                    labelWidth: 60,
	                    x: 460,
	                    y: 290
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);		
	}else{		
		Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
		ss=title.split('_');
			//Ext.getCmp('wsda_dalb').setValue(ss[1]);			
		Ext.getCmp('wsda_qzh').setValue(ss[0]);	
		if (record!=undefined){
			Ext.getCmp('zdnd').setValue(record.data.zdnd);			
			Ext.getCmp('jgwth').setValue(record.data.jgwt);
			Ext.getCmp('wsda_bgqx').setValue(record.data.bgqx);			
			Ext.getCmp('zrz').setValue(record.data.zrz);
			Ext.getCmp('szqm').setValue(record.data.szqm);
			Ext.getCmp('lwjg').setValue(record.data.lwjg);
			Ext.getCmp('sw_wh').setValue(record.data.wh);
			Ext.getCmp('sw_tm').setValue(record.data.tm);
		}
	}
	win.show();
};

var DispAj_fwdj = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	function getbh() {
		if (add_new==true){
			if (Ext.getCmp('wsda_bgqx').rawValue=='' || Ext.getCmp('jgwth').rawValue=='' || Ext.getCmp('zdnd').rawValue==''){
				Ext.getCmp('fwbh').setValue("0");
			}else{
				new Ajax.Request("/desktop/get_fwbh", { 
					   	method: "POST",
				    	parameters: {qzh:Ext.getCmp('wsda_qzh').rawValue,zdnd:Ext.getCmp('zdnd').rawValue,jgwt:Ext.getCmp('jgwth').rawValue,bgqx:Ext.getCmp('wsda_bgqx').rawValue},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('fwbh').setValue(request.responseText);
				     	}
					});
			};	
		}	
    };
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'å‘æ–‡ç™»è®°è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[
					{
						xtype: 'button',
						//cls: 'exit',
						text:'å½’æ¡£',
						handler: function() {
							//this.up('window').hide();
							if(add_new==false){
								if (Ext.getCmp('sfygd').rawValue=='æ˜¯'){
									alert("æ­¤å·å·²å½’è¿‡æ¡£ã€‚");
								}else{
									if(Ext.getCmp('wsda_bgqx').rawValue=='' || Ext.getCmp('jgwth').rawValue=='' || Ext.getCmp('zdnd').rawValue=='' || Ext.getCmp('fwrq').rawValue==''){
										alert("æœºæ„é—®é¢˜ï¼Œä¿ç®¡æœŸé™ï¼Œå½’æ¡£å¹´åº¦ï¼Œåˆ¶æ–‡æ—¥æœŸä¸èƒ½ä¸ºç©ºã€‚");
									}else{
										var pars=Ext.getCmp('daglaj_form').getForm().getValues();
										save_sql=pars['zdnd']+'@'+pars['jgwt']+'@'+pars['bgqx']+'@'+pars['wh']+'@'+pars['zrz']+'@'+pars['tm']+'@'+pars['fwrq']+'@'+pars['ys']+'@å‘æ–‡@'+pars['bz']+'@'+pars['id']+'@'											
										if(save_sql!=''){
											new Ajax.Request("/desktop/doc_gd", { 
												method: "POST",
												parameters: {qzh:Ext.getCmp('wsda_qzh').rawValue,save_sql:save_sql},
												onComplete:	 function(request) {
													fhz=request.responseText.split(":");
													if (fhz[0]=='success'){
														alert("å½’æ¡£æˆåŠŸã€‚");	
														Ext.getCmp('archive_grid_wsda').store.load();
														Ext.getCmp('archive_detail_win').close();										
													}else{
														if (fhz[0]=='false')
														{
															alert(fhz[1]);
														}else
														{
															alert("å½’æ¡£å¤±è´¥ï¼Œè¯·é‡æ–°å½’æ¡£ã€‚"+request.responseText);
														}
													}
												}
											});
										}										
									}
								}
							}else{
								alert("è¯·å…ˆä¿å­˜åå†å½’æ¡£ã€‚");
							}
						}
					},{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						if(Ext.getCmp('wsda_bgqx').rawValue=='' || Ext.getCmp('jgwth').rawValue=='' || Ext.getCmp('zdnd').rawValue=='' || Ext.getCmp('fwbh').rawValue==''){
							alert("æœºæ„é—®é¢˜ï¼Œä¿ç®¡æœŸé™ï¼Œå½’æ¡£å¹´åº¦ï¼Œå‘æ–‡ç¼–å·ä¸èƒ½ä¸ºç©ºã€‚");
						}else{
							if(add_new==false){
								new Ajax.Request("/desktop/update_doc_fwdj", { 
									method: "POST",
									parameters: pars,
									onComplete:	 function(request) {
										if (request.responseText=='success'){
											alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");
											Ext.getCmp('archive_grid_wsda').store.load();
											Ext.getCmp('archive_detail_win').close();												
										}else{
											alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
										}									
									}
								});
							}else{
								new Ajax.Request("/desktop/insert_doc_fwdj", { 
									method: "POST",
									parameters: pars,
									onComplete:	 function(request) {
										responseT=request.responseText.split(':');
										if (responseT[0]=='success'){
											alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
											Ext.getCmp('button_aj_add').setText('ä¿®æ”¹ä¿å­˜');
											Ext.getCmp('wsda_id').setValue(responseT[1]);
											Ext.getCmp('sfygd').setValue('å¦');											
											add_new=false;
											//Ext.getCmp('archive_grid_wsda').store.load();
											//Ext.getCmp('archive_tree').store.load();
											//Ext.getCmp('archive_detail_win').close();												
										}else{
											alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
										}
									
									}
								});
							}
						}
					}
				},
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						Ext.getCmp('archive_grid_wsda').store.load();
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'sfygd',
						id: 'sfygd',
	                    x: 10,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'wsda_id',
	                    x: 10,
	                    y: 190
	                },{
		                xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'wsda_qzh',
	                    x: 10,
	                    y: 190
	                },
				    {
	                    xtype: 'datefield',
	                    width: 200,
						format: 'Y-m-d',
						name:'fwrq',
						id:'fwrq',
	                    fieldLabel: 'å‘æ–‡æ—¥æœŸ',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 10
	                },
	                {
	                    xtype: 'combobox',
	                    width: 200,
	                    fieldLabel: 'ä¿ç®¡æœŸé™',
	                    labelWidth: 60,
	                    x: 230,
	                    y: 10,
						name: 'bgqx',
						id: 'wsda_bgqx',
						store: doc_bgqx_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						listeners : {
						       change : function(field,newValue,oldValue){
									getbh();
																		
						       }
						}
	                },
	                {
	                    xtype: 'numberfield',
	                    width: 200,
	                    fieldLabel: 'å‘æ–‡ç¼–å·',
						name: 'fwbh',
						id: 'fwbh',
	                    labelWidth: 60,
	                    x: 460,
	                    y: 10
	                },
	                {
	                    xtype: 'combobox',
	                    width: 200,
	                    fieldLabel: 'æœºæ„é—®é¢˜',
	                    labelWidth: 60,
						name: 'jgwt',
						store: jgwt_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote', 
						valueField:'jgwth',
						displayField:'jgwth',
						triggerAction:'all',
						id: 'jgwth',
	                    x: 10,
	                    y: 40,
						listeners : {
						       change : function(field,newValue,oldValue){
									getbh();
									new Ajax.Request("/desktop/get_doc_jgwtmc", { 
										   	method: "POST",
									    	parameters: {jgwth:Ext.getCmp('jgwth').rawValue},
									    	onComplete:	 function(request) {
									    		Ext.getCmp('jgwt_name').setValue(request.responseText);
									     	}
										});									
						       }
						}
	                },
	                {
	                    xtype: 'textfield',
	                    width: 220,
						id:'jgwt_name',
	                    fieldLabel: '',
	                    x: 210,
	                    y: 40
	                },
	                {
	                    xtype: 'numberfield',
	                    width: 200,
	                    fieldLabel: 'å½’æ¡£å¹´åº¦',
						name: 'zdnd',
						id: 'zdnd',
	                    labelWidth: 60,
	                    x: 460,
	                    y: 40,
						listeners : {
						       change : function(field,newValue,oldValue){
									getbh();									
						       }
						}
	                },
	                {
	                    xtype: 'textfield',
	                    width: 650,
	                    fieldLabel: 'æ–‡    å·',
						name: 'wh',
						id: 'wh',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 70
	                },
	                {
	                    xtype: 'textfield',
	                    width: 200,
	                    fieldLabel: 'è´£ ä»» è€…',
						name: 'zrz',
						id: 'zrz',						
	                    labelWidth: 60,
	                    x: 10,
	                    y: 100
	                },
	                {
	                    xtype: 'textfield',
	                    width: 200,
	                    fieldLabel: 'ç­¾ å‘ äºº',
						id:'qfr',
						name: 'qfr',
	                    labelWidth: 60,
	                    x: 230,
	                    y: 100
	                },
	                {
	                    xtype: 'textfield',
	                    width: 200,
	                    fieldLabel: 'ä¸»é€å•ä½',
						id:'fwdj_zsdw',
						name: 'zsdw',
	                    labelWidth: 60,
	                    x: 460,
	                    y: 100
	                },
	                {
	                    xtype: 'textfield',
	                    width: 200,
	                    fieldLabel: 'æŠ„æŠ¥å•ä½',
						id:'fwdj_cbdw',
						name: 'cbdw',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 130
	                },
	                {
	                    xtype: 'textfield',
	                    width: 200,
	                    fieldLabel: 'æŠ„é€å•ä½',
						id:'fwdj_csdw',
						name: 'csdw',
	                    labelWidth: 60,
	                    x: 230,
	                    y: 130
	                },
	                {
	                    xtype: 'textfield',
	                    width: 200,
	                    fieldLabel: 'ä¸‹å‘å•ä½',
						id:'fwdj_xfdw',
						name: 'xfdw',
	                    labelWidth: 60,
	                    x: 460,
	                    y: 130
	                },
	                {
	                    xtype: 'textareafield',
	                    height: 60,
	                    width: 650,
	                    fieldLabel: 'é¢˜    å',
						id:'fw_tm',
						name: 'tm',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 160
	                },
	                {
	                    xtype: 'textfield',
	                    width: 200,
	                    fieldLabel: 'ä¸»é¢˜è¯1',
						name: 'ztc1',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 230
	                },
	                {
	                    xtype: 'textfield',
	                    width: 200,
	                    fieldLabel: 'ä¸»é¢˜è¯2',
						name: 'ztc2',
	                    labelWidth: 60,
	                    x: 230,
	                    y: 230
	                },
	                {
	                    xtype: 'textfield',
	                    width: 200,
	                    fieldLabel: 'ä¸»é¢˜è¯3',
						name: 'ztc3',
	                    labelWidth: 60,
	                    x: 460,
	                    y: 230
	                },
	                {
	                    xtype: 'numberfield',
	                    width: 200,
	                    fieldLabel: 'æ‰“å°ä»½æ•°',
						name: 'dyfs',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 260
	                },
	                {
	                    xtype: 'numberfield',
	                    width: 200,
	                    fieldLabel: 'é¡µæ•°',
						name: 'ys',
	                    labelWidth: 60,
	                    x: 230,
	                    y: 260
	                },
	                {
	                    xtype: 'combobox',
	                    width: 200,
	                    fieldLabel: 'å¯†çº§',
	                    labelWidth: 60,
	                    x: 460,
	                    y: 260,
						name: 'mj',
						id: 'wsda_mj',						
						store: mj_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all'
	                },
	                {
	                    xtype: 'datefield',
	                    width: 200,
	                    fieldLabel: 'åˆ¶æ–‡æ—¥æœŸ',
						name: 'zwrq',
						format: 'Y-m-d',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 290
	                },
	                {
	                    xtype: 'textfield',
	                    width: 430,
	                    fieldLabel: 'å¤‡æ³¨',
						name: 'bz',
	                    labelWidth: 60,
	                    x: 230,
	                    y: 290
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);		
	}else{		
		Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
		ss=title.split('_');
			//Ext.getCmp('wsda_dalb').setValue(ss[1]);			
		Ext.getCmp('wsda_qzh').setValue(ss[0]);	
		if (record!=undefined){
			Ext.getCmp('zdnd').setValue(record.data.zdnd);			
			Ext.getCmp('jgwth').setValue(record.data.jgwt);
			Ext.getCmp('wsda_bgqx').setValue(record.data.bgqx);			
			Ext.getCmp('zrz').setValue(record.data.zrz);
			Ext.getCmp('qfr').setValue(record.data.qfr);
			Ext.getCmp('wh').setValue(record.data.wh);
			Ext.getCmp('fw_tm').setValue(record.data.tm);
			
			Ext.getCmp('fwdj_xfdw').setValue(record.data.sfdw);
			Ext.getCmp('fwdj_zsdw').setValue(record.data.zsdw);
			Ext.getCmp('fwdj_cbdw').setValue(record.data.cbdw);
			Ext.getCmp('fwdj_csdw').setValue(record.data.csdw);

		}
	}
	win.show();
};

var DispAj_lbzl = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	function getbh() {
		if (add_new==true){
			if (Ext.getCmp('wsda_bgqx').rawValue=='' || Ext.getCmp('jgwth').rawValue=='' || Ext.getCmp('zdnd').rawValue==''){
				Ext.getCmp('wjbh').setValue("0");
			}else{
				new Ajax.Request("/desktop/get_lbzl", { 
					   	method: "POST",
				    	parameters: {qzh:Ext.getCmp('wsda_qzh').rawValue,zdnd:Ext.getCmp('zdnd').rawValue,jgwt:Ext.getCmp('jgwth').rawValue,bgqx:Ext.getCmp('wsda_bgqx').rawValue},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('wjbh').setValue(request.responseText);
				     	}
					});
			};	
		}	
    };
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'å†…éƒ¨èµ„æ–™è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						if(Ext.getCmp('wsda_bgqx').rawValue=='' || Ext.getCmp('jgwth').rawValue=='' || Ext.getCmp('zdnd').rawValue=='' || Ext.getCmp('wjbh').rawValue==''){
							alert("æœºæ„é—®é¢˜ï¼Œä¿ç®¡æœŸé™ï¼Œå½’æ¡£å¹´åº¦ï¼Œæ–‡ä»¶ç¼–å·ä¸èƒ½ä¸ºç©ºã€‚");
						}else{
							if(add_new==false){
								new Ajax.Request("/desktop/update_doc_lbzl", { 
									method: "POST",
									parameters: pars,
									onComplete:	 function(request) {
										if (request.responseText=='success'){
											alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");
											Ext.getCmp('archive_grid_wsda').store.load();
											Ext.getCmp('archive_detail_win').close();												
										}else{
											alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
										}									
									}
								});
							}else{
								new Ajax.Request("/desktop/insert_doc_lbzl", { 
									method: "POST",
									parameters: pars,
									onComplete:	 function(request) {
										responseT=request.responseText.split(':');
										if (responseT[0]=='success'){
											alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
											Ext.getCmp('archive_grid_wsda').store.load();
											//Ext.getCmp('archive_tree').store.load();
											Ext.getCmp('archive_detail_win').close();												
										}else{
											alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
										}
									
									}
								});
							}
						}
					}
				},
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'wsda_id',
	                    x: 10,
	                    y: 190
	                },{
		                xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'wsda_qzh',
	                    x: 10,
	                    y: 190
	                },
				    {
					    xtype: 'datefield',	                 
	                    width: 200,
	                    fieldLabel: 'æ—¥æœŸ',
						name: 'rq',
						id: 'rq',
						format: 'Y-m-d',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 10
	                },
	                {
	                    xtype: 'combobox',
	                    width: 200,
	                    fieldLabel: 'ä¿ç®¡æœŸé™',
	                    labelWidth: 60,
						id: 'wsda_bgqx',
						name:'bgqx',
						store: doc_bgqx_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
	                    x: 230,
	                    y: 10,
						listeners : {
						       change : function(field,newValue,oldValue){
									getbh();									
						       }
						}	                    
	                },
	                {
	                    xtype: 'numberfield',
	                    width: 200,
	                    fieldLabel: 'æ–‡ä»¶ç¼–å·',
						name: 'wjbh',
						id: 'wjbh',
	                    labelWidth: 60,
	                    x: 460,
	                    y: 10
	                },
	                {
	                    xtype: 'combobox',
	                    width: 200,
	                    fieldLabel: 'æœºæ„é—®é¢˜',
						name: 'jgwt',
						id: 'jgwth',
	                    labelWidth: 60,
						store: jgwt_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote', 
						valueField:'jgwth',
						displayField:'jgwth',
						triggerAction:'all',
	                    x: 10,
	                    y: 100,
						listeners : {
						       change : function(field,newValue,oldValue){
									getbh();	
									new Ajax.Request("/desktop/get_doc_jgwtmc", { 
										   	method: "POST",
									    	parameters: {jgwth:Ext.getCmp('jgwth').rawValue},
									    	onComplete:	 function(request) {
									    		Ext.getCmp('jgwt_name').setValue(request.responseText);
									     	}
										});								
						       }
						}
	                },
	                {
	                    xtype: 'textfield',
	                    width: 220,
						id:'jgwt_name',
	                    fieldLabel: '',
	                    x: 210,
	                    y: 100
	                },
	                {
	                    xtype: 'numberfield',
	                    width: 200,
	                    fieldLabel: 'å½’æ¡£å¹´åº¦',
						name: 'zdnd',
						id: 'zdnd',
	                    labelWidth: 60,
	                    x: 460,
	                    y: 40,
						listeners : {
						       change : function(field,newValue,oldValue){
									getbh();									
						       }
						}
	                },
	                {
	                    xtype: 'textfield',
	                    width: 420,
	                    fieldLabel: 'æ–‡    å·',
						name: 'wh',
						id: 'wh',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 40
	                },
	                {
	                    xtype: 'textfield',
	                    width: 650,
	                    fieldLabel: 'è´£ ä»» è€…',
						name: 'zrz',
						id: 'zrz',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 70
	                },
	                {
	                    xtype: 'textareafield',
	                    height: 60,
	                    width: 650,
	                    fieldLabel: 'é¢˜    å',
						name: 'tm',
						id: 'tm',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 130
	                },
	                {
	                    xtype: 'numberfield',
	                    width: 200,
	                    fieldLabel: 'é¡µæ•°',
						name: 'ys',
						id: 'ys',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 200
	                },
	                {
	                    xtype: 'combobox',
	                    width: 200,
	                    fieldLabel: 'å¯†çº§',
	                    labelWidth: 60,
						name: 'mj',
						id: 'wsda_mj',						
						store: mj_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
	                    x: 230,
	                    y: 200
	                },
	                {
	                    xtype: 'datefield',
	                    width: 200,
	                    fieldLabel: 'åˆ¶æ–‡æ—¥æœŸ',
						name: 'zwrq',
						id: 'zwrq',
						format: 'Y-m-d',
	                    labelWidth: 60,
	                    x: 460,
	                    y: 100
	                },
	                {
	                    xtype: 'textfield',
	                    width: 650,
	                    fieldLabel: 'å¤‡æ³¨',
	                    labelWidth: 60,
						name: 'bz',
						id: 'bz',
	                    x: 10,
	                    y: 230
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);		
	}else{		
		Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
		ss=title.split('_');
			//Ext.getCmp('wsda_dalb').setValue(ss[1]);			
		Ext.getCmp('wsda_qzh').setValue(ss[0]);	
	}
	win.show();
};

var doc_dagl = function(title){
	var win = Ext.getCmp('doc_dagl_win');
	function formatDate(value){
        return value ? Ext.Date.dateFormat(value, 'M d, Y') : '';
    };
	var com_zrz=[];
	var com_wh=[];
	
    function doSort() {
        doc_dagl_store.sort(getSorters());
    }

    /**
     * Callback handler used when a sorter button is clicked or reordered
     * @param {Ext.Button} button The button that was clicked
     * @param {Boolean} changeDirection True to change direction (default). Set to false for reorder
     * operations as we wish to preserve ordering there
     */
    function changeSortDirection(button, changeDirection) {
        var sortData = button.sortData,
            iconCls  = button.iconCls;
        
        if (sortData) {
            if (changeDirection !== false) {
                button.sortData.direction = Ext.String.toggle(button.sortData.direction, "ASC", "DESC");
                button.setIconCls(Ext.String.toggle(iconCls, "sort-asc", "sort-desc"));
            }
            doc_dagl_store.clearFilter();
            doSort();
        }
    }

    /**
     * Returns an array of sortData from the sorter buttons
     * @return {Array} Ordered sort data from each of the sorter buttons
     */
    function getSorters() {
        var sorters = [];
 
        Ext.each(tbar.query('button'), function(button) {
            sorters.push(button.sortData);
        }, this);

        return sorters;
    }

    /**
     * Convenience function for creating Toolbar Buttons that are tied to sorters
     * @param {Object} config Optional config object
     * @return {Object} The new Button configuration
     */
    function createSorterButtonConfig(config) {
        config = config || {};
        Ext.applyIf(config, {
            listeners: {
                click: function(button, e) {
                    changeSortDirection(button, true);
                }
            },
            iconCls: 'sort-' + config.sortData.direction.toLowerCase(),
            reorderable: true,
            xtype: 'button'
        });
        return config;
    }

 
    

    var reorderer = Ext.create('Ext.ux.BoxReorderer', {
        listeners: {
            scope: this,
            Drop: function(r, c, button) { //update sort direction when button is dropped
                changeSortDirection(button, false);
            }
        }
    });

    var droppable = Ext.create('Ext.ux.ToolbarDroppable', {
        /**
         * Creates the new toolbar item from the drop event
         */
        createItem: function(data) {
            var header = data.header,
                headerCt = header.ownerCt,
                reorderer = headerCt.reorderer;
            
            // Hide the drop indicators of the standard HeaderDropZone
            // in case user had a pending valid drop in 
            if (reorderer) {
                reorderer.dropZone.invalidateDrop();
            }

            return createSorterButtonConfig({
                text: header.text,
                sortData: {
                    property: header.dataIndex,
                    direction: "ASC"
                }
            });
        },

        /**
         * Custom canDrop implementation which returns true if a column can be added to the toolbar
         * @param {Object} data Arbitrary data from the drag source. For a HeaderContainer, it will
         * contain a header property which is the Header being dragged.
         * @return {Boolean} True if the drop is allowed
         */
        canDrop: function(dragSource, event, data) {
            var sorters = getSorters(),
                header  = data.header,
                length = sorters.length,
                entryIndex = this.calculateEntryIndex(event),
                targetItem = this.toolbar.getComponent(entryIndex),
                i;

            // Group columns have no dataIndex and therefore cannot be sorted
            // If target isn't reorderable it could not be replaced
            if (!header.dataIndex || (targetItem && targetItem.reorderable === false)) {
                return false;
            }

            for (i = 0; i < length; i++) {
                if (sorters[i].property == header.dataIndex) {
                    return false;
                }
            }
            return true;
        },

        afterLayout: doSort
    });

    //create the toolbar with the 2 plugins
    var tbar = Ext.create('Ext.toolbar.Toolbar', {
        items  : ['-'
	        ],
        plugins: [reorderer, droppable]
    });

    tbar.add(createSorterButtonConfig({
        text: 'æŒ‰åºå·æ’åº',
        sortData: {
            property: 'bh',
            direction: 'DESC'
        }
    }));

    

	Ext.regModel('doc_dagl_model', {
        fields: [
          	{name: 'id',    type: 'integer'},
		      {name: 'bgqx',    type: 'string'},
		      {name: 'bh',    type: 'integer'},
		      {name: 'qzh',   type: 'string'},
		      {name: 'wh',   type: 'string'},
		      {name: 'tm',    type: 'string'},
			  {name: 'zrz',    type: 'string'},
		      {name: 'mj',   type: 'string'},
		      {name: 'rq',   type: 'date', dateFormat: 'Y-m-d H:i:s'},
		      {name: 'ys',    type: 'string'},						      
		      {name: 'nd',    type: 'string'},
			  {name: 'zwrq',    type: 'date', dateFormat: 'Y-m-d H:i:s'},
			  {name: 'bz',   type: 'string'},
		      {name: 'jgwth',   type: 'string'},
			  {name: 'wjlx',   type: 'string'},
			  {name: 'ownerid',    type: 'integer'},
		      {name: 'cbdw',    type: 'string'},
		      {name: 'csdw',    type: 'string'},
		      {name: 'xfdw',  type: 'string'},
		      {name: 'qtfs', type: 'string'},
		      {name: 'xhfs', type: 'string'},			      
		      {name: 'sfyglsk',    type: 'string'},
			  {name: 'sfygd',    type: 'string'},
		      {name: 'jh',    type: 'string'},			      
		      {name: 'mlh',    type: 'string'},
		      {name: 'ajh',   type: 'string'},
			  {name: 'ztc1',   type: 'string'},
		      {name: 'ztc2',    type: 'string'},
		      {name: 'ztc3',    type: 'string'}
        ]
      });

      var doc_dagl_store = Ext.create('Ext.data.Store', {
        id:'doc_dagl_store',
        model : 'doc_dagl_model',
		pageSize: 2000,
        //autoLoad: true,
        proxy: {
          type: 'ajax',
          url : '/desktop/get_doc_dagl_grid',
		  simpleSortMode: true,
          extraParams: {query:title},
          reader: {
            type: 'json',
            root: 'rows',
            totalProperty: 'results'
          }
        }
        //sortInfo:{field: 'level4', direction: "ASC"},
        //baseParams: {start:0, limit:25, query:""}
      });
		var cellEditing = Ext.create('Ext.grid.plugin.CellEditing', {
	        clicksToEdit: 1
	    });
      var doc_dagl_grid = new Ext.grid.GridPanel({
        id : 'doc_dagl_grid',
        store: doc_dagl_store,  
		bbar:[
	      	new Ext.PagingToolbar({
		        store: doc_dagl_store,
		        pageSize: 2000,
		        width : 350,
		        border : false,
		        displayInfo: true,
		        displayMsg: '{0} - {1} of {2}',
		        emptyMsg: "æ²¡æœ‰æ‰¾åˆ°ï¼",
		        prependButtons: true
		      })
	    ],
		tbar : tbar,      
        columns: [
		  	{
	            text: 'åºå·',
	            dataIndex: 'bh',
	            width: 50,
	            align: 'right',
	            editor: {
	                xtype: 'numberfield',
	                allowBlank: false,
	                minValue: 0,
	                maxValue: 100000
	            }
	        },
			{ text : 'id',  width : 0, sortable : true, dataIndex: 'id'},
		      { text : 'å¹´åº¦',  width : 50, sortable : true, dataIndex: 'nd'},
		      { text : 'æœºæ„é—®é¢˜å·',  width : 50, sortable : true, dataIndex: 'jgwth'},
		      { text : 'ä¿ç®¡æœŸé™', width : 75, sortable : true, dataIndex: 'bgqx'},
		      { text : 'æ–‡å·',   width : 75, sortable : true, dataIndex: 'wh'},
		      { text : 'è´£ä»»è€…',  width : 175, sortable : true, dataIndex: 'zrz'},
		      { text : 'é¢˜å',  width : 175, sortable : true, dataIndex: 'tm'},
		      { text : 'æ—¥æœŸ',  width : 75, sortable : true, dataIndex: 'rq' ,renderer: Ext.util.Format.dateRenderer('Y-m-d')},			      
		      { text : 'é¡µæ•°',  width : 75, sortable : true, dataIndex: 'ys'},
			ã€€ã€€{ text : 'æ–‡ä»¶ç±»å‹',  width : 75, sortable : true, dataIndex: 'wjlx'},			  
		      { text : 'å¤‡æ³¨',  flex : 1, sortable : true, dataIndex: 'bz'}
          
		],
          selType:'checkboxmodel',
          multiSelect:true,
          //selModel: {
          //  selType: 'cellmodel'
          //},
        viewConfig: {
            trackOver: false
        },
		plugins: [cellEditing]
      });	
	
	if (win==null) {
        win = new Ext.Window({
          id : 'doc_dagl_win',
          title: 'æ–‡ä¹¦å¤„ç†æ¡£æ¡ˆç®¡ç†',
          //closeAction: 'hide',
          width: 570,
          x : 300,
          y : 50,
          height: 500,
          minHeight: 500,
          layout: 'fit',
          modal: true,
          plain: true,
          items:doc_dagl_grid,          
          tbar:[{
            xtype: 'button',
            iconCls: 'save',
            text:'å½’æ¡£',
            handler: function() {
				save_sql='';
				Ext.Msg.show({
		         msg: 'æ­£åœ¨å¤„ç†æ•°æ®, è¯·ç¨ç­‰...',
		         progressText: 'Loading...',
		         width:300,
		         wait:true
		     	});
				size=doc_dagl_grid.store.data.items.size();
				if (size>0){					
					for (i = 0; i < size; i++) {
						data=doc_dagl_grid.store.data.items[i].data;
						if(doc_dagl_grid.store.data.items[i].data.rq!=null){
							year=(doc_dagl_grid.store.data.items[i].data.rq.getYear()+1900);
							month=doc_dagl_grid.store.data.items[i].data.rq.getMonth()+1;
							rq=year+'-'+month+'-'+doc_dagl_grid.store.data.items[i].data.rq.getDate();
						}else{
							rq=null;
						};
						if (save_sql==''){
							save_sql=data.nd+'@'+data.jgwth+'@'+data.bgqx+'@'+data.wh+'@'+data.zrz+'@'+data.tm+'@'+rq+'@'+data.ys+'@'+data.wjlx+'@'+data.bz+'@'+data.ownerid+'@'+data.mj								
						}else{
							save_sql=save_sql+'$'+data.nd+'@'+data.jgwth+'@'+data.bgqx+'@'+data.wh+'@'+data.zrz+'@'+data.tm+'@'+rq+'@'+data.ys+'@'+data.wjlx+'@'+data.bz+'@'+data.ownerid+'@'+data.mj
						}
					}										
				}
				if(save_sql!=''){
					new Ajax.Request("/desktop/doc_gd", { 
						method: "POST",
						parameters: {qzh:title,save_sql:save_sql},
						onComplete:	 function(request) {
							fhz=request.responseText.split(":");
							if (fhz[0]=='success'){
								alert("å½’æ¡£æˆåŠŸã€‚");	
								Ext.Msg.hide();							
								Ext.getCmp('doc_dagl_win').close();											
							}else{
								if (fhz[0]=='false')
								{
									alert(fhz[1]);
								}else
								{
									alert("å½’æ¡£å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
								}
							}
						}
					});
				}else{
					alert("è¯·é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡æ¿åˆ—è¡¨ä¾¢è¿›è¡Œä¿å­˜ã€‚");
				}
				
            }
          },
		  {
            xtype: 'button',
            iconCls: 'delete',
            text:'ä»ä¸´æ—¶åº“ä¸­åˆ é™¤',
            handler: function() {
              //this.up('window').hide();


              Ext.getCmp('doc_dagl_win').close();
            }
		  },
          
          {
            xtype: 'button',
            iconCls: 'exit',
            text:'é€€å‡º',
            handler: function() {
              //this.up('window').hide();
			
	        
              Ext.getCmp('doc_dagl_win').close();
            }
          }]

        });
      }
		
		new Ajax.Request("/desktop/get_doc_temp", { 
	        method: "POST",
	        parameters: eval("({query:" + title + "})"),
	        onComplete:  function(request) {
	          if (request.responseText=='success'){
				
	            doc_dagl_store.load();				
	          }else{
	            alert(request.responseText);
	          }
	        }
	    });
      win.show();
};


var DispAj_sx = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
		tbar:[
			{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
				handler: function() {
					if (Ext.getCmp('zh_id').value!=undefined){
						DispJr(record,true,Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
					}else
					{
						alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
					}

				}
			},
			{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
				handler: function() {

					var grid = Ext.getCmp('com_document_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];

					var pars="id="+record.data.id;
					Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
								if(id=="yes"){
									new Ajax.Request("/desktop/delete_document", { 
										method: "POST",
										parameters: {id:record.data.id,userid:currentUser.id},
										onComplete:	 function(request) {
											Ext.getCmp('com_document_grid').store.load();

										}
									});
								}else{
									//alert('O,no');
								}

						});

				}},
			{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
			handler: function() {
				var grid  = this.ownerCt.ownerCt;
				//alert(grid);
					var store = grid.getStore(); 
					var records = grid.getSelectionModel().getSelection();
					var data = [];
					Ext.Array.each(records,function(model){
						data.push(Ext.JSON.encode(model.get('id')));
						DispJr(model,false,'','',true);
					});
				}
			}	,{
					xtype:'button',text:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',tooltip:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',iconCls:'add',
			          handler: function() {
						if (Ext.getCmp('zh_id').value!=undefined){
							size=Ext.getCmp('com_document_grid').store.count();
							if (size>0){	              					  
				              	alert("æ­¤æ¡ˆå·å·²ç»æœ‰å·å†…ç›®å½•ï¼Œä¸èƒ½ä»¥æ¨¡æ¿æ–¹å¼è¿›è¡Œå¢åŠ å·å†…ç›®å½•ã€‚");
							}else{					
								DispJr_model(Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
							}
						}else
						{
							alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
						}		              
				 	}
				}

		],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						DispJr(r,false,'','',true);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'å£°åƒæ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						
						if(add_new==false || add_new=='3'){
							new Ajax.Request("/desktop/update_flow", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");	
										Ext.getCmp('zh_dh').setValue(responseT[1]);
										//Ext.getCmp('archive_grid').store.load();
										//Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
									}
									
								}
							});
						}else{
							new Ajax.Request("/desktop/insert_archive", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
										dh=responseT[1];
										Ext.getCmp('button_aj_add').setText('ä¿®æ”¹ä¿å­˜');
										Ext.getCmp('zh_id').setValue(responseT[2]);
										Ext.getCmp('zh_dh').setValue(responseT[1]);
										add_new=false;											
									}else{
										alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
									}
									
								}
							});
						}
					}
				},
				{
		          text:'æŸ¥çœ‹å›¾åƒæˆ–é™„ä»¶',
		          iconCls:'',
		          handler : function() {
		          
					if (Ext.getCmp('zh_dh').value!=undefined){
		              var dh = Ext.getCmp('zh_dh').value;
		              show_image(dh);	              
		              set_image("/assets/dady/fm.jpg");
		            }
		          }    
		        },
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						if (add_new!='3'){
							Ext.getCmp('archive_grid').store.load();
						};
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				region: 'south',
				iconCls:'icon-grid',
				layout: 'fit',
				height: 150,
				split: true,
				collapsible: true,
				title: 'å·å†…ç›®å½•',
				items: documentGrid

			},{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'ç›® å½• å·',
	                    labelWidth: 60,
	                    x: 10,
						name: 'mlh',
						id: 'zh_mlh',
	                    y: 10,
						listeners : {
						       change : function(field,newValue,oldValue){
									if (newValue==""){
										alert("ç›®å½•å·ä¸èƒ½ä¸ºç©ºã€‚");
										field.value=oldValue;
									}else{
										qzh=title.split("_");
										if(add_new==true){
											new Ajax.Request("/desktop/get_max_ajh", { 
											    	method: "POST",
											    	parameters: {dalb:qzh[0] + "_" +qzh[1]+"_"+ newValue,qx:false},
											    	onComplete:	 function(request) {
											    		Ext.getCmp('zh_ajh').setValue(request.responseText);
											     	}
											     });
										}
									}
									
						       }
						}
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'åˆ†ç±»å·',
	                    labelWidth: 60,
						name: 'flh',
						id: 'zh_flh',
	                    x: 175,
	                    y: 10
	                },
					{
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'æ¡ˆå·å·',
	                    labelWidth: 60,
						name: 'ajh',
						id: 'zh_ajh',
	                    x: 345,
	                    y: 10
	                },
					{
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'å¹´åº¦',
	                    labelWidth: 60,
						name: 'nd',
						id: 'zh_nd',
	                    x: 520,
	                    y: 10
	                },
	                {
	                    xtype: 'textareafield',
	                    height: 55,
	                    width: 655,
	                    fieldLabel: 'æ¡ˆå·æ ‡é¢˜',
	                    labelWidth: 60,
						name: 'tm',
						id: 'zh_aj_tm',
	                    x: 10,
	                    y: 45
	                },
	                
	                
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'èµ· å¹´ æœˆ',
	                    labelWidth: 60,
						name: 'qny',
						id: 'zh_qny',
	                    x: 10,
	                    y: 115
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'æ­¢å¹´æœˆ',
	                    labelWidth: 60,
						name: 'zny',
						id: 'zh_zny',
	                    x: 175,
	                    y: 115
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'ä»¶æ•°',
	                    labelWidth: 60,
						name: 'js',
						id: 'zh_js',
	                    x: 345,
	                    y: 115
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'é¡µæ•°',
	                    labelWidth: 60,
						name: 'ys',
						id: 'zh_ys',
	                    x: 520,
	                    y: 115
	                },
					{
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'ä¿ç®¡æœŸé™',
	                    labelWidth: 60,
						name: 'bgqx',
						store: bgqx_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_bgqx',
	                    x: 10,
	                    y: 150
	                },
					{
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'å¯†çº§',
	                    labelWidth: 60,
						name: 'mj',
						store: mj_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_mj',
	                    x: 175,
	                    y: 150
	                },
					{
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'ç®±å·',
	                    labelWidth: 60,
						name: 'xh',
						id: 'zh_xh',
	                    x: 345,
	                    y: 150
	                },
					{
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'ç§ç±»',
	                    labelWidth: 60,
						name: 'zl',
						store: sxzl_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_zl',
	                    x: 520,
	                    y: 150
	                },
	                {
	                    xtype: 'textfield',
	                    width: 310,
	                    fieldLabel: 'å­˜å…¥ä½ç½®',
	                    labelWidth: 60,
						name: 'cfwz',
						id: 'zh_cfwz',
	                    x: 10,
	                    y: 185
	                },
	                
	                
	                
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'å¤‡æ³¨',
	                    labelWidth: 60,
						name: 'bz',
						id: 'zh_bz',
	                    x: 345,
	                    y: 185
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'zh_qzh',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'zh_dalb',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'zh_id',
	                    x: 10,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dh',
						id: 'zh_dh',
	                    x: 10,
	                    y: 190
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		if(add_new==true){
			Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
			ss=title.split('_');
			Ext.getCmp('zh_dalb').setValue(ss[1]);		
			Ext.getCmp('zh_qzh').setValue(ss[0]);
			if(ss.length==3){
				new Ajax.Request("/desktop/get_mlh", { 
				    	method: "POST",
				    	parameters: {dalb:ss[2]},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_mlh').setValue(request.responseText);
				     	}
				     });
				new Ajax.Request("/desktop/get_max_ajh", { 
				    	method: "POST",
				    	parameters: {dalb:title,qx:true},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_ajh').setValue(request.responseText);
				     	}
				     });
			}
		}else{
			requestdata='';
			new Ajax.Request("/desktop/get_archivebyid", { 
			    	method: "POST",
			    	parameters: {dh:record.data.dh,id:record.data.id,userid:currentUser.id},
			    	onComplete:	 function(request) {
			    		requestdata=eval('(' + request.responseText + ')');						
						Ext.getCmp('daglaj_form').getForm().setValues(requestdata[0]);
			     	}
			     });
			//Ext.getCmp('button_aj_add').hidden=true;
			com_document_store.proxy.extraParams.query=record.data.id;
			com_document_store.load();
		}
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};
var DispAj_tjml = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
		tbar:[
			{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
				handler: function() {
					if (Ext.getCmp('zh_id').value!=undefined){
						DispJr(record,true,Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
					}else
					{
						alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
					};
				}
			},
			{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
				handler: function() {

					var grid = Ext.getCmp('com_document_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];

					var pars="id="+record.data.id;
					Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
								if(id=="yes"){
									new Ajax.Request("/desktop/delete_document", { 
										method: "POST",
										parameters: {id:record.data.id,userid:currentUser.id},
										onComplete:	 function(request) {
											Ext.getCmp('com_document_grid').store.load();

										}
									});
								}else{
									//alert('O,no');
								}

						});

				}},
			{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
			handler: function() {
				var grid  = this.ownerCt.ownerCt;
				//alert(grid);
					var store = grid.getStore(); 
					var records = grid.getSelectionModel().getSelection();
					var data = [];
					Ext.Array.each(records,function(model){
						data.push(Ext.JSON.encode(model.get('id')));
						DispJr(model,false,'','',true);
					});
				}
			}	,{
					xtype:'button',text:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',tooltip:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',iconCls:'add',
			          handler: function() {
						if (Ext.getCmp('zh_id').value!=undefined){
							size=Ext.getCmp('com_document_grid').store.count();
							if (size>0){	              					  
				              	alert("æ­¤æ¡ˆå·å·²ç»æœ‰å·å†…ç›®å½•ï¼Œä¸èƒ½ä»¥æ¨¡æ¿æ–¹å¼è¿›è¡Œå¢åŠ å·å†…ç›®å½•ã€‚");
							}else{					
								DispJr_model(Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
							}
						}else
						{
							alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
						}		              
				 	}
				}

		],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						DispJr(r,false,'','',true);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'æ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						
						if(add_new==false || add_new=='3'){
							new Ajax.Request("/desktop/update_flow", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");	
										Ext.getCmp('zh_dh').setValue(responseT[1]);
										//Ext.getCmp('archive_grid').store.load();
										//Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
									}
									
								}
							});
						}else{
							new Ajax.Request("/desktop/insert_archive", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
										dh=responseT[1];
										Ext.getCmp('button_aj_add').setText('ä¿®æ”¹ä¿å­˜');
										Ext.getCmp('zh_id').setValue(responseT[2]);
										Ext.getCmp('zh_dh').setValue(responseT[1]);
										add_new=false;												
									}else{
										alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
									}
									
								}
							});
						}
					}
				},
				{
		          text:'æŸ¥çœ‹å›¾åƒæˆ–é™„ä»¶',
		          iconCls:'',
		          handler : function() {
		          
					if (Ext.getCmp('zh_dh').value!=undefined){
		              var dh = Ext.getCmp('zh_dh').value;
		              show_image(dh);	              
		              set_image("/assets/dady/fm.jpg");
		            }
		          }    
		        },
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						if (add_new!='3'){
							Ext.getCmp('archive_grid').store.load();
						};
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				region: 'south',
				iconCls:'icon-grid',
				layout: 'fit',
				height: 150,
				split: true,
				collapsible: true,
				title: 'å·å†…ç›®å½•',
				items: documentGrid

			},{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'ç›® å½• å·',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 10,
						name: 'mlh',
						id: 'zh_mlh',	                    
						listeners : {
						       change : function(field,newValue,oldValue){
									if (newValue==""){
										alert("ç›®å½•å·ä¸èƒ½ä¸ºç©ºã€‚");
										field.value=oldValue;
									}else{
										qzh=title.split("_");
										if(add_new==true){
											new Ajax.Request("/desktop/get_max_ajh", { 
											    	method: "POST",
											    	parameters: {dalb:qzh[0] + "_" +qzh[1]+"_"+ newValue,qx:false},
											    	onComplete:	 function(request) {
											    		Ext.getCmp('zh_ajh').setValue(request.responseText);
											     	}
											     });
										}
									}
									
						       }
						}
	                },
					{
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'åˆ†ç±»å·',
	                    labelWidth: 60,
						name: 'flh',
						id: 'zh_flh',
	                    x: 175,
	                    y: 10
							                    
						
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'åºå·',
	                    labelWidth: 60,
						name: 'ajh',
						id: 'zh_ajh',
	                    x: 350,
	                    y: 10
							                    
						
	                },
					{
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'å¹´åº¦',
						name: 'nd',
						id: 'zh_nd',
	                    labelWidth: 60,
	                    x: 520,
	                    y: 10
	                },
					{
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'ä¿ç®¡æœŸé™',
	                    labelWidth: 60,
						name: 'bgqx',
						store: bgqx_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_bgqx',
	                    x: 10,
	                    y: 45
	                },
	                {
	                    xtype: 'textfield',
	                    width: 490,
	                    fieldLabel: 'å›¾ å¹… å·',
	                    labelWidth: 60,
						name: 'tfh',
						id: 'zh_tfh',
	                    x: 175,
	                    y: 45
	                },
	                
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'å›¾    å',
						name: 'tm',
						id: 'zh_tm',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 80
	                },
	                {
	                    xtype: 'textfield',
	                    width: 485,
	                    fieldLabel: 'å›¾ æŸœ å·',
						name: 'tgh',
						id: 'zh_tgh',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 115
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'å¼ æ•°',
						name: 'ys',
						id: 'zh_ys',
	                    labelWidth: 60,
	                    x: 525,
	                    y: 115
	                },
	                
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'å¤‡ æ³¨',
						name: 'bz',
						id: 'zh_bz',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 150
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'zh_qzh',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'zh_dalb',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'zh_id',
	                    x: 10,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dh',
						id: 'zh_dh',
	                    x: 10,
	                    y: 190
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		Ext.getCmp('zh_flh').setValue('C2');
		if(add_new==true){
			Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
			ss=title.split('_');
			Ext.getCmp('zh_dalb').setValue(ss[1]);
		
			Ext.getCmp('zh_qzh').setValue(ss[0]);
			if(ss.length==3){
				new Ajax.Request("/desktop/get_mlh", { 
				    	method: "POST",
				    	parameters: {dalb:ss[2]},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_mlh').setValue(request.responseText);
				     	}
				     });
				new Ajax.Request("/desktop/get_max_ajh", { 
				    	method: "POST",
				    	parameters: {dalb:title,qx:true},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_ajh').setValue(request.responseText);
				     	}
				     });
			}
		}else{
			requestdata='';
			new Ajax.Request("/desktop/get_archivebyid", { 
			    	method: "POST",
			    	parameters: {dh:record.data.dh,id:record.data.id,userid:currentUser.id},
			    	onComplete:	 function(request) {
			    		requestdata=eval('(' + request.responseText + ')');						
						Ext.getCmp('daglaj_form').getForm().setValues(requestdata[0]);
			     	}
			     });
			//Ext.getCmp('button_aj_add').hidden=true;
			com_document_store.proxy.extraParams.query=record.data.id;
			com_document_store.load();
		}
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};
var DispAj_qtda_dzda = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
		tbar:[
			{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
				handler: function() {
					var grid = Ext.getCmp('archive_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];
					DispJr(record,true);

				}
			},
			{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
				handler: function() {

					var grid = Ext.getCmp('com_document_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];

					var pars="id="+record.data.id;
					Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
								if(id=="yes"){
									new Ajax.Request("/desktop/delete_document", { 
										method: "POST",
										parameters: {id:record.data.id,userid:currentUser.id},
										onComplete:	 function(request) {
											Ext.getCmp('com_document_grid').store.load();

										}
									});
								}else{
									//alert('O,no');
								}

						});

				}},
			{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
			handler: function() {
				var grid  = this.ownerCt.ownerCt;
				//alert(grid);
					var store = grid.getStore(); 
					var records = grid.getSelectionModel().getSelection();
					var data = [];
					Ext.Array.each(records,function(model){
						data.push(Ext.JSON.encode(model.get('id')));
						DispJr(model,false);
					});
				}
			}	,{
					xtype:'button',text:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',tooltip:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',iconCls:'add',
			          handler: function() {
						if (Ext.getCmp('zh_id').value!=undefined){
							size=Ext.getCmp('com_document_grid').store.count();
							if (size>0){	              					  
				              	alert("æ­¤æ¡ˆå·å·²ç»æœ‰å·å†…ç›®å½•ï¼Œä¸èƒ½ä»¥æ¨¡æ¿æ–¹å¼è¿›è¡Œå¢åŠ å·å†…ç›®å½•ã€‚");
							}else{					
								DispJr_model(Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
							}
						}else
						{
							alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
						}		              
				 	}
				}

		],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						DispJr(r,false);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'å…¶å®ƒæ¡£æ¡ˆ_ç”µå­æ¡£æ¡ˆæ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						
						if(add_new==false || add_new=='3'){
							new Ajax.Request("/desktop/update_flow", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");	
										Ext.getCmp('zh_dh').setValue(responseT[1]);
										//Ext.getCmp('archive_grid').store.load();
										//Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
									}
									
								}
							});
						}else{
							new Ajax.Request("/desktop/insert_archive", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
										dh=responseT[1];
										Ext.getCmp('button_aj_add').setText('ä¿®æ”¹ä¿å­˜');
										Ext.getCmp('zh_id').setValue(responseT[2]);
										Ext.getCmp('zh_dh').setValue(responseT[1]);
										add_new=false;												
									}else{
										alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
									}
									
								}
							});
						}
					}
				},
				{
		          text:'æŸ¥çœ‹å›¾åƒæˆ–é™„ä»¶',
		          iconCls:'',
		          handler : function() {
		          
					if (Ext.getCmp('zh_dh').value!=undefined){
		              var dh = Ext.getCmp('zh_dh').value;
		              show_image(dh);	              
		              set_image("/assets/dady/fm.jpg");
		            }
		          }    
		        },
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						if (add_new!='3'){
							Ext.getCmp('archive_grid').store.load();
						};
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				region: 'south',
				iconCls:'icon-grid',
				layout: 'fit',
				height: 150,
				split: true,
				collapsible: true,
				title: 'å·å†…ç›®å½•',
				items: documentGrid

			},{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'æ¡£ å·',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 10,
						name: 'mlh',
						id: 'zh_mlh',	                    
						listeners : {
						       change : function(field,newValue,oldValue){
									if (newValue==""){
										alert("æ¡£å·ä¸èƒ½ä¸ºç©ºã€‚");
										field.value=oldValue;
									}else{
										qzh=title.split("_");
										if(add_new==true){
											new Ajax.Request("/desktop/get_max_ajh", { 
											    	method: "POST",
											    	parameters: {dalb:qzh[0] + "_" +qzh[1]+"_"+ newValue,qx:false},
											    	onComplete:	 function(request) {
											    		Ext.getCmp('zh_ajh').setValue(request.responseText);
											     	}
											     });
										}
									}
									
						       }
						}
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'åˆ†ç±»å·',
	                    labelWidth: 60,
						name: 'flh',
						id: 'zh_flh',
	                    x: 175,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'é¡ºåºå·',
						name: 'ajh',
						id: 'zh_ajh',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'æäº¤äºº',
						name: 'tjr',
						id: 'zh_tjr',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 220
	                },
	                {
	                    xtype: 'textfield',
	                    width: 310,
	                    fieldLabel: 'è½¯ä»¶ç¯å¢ƒ',
						name: 'rjhj',
						id: 'zh_rjhj',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 130
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'æ“ä½œç³»ç»Ÿ',
						name: 'czxt',
						id: 'zh_czxt',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 130
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'æ•°é‡',
						name: 'sl',
						id: 'zh_sl',
	                    labelWidth: 60,
	                    x: 180,
	                    y: 100
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'å¤‡ä»½æ•°',
						name: 'bfs',
						id: 'zh_bfs',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 100
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'è½½ä½“åŒ…å«çš„æ–‡ä»¶æ ¼å¼',
	                    labelWidth: 60,
						name: 'ztbhdwjgs',
						id: 'zh_ztbhdwjgs',
	                    x: 10,
	                    y: 220
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'åº”ç”¨è½¯ä»¶   å¹³å°',
						name: 'yyrjpt',
						id: 'zh_yyrjpt',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 190
	                },
	                {
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'ä¿ç®¡æœŸé™',
						name: 'bgqx',
						store: bgqx_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_bgqx',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'å¯†çº§',
						name: 'mj',
						store: mj_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_mj',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'æäº¤å•ä½',
	                    labelWidth: 60,
						name: 'tjdw',
						id: 'zh_djdw',
	                    x: 345,
	                    y: 220
	                },
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'é¢˜ å',
						name: 'tm',
						id: 'zh_tm',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 40
	                },
	                {
	                    xtype: 'textfield',
	                    width: 170,
	                    fieldLabel: 'æ–‡ä»¶è½½ä½“',
						name: 'wjzt',
						id: 'zh_wjzt',
	                    labelWidth: 60,
	                    x: 495,
	                    y: 100
	                },
	                {
	                    xtype: 'textfield',
	                    width: 310,
	                    fieldLabel: 'ç”µå­æ–‡ä»¶å',
						name: 'dzwjm',
						id: 'zh_dzwjm',
	                    labelWidth: 65,
	                    x: 10,
	                    y: 70
	                },
	                {
	                    xtype: 'textfield',
	                    width: 150,
	                    fieldLabel: 'è½½ä½“ç¼–å·',
						name: 'ztbh',
						id: 'zh_ztbh',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 100
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'å½¢æˆéƒ¨é—¨',
						name: 'xcbm',
						id: 'zh_xcbm',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 70
	                },
	                {
	                    xtype: 'datefield',
						format: 'Y-m-d',
	                    width: 170,
	                    fieldLabel: 'å½¢æˆæ—¥æœŸ',
						name: 'xcrq',
						id: 'zh_xcrq',
	                    labelWidth: 60,
	                    x: 495,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'ç®± å·',
						name: 'xh',
						id: 'zh_xh',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 250
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'æ¥æ”¶äºº',
						name: 'jsr',
						id: 'zh_jsr',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 250
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'æ¥æ”¶å•ä½',
						name: 'jsdw',
						id: 'zh_jsdw',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 250
	                },
	                {
	                    xtype: 'textfield',
	                    width: 310,
	                    fieldLabel: 'å­˜å…¥ä½ç½®',
						name: 'cfwz',
						id: 'zh_cfwz',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 280
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'å¤‡æ³¨',
						name: 'bz',
						id: 'zh_bz',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 280
	                },
	                {
	                    xtype: 'textfield',
	                    width: 475,
	                    fieldLabel: 'ç¡¬ä»¶ç¯å¢ƒ',
						name: 'yjhj',
						id: 'zh_yjhj',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 160
	                },
	                {
	                    xtype: 'textfield',
	                    width: 170,
	                    fieldLabel: 'é¡µæ•°',
						name: 'ys',
						id: 'zh_ys',
	                    labelWidth: 60,
	                    x: 495,
	                    y: 160
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'zh_qzh',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'zh_dalb',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'zh_id',
	                    x: 10,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dh',
						id: 'zh_dh',
	                    x: 10,
	                    y: 190
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		if(add_new==true){
			Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
			ss=title.split('_');
			Ext.getCmp('zh_dalb').setValue(ss[1]);
		
			Ext.getCmp('zh_qzh').setValue(ss[0]);
			if(ss.length==3){
				new Ajax.Request("/desktop/get_mlh", { 
				    	method: "POST",
				    	parameters: {dalb:ss[2]},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_mlh').setValue(request.responseText);
				     	}
				     });
				new Ajax.Request("/desktop/get_max_ajh", { 
				    	method: "POST",
				    	parameters: {dalb:title,qx:true},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_ajh').setValue(request.responseText);
				     	}
				     });
			}
		}else{
			requestdata='';
			new Ajax.Request("/desktop/get_archivebyid", { 
			    	method: "POST",
			    	parameters: {dh:record.data.dh,id:record.data.id,userid:currentUser.id},
			    	onComplete:	 function(request) {
			    		requestdata=eval('(' + request.responseText + ')');						
						Ext.getCmp('daglaj_form').getForm().setValues(requestdata[0]);
			     	}
			     });
			//Ext.getCmp('button_aj_add').hidden=true;
			com_document_store.proxy.extraParams.query=record.data.id;
			com_document_store.load();
		}
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};
var DispAj_qtda_sbda = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
		tbar:[
			{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
				handler: function() {
					if (Ext.getCmp('zh_id').value!=undefined){
						DispJr(record,true,Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
					}else
					{
						alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
					};

				}
			},
			{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
				handler: function() {

					var grid = Ext.getCmp('com_document_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];

					var pars="id="+record.data.id;
					Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
								if(id=="yes"){
									new Ajax.Request("/desktop/delete_document", { 
										method: "POST",
										parameters: {id:record.data.id,userid:currentUser.id},
										onComplete:	 function(request) {
											Ext.getCmp('com_document_grid').store.load();

										}
									});
								}else{
									//alert('O,no');
								}

						});

				}},
			{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
			handler: function() {
				var grid  = this.ownerCt.ownerCt;
				//alert(grid);
					var store = grid.getStore(); 
					var records = grid.getSelectionModel().getSelection();
					var data = [];
					Ext.Array.each(records,function(model){
						data.push(Ext.JSON.encode(model.get('id')));
						DispJr(model,false,'','',true);
					});
				}
			}	,{
					xtype:'button',text:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',tooltip:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',iconCls:'add',
			          handler: function() {
						if (Ext.getCmp('zh_id').value!=undefined){
							size=Ext.getCmp('com_document_grid').store.count();
							if (size>0){	              					  
				              	alert("æ­¤æ¡ˆå·å·²ç»æœ‰å·å†…ç›®å½•ï¼Œä¸èƒ½ä»¥æ¨¡æ¿æ–¹å¼è¿›è¡Œå¢åŠ å·å†…ç›®å½•ã€‚");
							}else{					
								DispJr_model(Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
							}
						}else
						{
							alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
						}		              
				 	}
				}

		],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						DispJr(r,false,'','',true);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'å…¶å®ƒæ¡£æ¡ˆ_è®¾å¤‡æ¡£æ¡ˆæ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						
						if(add_new==false || add_new=='3'){
							new Ajax.Request("/desktop/update_flow", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");	
										Ext.getCmp('zh_dh').setValue(responseT[1]);
										//Ext.getCmp('archive_grid').store.load();
										//Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
									}
									
								}
							});
						}else{
							new Ajax.Request("/desktop/insert_archive", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
										dh=responseT[1];
										Ext.getCmp('button_aj_add').setText('ä¿®æ”¹ä¿å­˜');
										Ext.getCmp('zh_id').setValue(responseT[2]);
										Ext.getCmp('zh_dh').setValue(responseT[1]);
										add_new=false;												
									}else{
										alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
									}
									
								}
							});
						}
					}
				},
				{
		          text:'æŸ¥çœ‹å›¾åƒæˆ–é™„ä»¶',
		          iconCls:'',
		          handler : function() {
		          
					if (Ext.getCmp('zh_dh').value!=undefined){
		              var dh = Ext.getCmp('zh_dh').value;
		              show_image(dh);	              
		              set_image("/assets/dady/fm.jpg");
		            }
		          }    
		        },
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						if (add_new!='3'){
							Ext.getCmp('archive_grid').store.load();
						};
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				region: 'south',
				iconCls:'icon-grid',
				layout: 'fit',
				height: 150,
				split: true,
				collapsible: true,
				title: 'å·å†…ç›®å½•',
				items: documentGrid

			},{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
	                    xtype: 'textfield',
	                    width: 155,
	                    fieldLabel: 'ç›® å½• å·',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 10,
						name: 'mlh',
						id: 'zh_mlh',	                    
						listeners : {
						       change : function(field,newValue,oldValue){
									if (newValue==""){
										alert("æ¡£å·ä¸èƒ½ä¸ºç©ºã€‚");
										field.value=oldValue;
									}else{
										qzh=title.split("_");
										if(add_new==true){
											new Ajax.Request("/desktop/get_max_ajh", { 
											    	method: "POST",
											    	parameters: {dalb:qzh[0] + "_" +qzh[1]+"_"+ newValue,qx:false},
											    	onComplete:	 function(request) {
											    		Ext.getCmp('zh_ajh').setValue(request.responseText);
											     	}
											     });
										}
									}
									
						       }
						}
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'åˆ†ç±»å·',
						name: 'flh',
						id: 'zh_flh',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'ä»¶å·',
						name: 'ajh',
						id: 'zh_ajh',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'èµ„äº§ç¼–å·',
						name: 'zcbh',
						id: 'zh_zcbh',
	                    labelWidth: 60,
	                    x: 520,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 475,
	                    fieldLabel: 'ä½¿ç”¨ä¿ç®¡  å•ä½',
						name: 'sybgdw',
						id: 'zh_sybgdw',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 130
	                },
	                {
	                    xtype: 'textfield',
	                    width: 325,
	                    fieldLabel: 'ä½¿ç”¨ä¿ç®¡äºº',
						name: 'sybgr',
						id: 'zh_sybgr',
	                    labelWidth: 60,
	                    x: 340,
	                    y: 160
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'é¡µæ•°',
						name: 'ys',
						id: 'zh_ys',
	                    labelWidth: 60,
	                    x: 520,
	                    y: 130
	                },
	                {
	                    xtype: 'textfield',
	                    width: 310,
	                    fieldLabel: 'å­˜å…¥ä½ç½®',
						name: 'cfwz',
						id: 'zh_cfwz',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    width: 325,
	                    fieldLabel: 'ç®±å·',
						name: 'xh',
						id: 'zh_xh',
	                    labelWidth: 60,
	                    x: 340,
	                    y: 190
	                },
	                {
	                    xtype: 'combobox',
	                    width: 155,
	                    fieldLabel: 'ä¿ç®¡æœŸé™',
						name: 'bgqx',
						store: bgqx_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_bgqx',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 160
	                },
	                {
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'å¯†çº§',
						name: 'mj',
						store: mj_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_mj',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 160
	                },
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'å¤‡æ³¨',
						name: 'bz',
						id: 'zh_bz',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 220
	                },
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'èµ„äº§åç§°',
						name: 'zcmc',
						id: 'zh_zcmc',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 40
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'æ•°é‡',
						name: 'sl',
						id: 'zh_sl',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 70
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'å•ä½',
						name: 'dw',
						id: 'zh_dw',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 70
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'å•ä»·',
						name: 'dj',
						id: 'zh_dj',
	                    labelWidth: 60,
	                    x: 520,
	                    y: 70
	                },
	                {
	                    xtype: 'datefield',
						format: 'Y-m-d',
	                    width: 155,
	                    fieldLabel: 'è´­ç½®æ—¶é—´',
						name: 'gzsj',
						id: 'zh_gzsj',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 70
	                },
	                {
	                    xtype: 'textfield',
	                    width: 155,
	                    fieldLabel: 'é‡‘é¢',
						name: 'je',
						id: 'zh_je',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 100
	                },
	                {
	                    xtype: 'textfield',
	                    width: 490,
	                    fieldLabel: 'å­˜æ”¾åœ°ç‚¹',
						name: 'cfdd',
						id: 'zh_cfdd',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 100
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'zh_qzh',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'zh_dalb',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'zh_id',
	                    x: 10,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dh',
						id: 'zh_dh',
	                    x: 10,
	                    y: 190
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		if(add_new==true){
			Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
			ss=title.split('_');
			Ext.getCmp('zh_dalb').setValue(ss[1]);
		
			Ext.getCmp('zh_qzh').setValue(ss[0]);
			if(ss.length==3){
				new Ajax.Request("/desktop/get_mlh", { 
				    	method: "POST",
				    	parameters: {dalb:ss[2]},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_mlh').setValue(request.responseText);
				     	}
				     });
				new Ajax.Request("/desktop/get_max_ajh", { 
				    	method: "POST",
				    	parameters: {dalb:title,qx:true},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_ajh').setValue(request.responseText);
				     	}
				     });
			}
		}else{
			requestdata='';
			new Ajax.Request("/desktop/get_archivebyid", { 
			    	method: "POST",
			    	parameters: {dh:record.data.dh,id:record.data.id,userid:currentUser.id},
			    	onComplete:	 function(request) {
			    		requestdata=eval('(' + request.responseText + ')');						
						Ext.getCmp('daglaj_form').getForm().setValues(requestdata[0]);
			     	}
			     });
			//Ext.getCmp('button_aj_add').hidden=true;
			com_document_store.proxy.extraParams.query=record.data.id;
			com_document_store.load();
		}
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};
var DispAj_qtda_jjda = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
		tbar:[
			{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
				handler: function() {
					if (Ext.getCmp('zh_id').value!=undefined){
						DispJr(record,true,Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
					}else
					{
						alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
					};

				}
			},
			{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
				handler: function() {

					var grid = Ext.getCmp('com_document_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];

					var pars="id="+record.data.id;
					Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
								if(id=="yes"){
									new Ajax.Request("/desktop/delete_document", { 
										method: "POST",
										parameters: {id:record.data.id,userid:currentUser.id},
										onComplete:	 function(request) {
											Ext.getCmp('com_document_grid').store.load();

										}
									});
								}else{
									//alert('O,no');
								}

						});

				}},
			{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
			handler: function() {
				var grid  = this.ownerCt.ownerCt;
				//alert(grid);
					var store = grid.getStore(); 
					var records = grid.getSelectionModel().getSelection();
					var data = [];
					Ext.Array.each(records,function(model){
						data.push(Ext.JSON.encode(model.get('id')));
						DispJr(model,false,'','',true);
					});
				}
			}	,{
					xtype:'button',text:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',tooltip:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',iconCls:'add',
			          handler: function() {
						if (Ext.getCmp('zh_id').value!=undefined){
							size=Ext.getCmp('com_document_grid').store.count();
							if (size>0){	              					  
				              	alert("æ­¤æ¡ˆå·å·²ç»æœ‰å·å†…ç›®å½•ï¼Œä¸èƒ½ä»¥æ¨¡æ¿æ–¹å¼è¿›è¡Œå¢åŠ å·å†…ç›®å½•ã€‚");
							}else{					
								DispJr_model(Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
							}
						}else
						{
							alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
						}		              
				 	}
				}

		],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						DispJr(r,false,'','',true);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'å…¶å®ƒæ¡£æ¡ˆ_åŸºå»ºæ¡£æ¡ˆæ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						
						if(add_new==false || add_new=='3'){
							new Ajax.Request("/desktop/update_flow", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");	
										Ext.getCmp('zh_dh').setValue(responseT[1]);
										//Ext.getCmp('archive_grid').store.load();
										//Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
									}
									
								}
							});
						}else{
							new Ajax.Request("/desktop/insert_archive", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
										dh=responseT[1];
										Ext.getCmp('button_aj_add').setText('ä¿®æ”¹ä¿å­˜');
										Ext.getCmp('zh_id').setValue(responseT[2]);
										Ext.getCmp('zh_dh').setValue(responseT[1]);
										add_new=false;											
									}else{
										alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
									}
									
								}
							});
						}
					}
				},
				{
		          text:'æŸ¥çœ‹å›¾åƒæˆ–é™„ä»¶',
		          iconCls:'',
		          handler : function() {
		          
					if (Ext.getCmp('zh_dh').value!=undefined){
		              var dh = Ext.getCmp('zh_dh').value;
		              show_image(dh);	              
		              set_image("/assets/dady/fm.jpg");
		            }
		          }    
		        },
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						if (add_new!='3'){
							Ext.getCmp('archive_grid').store.load();
						};
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				region: 'south',
				iconCls:'icon-grid',
				layout: 'fit',
				height: 150,
				split: true,
				collapsible: true,
				title: 'å·å†…ç›®å½•',
				items: documentGrid

			},{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'ç›® å½• å·',
						name: 'mlh',
						id: 'zh_mlh',	                    
						listeners : {
						       change : function(field,newValue,oldValue){
									if (newValue==""){
										alert("ç›®å½•å·ä¸èƒ½ä¸ºç©ºã€‚");
										field.value=oldValue;
									}else{
										qzh=title.split("_");
										if(add_new==true){
											new Ajax.Request("/desktop/get_max_ajh", { 
											    	method: "POST",
											    	parameters: {dalb:qzh[0] + "_" +qzh[1]+"_"+ newValue,qx:false},
											    	onComplete:	 function(request) {
											    		Ext.getCmp('zh_ajh').setValue(request.responseText);
											     	}
											     });
										}
									}
									
						       }
						},
	                    labelWidth: 60,
	                    x: 10,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'åˆ†ç±»å·',
						name: 'flh',
						id: 'zh_flh',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'æ¡ˆå·å·',
						name: 'ajh',
						id: 'zh_ajh',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'å»ºè®¾å¹´ä»£',
						name: 'nd',
						id: 'zh_nd',
	                    labelWidth: 60,
	                    x: 520,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'èµ· å¹´ æœˆ',
						name: 'qny',
						id: 'zh_qny',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 100
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'æ­¢å¹´æœˆ',
						name: 'zny',
						id: 'zh_zny',
	                    labelWidth: 60,
	                    x: 520,
	                    y: 100
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'ä»¶æ•°',
						name: 'js',
						id: 'zh_js',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 130
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'é¡µæ•°',
						name: 'ys',
						id: 'zh_ys',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 130
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'å­˜å…¥ä½ç½®',
						name: 'cfwz',
						id: 'zh_cfwz',
	                    labelWidth: 60,
	                    x: 520,
	                    y: 130
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'ç®±å·',
						name: 'xh',
						id: 'zh_xh',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 130
	                },
	                {
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'ä¿ç®¡æœŸé™',
						name: 'bgqx',
						store: bgqx_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_bgqx',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 100
	                },
	                {
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'å¯†çº§',
						name: 'mj',
						store: mj_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_mj',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 100
	                },
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'å¤‡æ³¨',
						name: 'bz',
						id: 'zh_bz',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 160
	                },
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'é¡¹ç›®åç§°',
						name: 'xmmc',
						id: 'zh_xmmc',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 40
	                },
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'å»ºè®¾å•ä½',
						name: 'jsdw',
						id: 'zh_jsdw',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 70
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'zh_qzh',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'zh_dalb',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'zh_id',
	                    x: 10,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dh',
						id: 'zh_dh',
	                    x: 10,
	                    y: 190
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		if(add_new==true){
			Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
			ss=title.split('_');
			Ext.getCmp('zh_dalb').setValue(ss[1]);
		
			Ext.getCmp('zh_qzh').setValue(ss[0]);
			if(ss.length==3){
				new Ajax.Request("/desktop/get_mlh", { 
				    	method: "POST",
				    	parameters: {dalb:ss[2]},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_mlh').setValue(request.responseText);
				     	}
				     });
				new Ajax.Request("/desktop/get_max_ajh", { 
				    	method: "POST",
				    	parameters: {dalb:title,qx:true},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_ajh').setValue(request.responseText);
				     	}
				     });
			}
		}else{
			requestdata='';
			new Ajax.Request("/desktop/get_archivebyid", { 
			    	method: "POST",
			    	parameters: {dh:record.data.dh,id:record.data.id,userid:currentUser.id},
			    	onComplete:	 function(request) {
			    		requestdata=eval('(' + request.responseText + ')');						
						Ext.getCmp('daglaj_form').getForm().setValues(requestdata[0]);
			     	}
			     });
			//Ext.getCmp('button_aj_add').hidden=true;
			com_document_store.proxy.extraParams.query=record.data.id;
			com_document_store.load();
		}
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};
var DispAj_qtda_swda = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
		tbar:[
			{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
				handler: function() {
					if (Ext.getCmp('zh_id').value!=undefined){
						DispJr(record,true,Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
					}else
					{
						alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
					};

				}
			},
			{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
				handler: function() {

					var grid = Ext.getCmp('com_document_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];

					var pars="id="+record.data.id;
					Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
								if(id=="yes"){
									new Ajax.Request("/desktop/delete_document", { 
										method: "POST",
										parameters: {id:record.data.id,userid:currentUser.id},
										onComplete:	 function(request) {
											Ext.getCmp('com_document_grid').store.load();

										}
									});
								}else{
									//alert('O,no');
								}

						});

				}},
			{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
			handler: function() {
				var grid  = this.ownerCt.ownerCt;
				//alert(grid);
					var store = grid.getStore(); 
					var records = grid.getSelectionModel().getSelection();
					var data = [];
					Ext.Array.each(records,function(model){
						data.push(Ext.JSON.encode(model.get('id')));
						DispJr(model,false,'','',true);
					});
				}
			}	,{
					xtype:'button',text:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',tooltip:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',iconCls:'add',
			          handler: function() {
						if (Ext.getCmp('zh_id').value!=undefined){
							size=Ext.getCmp('com_document_grid').store.count();
							if (size>0){	              					  
				              	alert("æ­¤æ¡ˆå·å·²ç»æœ‰å·å†…ç›®å½•ï¼Œä¸èƒ½ä»¥æ¨¡æ¿æ–¹å¼è¿›è¡Œå¢åŠ å·å†…ç›®å½•ã€‚");
							}else{					
								DispJr_model(Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
							}
						}else
						{
							alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
						}		              
				 	}
				}

		],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						DispJr(r,false,'','',true);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'å…¶å®ƒæ¡£æ¡ˆ_å®ç‰©æ¡£æ¡ˆæ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						
						if(add_new==false || add_new=='3'){
							new Ajax.Request("/desktop/update_flow", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");	
										Ext.getCmp('zh_dh').setValue(responseT[1]);
										//Ext.getCmp('archive_grid').store.load();
										//Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
									}
									
								}
							});
						}else{
							new Ajax.Request("/desktop/insert_archive", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
										dh=responseT[1];
										Ext.getCmp('button_aj_add').setText('ä¿®æ”¹ä¿å­˜');
										Ext.getCmp('zh_id').setValue(responseT[2]);
										Ext.getCmp('zh_dh').setValue(responseT[1]);
										add_new=false;											
									}else{
										alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
									}
									
								}
							});
						}
					}
				},
				{
		          text:'æŸ¥çœ‹å›¾åƒæˆ–é™„ä»¶',
		          iconCls:'',
		          handler : function() {
		          
					if (Ext.getCmp('zh_dh').value!=undefined){
		              var dh = Ext.getCmp('zh_dh').value;
		              show_image(dh);	              
		              set_image("/assets/dady/fm.jpg");
		            }
		          }    
		        },
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						if (add_new!='3'){
							Ext.getCmp('archive_grid').store.load();
						};
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				region: 'south',
				iconCls:'icon-grid',
				layout: 'fit',
				height: 150,
				split: true,
				collapsible: true,
				title: 'å·å†…ç›®å½•',
				items: documentGrid

			},{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'ç›® å½• å·',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 10,
						name: 'mlh',
						id: 'zh_mlh',	                    
						listeners : {
						       change : function(field,newValue,oldValue){
									if (newValue==""){
										alert("ç›®å½•å·ä¸èƒ½ä¸ºç©ºã€‚");
										field.value=oldValue;
									}else{
										qzh=title.split("_");
										if(add_new==true){
											new Ajax.Request("/desktop/get_max_ajh", { 
											    	method: "POST",
											    	parameters: {dalb:qzh[0] + "_" +qzh[1]+"_"+ newValue,qx:false},
											    	onComplete:	 function(request) {
											    		Ext.getCmp('zh_ajh').setValue(request.responseText);
											     	}
											     });
										}
									}
									
						       }
						}
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'åˆ†ç±»å·',
						name: 'flh',
						id: 'zh_flh',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'ä»¶å·',
						name: 'ajh',
						id: 'zh_ajh',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 160,
	                    fieldLabel: 'ç¼–å·',
						name: 'bh',
						id: 'zh_bh',
	                    labelWidth: 60,
	                    x: 505,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'è½½ä½“å½¢å¼',
						name: 'ztxs',
						id: 'zh_ztxs',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 130
	                },
	                {
	                    xtype: 'textfield',
	                    width: 160,
	                    fieldLabel: 'é¡µæ•°',
						name: 'ys',
						id: 'zh_ys',
	                    labelWidth: 60,
	                    x: 505,
	                    y: 130
	                },
	                {
	                    xtype: 'textfield',
	                    width: 310,
	                    fieldLabel: 'å­˜å…¥ä½ç½®',
						name: 'cfwz',
						id: 'zh_cfwz',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 160
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'ç®±å·',
						name: 'xh',
						id: 'zh_xh',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 160
	                },
	                {
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'ä¿ç®¡æœŸé™',
						name: 'bgqx',
						store: bgqx_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_bgqx',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 130
	                },
	                {
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'å¯†çº§',
						name: 'mj',
						store: mj_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_mj',
	                    labelWidth: 60,
	                    x: 340,
	                    y: 130
	                },
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'å¤‡æ³¨',
						name: 'bz',
						id: 'zh_bz',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'ç±» åˆ«',
						name: 'lb',
						store: swda_lb_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_lb',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 70
	                },
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'å ç§°',
	 					name: 'mc',
						id: 'zh_mc',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 40
	                },
	                {
	                    xtype: 'textfield',
	                    width: 310,
	                    fieldLabel: 'è·å¥–è€…',
						name: 'hjz',
						id: 'zh_hjz',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 70
	                },
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'æˆå¥–å•ä½',
						name: 'sjdw',
						id: 'zh_sjdw',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 100
	                },
	                {
	                    xtype: 'datefield',
						format: 'Y-m-d',
	                    width: 160,
	                    fieldLabel: 'è·å¥–æ—¶é—´',
						name: 'sjsj',
						id: 'zh_sjsj',
	                    labelWidth: 60,
	                    x: 505,
	                    y: 70
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'zh_qzh',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'zh_dalb',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'zh_id',
	                    x: 10,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dh',
						id: 'zh_dh',
	                    x: 10,
	                    y: 190
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		if(add_new==true){
			Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
			ss=title.split('_');
			Ext.getCmp('zh_dalb').setValue(ss[1]);
		
			Ext.getCmp('zh_qzh').setValue(ss[0]);
			if(ss.length==3){
				new Ajax.Request("/desktop/get_mlh", { 
				    	method: "POST",
				    	parameters: {dalb:ss[2]},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_mlh').setValue(request.responseText);
				     	}
				     });
				new Ajax.Request("/desktop/get_max_ajh", { 
				    	method: "POST",
				    	parameters: {dalb:title,qx:true},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_ajh').setValue(request.responseText);
				     	}
				     });
			}
		}else{
			requestdata='';
			new Ajax.Request("/desktop/get_archivebyid", { 
			    	method: "POST",
			    	parameters: {dh:record.data.dh,id:record.data.id,userid:currentUser.id},
			    	onComplete:	 function(request) {
			    		requestdata=eval('(' + request.responseText + ')');						
						Ext.getCmp('daglaj_form').getForm().setValues(requestdata[0]);
			     	}
			     });
			//Ext.getCmp('button_aj_add').hidden=true;
			com_document_store.proxy.extraParams.query=record.data.id;
			com_document_store.load();
		}
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};
var DispAj_qtda_zlxx = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
		tbar:[
			{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
				handler: function() {
					var grid = Ext.getCmp('archive_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];
					DispJr(record,true);

				}
			},
			{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
				handler: function() {

					var grid = Ext.getCmp('com_document_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];

					var pars="id="+record.data.id;
					Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
								if(id=="yes"){
									new Ajax.Request("/desktop/delete_document", { 
										method: "POST",
										parameters: {id:record.data.id,userid:currentUser.id},
										onComplete:	 function(request) {
											Ext.getCmp('com_document_grid').store.load();

										}
									});
								}else{
									//alert('O,no');
								}

						});

				}},
			{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
			handler: function() {
				var grid  = this.ownerCt.ownerCt;
				//alert(grid);
					var store = grid.getStore(); 
					var records = grid.getSelectionModel().getSelection();
					var data = [];
					Ext.Array.each(records,function(model){
						data.push(Ext.JSON.encode(model.get('id')));
						DispJr(model,false);
					});
				}
			}	,{
					xtype:'button',text:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',tooltip:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',iconCls:'add',
			          handler: function() {
						if (Ext.getCmp('zh_id').value!=undefined){
							size=Ext.getCmp('com_document_grid').store.count();
							if (size>0){	              					  
				              	alert("æ­¤æ¡ˆå·å·²ç»æœ‰å·å†…ç›®å½•ï¼Œä¸èƒ½ä»¥æ¨¡æ¿æ–¹å¼è¿›è¡Œå¢åŠ å·å†…ç›®å½•ã€‚");
							}else{					
								DispJr_model(Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
							}
						}else
						{
							alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
						}		              
				 	}
				}

		],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						DispJr(r,false);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'å…¶å®ƒæ¡£æ¡ˆ_èµ„æ–™ä¿¡æ¯æ¡£æ¡ˆæ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						
						if(add_new==false || add_new=='3'){
							new Ajax.Request("/desktop/update_flow", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");
										Ext.getCmp('archive_grid').store.load();
										Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
									}
									
								}
							});
						}else{
							new Ajax.Request("/desktop/insert_archive", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
										Ext.getCmp('archive_grid').store.load();
										//Ext.getCmp('archive_tree').store.load();
										Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
									}
									
								}
							});
						}
					}
				},
				{
		          text:'æŸ¥çœ‹å›¾åƒæˆ–é™„ä»¶',
		          iconCls:'',
		          handler : function() {
		          
					if (Ext.getCmp('zh_dh').value!=undefined){
		              var dh = Ext.getCmp('zh_dh').value;
		              show_image(dh);	              
		              set_image("/assets/dady/fm.jpg");
		            }
		          }    
		        },
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				region: 'south',
				iconCls:'icon-grid',
				layout: 'fit',
				height: 150,
				split: true,
				collapsible: true,
				title: 'å·å†…ç›®å½•',
				items: documentGrid

			},{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'ç›® å½• å·',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 10,
						name: 'mlh',
						id: 'zh_mlh',	                    
						listeners : {
						       change : function(field,newValue,oldValue){
									if (newValue==""){
										alert("ç›®å½•å·ä¸èƒ½ä¸ºç©ºã€‚");
										field.value=oldValue;
									}else{
										qzh=title.split("_");
										if(add_new==true){
											new Ajax.Request("/desktop/get_max_ajh", { 
											    	method: "POST",
											    	parameters: {dalb:qzh[0] + "_" +qzh[1]+"_"+ newValue,qx:false},
											    	onComplete:	 function(request) {
											    		Ext.getCmp('zh_ajh').setValue(request.responseText);
											     	}
											     });
										}
									}
									
						       }
						}
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'åˆ†ç±»å·',
						name: 'flh',
						id: 'zh_flh',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 140,
	                    fieldLabel: 'ä»¶å·',
						name: 'ajh',
						id: 'zh_ajh',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 160,
	                    fieldLabel: 'ç¼–å·',
						name: 'bh',
						id: 'zh_bh',
	                    labelWidth: 60,
	                    x: 505,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 160,
	                    fieldLabel: 'é¡µæ•°',
						name: 'ys',
						id: 'zh_ys',
	                    labelWidth: 60,
	                    x: 505,
	                    y: 100
	                },
	                {
	                    xtype: 'textfield',
	                    width: 310,
	                    fieldLabel: 'å­˜å…¥ä½ç½®',
						name: 'cfwz',
						id: 'zh_cfwz',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 130
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'ç®±å·',
						name: 'xh',
						id: 'zh_xh',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 130
	                },
	                {
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'ä¿ç®¡æœŸé™',
						name: 'bgqx',
						store: bgqx_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_bgqx',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 100
	                },
	                {
	                    xtype: 'combobox',
	                    width: 145,
	                    fieldLabel: 'å¯†çº§',
						name: 'mj',
						store: mj_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_mj',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 100
	                },
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'å¤‡æ³¨',
						name: 'bz',
						id: 'zh_bz',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 160
	                },
	                {
	                    xtype: 'combobox',
	                    width: 160,
	                    fieldLabel: 'ç±»åˆ«',
						name: 'lb',
						store: zlxx_lb_store,
						emptyText:'è¯·é€‰æ‹©',
						mode: 'remote',
						minChars : 2,
						valueField:'text',
						displayField:'text',
						triggerAction:'all',
						id:'zh_lb',
	                    labelWidth: 60,
	                    x: 505,
	                    y: 40
	                },
	                {
	                    xtype: 'textfield',
	                    width: 475,
	                    fieldLabel: 'ç¼–åˆ¶å•ä½',
						name: 'bzdm',
						id: 'zh_bzdw',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 40
	                },
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'æ ‡ é¢˜',
						name: 'tm',
						id: 'zh_tm',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 70
	                },
	                {
	                    xtype: 'textfield',
	                    width: 145,
	                    fieldLabel: 'å‡ºç‰ˆå¹´åº¦',
						name: 'nd',
						id: 'zh_nd',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 100
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'zh_qzh',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'zh_dalb',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'zh_id',
	                    x: 10,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dh',
						id: 'zh_dh',
	                    x: 10,
	                    y: 190
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		if(add_new==true){
			Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
			ss=title.split('_');
			Ext.getCmp('zh_dalb').setValue(ss[1]);
		
			Ext.getCmp('zh_qzh').setValue(ss[0]);
			if(ss.length==3){
				new Ajax.Request("/desktop/get_mlh", { 
				    	method: "POST",
				    	parameters: {dalb:ss[2]},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_mlh').setValue(request.responseText);
				     	}
				     });
				new Ajax.Request("/desktop/get_max_ajh", { 
				    	method: "POST",
				    	parameters: {dalb:title,qx:true},
				    	onComplete:	 function(request) {
				    		Ext.getCmp('zh_ajh').setValue(request.responseText);
				     	}
				     });
			}
		}else{
			requestdata='';
			new Ajax.Request("/desktop/get_archivebyid", { 
			    	method: "POST",
			    	parameters: {dh:record.data.dh,id:record.data.id,userid:currentUser.id},
			    	onComplete:	 function(request) {
			    		requestdata=eval('(' + request.responseText + ')');						
						Ext.getCmp('daglaj_form').getForm().setValues(requestdata[0]);
			     	}
			     });
			//Ext.getCmp('button_aj_add').hidden=true;
			com_document_store.proxy.extraParams.query=record.data.id;
			com_document_store.load();
		}
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};
var DispAj_by_tszlhj = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
		tbar:[
			{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
				handler: function() {
					var grid = Ext.getCmp('archive_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];
					DispJr(record,true);

				}
			},
			{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
				handler: function() {

					var grid = Ext.getCmp('com_document_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];

					var pars="id="+record.data.id;
					Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
								if(id=="yes"){
									new Ajax.Request("/desktop/delete_document", { 
										method: "POST",
										parameters: {id:record.data.id,userid:currentUser.id},
										onComplete:	 function(request) {
											Ext.getCmp('com_document_grid').store.load();

										}
									});
								}else{
									//alert('O,no');
								}

						});

				}},
			{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
			handler: function() {
				var grid  = this.ownerCt.ownerCt;
				//alert(grid);
					var store = grid.getStore(); 
					var records = grid.getSelectionModel().getSelection();
					var data = [];
					Ext.Array.each(records,function(model){
						data.push(Ext.JSON.encode(model.get('id')));
						DispJr(model,false);
					});
				}
			}	,{
					xtype:'button',text:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',tooltip:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',iconCls:'add',
			          handler: function() {
						if (Ext.getCmp('zh_id').value!=undefined){
							size=Ext.getCmp('com_document_grid').store.count();
							if (size>0){	              					  
				              	alert("æ­¤æ¡ˆå·å·²ç»æœ‰å·å†…ç›®å½•ï¼Œä¸èƒ½ä»¥æ¨¡æ¿æ–¹å¼è¿›è¡Œå¢åŠ å·å†…ç›®å½•ã€‚");
							}else{					
								DispJr_model(Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
							}
						}else
						{
							alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
						}		              
				 	}
				}

		],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						DispJr(r,false);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'ç¼–ç ”ç±»-å›¾ä¹¦èµ„æ–™æ±‡é›†æ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						
						if(add_new==false || add_new=='3'){
							new Ajax.Request("/desktop/update_flow", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");
										Ext.getCmp('archive_grid').store.load();
										Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
									}
									
								}
							});
						}else{
							new Ajax.Request("/desktop/insert_archive", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
										Ext.getCmp('archive_grid').store.load();
										//Ext.getCmp('archive_tree').store.load();
										Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
									}
									
								}
							});
						}
					}
				},
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				region: 'south',
				iconCls:'icon-grid',
				layout: 'fit',
				height: 150,
				split: true,
				collapsible: true,
				title: 'å·å†…ç›®å½•',
				items: documentGrid

			},{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
	                    xtype: 'textfield',
	                    width: 310,
	                    fieldLabel: 'ç™»è®°å·',
						name: 'djh',
						id: 'zh_djh',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 325,
	                    fieldLabel: 'åˆ‘æœŸ',
						name: 'kq',
						id: 'zh_kq',
	                    labelWidth: 60,
	                    x: 340,
	                    y: 10
	                },
	                {
	                    xtype: 'textareafield',
	                    height: 55,
	                    width: 655,
	                    fieldLabel: 'å ç§°',
						name: 'mc',
						id: 'zh_mc',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 45
	                },
	                {
	                    xtype: 'textfield',
	                    width: 160,
	                    fieldLabel: 'ä»½ æ•°',
						name: 'fs',
						id: 'zh_fs',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 150
	                },
	                {
	                    xtype: 'textfield',
	                    width: 335,
	                    fieldLabel: 'é‚®å‘ä»£ç ',
						name: 'yfdm',
						id: 'zh_yfdm',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 115
	                },
	                {
	                    xtype: 'textfield',
	                    width: 125,
	                    fieldLabel: 'å•ä»·',
						name: 'dj',
						id: 'zh_dj',
	                    labelWidth: 60,
	                    x: 520,
	                    y: 115
	                },
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'å¤‡ æ³¨',
						name: 'bz',
						id: 'zh_bz',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 185
	                },
	                {
	                    xtype: 'textfield',
	                    width: 490,
	                    fieldLabel: 'å­˜æ”¾ä½ç½®',
						name: 'cfwz',
						id: 'zh_cfwz',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 150
	                },
	                {
	                    xtype: 'datefield',
						format: 'Y-m-d',
	                    width: 160,
	                    fieldLabel: 'å‡ºç‰ˆæ—¥æœŸ',
						name: 'cbrq',
						id: 'zh_cbrq',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 115
	                },
	                {
	                    xtype: 'label',
	                    height: 20,
	                    width: 20,
	                    text: 'å…ƒ',
	                    x: 650,
	                    y: 120
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'zh_qzh',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'zh_dalb',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'zh_id',
	                    x: 10,
	                    y: 190
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dh',
						id: 'zh_dh',
	                    x: 10,
	                    y: 190
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		
		Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
		ss=title.split('_');
		Ext.getCmp('zh_dalb').setValue(ss[1]);		
		Ext.getCmp('zh_qzh').setValue(ss[0]);
		
		
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};
var DispAj_by_jcszhb = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
		tbar:[
			{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
				handler: function() {
					var grid = Ext.getCmp('archive_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];
					DispJr(record,true);

				}
			},
			{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
				handler: function() {

					var grid = Ext.getCmp('com_document_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];

					var pars="id="+record.data.id;
					Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
								if(id=="yes"){
									new Ajax.Request("/desktop/delete_document", { 
										method: "POST",
										parameters: {id:record.data.id,userid:currentUser.id},
										onComplete:	 function(request) {
											Ext.getCmp('com_document_grid').store.load();

										}
									});
								}else{
									//alert('O,no');
								}

						});

				}},
			{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
			handler: function() {
				var grid  = this.ownerCt.ownerCt;
				//alert(grid);
					var store = grid.getStore(); 
					var records = grid.getSelectionModel().getSelection();
					var data = [];
					Ext.Array.each(records,function(model){
						data.push(Ext.JSON.encode(model.get('id')));
						DispJr(model,false);
					});
				}
			}	,{
					xtype:'button',text:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',tooltip:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',iconCls:'add',
			          handler: function() {
						if (Ext.getCmp('zh_id').value!=undefined){
							size=Ext.getCmp('com_document_grid').store.count();
							if (size>0){	              					  
				              	alert("æ­¤æ¡ˆå·å·²ç»æœ‰å·å†…ç›®å½•ï¼Œä¸èƒ½ä»¥æ¨¡æ¿æ–¹å¼è¿›è¡Œå¢åŠ å·å†…ç›®å½•ã€‚");
							}else{					
								DispJr_model(Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
							}
						}else
						{
							alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
						}		              
				 	}
				}

		],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						DispJr(r,false);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'ç¼–ç ”ç±»-å›¾ä¹¦èµ„æ–™æ±‡é›†æ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						
						if(add_new==false || add_new=='3'){
							new Ajax.Request("/desktop/update_flow", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									if (request.responseText=='success'){
										alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");
										Ext.getCmp('archive_grid').store.load();
										Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
									}
									
								}
							});
						}else{
							new Ajax.Request("/desktop/insert_archive", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
										Ext.getCmp('archive_grid').store.load();
										//Ext.getCmp('archive_tree').store.load();
										Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
									}
									
								}
							});
						}
					}
				},
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				region: 'south',
				iconCls:'icon-grid',
				layout: 'fit',
				height: 150,
				split: true,
				collapsible: true,
				title: 'å·å†…ç›®å½•',
				items: documentGrid

			},{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'ä¸“ é¢˜',
						name: 'zt',
						id: 'zh_zt',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 10
	                },
	                {
	                    xtype: 'textareafield',
	                    height: 55,
	                    width: 655,
	                    fieldLabel: 'å‰ è¨€',
						name: 'qy',
						id: 'zh_qy',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 45
	                },
	                {
	                    xtype: 'textareafield',
	                    height: 40,
	                    width: 655,
	                    fieldLabel: 'ç»Ÿè®¡æ•°æ®',
						name: 'tjsj',
						id: 'zh_tjsj',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 115
	                },
	                {
	                    xtype: 'textareafield',
	                    height: 40,
	                    width: 655,
	                    fieldLabel: 'è¯´ æ˜',
						name: 'sm',
						id: 'zh_sm',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 170
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'zh_qzh',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'zh_dalb',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'zh_id',
	                    x: 10,
	                    y: 190
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		
		Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
		ss=title.split('_');
		Ext.getCmp('zh_dalb').setValue(ss[1]);		
		Ext.getCmp('zh_qzh').setValue(ss[0]);
		
		
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};
var DispAj_by_zzjgyg = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
		tbar:[
			{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
				handler: function() {
					var grid = Ext.getCmp('archive_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];
					DispJr(record,true);

				}
			},
			{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
				handler: function() {

					var grid = Ext.getCmp('com_document_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];

					var pars="id="+record.data.id;
					Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
								if(id=="yes"){
									new Ajax.Request("/desktop/delete_document", { 
										method: "POST",
										parameters: {id:record.data.id,userid:currentUser.id},
										onComplete:	 function(request) {
											Ext.getCmp('com_document_grid').store.load();

										}
									});
								}else{
									//alert('O,no');
								}

						});

				}},
			{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
			handler: function() {
				var grid  = this.ownerCt.ownerCt;
				//alert(grid);
					var store = grid.getStore(); 
					var records = grid.getSelectionModel().getSelection();
					var data = [];
					Ext.Array.each(records,function(model){
						data.push(Ext.JSON.encode(model.get('id')));
						DispJr(model,false);
					});
				}
			}	,{
					xtype:'button',text:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',tooltip:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',iconCls:'add',
			          handler: function() {
						if (Ext.getCmp('zh_id').value!=undefined){
							size=Ext.getCmp('com_document_grid').store.count();
							if (size>0){	              					  
				              	alert("æ­¤æ¡ˆå·å·²ç»æœ‰å·å†…ç›®å½•ï¼Œä¸èƒ½ä»¥æ¨¡æ¿æ–¹å¼è¿›è¡Œå¢åŠ å·å†…ç›®å½•ã€‚");
							}else{					
								DispJr_model(Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
							}
						}else
						{
							alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
						}		              
				 	}
				}

		],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						DispJr(r,false);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'ç¼–ç ”ç±»-ç»„ç»‡æœºæ„æ²¿é©æ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						
						if(add_new==false || add_new=='3'){
							new Ajax.Request("/desktop/update_flow", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									if (request.responseText=='success'){
										alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");
										Ext.getCmp('archive_grid').store.load();
										Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
									}
									
								}
							});
						}else{
							new Ajax.Request("/desktop/insert_archive", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
										Ext.getCmp('archive_grid').store.load();
										//Ext.getCmp('archive_tree').store.load();
										Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
									}
									
								}
							});
						}
					}
				},
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				region: 'south',
				iconCls:'icon-grid',
				layout: 'fit',
				height: 150,
				split: true,
				collapsible: true,
				title: 'å·å†…ç›®å½•',
				items: documentGrid

			},{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'æœºæ„åç§°',
						name: 'jgmc',
						id: 'zh_jgmc',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 10
	                },
	                {
	                    xtype: 'textareafield',
	                    height: 80,
	                    width: 655,
	                    fieldLabel: 'ç»„ç»‡ç³»ç»Ÿ é¢†å¯¼æˆå‘˜ ç»„æˆ',
						name: 'zzzc',
						id: 'zh_zzzc',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 80
	                },
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'èµ·æ­¢å¹´æœˆ',
						name: 'qzny',
						id: 'zh_qzny',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 45
	                },
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'å¤‡ æ³¨',
						name: 'bz',
						id: 'zh_bz',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 175
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'zh_qzh',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'zh_dalb',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'zh_id',
	                    x: 10,
	                    y: 190
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		
		Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
		ss=title.split('_');
		Ext.getCmp('zh_dalb').setValue(ss[1]);		
		Ext.getCmp('zh_qzh').setValue(ss[0]);
		
		
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};
var DispAj_by_dsj = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
		tbar:[
			{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
				handler: function() {
					var grid = Ext.getCmp('archive_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];
					DispJr(record,true);

				}
			},
			{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
				handler: function() {

					var grid = Ext.getCmp('com_document_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];

					var pars="id="+record.data.id;
					Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
								if(id=="yes"){
									new Ajax.Request("/desktop/delete_document", { 
										method: "POST",
										parameters: {id:record.data.id,userid:currentUser.id},
										onComplete:	 function(request) {
											Ext.getCmp('com_document_grid').store.load();

										}
									});
								}else{
									//alert('O,no');
								}

						});

				}},
			{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
			handler: function() {
				var grid  = this.ownerCt.ownerCt;
				//alert(grid);
					var store = grid.getStore(); 
					var records = grid.getSelectionModel().getSelection();
					var data = [];
					Ext.Array.each(records,function(model){
						data.push(Ext.JSON.encode(model.get('id')));
						DispJr(model,false);
					});
				}
			}	,{
					xtype:'button',text:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',tooltip:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',iconCls:'add',
			          handler: function() {
						if (Ext.getCmp('zh_id').value!=undefined){
							size=Ext.getCmp('com_document_grid').store.count();
							if (size>0){	              					  
				              	alert("æ­¤æ¡ˆå·å·²ç»æœ‰å·å†…ç›®å½•ï¼Œä¸èƒ½ä»¥æ¨¡æ¿æ–¹å¼è¿›è¡Œå¢åŠ å·å†…ç›®å½•ã€‚");
							}else{					
								DispJr_model(Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
							}
						}else
						{
							alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
						}		              
				 	}
				}

		],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						DispJr(r,false);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'ç¼–ç ”ç±»-å¤§äº‹è®°æ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						
						if(add_new==false || add_new=='3'){
							new Ajax.Request("/desktop/update_flow", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									if (request.responseText=='success'){
										alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");
										Ext.getCmp('archive_grid').store.load();
										Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
									}
									
								}
							});
						}else{
							new Ajax.Request("/desktop/insert_archive", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
										Ext.getCmp('archive_grid').store.load();
										////Ext.getCmp('archive_tree')//Ext.getCmp('archive_tree').store.load();
										Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
									}
									
								}
							});
						}
					}
				},
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				region: 'south',
				iconCls:'icon-grid',
				layout: 'fit',
				height: 150,
				split: true,
				collapsible: true,
				title: 'å·å†…ç›®å½•',
				items: documentGrid

			},{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
	                    xtype: 'textareafield',
	                    height: 35,
	                    width: 655,
	                    fieldLabel: 'åœ° ç‚¹',
						name: 'dd',
						id: 'zh_dd',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 70
	                },
	                {
	                    xtype: 'textfield',
	                    width: 320,
	                    fieldLabel: 'è®°å½•äºº',
						name: 'jlr',
						id: 'zh_jlr',
	                    labelWidth: 60,
	                    x: 345,
	                    y: 10
	                },
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'ææ–™æ¥æº',
						name: 'clly',
						id: 'zh_clly',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 40
	                },
	                {
	                    xtype: 'datefield',
						format: 'Y-m-d',
	                    width: 160,
	                    fieldLabel: 'å‘ç”Ÿæ—¥æœŸ',
						name: 'fsrq',
						id: 'zh_fsrq',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 10
	                },
	                {
	                    xtype: 'datefield',format: 'Y-m-d',
	                    width: 165,
	                    fieldLabel: 'è®°å½•æ—¥æœŸ',
						name: 'jlrq',
						id: 'zh_jlrq',
	                    labelWidth: 60,
	                    x: 175,
	                    y: 10
	                },
	                {
	                    xtype: 'textareafield',
	                    height: 35,
	                    width: 655,
	                    fieldLabel: 'äºº ç‰©',
						name: 'rw',
						id: 'zh_rw',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 115
	                },
	                {
	                    xtype: 'textareafield',
	                    height: 35,
	                    width: 655,
	                    fieldLabel: 'äº‹ ç”±',
						name: 'sy',
						id: 'zh_sy',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 160
	                },
	                {
	                    xtype: 'textareafield',
	                    height: 35,
	                    width: 655,
	                    fieldLabel: 'å›  æœ',
						name: 'yg',
						id: 'zh_yg',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 205
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'zh_qzh',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'zh_dalb',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'zh_id',
	                    x: 10,
	                    y: 190
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		
		Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
		ss=title.split('_');
		Ext.getCmp('zh_dalb').setValue(ss[1]);		
		Ext.getCmp('zh_qzh').setValue(ss[0]);
		
		
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};
var DispAj_by_qzsm = function(record,add_new,title){
	var win = Ext.getCmp('archive_detail_win');
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'id',		type: 'integer'},
				{name: 'tm',		type: 'string'},
				{name: 'sxh',		type: 'string'},
				{name: 'yh',		type: 'string'},
				{name: 'wh',		type: 'string'},
				{name: 'zrz',		type: 'string'},
				{name: 'rq',		type: 'string',	 type: 'date',	dateFormat: 'Y-m-d H:i:s'},
				{name: 'bz',		type: 'string'},
				{name: 'dh',		type: 'string'},
				{name: 'ownerid',		type: 'integer'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_document',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		//id: title,
		id : 'com_document_grid',
		store: com_document_store,
		tbar:[
			{xtype:'button',text:'æ·»åŠ ',tooltip:'æ·»åŠ å·å†…ç›®å½•',id:'jradd',iconCls:'add',
				handler: function() {
					var grid = Ext.getCmp('archive_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];
					DispJr(record,true);

				}
			},
			{xtype:'button',text:'åˆ é™¤',tooltip:'åˆ é™¤å·å†…ç›®å½•',id:'jrdelete',iconCls:'remove',
				handler: function() {

					var grid = Ext.getCmp('com_document_grid');
					var records = grid.getSelectionModel().getSelection();
					var record = records[0];

					var pars="id="+record.data.id;
					Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æ¡£å·ä¸ºï¼šï¼"+record.data.dh+";é¡ºåºå·ä¸ºï¼š"+record.data.sxh+"å·å†…ç›®å½•ï¼Ÿ",function callback(id){
								if(id=="yes"){
									new Ajax.Request("/desktop/delete_document", { 
										method: "POST",
										parameters: {id:record.data.id,userid:currentUser.id},
										onComplete:	 function(request) {
											Ext.getCmp('com_document_grid').store.load();

										}
									});
								}else{
									//alert('O,no');
								}

						});

				}},
			{xtype:'button',text:'ä¿®æ”¹',tooltip:'æ˜¾ç¤ºæˆ–ä¿®æ”¹å·å†…ç›®å½•',id:'jrsave',iconCls:'option',
			handler: function() {
				var grid  = this.ownerCt.ownerCt;
				//alert(grid);
					var store = grid.getStore(); 
					var records = grid.getSelectionModel().getSelection();
					var data = [];
					Ext.Array.each(records,function(model){
						data.push(Ext.JSON.encode(model.get('id')));
						DispJr(model,false);
					});
				}
			}	,{
					xtype:'button',text:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',tooltip:'ä»¥æ¨¡æ¿æ–¹å¼å¢åŠ å·å†…ç›®å½•',iconCls:'add',
			          handler: function() {
						if (Ext.getCmp('zh_id').value!=undefined){
							size=Ext.getCmp('com_document_grid').store.count();
							if (size>0){	              					  
				              	alert("æ­¤æ¡ˆå·å·²ç»æœ‰å·å†…ç›®å½•ï¼Œä¸èƒ½ä»¥æ¨¡æ¿æ–¹å¼è¿›è¡Œå¢åŠ å·å†…ç›®å½•ã€‚");
							}else{					
								DispJr_model(Ext.getCmp('zh_id').value,Ext.getCmp('zh_dh').value,true);
							}
						}else
						{
							alert("è¯·å…ˆä¿å­˜æ¡ˆå·å†è¿›è¡Œå·å†…çš„æ–°å¢ã€‚");
						}		              
				 	}
				}

		],
		columns: [
			{ text : 'id',	width : 0, sortable : true, dataIndex: 'id'},
			{ text : 'æ¡£å·',	width : 75, sortable : true, dataIndex: 'dh'},
			{ text : 'é¡ºåºå·',	 width : 30, sortable : true, dataIndex: 'sxh'},
			{ text : 'æ–‡å·',	width : 105, sortable : true, dataIndex: 'wh'},
			{ text : 'è´£ä»»è€…',	 width : 75, sortable : true, dataIndex: 'zrz'},
			{ text : 'é¢˜å',	width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'é¡µå·',	width : 75, sortable : true, dataIndex: 'yh'},

			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d')},
			{ text : 'å¤‡æ³¨',	width : 75, sortable : true, dataIndex: 'bz'},
			{ text : 'ownerid',	 flex : 1, sortable : true, dataIndex: 'ownerid'}
			],
		listeners:{
				itemdblclick:{
					fn:function(v,r,i,n,e,b){
						var tt=r.get("zrq");
						//showContactForm();
						DispJr(r,false);
						//alert(tt);
					}
				}
			},
		//width : 800,
		//height : 300,
		viewConfig: {
			stripeRows:true
		}
	});
	if (win==null) {
		win = new Ext.Window({
			id : 'archive_detail_win',
			title: 'ç¼–ç ”ç±»-å…¨å®—è¯´æ˜æ¡ˆå·è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 688,
			height: 450,
			minHeight: 450,
			layout: 'border',
			modal: true,
			plain: true,
			buttons:[{
					xtype: 'button',
					cls: 'change',
					id:'button_aj_add',
					text:'ä¿®æ”¹ä¿å­˜',
					handler: function() {
						var pars=Ext.getCmp('daglaj_form').getForm().getValues();
						
						if(add_new==false || add_new=='3'){
							new Ajax.Request("/desktop/update_flow", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									if (request.responseText=='success'){
										alert("æ¡ˆå·ä¿®æ”¹æˆåŠŸã€‚");
										Ext.getCmp('archive_grid').store.load();
										Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿®æ”¹ã€‚"+request.responseText);
									}
									
								}
							});
						}else{
							new Ajax.Request("/desktop/insert_archive", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									responseT=request.responseText.split(':');
									if (responseT[0]=='success'){
										alert("æ¡ˆå·æ–°å¢æˆåŠŸã€‚");
										Ext.getCmp('archive_grid').store.load();
										//Ext.getCmp('archive_tree').store.load();
										Ext.getCmp('archive_detail_win').close();												
									}else{
										alert("æ¡ˆå·æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
									}
									
								}
							});
						}
					}
				},
				{
					xtype: 'button',
					cls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						//this.up('window').hide();
						Ext.getCmp('archive_detail_win').close();
					}
				}],
			items: [{
				region: 'south',
				iconCls:'icon-grid',
				layout: 'fit',
				height: 150,
				split: true,
				collapsible: true,
				title: 'å·å†…ç›®å½•',
				items: documentGrid

			},{
				width: 688,
				height: 256,
				region: 'center',
				xtype:'form',
				layout: 'absolute',
				id : 'daglaj_form',
				items: [
	                {
	                    xtype: 'textfield',
	                    width: 475,
	                    fieldLabel: 'ç›® å½• å·',
						name: 'mlh',
						id: 'zh_mlh',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 10
	                },
	                {
	                    xtype: 'textareafield',
	                    height: 105,
	                    width: 655,
	                    fieldLabel: 'å…¨å®—æ„æˆè€…ç®€ä»‹',
						name: 'qzgczjj',
						id: 'zh_qzgczjj',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 45
	                },
	                {
	                    xtype: 'textfield',
	                    width: 655,
	                    fieldLabel: 'å¤‡ æ³¨',
						name: 'bz',
						id: 'zh_bz',
	                    labelWidth: 60,
	                    x: 10,
	                    y: 165
	                },
	                {
	                    xtype: 'datefield',format: 'Y-m-d',
	                    width: 170,
	                    fieldLabel: 'æ—¶é—´',
						name: 'sj',
						id: 'zh_sj',
	                    labelWidth: 60,
	                    x: 495,
	                    y: 10
	                },
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'qzh',
						id: 'zh_qzh',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'dalb',
						id: 'zh_dalb',
	                    x: 10,
	                    y: 190
	                },
	                {
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'id',
						id: 'zh_id',
	                    x: 10,
	                    y: 190
	                }		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
	            ]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('daglaj_form').getForm().setValues(record.data);
		com_document_store.proxy.extraParams.query=record.data.id;
		com_document_store.load();
		
	}else{
		
		Ext.getCmp('button_aj_add').text="æ–°å¢ä¿å­˜";
		ss=title.split('_');
		Ext.getCmp('zh_dalb').setValue(ss[1]);		
		Ext.getCmp('zh_qzh').setValue(ss[0]);
		
		
		
	}
	//è®¾ç½®æ•°æ®
	
	win.show();
};

//å€Ÿé˜…ç»Ÿè®¡çª—å£
var jytj = function(){
	var win = Ext.getCmp('jytj_win');
	var tjlb='';
	Ext.regModel('com_document_model', {
		fields: [
				{name: 'xh',		type: 'integer'},
				{name: 'jydw',		type: 'string'},
				{name: 'tm',		type: 'string'},
				{name: 'lymd',		type: 'string'},
				{name: 'jh',		type: 'string'},
				{name: 'jyr',		type: 'string'},
				{name: 'rq',		type: 'string'},
				{name: 'ghrq',		type: 'string'},
				{name: 'zjlr',		type: 'string'}
		]
	});

	var com_document_store = Ext.create('Ext.data.Store', {
		model : 'com_document_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_jytj',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var documentGrid = new Ext.grid.GridPanel({
		id : 'jytj_grid',
		store: com_document_store,		
		columns: [
			{ text : 'åºå·',	width : 20, sortable : true, dataIndex: 'xh'},
			{ text : 'æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'rq'},
			{ text : 'å€Ÿé˜…å•ä½',	width : 175, sortable : true, dataIndex: 'jydw'},
			{ text : 'æ¡ˆå·æ ‡é¢˜',	 width : 175, sortable : true, dataIndex: 'tm'},
			{ text : 'åˆ©ç”¨ç›®çš„',	width : 105, sortable : true, dataIndex: 'lymd'},
			{ text : 'å·å·',	 width : 75, sortable : true, dataIndex: 'jh'},
			{ text : 'å€Ÿé˜…äºº',	width : 175, sortable : true, dataIndex: 'jyr'},
			{ text : 'å½’è¿˜æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'ghrq'},
			{ text : 'è¯ä»¶å†…å®¹',	width : 75, sortable : true, dataIndex: 'zjlr'}
			],
		viewConfig: {
			stripeRows:true
		}
	});
	Ext.regModel('tj_model', {
		fields: [
				{name: 'qrq',		type: 'string'},
				{name: 'zrq',		type: 'string'},
				{name: 'jyrc',		type: 'string'},
				{name: 'jyjc',		type: 'string'},
				{name: 'bsxz',		type: 'string'},
				{name: 'gzkc',		type: 'string'},
				{name: 'xsyj',		type: 'string'},
				{name: 'jjjs',		type: 'string'},
				{name: 'xcjy',		type: 'string'},
				{name: 'qt',		type: 'string'},
				{name: 'fyys',		type: 'string'},
				{name: 'zcys',		type: 'string'}
		]
	});

	var tj_store = Ext.create('Ext.data.Store', {
		model : 'tj_model',
		proxy: {
			type: 'ajax',
			url : '/desktop/get_jytj',
			extraParams: {query:""},
			reader: {
				type: 'json',
				root: 'rows',
				totalProperty: 'results'
			}
		}
	});

	var tjGrid = new Ext.grid.GridPanel({
		id : 'tj_grid',
		store: tj_store,
		//layout:'fit',
		//height:150,	
		//width:300,	
		columns: [
			{ text : 'èµ·æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'qrq'},
			{ text : 'æ­¢æ—¥æœŸ',	width : 75, sortable : true, dataIndex: 'zrq'},
			{ text : 'å€Ÿé˜…äººæ¬¡',	width : 75, sortable : true, dataIndex: 'jyrc'},
			{ text : 'å€Ÿé˜…å·æ¬¡',	 width : 75, sortable : true, dataIndex: 'jyjc'},
			{ text : 'ç¼–å²ä¿®å¿—',	width : 75, sortable : true, dataIndex: 'bsxz'},
			{ text : 'å·¥ä½œè€ƒæŸ¥',	 width : 75, sortable : true, dataIndex: 'gzkc'},
			{ text : 'å­¦æœ¯ç ”ç©¶',	width : 75, sortable : true, dataIndex: 'xsyj'},
			{ text : 'ç»æµå»ºè®¾',	width : 75, sortable : true, dataIndex: 'jjjs'},
			{ text : 'å®£ä¼ æ•™è‚²',	width : 75, sortable : true, dataIndex: 'xcjy'},
			{ text : 'å…¶å®ƒ',	width : 75, sortable : true, dataIndex: 'qt'},
			{ text : 'å¤å°é¡µæ•°',	width : 75, sortable : true, dataIndex: 'fyys'},
			{ text : 'æ‘˜æŠ„é¡µæ•°',	width : 75, sortable : true, dataIndex: 'zcys'}
			],
		viewConfig: {
			stripeRows:true
		}
	});
	function get_jytj_grid(zt) {		
			if (Ext.getCmp('tj_qrq').rawValue=='' || Ext.getCmp('tj_zrq').rawValue==''){
				alert("èµ·æ—¥æœŸæˆ–æ­¢æ—¥æœŸä¸èƒ½ä¸ºç©ºï¼Œè¯·é€‰æ‹©ã€‚");
			}else{
				tjlb=zt;
				Ext.getCmp('jytj_grid').setVisible(true); 
				Ext.getCmp('tj_grid').setVisible(false);
				com_document_store.proxy.extraParams.query=zt;
				com_document_store.proxy.extraParams.qrq=Ext.getCmp('tj_qrq').rawValue;
				com_document_store.proxy.extraParams.zrq=Ext.getCmp('tj_zrq').rawValue;
				com_document_store.proxy.extraParams.jyr=Ext.getCmp('tj_jyr').value;
				com_document_store.proxy.extraParams.jydw=Ext.getCmp('tj_jydw').value;
	            com_document_store.load();
			};			
    };
	function print_jytj(zt) {		
			if (Ext.getCmp('tj_qrq').rawValue=='' || Ext.getCmp('tj_zrq').rawValue==''){
				alert("èµ·æ—¥æœŸæˆ–æ­¢æ—¥æœŸä¸èƒ½ä¸ºç©ºï¼Œè¯·é€‰æ‹©ã€‚");
			}else{				
				new Ajax.Request("/desktop/dajy_print", { 
					method: "POST",
					parameters: eval("({query:'" + zt + "',qrq:'" + Ext.getCmp('tj_qrq').rawValue + "',zrq:'" + Ext.getCmp('tj_zrq').rawValue + "',jyr:'" + Ext.getCmp('tj_jyr').rawValue + "',jydw:'" + Ext.getCmp('tj_jydw').rawValue + "'})"),
					onComplete:	 function(request) {
						fhz=request.responseText.split(":");
						if (fhz[0]=='success'){
						   // printfile=fhz[1].split(",");
						   // for (k=0;k<printfile.length;k++){
						   //   	LODOP=getLodop(document.getElementById('LODOP'),document.getElementById('LODOP_EM')); 
						   //   	image_path = window.location.href + "assets/dady/tmp1/" + printfile[k];
						   //   	LODOP.PRINT_INIT(image_path);
						   //   	if (zt=='4'){
						   //   		LODOP.SET_PRINT_PAGESIZE(1,0,0,"A4");
						   //   	}else{
						   // 		LODOP.SET_PRINT_PAGESIZE(2,0,0,"A4");
						   //   	}
				           //   	LODOP.ADD_PRINT_IMAGE(0,0,1000,1410,"<img border='0' src='"+image_path+"' width='100%' height='100%'/>");
				           //   	LODOP.SET_PRINT_STYLEA(0,"Stretch",2);//(å¯å˜å½¢)æ‰©å±•ç¼©æ”¾æ¨¡å¼
				           //   	LODOP.SET_PRINT_MODE("PRINT_PAGE_PERCENT","Full-Page");
				           //   	//LODOP.PREVIEW();
						   //   	LODOP.PRINT();
						   // }
						   // alert("æ‰“å°æˆåŠŸã€‚"+fhz[1] );	
							window.open(fhz[1],'','height=500,width=800,top=150, left=100,scrollbars=yes,status=yes');											
						}else{
							alert(request.responseText);
						}						
					}
				});
			};			
    };

	if (win==null) {
		win = new Ext.Window({
			id : 'jytj_win',
			title: 'æ¡£æ¡ˆåˆ©ç”¨ç»Ÿè®¡',
			//closeAction: 'hide',
			width: 579,
			height: 350,
			minHeight: 350,
			layout: 'border',
			modal: true,
			plain: true,
			bbar:[
				{
					xtype: 'button',
					iconCls: 'hd',
					text:'æ¬ æ¡£æ¸…å•',
					handler: function() {
						get_jytj_grid('1');						
					}
				},
				{
					xtype: 'button',
					iconCls: 'hd',
					text:'å·²è¿˜æ¡£æ¸…å•',
					handler: function() {
						get_jytj_grid('2');	
					}
				},
				{
					xtype: 'button',
					iconCls: 'xjhd',
					text:'å€Ÿé˜…ç™»è®°æµè§ˆ',
					handler: function() {
						get_jytj_grid('3');	
					}
				},
			   // {
			   // 	xtype: 'button',
			   // 	iconCls: 'xjhd',
			   // 	text:'æ¡£æ¡ˆåˆ©ç”¨æ•ˆæœ',
			   // 	handler: function() {
			   // 		Ext.getCmp('jytj_win').close();
			   // 	}
			   // },
				{
					xtype: 'button',
					iconCls: 'tj',
					text:'ç»Ÿè®¡æ±‡æ€»',
					handler: function() {
						Ext.getCmp('jytj_grid').setVisible(false); 
						Ext.getCmp('tj_grid').setVisible(true);
						tjlb='4';	
						Ext.getCmp('tj_grid').setHeight(160);
						Ext.getCmp('tj_grid').setWidth(579);						
						tj_store.proxy.extraParams.query=tjlb;
						tj_store.proxy.extraParams.qrq=Ext.getCmp('tj_qrq').rawValue;
						tj_store.proxy.extraParams.zrq=Ext.getCmp('tj_zrq').rawValue;
						tj_store.proxy.extraParams.jyr=Ext.getCmp('tj_jyr').value;
						tj_store.proxy.extraParams.jydw=Ext.getCmp('tj_jydw').value;
			            tj_store.load();
					}
				},
				{
					xtype: 'button',
					iconCls: 'print',
					text:'æ‰“å°',
					handler: function() {
						if (tjlb!=""){							
							print_jytj(tjlb);	
						}
					}
				},				
				{
					xtype: 'button',
					iconCls: 'exit',
					text:'é€€å‡º',
					handler: function() {
						Ext.getCmp('jytj_win').close();
					}
				}],
			items: [{
				region: 'center',
				iconCls:'icon-grid',
				layout: 'fit',
				height: 150,
				title: 'ç»Ÿè®¡ç»“æœ',
				items: [documentGrid,tjGrid]
			},{
				width: 579,
				height: 95,
				region: 'north',
				split: true,
				collapsible: true,
				title: 'æ¡£æ¡ˆåˆ©ç”¨ç»Ÿè®¡æ¡ä»¶',
				xtype:'form',
				layout: 'absolute',
				items: [
	                {
					    xtype: 'datefield',
                        width: ã€€200,
                        fieldLabel: 'èµ·æ—¥æœŸ',
					 	id:'tj_qrq',
                        labelWidth: 60,
					 	format: 'Y-m-d',
					 	x: 10,
                        y: 10
                    },
                    {
                        xtype: 'datefield',
                        width: ã€€200,
                        fieldLabel: 'æ­¢æ—¥æœŸ',
					 	format: 'Y-m-d',
					 	id:'tj_zrq',
                        labelWidth: 60,
                        x: 10,
                        y: 40
                    },
                    {
                        xtype: 'textfield',
                        width: 310,
                        fieldLabel: 'å€Ÿé˜…äºº',
					 	id:'tj_jyr',
                        labelWidth: 60,
                        x: 230,
                        y: 10
                    },
                    {
                        xtype: 'textfield',
                        width: 310,
                        fieldLabel: 'å€Ÿé˜…å•ä½',
					 	id:'tj_jydw',
                        labelWidth: 60,
                        x: 230,
                        y: 40
                    }
	            ]
			}]
		});
	}	
	win.show();
};


var doc_jgwt_disp = function(record,add_new){
  var win = Ext.getCmp('doc_jgwt_disp_win');

  //qz_store.load();
  if (win==null) {
    win = new Ext.Window({
      id : 'doc_jgwt_disp_win',
      title: 'ä¿®æ”¹æœºæ„é—®é¢˜ä¿¡æ¯',
      //closeAction: 'hide',
      width: 370,
      height: 150,
      //minHeight: 200,
      layout: 'fit',
      modal: true,
      plain: true,
      //items:user_setup_grid,          
      items: [{
        width: 370,
        height: 140,
        xtype:'form',
        layout: 'absolute',
        id : 'doc_jgwt_disp_form',
        items: [
          {
            xtype: 'label',
            text: 'æœºæ„é—®é¢˜å·ï¼š',
            x: 10,
            y: 10,
            width: 100
          },
          {
            xtype: 'label',
            text: 'æœºæ„é—®é¢˜åç§°ï¼š',
            x: 10,
            y: 40,
            width: 100
          },
          {
            xtype: 'textfield',
            hidden : true,
            name : 'id' ,
            id:'doc_jgwt_id'                    
          },
		{
            xtype: 'textfield',
            hidden : true,
            name : 'userid' ,
            id:'userid'                    
          },
          {
            xtype: 'textfield',
            x: 130,
            y: 10,
            width: 200,
            name: 'jgwth',
            id:'doc_jgwt_jgwth'
          },
          {
            xtype: 'textfield',
            x: 130,
            y: 40,
            width: 200,
            name: 'jgwtmc',
            id:'doc_jgwt_jgwtmc'
          }
        ],
        buttons:[{
            xtype: 'button',
            iconCls: 'option',
            id:'button_doc_jgwt_add',
            text:'ä¿®æ”¹',
            handler: function() {
              var pars=this.up('panel').getForm().getValues();
              if(pars['jgwth']!=''){
                if(pars['jgwtmc']!=''){
                  if(add_new==false){
                    new Ajax.Request("/desktop/update_doc_jgwt", { 
                      method: "POST",
                      parameters: pars,
                      onComplete:  function(request) {
                        text=request.responseText.split(':');
                        if (request.responseText=='success'){

                          Ext.getCmp('doc_jgwt_disp_win').close();

                          Ext.getCmp('doc_jgwt_setup_grid').store.url='/desktop/get_doc_jgwt_grid';
                          Ext.getCmp('doc_jgwt_setup_grid').store.load();
                        }else{
                          if (text[0]=='false'){
                            alert(text[1]);
                          }else{
                            alert("ä¿®æ”¹å¤±è´¥ã€‚");
                          }
                        }

                      }
                    });
                  }else{
                    new Ajax.Request("/desktop/insert_doc_jgwt", { 
                      method: "POST",
                      parameters: pars,
                      onComplete:  function(request) {
                        text=request.responseText.split(':');
                        if (text[0]=='success'){

                          Ext.getCmp('doc_jgwt_disp_win').close();
                          Ext.getCmp('doc_jgwt_setup_grid').store.url='/desktop/get_doc_jgwt_grid';
                          Ext.getCmp('doc_jgwt_setup_grid').store.load();
                        }else{
                          if (text[0]=='false'){
                            alert(text[1]);
                          }else{
                            alert("æ–°å¢å¤±è´¥ã€‚");
                          }
                        }
                      }
                    });
                  }
                }else{
                  alert("æœºæ„é—®é¢˜åç§°ä¸èƒ½ä¸ºç©ºã€‚");
                }
              }else{
                alert("æœºæ„é—®é¢˜å·ä¸èƒ½ä¸ºç©ºã€‚");
              }
            }
          },
          {
            xtype: 'button',
            iconCls: 'exit',
            text:'é€€å‡º',
            handler: function() {
              //this.up('window').hide();
              Ext.getCmp('doc_jgwt_disp_win').close();
            }
          }]
      }]

    });
  }
	Ext.getCmp('userid').setValue(currentUser.id);
  if(add_new==false){
  //è®¾ç½®æ•°æ®
    Ext.getCmp('doc_jgwt_disp_form').getForm().setValues(record.data);

  }else{
    Ext.getCmp('doc_jgwt_disp_win').title="æ–°å¢æœºæ„é—®é¢˜ä¿¡æ¯";
    Ext.getCmp('button_doc_jgwt_add').text="æ–°å¢";
    Ext.getCmp('button_doc_jgwt_add').iconCls="add";
  }

  win.show();
};

var doc_jgwt_setup = function(){
  var win = Ext.getCmp('doc_jgwt_setup_win');

  Ext.regModel('doc_jgwt_setup_model', {
    fields: [
      {name: 'id',    type: 'integer'},
      {name: 'jgwth',    type: 'string'},
      {name: 'jgwtmc',    type: 'string'}

    ]
  });

  var doc_jgwt_setup_store = Ext.create('Ext.data.Store', {
    id:'doc_jgwt_setup_store',
    model : 'doc_jgwt_setup_model',
    autoLoad: true,
    proxy: {
      type: 'ajax',
      url : '/desktop/get_doc_jgwt_grid',
      //extraParams: cx_tj,
      reader: {
        type: 'json',
        root: 'rows',
        totalProperty: 'results'
      }
    }
    //sortInfo:{field: 'level4', direction: "ASC"},
    //baseParams: {start:0, limit:25, query:""}
  });
  var doc_jgwt_setup_grid = new Ext.grid.GridPanel({
    id : 'doc_jgwt_setup_grid',
    store: doc_jgwt_setup_store,        
    columns: [
      { text : 'id',  width : 0, sortable : true, dataIndex: 'id'},
      { text : 'æœºæ„é—®é¢˜å·',  width : 150, sortable : true, dataIndex: 'jgwth'},
      { text : 'æœºæ„é—®é¢˜åç§°',  width : 250, sortable : true, dataIndex: 'jgwtmc'}
      ],
      selType:'checkboxmodel',
      //multiSelect:true,
      listeners:{
        itemdblclick:{
          fn:function(v,r,i,n,e,b){
            var tt=r.get("zrq");

            //DispAj(r,false);
          }
        }
      },

    viewConfig: {
      stripeRows:true
    }
  });
  if (win==null) {
    win = new Ext.Window({
      id : 'doc_jgwt_setup_win',
      title: 'æœºæ„é—®é¢˜è®¾ç½®',
      //closeAction: 'hide',
      width: 670,
      x : 300,
      y : 50,
      height: 500,
      minHeight: 500,
      layout: 'fit',
      modal: true,
      plain: true,
      items:doc_jgwt_setup_grid,          
      tbar:[{
        xtype: 'button',
        iconCls: 'add',
        text:'æ–°å¢',
        handler: function() {
          //this.up('window').hide();

          doc_jgwt_disp("record",true);
        }
      },
      {
        xtype: 'button',
        iconCls: 'option',
        text:'ä¿®æ”¹',
        handler: function() {
          //this.up('window').hide();

          var grid = Ext.getCmp('doc_jgwt_setup_grid');
          var records = grid.getSelectionModel().getSelection();
          if (records.length==1){
            var record = records[0];
            doc_jgwt_disp(record,false);
          }else{
            alert("è¯·é€‰æ‹©ä¸€ä¸ªæœºæ„é—®é¢˜è¿›è¡Œä¿®æ”¹ã€‚");
          }
        }
      },
      {
        xtype: 'button',
        iconCls: 'delete',
        text:'åˆ é™¤',
        handler: function() {
          var grid = Ext.getCmp('doc_jgwt_setup_grid');
          var records = grid.getSelectionModel().getSelection();
          if (records.length==0){
            alert("è¯·é€‰æ‹©ä¸€ä¸ªæœºæ„é—®é¢˜è¿›è¡Œåˆ é™¤ã€‚");

          }else{
            var record = records[0];
            var pars="id="+record.data.id;
            Ext.Msg.confirm("æç¤ºä¿¡æ¯","æ˜¯å¦è¦åˆ é™¤æœºæ„é—®é¢˜åç§°ä¸ºï¼šï¼"+record.data.jgwtmc+"çš„æœºæ„é—®é¢˜ï¼Ÿ",function callback(id){
                  if(id=="yes"){
                    new Ajax.Request("/desktop/delete_doc_jgwt", { 
                      method: "POST",
                      parameters: pars,
                      onComplete:  function(request) {
                        text=request.responseText.split(':');
                        if (request.responseText=='success'){
                          Ext.getCmp('doc_jgwt_setup_grid').store.url='/desktop/get_doc_jgwt_grid';
                          Ext.getCmp('doc_jgwt_setup_grid').store.load();
                        }else{
                          if (text[0]=='false'){
                            alert(text[1]);
                          }else{
                            alert("åˆ é™¤å¤±è´¥ã€‚");
                          }

                        }
                      }
                    });
                  }else{
                    //alert('O,no');
                  }

              }); 
          }
        }
      },
      {
        xtype: 'button',
        iconCls: 'exit',
        text:'é€€å‡º',
        handler: function() {
          //this.up('window').hide();
          Ext.getCmp('doc_jgwt_setup_win').close();
        }
      }]

    });
  }


  win.show();
};  

//æ˜¾ç¤ºå·å†…ç›®å½•çª—å£
var DispJr = function(recordad,add_new,jr_aj_ownerid,jr_dh,aj_add_new){
	var win = Ext.getCmp('document_detail_win');
	if (win==null) {
		win = new Ext.Window({
			id : 'document_detail_win',
			title: 'å·å†…ç›®å½•è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 370,
			height: 400,
			minHeight: 400,
			layout: 'fit',
			modal: true,
			plain: true,
			items: [{
				width: 370,
				height: 400,
				xtype:'form',
				layout: 'absolute',
				id : 'dagljr_form',
				items: [
					{
						xtype: 'label',
						text: 'æ¡£å·',
						x: 10,
						y: 10,
						width: 100
					},
					{
						xtype: 'label',
						text: 'é¡ºåºå·',
						x: 10,
						y: 40,
						width: 100
					},
					{
						xtype: 'label',
						text: 'æ–‡å·',
						x: 10,
						y: 70,
						width: 100
					},
					{
						xtype: 'label',
						text: 'è´£ä»»è€…',
						x: 10,
						y: 100,
						width: 100
					},
					{
						xtype: 'label',
						text: 'é¢˜å',
						x: 10,
						y: 160,
						width: 100
					},
					{
						xtype: 'label',
						text: 'æ—¥æœŸ',
						x: 10,
						y: 190,
						width: 100
					},
					{
						xtype: 'label',
						text: 'é¡µå·',
						x: 10,
						y: 220,
						width: 100
					},
					
					{
						xtype: 'label',
						text: 'å¤‡æ³¨',
						x: 10,
						y: 250,
						width: 100
					},
					{
						xtype: 'textfield',
						hidden : true,
						name : 'id'
						
																	
					},
					{
						xtype: 'textfield',
						hidden : true,
						name : 'ownerid',
						id:'jr_ownerid'											
					},
					{
						xtype: 'textfield',
						x: 130,
						y: 10,
						width: 200,
						name: 'dh',
						id:'jr_dh',
					
						readonly:true
					},
					{
						xtype: 'textfield',
						x: 130,
						y: 40,
						width: 200,
						id:'jr_sxh',
						name: 'sxh'
					},
					{
						xtype: 'textfield',
						x: 130,
						y: 70,
						width: 200,
						id:'jr_wh',
						name: 'wh'
					},
					{
						xtype: 'textfield',
						x: 130,
						y: 100,
						width: 200,
						id:'jr_zrz',
						name: 'zrz'
					},
					{
						xtype: 'textarea',
						x: 130,
						y: 130,
						width: 200,
						name: 'tm',
						id:'jr_tm',
						height:50
					},
					
					{
						xtype: 'datefield',
						format: 'Y-m-d',
						x: 130,
						y: 190,
						width: 200,
						id:'jr_rq',
						name: 'rq'
					},
					{
						xtype: 'textfield',
						x: 130,
						y: 220,
						width: 200,
						id:'jr_yh',
						name: 'yh'
					},
					
					{
						xtype: 'textarea',
						x: 130,
						y: 250,
						width: 200,
						name: 'bz',
						id:'jr_bz',
						height: 80
					}		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
				],
				buttons:[{
						xtype: 'button',
						cls: 'contactBtn',
						id:'button_jr_add',
						text:'ä¿®æ”¹',
						handler: function() {
							var pars=this.up('panel').getForm().getValues();
							if(add_new==false){
								new Ajax.Request("/desktop/update_document", { 
									method: "POST",
									parameters: pars,
									onComplete:	 function(request) {
										fhz=request.responseText.split(":");
										if (fhz[0]=='success'){
											alert("å·å†…ä¿®æ”¹æˆåŠŸã€‚");
											if (aj_add_new==true){
												if (add_new==true){
													Ext.getCmp('com_document_grid').store.proxy.extraParams.query=jr_aj_ownerid;
												};
												Ext.getCmp('com_document_grid').store.load();	
											}else
											{
												Ext.getCmp('document_grid').store.load();
											};
											Ext.getCmp('document_detail_win').close();											
										}else{
											if (fhz[0]=='false')
											{
												alert(fhz[1]);
											}else
											{
												alert("å·å†…ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
											}
										}
									}
								});}
							else{
								new Ajax.Request("/desktop/insert_document", { 
									method: "POST",
									parameters: pars,
									onComplete:	 function(request) {
										fhz=request.responseText.split(":");
										if (fhz[0]=='success'){
											alert("å·å†…æ–°å¢æˆåŠŸã€‚");
											if (aj_add_new==true){
												if (add_new==true){
													Ext.getCmp('com_document_grid').store.proxy.extraParams.query=jr_aj_ownerid;
												};
												Ext.getCmp('com_document_grid').store.load();	
											}else
											{
												Ext.getCmp('document_grid').store.load();
											};
											Ext.getCmp('document_detail_win').close();										
										}else{
											if (fhz[0]=='false')
											{
												alert(fhz[1]);
											}else
											{
												alert("å·å†…æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
											}
										}
										
									}
								});
							}
						}
					},
					{
						xtype: 'button',
						cls: 'contactBtn',
						text:'é€€å‡º',
						handler: function() {
							//this.up('window').close();
							if (aj_add_new==true){
								if (add_new==true){
									Ext.getCmp('com_document_grid').store.proxy.extraParams.query=jr_aj_ownerid;
								};
								Ext.getCmp('com_document_grid').store.load();	
							}else
							{
								Ext.getCmp('document_grid').store.load();
							};					
							Ext.getCmp('document_detail_win').close();
						}
					}]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	Ext.getCmp('jr_dh').readOnly=true;
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('dagljr_form').getForm().setValues(recordad.data);
		Ext.getCmp('jr_rq').Value=(recordad.data.rq);
	}else{
		
		Ext.getCmp('button_jr_add').text="æ–°å¢ä¿å­˜";
		
		if (jr_dh!=undefined){
			Ext.getCmp('jr_dh').setValue(jr_dh);
			pars= {dh:jr_dh};
		}else{
			Ext.getCmp('jr_dh').setValue(recordad.data.dh);
			pars= {dh:recordad.data.dh};
		};
		if (jr_aj_ownerid!=undefined){
			Ext.getCmp('jr_ownerid').setValue(jr_aj_ownerid);
		}else{
			Ext.getCmp('jr_ownerid').setValue(recordad.data.id);
		};
	
		new Ajax.Request("/desktop/get_max_sxh", { 
		    	method: "POST",
		    	parameters: pars,
		    	onComplete:	 function(request) {
		    		Ext.getCmp('jr_sxh').setValue(request.responseText);
		     	}
		     });
		
		Ext.getCmp('jr_sxh').setValue("");
		Ext.getCmp('jr_tm').setValue("");
		Ext.getCmp('jr_wh').setValue("");
		Ext.getCmp('jr_zrz').setValue("");
		Ext.getCmp('jr_yh').setValue("");
		Ext.getCmp('jr_rq').setValue("");
		Ext.getCmp('jr_bz').setValue("");
	}
	win.show();
};

var DispJr_zp = function(recordad,add_new,jr_aj_ownerid,jr_dh,aj_add_new){
	var win = Ext.getCmp('document_detail_win');
	if (win==null) {
		win = new Ext.Window({
			id : 'document_detail_win',
			title: 'ç…§ç‰‡å·å†…ç›®å½•è¯¦ç»†ä¿¡æ¯',
			//closeAction: 'hide',
			width: 370,
			height: 500,
			minHeight: 500,
			layout: 'fit',
			modal: true,
			plain: true,
			items: [{
				width: 370,
				height: 400,
				xtype:'form',
				layout: 'absolute',
				id : 'dagljr_form',
				items: [
					{
						xtype: 'label',
						text: 'æ¡£å·',
						x: 10,
						y: 10,
						width: 100
					},
					{
						xtype: 'label',
						text: 'ç…§ç‰‡å·',
						x: 10,
						y: 40,
						width: 100
					},
					{
						xtype: 'label',
						text: 'æ‹æ‘„è€…',
						x: 10,
						y: 70,
						width: 100
					},
					{
						xtype: 'label',
						text: 'äº‹ç”±',
						x: 10,
						y: 100,
						width: 100
					},
					{
						xtype: 'label',
						text: 'åœ°ç‚¹',
						x: 10,
						y: 130,
						width: 100
					},
					{
						xtype: 'label',
						text: 'äººç‰©',
						x: 10,
						y: 160,
						width: 100
					},
					{
						xtype: 'label',
						text: 'èƒŒæ™¯',
						x: 10,
						y: 190,
						width: 100
					},
					{
						xtype: 'label',
						text: 'é¢˜å',
						x: 10,
						y: 220,
						width: 100
					},
					{
						xtype: 'label',
						text: 'æ—¥æœŸ',
						x: 10,
						y: 290,
						width: 100
					},
					{
						xtype: 'label',
						text: 'é¡µå·',
						x: 10,
						y: 320,
						width: 100
					},
					
					{
						xtype: 'label',
						text: 'å¤‡æ³¨',
						x: 10,
						y: 350,
						width: 100
					},
					{
						xtype: 'textfield',
						hidden : true,
						name : 'id'
						
																	
					},
					{
						xtype: 'textfield',
						hidden : true,
						name : 'ownerid',
						id:'jr_ownerid'											
					},
					{
						xtype: 'textfield',
						hidden : true,
						name : 'zpid',
						id:'jr_zpid'											
					},
					{
						xtype: 'textfield',
						x: 130,
						y: 10,
						width: 200,
						name: 'dh',
						id:'jr_dh',
					
						readonly:true
					},
					{
						xtype: 'textfield',
						x: 130,
						y: 40,
						width: 200,
						id:'jr_zph',
						name: 'zph'
					},
					{
						xtype: 'textfield',
						x: 130,
						y: 70,
						width: 200,
						id:'jr_psz',
						name: 'psz'
					},
					{
						xtype: 'textfield',
						x: 130,
						y: 100,
						width: 200,
						id:'jr_sy',
						name: 'sy'
					},
					{
						xtype: 'textfield',
						x: 130,
						y: 130,
						width: 200,
						id:'jr_dd',
						name: 'dd'
					},
					{
						xtype: 'textfield',
						x: 130,
						y: 160,
						width: 200,
						id:'jr_rw',
						name: 'rw'
					},
					{
						xtype: 'textfield',
						x: 130,
						y: 190,
						width: 200,
						id:'jr_bj',
						name: 'bj'
					},
					{
						xtype: 'textarea',
						x: 130,
						y: 220,
						width: 200,
						name: 'tm',
						id:'jr_tm',
						height:60
					},
					
					{
						xtype: 'datefield',
						format: 'Y-m-d',
						x: 130,
						y: 290,
						width: 200,
						id:'jr_psrq',
						name: 'psrq'
					},
					{
						xtype: 'textfield',
						x: 130,
						y: 320,
						width: 200,
						id:'jr_yh',
						name: 'yh'
					},
					
					{
						xtype: 'textarea',
						x: 130,
						y: 350,
						width: 200,
						name: 'bz',
						id:'jr_bz',
						height: 80
					}		,
							{
			                    xtype: 'textfield',
			                    hidden : true,
								name: 'userid',
								id: 'userid',
			                    x: 10,
			                    y: 190
			                }
				],
				buttons:[{
						xtype: 'button',
						cls: 'contactBtn',
						id:'button_jr_add',
						text:'ä¿®æ”¹',
						handler: function() {
							var pars=this.up('panel').getForm().getValues();
							if(add_new==false){
								new Ajax.Request("/desktop/update_document", { 
									method: "POST",
									parameters: pars,
									onComplete:	 function(request) {
										fhz=request.responseText.split(":");
										if (fhz[0]=='success'){
											alert("å·å†…ä¿®æ”¹æˆåŠŸã€‚");
											if (aj_add_new==true){
												if (add_new==true){
													Ext.getCmp('com_document_grid').store.proxy.extraParams.query=jr_aj_ownerid;
												};
												Ext.getCmp('com_document_grid').store.load();	
											}else
											{
												Ext.getCmp('document_grid').store.load();
											};
											Ext.getCmp('document_detail_win').close();											
										}else{
											if (fhz[0]=='false')
											{
												alert(fhz[1]);
											}else
											{
												alert("å·å†…ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
											}
										}
									}
								});}
							else{
								new Ajax.Request("/desktop/insert_document", { 
									method: "POST",
									parameters: pars,
									onComplete:	 function(request) {
										fhz=request.responseText.split(":");
										if (fhz[0]=='success'){
											alert("å·å†…æ–°å¢æˆåŠŸã€‚");
											if (aj_add_new==true){
												if (add_new==true){
													Ext.getCmp('com_document_grid').store.proxy.extraParams.query=jr_aj_ownerid;
												};
												Ext.getCmp('com_document_grid').store.load();	
											}else
											{
												Ext.getCmp('document_grid').store.load();
											};
											Ext.getCmp('document_detail_win').close();										
										}else{
											if (fhz[0]=='false')
											{
												alert(fhz[1]);
											}else
											{
												alert("å·å†…æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
											}
										}
										
									}
								});
							}
						}
					},
					{
						xtype: 'button',
						cls: 'contactBtn',
						text:'é€€å‡º',
						handler: function() {
							//this.up('window').close();
							if (aj_add_new==true){
								if (add_new==true){
									Ext.getCmp('com_document_grid').store.proxy.extraParams.query=jr_aj_ownerid;
								};
								Ext.getCmp('com_document_grid').store.load();	
							}else
							{
								Ext.getCmp('document_grid').store.load();
							};					
							Ext.getCmp('document_detail_win').close();
						}
					}]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	Ext.getCmp('jr_dh').readOnly=true;
	if(add_new==false){
	//è®¾ç½®æ•°æ®
		Ext.getCmp('dagljr_form').getForm().setValues(recordad.data);
		Ext.getCmp('jr_psrq').Value=(recordad.data.psrq);
		
	}else{
		
		Ext.getCmp('button_jr_add').text="æ–°å¢ä¿å­˜";
		
		if (jr_dh!=undefined){
			Ext.getCmp('jr_dh').setValue(jr_dh);
			pars= {dh:jr_dh};
		}else{
			Ext.getCmp('jr_dh').setValue(recordad.data.dh);
			pars= {dh:recordad.data.dh};
		};
		if (jr_aj_ownerid!=undefined){
			Ext.getCmp('jr_ownerid').setValue(jr_aj_ownerid);
		}else{
			Ext.getCmp('jr_ownerid').setValue(recordad.data.id);
		};
	
		new Ajax.Request("/desktop/get_max_sxh", { 
		    	method: "POST",
		    	parameters: pars,
		    	onComplete:	 function(request) {
		    		Ext.getCmp('jr_sxh').setValue(request.responseText);
		     	}
		     });
		
		Ext.getCmp('jr_zph').setValue("");
		Ext.getCmp('jr_tm').setValue("");
		Ext.getCmp('jr_psz').setValue("");
		Ext.getCmp('jr_sy').setValue("");
		Ext.getCmp('jr_dd').setValue("");
		Ext.getCmp('jr_rw').setValue("");
		Ext.getCmp('jr_bj').setValue("");
		Ext.getCmp('jr_yh').setValue("");
		Ext.getCmp('jr_psrq').setValue("");
		Ext.getCmp('jr_bz').setValue("");
	}
	win.show();
};

var DispBkb = function(id){
	var win = Ext.getCmp('bkb_win');
	if (win==null) {
		win = new Ext.Window({
			id : 'bkb_win',
			title: 'å¤‡è€ƒè¡¨',
			//closeAction: 'hide',
			width: 370,
			height: 250,
			minHeight: 300,
			layout: 'fit',
			modal: true,
			plain: true,
			items: [{
				width: 370,
				height: 300,
				xtype:'form',
				layout: 'absolute',
				id : 'dagl_bkb_form',
				items: [
					{
						xtype: 'label',
						text: 'ç«‹å·äºº',
						x: 10,
						y: 10,
						width: 100
					},
					{
						xtype: 'label',
						text: 'æ£€æŸ¥äºº',
						x: 10,
						y: 40,
						width: 100
					},
					{
						xtype: 'label',
						text: 'ç«‹å·æ—¶é—´',
						x: 10,
						y: 70,
						width: 100
					},
					{
						xtype: 'label',
						text: 'æƒ…å†µè¯´æ˜',
						x: 10,
						y: 100,
						width: 100
					},
					
					{
						xtype: 'textfield',
						hidden : true,
						name : 'id'																							
					},
					{
						xtype: 'textfield',
						hidden : true,
						name : 'ownerid',
						id:'bkb_ownerid'											
					},
					{
						xtype: 'textfield',
						x: 130,
						y: 10,
						width: 200,
						name: 'ljr',
						id:'bkb_ljr',
					},
					{
						xtype: 'textfield',
						x: 130,
						y: 40,
						width: 200,
						id:'bkb_jcr',
						name: 'jcr'
					},
					{
						xtype: 'datefield',
						format: 'Y-m-d',
						x: 130,
						y: 70,
						width: 200,
						id:'bkb_ljsj',
						name: 'ljsj'
					},
					{
						xtype: 'textarea',
						x: 130,
						y: 100,
						width: 200,
						name: 'qksm',
						id:'bkb_qksm',
						height:130
					},														
					{
	                    xtype: 'textfield',
	                    hidden : true,
						name: 'userid',
						id: 'userid',
	                    x: 10,
	                    y: 190
	                }
				],
				buttons:[{
						xtype: 'button',
						cls: 'contactBtn',
						id:'button_jr_add',
						text:'ä¿å­˜',
						handler: function() {
							var pars=this.up('panel').getForm().getValues();
							new Ajax.Request("/desktop/save_bkb", { 
								method: "POST",
								parameters: pars,
								onComplete:	 function(request) {
									fhz=request.responseText.split(":");
									if (fhz[0]=='success'){
										alert("ä¿å­˜æˆåŠŸã€‚");	
										Ext.getCmp('bkb_win').close();																			
									}else{
										if (fhz[0]=='false')
										{
											alert(fhz[1]);
										}else
										{
											alert("ä¿å­˜å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
										}
									}
								}
							});
							
						}
					},
					{
						xtype: 'button',
						cls: 'contactBtn',
						text:'é€€å‡º',
						handler: function() {				
							Ext.getCmp('bkb_win').close();
						}
					}]
			}]
		});
	}
	Ext.getCmp('userid').setValue(currentUser.id);
	Ext.getCmp('bkb_ownerid').setValue(id);
	new Ajax.Request("/desktop/get_bkb_byid", { 
	    	method: "POST",
	    	parameters: {ownerid:id,userid:currentUser.id},
	    	onComplete:	 function(request) {
	    		requestdata=eval('(' + request.responseText + ')');						
				Ext.getCmp('dagl_bkb_form').getForm().setValues(requestdata[0]);
				Ext.getCmp('bkb_ljsj').setValue( new Date(requestdata[0]['ljsj'].replace('-','/').replace('-','/')))
	     	}
	});
	win.show();
};

//æ˜¾ç¤ºå·å†…æ¨¡æ¿æ–°å¢çª—å£
var DispJr_model = function(jr_aj_ownerid,jr_dh,aj_add_new){
	var win = Ext.getCmp('document_model_win');
	function formatDate(value){
        return value ? Ext.Date.dateFormat(value, 'M d, Y') : '';
    };
	var com_zrz=[];
	var com_wh=[];
	

	Ext.regModel('jr_model_model', {
        fields: [
          {name: 'wh',    type: 'string'},
          {name: 'zrz',    type: 'string'},
          {name: 'name',    type: 'string'},
          {name: 'rq',   type: 'date', dateFormat: 'Y-m-d'},
          {name: 'yh',    type: 'string'}
        ]
      });

      var jr_model_store = Ext.create('Ext.data.Store', {
        id:'jr_model_store',
        model : 'jr_model_model',
        autoLoad: true,
        proxy: {
          type: 'ajax',
          url : '/desktop/get_jr_modellist_grid',
          extraParams: {query:'1'},
          reader: {
            type: 'json',
            root: 'rows',
            totalProperty: 'results'
          }
        }
        //sortInfo:{field: 'level4', direction: "ASC"},
        //baseParams: {start:0, limit:25, query:""}
      });
		var cellEditing = Ext.create('Ext.grid.plugin.CellEditing', {
	        clicksToEdit: 1
	    });
      var jr_model_grid = new Ext.grid.GridPanel({
        id : 'jr_model_grid',
        store: jr_model_store,        
        columns: [
		{
            xtype: 'checkcolumn',
            header: 'é€‰æ‹©',
            dataIndex: 'indoor',
            width: 40
        },
          { text : 'æ–‡å·',  width : 75, sortable : true, dataIndex: 'wh',
		  	editor: {
              xtype: 'combobox',
              	store: com_jr_wh_store,
                emptyText:'è¯·é€‰æ‹©',
                mode: 'remote',
                minChars : 2,
                valueField:'name',
                displayField:'name',
                triggerAction:'all',
                listConfig: { loadMask: false }
          	}
		  },
          { text : 'è´£ä»»è€…',  width : 150, sortable : true, dataIndex: 'zrz',
		  	editor: {
              xtype: 'combobox',
              store: com_jr_zrz_store,
              emptyText:'è¯·é€‰æ‹©',
              mode: 'remote',
              minChars : 2,
              valueField:'name',
              displayField:'name',
              triggerAction:'all',
              listConfig: { loadMask: false }
          	}
		  },
          { text : 'é¢˜å',  width : 150, sortable : true, dataIndex: 'name',	
			editor: {
              allowBlank: false
          	},
			flex: 1
		  },
          { text : 'æ—¥æœŸ',  width : 70, sortable : true, dataIndex: 'rq',renderer: Ext.util.Format.dateRenderer('Y-m-d'),
			
			editor: {
              xtype: 'datefield',
              format: 'y-m-d',
              //minValue: '2012-01-01',
              //disabledDays: [0, 6],
              //disabledDaysText: 'Plants are not available on the weekends'
          	}
		  },
		  { text : 'é¡µå·',  width : 150, sortable : true, dataIndex: 'yh',	
			editor: {
              allowBlank: false
          	},
			flex: 1
		  }
          ],
          //selType:'checkboxmodel',
          //multiSelect:true,
          selModel: {
            selType: 'cellmodel'
          },
        viewConfig: {
          stripeRows:true
        },
		plugins: [cellEditing]
      });	
	if (win==null) {
        win = new Ext.Window({
          id : 'jr_model_win',
          title: 'å·å†…æ¨¡æ¿æ–¹å¼è¾“å…¥',
          //closeAction: 'hide',
          width: 570,
          x : 300,
          y : 50,
          height: 500,
          minHeight: 500,
          layout: 'fit',
          modal: true,
          plain: true,
          items:jr_model_grid,          
          tbar:[{
            xtype: 'button',
            iconCls: 'save',
            text:'ç¡®å®šä¿å­˜',
            handler: function() {
				save_sql='';
				size=jr_model_grid.store.data.items.size();
				if (size>0){					
					for (i = 0; i < size; i++) {
						if (jr_model_grid.store.data.items[i].data.indoor==true)
						{
							if(jr_model_grid.store.data.items[i].data.rq!=null){
								year=(jr_model_grid.store.data.items[i].data.rq.getYear()+1900);
								month=jr_model_grid.store.data.items[i].data.rq.getMonth()+1;
								rq=year+'-'+month+'-'+jr_model_grid.store.data.items[i].data.rq.getDate();
							}else{
								rq=null;
							};
							if (save_sql==''){
								save_sql=jr_model_grid.store.data.items[i].data.wh+'@'+jr_model_grid.store.data.items[i].data.zrz+'@'+jr_model_grid.store.data.items[i].data.name+'@'+rq+'@'+jr_model_grid.store.data.items[i].data.yh								
							}else{
								save_sql=save_sql+'$'+jr_model_grid.store.data.items[i].data.wh+'@'+jr_model_grid.store.data.items[i].data.zrz+'@'+jr_model_grid.store.data.items[i].data.name+'@'+rq+'@'+jr_model_grid.store.data.items[i].data.yh
							}
						}
					}
					
				}
				if(save_sql!=''){
					new Ajax.Request("/desktop/insert_document_model", { 
						method: "POST",
						parameters: {dh:jr_dh,ownerid:jr_aj_ownerid,save_sql:save_sql,userid:currentUser.id},
						onComplete:	 function(request) {
							fhz=request.responseText.split(":");
							if (fhz[0]=='success'){
								alert("å·å†…æ–°å¢æˆåŠŸã€‚");
								if (aj_add_new==true){	
									Ext.getCmp('com_document_grid').store.proxy.extraParams.query=jr_aj_ownerid;								
									Ext.getCmp('com_document_grid').store.load();	
								}else
								{
									Ext.getCmp('document_grid').store.load();
								};
								Ext.getCmp('jr_model_win').close();											
							}else{
								if (fhz[0]=='false')
								{
									alert(fhz[1]);
								}else
								{
									alert("å·å†…æ–°å¢å¤±è´¥ï¼Œè¯·é‡æ–°ä¿å­˜ã€‚"+request.responseText);
								}
							}
						}
					});
				}else{
					alert("è¯·é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡æ¿åˆ—è¡¨ä¾¢è¿›è¡Œä¿å­˜ã€‚");
				}
				
            }
          },
          '<span style=" font-size:12px;font-weight:600;color:#3366FF;">å·å†…æ¨¡æ¿åç§°é€‰æ‹©</span>:&nbsp;&nbsp;',{
           xtype: 'combo',           
           x: 130,
           y: 190,
           width: 200,
           name: 'jr_model_select',
           id: 'jr_model_select',
           store: com_jr_tm_store,
           emptyText:'è¯·é€‰æ‹©',
           mode: 'local',
           minChars : 2,
           valueField:'id',
           displayField:'name',
           triggerAction:'all',
           listeners:{
             select:function(combo, records, index) {
               jr_model_store.proxy.extraParams.query=combo.lastValue;
               jr_model_store.load();
             }
           }
		  },
          {
            xtype: 'button',
            iconCls: 'exit',
            text:'é€€å‡º',
            handler: function() {
              //this.up('window').hide();
              Ext.getCmp('jr_model_win').close();
            }
          }]

        });
      }


      win.show();
};


//å›¾åƒæ˜¾ç¤ºçª—å£
var scale = 0.64;
var scaleMultiplier = 0.8;
var translatePos =  { x: 0,y: 0};
var imageObj = new Image();
var imagefx=1; //1ä»£è¡¨çºµå‘ï¼Œ2ä»£è¡¨æ¨ªå‘
var draw = function(scale, translatePos, imageObj){

 var canvas = document.getElementById('myCanvas');
 var context = canvas.getContext("2d");

 // clear canvas
 context.clearRect(0, 0, canvas.width, canvas.height);
 context.save();

 //context.translate(translatePos.x, translatePos.y);
 //context.scale(scale, scale);

 imageObj.onload = function(){
   //imgW = imageObj.width;
   //imgH = imageObj.height;
	imgW =600;	
	imgH=imgW*(imageObj.height/imageObj.width);
   context.drawImage(imageObj, translatePos.x , translatePos.y , imgW * scale, imgH * scale );
 };

 //imgW = imageObj.width;
 //imgH = imageObj.height;
	imgW =600;	
	imgH=imgW*(imageObj.height/imageObj.width);
 context.drawImage(imageObj, translatePos.x , translatePos.y , imgW * scale, imgH * scale );

 context.restore();
}

var draw_new = function(scale, translatePos, imageObj){

  var canvas = document.getElementById("myCanvas");
  var context = canvas.getContext("2d");

  // clear canvas
  context.clearRect(0, 0, canvas.width, canvas.height);
  context.save();

  var imgW = imageObj.width;
  var imgH = imageObj.height;

  //context.translate(translatePos.x + imgW/2, translatePos.y+imgH/2);
  //context.rotate(angle);
  context.scale(scale, scale);

  imageObj.onload = function(){
   var centerX = translatePos.x + canvas.width / 2;
   var centerY = translatePos.y + canvas.height / 2;
   imgW = imageObj.width;
   imgH = imageObj.height;
   context.drawImage(imageObj, centerX - imgW * scale/2.0, centerY - imgH * scale/2.0, imgW * scale, imgH * scale );
  };

  var centerX = translatePos.x + canvas.width / 2;
  var centerY = translatePos.y + canvas.height / 2;
  imgW = imageObj.width;
  imgH = imageObj.height;
  context.drawImage(imageObj, centerX - imgW * scale/2.0, centerY - imgH * scale/2.0, imgW * scale, imgH * scale );

  context.restore();
}


var show_image = function(dh,ip,lb) {
	var path='';
	var print_id=''
  	//var canvas_string =
    //'<div id="wrapper">'
    //+' <canvas id="myCanvas" width="600" height="800">'
    //+' </canvas>'
    //+'</div>';
	var canvas_string =
	    '<div id="wrapper" oncontextmenu="return false">'
	    +' <canvas id="myCanvas" width="600" height="800">'
	    +' </canvas>'
	    +'</div>';
    function getNodes(node,tf) {
      //éå†æ‰€æœ‰å­èŠ‚ç‚¹
      if (node.childNodes.size() == 0) return;
      node.eachChild(function(n){
        n.data.checked=tf;
        n.updateInfo({checked:tf});
        getNodes(n,tf);
      });
    };
    function get_NodesChecked(node) {
      if (node.childNodes.size() == 0) return;
      node.eachChild(function(n){
      	if (n.data.checked==true){
			if (n.data.id!="root1"){
				printid=n.data.id.split('|')
                if (print_id==""){
                  print_id= printid[0]
                }else{
                  print_id=print_id+ "," +printid[0]
                }
              };
              
			}
		get_NodesChecked(n);
      });


    };
    var yxtree_store = Ext.create('Ext.data.TreeStore', {
        autoLoad: true,
        proxy: {
            type: 'ajax',
            url: 'desktop/get_yx_tree',
            extraParams: {
              node:"root", dh:""
            },
            actionMethods: 'POST'
        }
    });

    var yxtreePanel = Ext.create('Ext.tree.Panel', {
      store: yxtree_store,
      id:'yx_show_tree',
      rootVisible: false,
      useArrows: true,
      singleExpand: true,
      autoScroll: true,
      //tbar:['->',
      //{
      //  xtype:'button',
      //  text:'åˆ·æ–°',
      //  tooltip:'åˆ·æ–°ç›®å½•',
      //  iconCls:'refresh',
      //  handler: function() {
      //    Ext.getCmp('yx_show_tree').store.load();
      //  }
      //}
      //],
      width: 200,
		listeners:{
          checkchange:function(node,checked,option){          
            if (checked){             
              getNodes(node,true);
              //get_parentNode(node);           
              }else{
              getNodes(node,false);
              }           
          }
        }
    });


    yxtreePanel.on("select",function(node){ 
      data = node.selected.items[0].data;  // data.id, data.parent, data.text, data.leaf
      ss=data.id.split('|');
	  if (ss[0]!='root1'){
      	var pars={ip:ip,gid:ss[0],userid:currentUser.id};
		if(lb=='1'){
			new Ajax.Request("/desktop/yun_get_timage_from_db", {
	        	method: "POST",
		        parameters: pars,
		        onComplete:  function(request) {
		          path = request.responseText;
		          if (path != '') { 
					if(lb=='1'){
						path="http://" + ip + ":3000/" +  path 
					};
					if (path.toUpperCase().include('JPG') || path.toUpperCase().include('TIF') || path.toUpperCase().include('JPEG') || path.toUpperCase().include('TIFF')) { 
						ifx=path.split('?');
						var number = Math.random(); 
						imagefx=ifx[1];
			            imageObj.src = path +'?' + number;
						//imageObj.src ="http://" + ip + ":3000/" +  path +'?' + number;
						scale=1;
						translatePos.x = 0;
					    translatePos.y = 0;
			            draw(scale, translatePos,imageObj);
					}else{				
						//location.href= path;
						window.open(path,'','height=500,width=800,top=150, left=100,scrollbars=yes,status=yes');
						imageObj.src = '';
			            draw(scale, translatePos,imageObj);
					}
		          }
		        }
	      	});
		}else{
	      new Ajax.Request("/desktop/get_timage_from_db", {
	        method: "POST",
	        parameters: pars,
	        onComplete:  function(request) {
	          path = request.responseText;
	          if (path != '') { 
				//set_image("/assets/dady/fm.jpg");
				if(lb=='1'){
					path="http://" + ip + ":3000/" +  path 
				};
				if (path.toUpperCase().include('JPG') || path.toUpperCase().include('TIF') || path.toUpperCase().include('JPEG') || path.toUpperCase().include('TIFF')) { 
					ifx=path.split('?');
					var number = Math.random(); 
					imagefx=ifx[1];
		            imageObj.src = path +'?' + number;
					//imageObj.src ="http://" + ip + ":3000/" +  path +'?' + number;
					scale=1;
					translatePos.x = 0;
				    translatePos.y = 0;
		            draw(scale, translatePos,imageObj);
				}else{				
					//location.href= path;
					window.open(path,'','height=500,width=800,top=150, left=100,scrollbars=yes,status=yes');
					imageObj.src = '';
		            draw(scale, translatePos,imageObj);
				}
	          }
	        }
	      });

		}
	  };
    });

  var yxxs_win = new Ext.Window({
    id : 'yxxs_win',
    iconCls : 'picture16',
    title: 'å½±åƒæµè§ˆ',
    floating: true,
    shadow: true,
    draggable: true,
    closable: true,
    //modal: true,
    width: 800,
    height: 600,
    layout: 'fit',
    plain: true,
    items: [{
    layout:"border",
    items:[{
      region:"center",
      title:"å›¾åƒ",
      tbar:[{
         text : 'æ”¾å¤§',
         iconCls:'zoomin',
         handler : function() {
           scale /= scaleMultiplier;
           draw(scale, translatePos, imageObj);
         }
       },{
         text : 'ç¼©å°',
         iconCls:'zoomout',
         handler : function() {
           scale *= scaleMultiplier;
           draw(scale, translatePos, imageObj);                  
         }
       },{
         text : 'ä¸Šä¸€é¡µ',
         iconCls:'up16',
         handler : function() {
            //var yxtree_store = Ext.getCmp('yx_show_tree').store;
            var yxtree_panel = Ext.getCmp('yx_show_tree');
            var node = yxtree_panel.selModel.selected.items[0];
            var prev_node = node.previousSibling;
            yxtree_panel.selModel.select(prev_node);
            
            //var record = tree.getRootNode().findChild('id_name','record_id',true);
            //tree.getSelectionModel().select(record);
            
         }
       },{
         text : 'ä¸‹ä¸€é¡µ',
         iconCls:'down16',
         handler : function() {
           var yxtree_panel = Ext.getCmp('yx_show_tree');
           var node = yxtree_panel.selModel.selected.items[0];
           var next_node = node.nextSibling;
           yxtree_panel.selModel.select(next_node);
         }
       },
		{
          text: 'æ‰“å°å›¾åƒ',
		  id:'image_print',
		ã€€ã€€iconCls:'print',
          handler : function() {
				new Ajax.Request("/desktop/get_users_sort_forqxdm", { 
			        method: "POST",
			        parameters: eval("({userid:" + currentUser.id + ",qxdm:'ip',qxlb:1,dh:'" + dh + "'})"),
			        onComplete:  function(request) {
			        	if (request.responseText=='success'){
							root=Ext.getCmp('yx_show_tree').store.getRootNode();
			                print_id="";
			                get_NodesChecked(root);
							if (print_id!=""){
								Ext.getCmp('image_print').setVisible(false);
								var pars={gid:print_id,userid:currentUser.id};
							    new Ajax.Request("/desktop/get_timage_from_db_print", {
							        method: "POST",
							        parameters: pars,
							        onComplete:  function(request) {
							          printfile = request.responseText;
							          if(printfile!=''){
										path=printfile.split(":");
										if (path[0] == 'success'){
											printfile=path[1].split(",");
										    for (k=0;k<printfile.length;k++){
												if (printfile[k]!=""){
													if (printfile[k].toUpperCase().include('JPG') || printfile[k].toUpperCase().include('TIF') || printfile[k].toUpperCase().include('JPEG') || printfile[k].toUpperCase().include('TIFF')) { 
														ifx=printfile[k].split('?');
														imagefx=ifx[1];
														LODOP=getLodop(document.getElementById('LODOP'),document.getElementById('LODOP_EM'));                        
												          //LODOP.ADD_PRINT_BARCODE(0,0,200,100,"Code39","*123ABC4567890*");
														var number = Math.random(); 
												        image_path = window.location.href + printfile[k] +'?' + number;				
												        LODOP.PRINT_INIT(image_path);				
													  	LODOP.SET_PRINT_PAGESIZE(imagefx,0,0,"A4");
												        LODOP.ADD_PRINT_IMAGE(0,0,1000,1410,"<img border='0' src='"+image_path+"' width='100%' height='100%'/>");
												        LODOP.SET_PRINT_STYLEA(0,"Stretch",2);//(å¯å˜å½¢)æ‰©å±•ç¼©æ”¾æ¨¡å¼
												        LODOP.SET_PRINT_MODE("PRINT_PAGE_PERCENT","Full-Page");				
												        //LODOP.PREVIEW();
												        LODOP.PRINT();
													}else{	
														window.open(path[1],'','height=500,width=800,top=150, left=100,scrollbars=yes,status=yes');
													}
												}
											};
											alert('æ‰“å°å®Œæˆã€‚');																						
											Ext.getCmp('image_print').setVisible(true);
										}else{
											alert(printfile);
										}
								      }
									}
								});					
							}
						}else{
				            alert('æ‚¨æ— æ­¤ç±»æ¡£æ¡ˆçš„æ‰“å°å½±åƒæ–‡ä»¶çš„æƒé™ã€‚');
				        }
					}
				});
				
				//alert(print_id);
		  //  if (path != '') {
          //  	LODOP=getLodop(document.getElementById('LODOP'),document.getElementById('LODOP_EM'));                        
	      //      //LODOP.ADD_PRINT_BARCODE(0,0,200,100,"Code39","*123ABC4567890*");
	      //      image_path = window.location.href + path;				
	      //      LODOP.PRINT_INIT(image_path);				
		  //  	LODOP.SET_PRINT_PAGESIZE(imagefx,0,0,"A4");
	      //      LODOP.ADD_PRINT_IMAGE(0,0,1000,1410,"<img border='0' src='"+image_path+"' width='100%' height='100%'/>");
	      //      LODOP.SET_PRINT_STYLEA(0,"Stretch",2);//(å¯å˜å½¢)æ‰©å±•ç¼©æ”¾æ¨¡å¼
	      //      LODOP.SET_PRINT_MODE("PRINT_PAGE_PERCENT","Full-Page");				
	      //      LODOP.PREVIEW();
	      //      //LODOP.PRINT();
		  //  }
          }
        },
		{
	          text: 'å½±åƒæ–‡ä»¶å¯¼å‡º',
			ã€€ã€€id:'image_dc',
			ã€€ã€€iconCls:'save',
	          handler : function() {
				new Ajax.Request("/desktop/get_users_sort_forqxdm", { 
			        method: "POST",
			        parameters: eval("({userid:" + currentUser.id + ",qxdm:'dc',qxlb:1,dh:'" + dh + "'})"),
			        onComplete:  function(request) {
			        	if (request.responseText=='success'){
							root=Ext.getCmp('yx_show_tree').store.getRootNode();
			                print_id="";
			                get_NodesChecked(root);
							if (print_id!=""){
								Ext.getCmp('image_dc').setVisible(false);
								var pars={gid:print_id,dylb:1,userid:currentUser.id};
							    new Ajax.Request("/desktop/get_timage_from_db_print", {
							        method: "POST",
							        parameters: pars,
							        onComplete:  function(request) {
							          printfile = request.responseText;
							          if (printfile != '') { 									
										path=printfile.split(",");
										if(path[0]=='success'){
									    	//for (k=1;k<path.length;k++){											
													if (path[1]!=""){			
														//location.href= path[k];
														window.open("/assets/" + path[1],'','height=500,width=800,top=150, left=100,scrollbars=yes,status=yes');
														imageObj.src = '';
											            draw(scale, translatePos,imageObj);
													}											
									          //};
											  alert('å¯¼å‡ºå®Œæˆã€‚');

											}
										}else{
											alert('å¯¼å‡ºå¤±è´¥ã€‚')
										}
										Ext.getCmp('image_dc').setVisible(true);
								     }
								  });

							}
						}else{
				            alert('æ‚¨æ— æ­¤ç±»æ¡£æ¡ˆçš„å½±åƒæ–‡ä»¶å¯¼å‡ºçš„æƒé™ã€‚');
				          }
				        }
				    });
			 }	          
	    }
		,
		{
	          text: 'é€€å‡º',
			ã€€ã€€iconCls:'exit',
	          handler : function() {
				Ext.getCmp('yxxs_win').close();
			 }	          
	    }
	  ],
      items:[{
          xtype: 'panel', //æˆ–è€…xtype: 'component',
		  layout:'fit',
          html:canvas_string
          }]
      
	   },{ 
        title:'å½±åƒåˆ—è¡¨',
        region:'west',
        iconCls:'wenshu16',
        xtype:'panel',
        //margins:'5 2 5 5',
        width: 200,
        collapsible:true,//å¯ä»¥è¢«æŠ˜å 
        id:'yxtree-panel',
        layout:'fit',
        split:true,
        items:[yxtreePanel]
      }]
    }]
  });
	new Ajax.Request("/desktop/get_users_sort_forqxdm", { 
        method: "POST",
        parameters: eval("({userid:" + currentUser.id + ",qxdm:'i',qxlb:1,dh:'" + dh + "'})"),
        onComplete:  function(request) {
          if (request.responseText=='success'){
			if(lb=='1'){
				var yxtree_store = Ext.getCmp('yx_show_tree').store;
			    yxtree_store.clearOnLoad = false;
			    yxtree_store.getRootNode().removeAll() ;
			    yxtree_store.proxy.extraParams = {ip:ip,node:"root", dh:dh};
				yxtree_store.proxy.url="desktop/yun_get_yx_tree"
			}else{							
            	var yxtree_store = Ext.getCmp('yx_show_tree').store;
			    yxtree_store.clearOnLoad = false;
			    yxtree_store.getRootNode().removeAll() ;
			    yxtree_store.proxy.extraParams = {node:"root", dh:dh};
			}
		    yxtree_store.load();
		  	yxxs_win.show();
			set_image("/assets/dady/fm.jpg");
          }else{
            alert('æ‚¨æ— æ­¤ç±»æ¡£æ¡ˆçš„æŸ¥çœ‹å½±åƒæ–‡ä»¶çš„æƒé™ã€‚');
            Ext.getCmp('yxxs_win').close();
          }
        }
    });
	

}

var set_image = function(photoURL) {
 var canvas = document.getElementById('myCanvas');
 var context = canvas.getContext("2d");
 var startDragOffset = {};
 var mouseDown = false;

 //scale = 1.0;
 translatePos =  { x: 0,y: 0};
 imageObj.src = photoURL;
//imageObj.src = "http://127.0.0.1:3000/" + photoURL;

 // add event listeners to handle screen drag
 canvas.addEventListener("mousedown", function(evt){
   mouseDown = true;
   startDragOffset.x = evt.clientX - translatePos.x;
   startDragOffset.y = evt.clientY - translatePos.y;
 });

 canvas.addEventListener("mouseup", function(evt){
   mouseDown = false;
 });

 canvas.addEventListener("mouseover", function(evt){
   mouseDown = false;
 });

 canvas.addEventListener("mouseout", function(evt){
   mouseDown = false;
 });

 canvas.addEventListener("mousemove", function(evt){
   if (mouseDown) {
     translatePos.x = evt.clientX - startDragOffset.x;
     translatePos.y = evt.clientY - startDragOffset.y;
     draw(scale, translatePos, imageObj);
   }
 });

 draw(scale, translatePos,imageObj);
};


//add by liujun showAdvancedSearch()
var showAdvancedSearch = function(fields,grid,dh,doc_dagl,jr,rz) {
    
    var panel = new Ext.Panel({  
      title : 'é«˜çº§æŸ¥è¯¢',  
      width : '280px',  
      html : '<div id="div1" style="height:160px;padding:5px">åŸæ–‡æœ¬</div>'  
    });

	var select='';
    var field=fields.split(',');
	for (i = 0; i < field.length; i++) {
		fiel=field[i].split(';')
		select=select + '<option value="' + fiel[1] + '">' + fiel[0] + "</option>"
	};
    //Ext.DomHelper.append(Ext.get("div1"),"<br>æ–°è¿½åŠ äº†æ–‡æœ¬",true);
    var advanced_search_win = new Ext.Window({
      id : 'advanced-search-win',
      iconCls : 'picture16',
      title: 'æŸ¥è¯¢æ¡ä»¶',
      floating: true,
      shadow: true,
      draggable: true,
      closable: true,
      modal: true,
      width: 410,
      height: 300,
      layout: 'fit',
      plain: true,
      tbar:[{
        text : 'å¢åŠ ',
        iconCls:'add',
        handler : function() {
          Ext.DomHelper.append(Ext.get("adv-search"),
            '<div style="height:30px;padding:10px;"><select>' + select + '</select><select><option value="=">ç­‰äº</option><option value=">">å¤§äº</option><option value="<">å°äº</option><option value="like">åŒ…å«</option></select><input class="search_text"  name="query" style="margin-left: 10px;width: 200px;" type="text"><div>',true);
        }
      },'->',{
        text : 'æäº¤',
        iconCls:'search',
        handler : function(){
          	var cxtj='';
			for (i = 0; i < Ext.get("adv-search").dom.childNodes.length; i++) {
				if (Ext.get("adv-search").dom.childNodes[i].childNodes[2].getValue()!=''){
					value=Ext.get("adv-search").dom.childNodes[i].childNodes[0].getValue();
					value1=Ext.get("adv-search").dom.childNodes[i].childNodes[1].getValue();
					value2=Ext.get("adv-search").dom.childNodes[i].childNodes[2].getValue();
					if(cxtj!=''){
						cxtj=cxtj+","+value+":'"+value+"$"+value1+"$"+value2+"'";
					}else{
						cxtj=value+":'"+value+"$"+value1+"$"+value2+"'";
					}
				}
			};
			if (cxtj!='')
			{
				docglcx=1;
				//cxtj='({' + cxtj +",dh:'"+ dh+ "'" + ',page:1,start:0,docglcx:1})';
				//Ext.getCmp(grid).initialConfig.bbar[0].moveFirst()
				cxtj='({' + cxtj +",dh:'"+ dh+ "'" +  '})';
				if (doc_dagl==true){
					Ext.getCmp(grid).store.proxy.url="/desktop/doc_dagl_query";
					Ext.getCmp(grid).store.proxy.extraParams=eval(cxtj);		
					Ext.getCmp(grid).store.load();
					Ext.getCmp('advanced-search-win').close();
				}else{
					if(jr==true){						
						Ext.getCmp(grid).store.proxy.url="/desktop/document_query_sd";
						Ext.getCmp(grid).store.proxy.extraParams=eval(cxtj);		
						Ext.getCmp(grid).store.load();
						Ext.getCmp('advanced-search-win').close();
					}else{
						if(rz==true){
							Ext.getCmp(grid).store.proxy.url="/desktop/get_rz_manage_grid";
							Ext.getCmp(grid).store.proxy.extraParams=eval(cxtj);		
							Ext.getCmp(grid).store.load();
							Ext.getCmp('advanced-search-win').close();
						}
						else{
							Ext.getCmp(grid).store.proxy.url="/desktop/archive_query_sd";
							Ext.getCmp(grid).store.proxy.extraParams=eval(cxtj);		
							Ext.getCmp(grid).store.load();
							Ext.getCmp('advanced-search-win').close();
						}
					}
				}
				docglcx=0;
			}else
			{
				alert("è¯·è¾“å…¥æŸ¥è¯¢æ¡ä»¶å†è¿›è¡Œæäº¤ã€‚")
			}
			 
        }
      },
	  {
        text : 'é€€å‡º',
        iconCls:'exit',
        handler : function() {
        	Ext.getCmp('advanced-search-win').close();
		}
      }],
      items:[{
         xtype: 'panel', //æˆ–è€…xtype: 'component',
         html:'<div id="adv-search" style="height:50px;padding:5px"><div style="height:30px;padding:10px;" ><select>' + select + '</select><select><option value="=">ç­‰äº</option><option value=">">å¤§äº</option><option value="<">å°äº</option><option value="like">åŒ…å«</option></select><input class="search_text"  name="query" style="margin-left: 10px;width: 200px;" type="text"></div></div>'
      }]
    });
    advanced_search_win.show();
};

//è®¾å¤‡æ­£åœ¨æ“ä½œçª—å£
var sb_cz_msg = function(sbid){
	var win = Ext.getCmp('sb_cz_msg_win');
	if (win==null) {
		loopable=false;
		i =0;
		sb_name='';
		czdz=['æ­£åœ¨æ“ä½œ','å®Œæˆæ“ä½œ'];
		sbname=[];
		strdisp='';
		//sb_id=sbid.split(';');
		new Ajax.Request("/desktop/get_sb_zt", { 
			method: "POST",
			parameters: {sbid:sbid},
			onComplete:	 function(request) {
				text=request.responseText.split(':');
				if (text[0]=='success'){
					alert("è®¾å¤‡æ“ä½œæˆåŠŸã€‚");
																
				}else{
					if (text[0]=='false'){
						loopCheck(text[1],true);
					}
				}
				
				
				
			}
		});
		function loopCheck(sb,lp) {
		  if (lp) {
			loopable=true;	
		   //if (i=='0'){	
		   //	if (sb_name==''){
		   //		sb_name=sb['sbmc']
		   //	}else{
		   //		sb_name= sb['sbmc'] +','+sb_name 
		   //	}
		   //	sbname=sb_name.split(',');
		   //	strdisp='';
		   //	for (x=0;x<sbname.length;x++){
		   //		if (x=='0'){						
		   //			strdisp=strdisp + '<p>' + sbname[x] + '......' + czdz[0] + '</p>' 
		   //		}else{
		   //			strdisp=strdisp + '<p>' + sbname[x] + '......' + czdz[1] + '</p>' 
		   //		}						
		   //	}
				Ext.getCmp('zzcz_disp').getEl().dom.innerHTML = Ext.getCmp('zzcz_disp').initialConfig.html + sb;
			//};									
			if (i>3){
					Ext.getCmp('sb_cz_msg_win').close();	
			}else{				
				i = i +1;		            
	            sf = 0;
	            td = 1*1000 ; //60s 
	            var f = function() { loopCheck(sb,loopable); };
	            var t = setTimeout(f,td);				
			};            
          }
        };
		
		win = new Ext.Window({
			id : 'sb_cz_msg_win',
			title: 'è®¾å¤‡æ­£åœ¨æ“ä½œçª—å£',
			//closeAction: 'hide',
			width: 270,
			height: 200,
			layout: 'fit',
			modal: true,
			plain: true,
			items:[{	//title:'æƒ…æ™¯æ¨¡å¼æ ‘',
				//region:'west',
				//iconCls:'users',
				xtype:'panel',
				margins:'0 0 0 0',
				width: 200,
				//collapsible:true,//å¯ä»¥è¢«æŠ˜å 							
				layout:'fit',
				autoscroll:true,
				split:true,
				items:[{
					xtype: 'box',
					autoscroll:true,
					html:"<img src='/assets/zzcz.gif' />",
					x:10,
					y:10,
					width: 8,
					height:8,
					id:'zzcz_disp'
				}]

			}]
		})
	}


	win.show();
	
};

//æ­£åœ¨æ“ä½œçª—å£
var cz_msg = function(czid){
	var win = Ext.getCmp('cz_msg_win');
	if (win==null) {
		loopable=false;
		i =0;
		sb_name='';
		czdz=['æ­£åœ¨æ“ä½œ','å®Œæˆæ“ä½œ'];
		sbname=[];
		strdisp='';
		//sb_id=sbid.split(';');
		new Ajax.Request("/desktop/get_cz_zt", { 
			method: "POST",
			parameters: {czid:czid},
			onComplete:	 function(request) {
				text=request.responseText.split(':');
				if (text[0]=='success'){
					if (text[1]=='success'){
						window.open(text[2],'','height=500,width=800,top=150, left=100,scrollbars=yes,status=yes');
					}else{
						alert(text[2])
					}
					Ext.getCmp('cz_msg_win').close();											
				}else{
					loopCheck(text[1],true);
				}				
			}
		});
	
		function loopCheck(sb,lp) {
			loopable=false;
				//Ext.getCmp('cz_disp').getEl().dom.innerHTML = Ext.getCmp('cz_disp').initialConfig.html + sb;
			Ext.getCmp('cz_disp').getEl().dom.innerHTML =  "æ­£åœ¨æ“ä½œï¼Œè¯·ç¨ç­‰ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚";
			new Ajax.Request("/desktop/get_cz_zt", { 
				method: "POST",
				parameters: {czid:czid},
				onComplete:	 function(request) {
					text=request.responseText.split(':');
					if (text[0]=='success'){
						if (text[1]=='success'){
							window.open(text[2],'','height=500,width=800,top=150, left=100,scrollbars=yes,status=yes');
						}else{
							alert(text[2])
						}
						Ext.getCmp('cz_msg_win').close();
					}else{
						loopable=false;
						if (loopable==false){
								sf = 0;
					            td = 3*1000 ; //60s 
					            var f = function() { loopCheck(sb,loopable); };
					            var t = setTimeout(f,td);
						};
					}
				}
			});	
											
          	
				
          
        };
		
		win = new Ext.Window({
			id : 'cz_msg_win',
			title: 'æ­£åœ¨æ“ä½œ',
			//closeAction: 'hide',
			width: 270,
			height: 200,
			layout: 'fit',
			//modal: true,
			plain: true,
			items:[{	//title:'æƒ…æ™¯æ¨¡å¼æ ‘',
				//region:'west',
				//iconCls:'users',
				xtype:'panel',
				margins:'0 0 0 0',
				width: 200,
				//collapsible:true,//å¯ä»¥è¢«æŠ˜å 							
				layout:'fit',
				autoscroll:true,
				split:true,
				items:[{
					xtype: 'box',
					autoscroll:true,
					html:"<img src='/assets/zzcz.gif' />",
					x:10,
					y:10,
					width: 8,
					height:8,
					id:'cz_disp'
				}]

			}]
		})
	
	}
	
	win.show();
	
};

var yun_cz_msg = function(czid){
	var win = Ext.getCmp('yun_cz_msg_win');
	if (win==null) {
		loopable=false;
		i =0;
		sb_name='';
		czdz=['æ­£åœ¨æ“ä½œ','å®Œæˆæ“ä½œ'];
		sbname=[];
		strdisp='';
		//sb_id=sbid.split(';');
		new Ajax.Request("/desktop/yun_get_cz_zt", { 
			method: "POST",
			parameters: {czid:czid},
			onComplete:	 function(request) {
				text=request.responseText.split(':');
				if (text[0]=='success'){				
					Ext.getCmp('yun_cz_msg_win').close();											
				}else{
					loopCheck(text[1],true);
				}				
			}
		});
	
		function loopCheck(sb,lp) {
			loopable=false;
				//Ext.getCmp('cz_disp').getEl().dom.innerHTML = Ext.getCmp('cz_disp').initialConfig.html + sb;
			Ext.getCmp('cz_disp').getEl().dom.innerHTML =  "æ­£åœ¨æŸ¥è¯¢ï¼Œè¯·ç¨ç­‰ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚";
			new Ajax.Request("/desktop/yun_get_cz_zt", { 
				method: "POST",
				parameters: {czid:czid},
				onComplete:	 function(request) {
					text=request.responseText.split(':');
					if (text[0]=='success'){						
						Ext.getCmp('yun_cz_msg_win').close();
					}else{
						loopable=false;
						if (loopable==false){
								sf = 0;
					            td = 3*1000 ; //60s 
					            var f = function() { loopCheck(sb,loopable); };
					            var t = setTimeout(f,td);
						};
					}
				}
			});
        };
		
		win = new Ext.Window({
			id : 'yun_cz_msg_win',
			title: 'æ­£åœ¨æŸ¥è¯¢',
			//closeAction: 'hide',
			width: 270,
			height: 100,
			layout: 'fit',
			//modal: true,
			plain: true,
			items:[{	//title:'æƒ…æ™¯æ¨¡å¼æ ‘',
				//region:'west',
				//iconCls:'users',
				xtype:'panel',
				margins:'0 0 0 0',
				width: 200,
				//collapsible:true,//å¯ä»¥è¢«æŠ˜å 							
				layout:'fit',
				autoscroll:true,
				split:true,
				items:[{
					xtype: 'box',
					autoscroll:true,
					html:"<img src='/assets/zzcz.gif' />",
					x:10,
					y:10,
					width: 8,
					height:8,
					id:'cz_disp'
				}]

			}]
		})
	
	}
	
	win.show();
	
};

"digest"%b340be5719dffccb486de4aa3d6185f8:@created_atf1382268051.313714 ä:@compressedF